<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Sizer on Backtrader 中文</title><link>https://www.poloxue.com/backtrader/docs/14-sizers/</link><description>Recent content in Sizer on Backtrader 中文</description><generator>Hugo</generator><language>zh-cn</language><atom:link href="https://www.poloxue.com/backtrader/docs/14-sizers/index.xml" rel="self" type="application/rss+xml"/><item><title>sizers</title><link>https://www.poloxue.com/backtrader/docs/14-sizers/01-sizers/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://www.poloxue.com/backtrader/docs/14-sizers/01-sizers/</guid><description>&lt;h1 id="sizers"&gt;Sizers&lt;a class="anchor" href="#sizers"&gt;#&lt;/a&gt;&lt;/h1&gt;
&lt;p&gt;策略提供交易方法，即：&lt;code&gt;buy&lt;/code&gt;、&lt;code&gt;sell&lt;/code&gt; 和 &lt;code&gt;close&lt;/code&gt;。让我们看看 &lt;code&gt;buy&lt;/code&gt; 的签名：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-python" data-lang="python"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;def&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;buy&lt;/span&gt;(self, data&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#66d9ef"&gt;None&lt;/span&gt;, size&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#66d9ef"&gt;None&lt;/span&gt;, price&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#66d9ef"&gt;None&lt;/span&gt;, plimit&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#66d9ef"&gt;None&lt;/span&gt;, exectype&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#66d9ef"&gt;None&lt;/span&gt;, valid&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#66d9ef"&gt;None&lt;/span&gt;, tradeid&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;0&lt;/span&gt;, &lt;span style="color:#f92672"&gt;**&lt;/span&gt;kwargs):&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;注意，如果调用者没有指定 &lt;code&gt;size&lt;/code&gt;，则 &lt;code&gt;size&lt;/code&gt; 的默认值为 &lt;code&gt;None&lt;/code&gt;。这就是 Sizers 发挥重要作用的地方：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;size=None&lt;/code&gt; 请求策略向其 Sizer 询问实际的头寸大小&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;这显然意味着策略有一个 Sizer：是的，确实如此！如果用户没有添加 Sizer，后台机制会为策略添加一个默认的 Sizer。添加到策略中的默认 Sizer 是 &lt;code&gt;SizerFix&lt;/code&gt;。定义的初始行：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-python" data-lang="python"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;class&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;SizerFix&lt;/span&gt;(SizerBase):
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; params &lt;span style="color:#f92672"&gt;=&lt;/span&gt; ((&lt;span style="color:#e6db74"&gt;&amp;#39;stake&amp;#39;&lt;/span&gt;, &lt;span style="color:#ae81ff"&gt;1&lt;/span&gt;),)&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;很容易猜到这个 Sizer 只是使用 1 个单位（无论是股票、合约等）买卖。&lt;/p&gt;
&lt;h2 id="使用-sizers"&gt;使用 Sizers&lt;a class="anchor" href="#%e4%bd%bf%e7%94%a8-sizers"&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;h3 id="从-cerebro"&gt;从 Cerebro&lt;a class="anchor" href="#%e4%bb%8e-cerebro"&gt;#&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;Sizers 可以通过 Cerebro 以两种不同的方法添加：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;addsizer(sizercls, *args, **kwargs)&lt;/code&gt;：添加一个 Sizer，将应用于添加到 cerebro 的任何策略。这就是所谓的默认 Sizer。例如：&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-python" data-lang="python"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;cerebro &lt;span style="color:#f92672"&gt;=&lt;/span&gt; bt&lt;span style="color:#f92672"&gt;.&lt;/span&gt;Cerebro()
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;cerebro&lt;span style="color:#f92672"&gt;.&lt;/span&gt;addsizer(bt&lt;span style="color:#f92672"&gt;.&lt;/span&gt;sizers&lt;span style="color:#f92672"&gt;.&lt;/span&gt;SizerFix, stake&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;20&lt;/span&gt;) &lt;span style="color:#75715e"&gt;# 默认策略的 Sizer&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;&lt;code&gt;addsizer_byidx(idx, sizercls, *args, **kwargs)&lt;/code&gt;：只将 Sizer 添加到 &lt;code&gt;idx&lt;/code&gt; 引用的策略中。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;这个 &lt;code&gt;idx&lt;/code&gt; 可以作为 &lt;code&gt;addstrategy&lt;/code&gt; 的返回值获得。例如：&lt;/p&gt;</description></item><item><title>参考</title><link>https://www.poloxue.com/backtrader/docs/14-sizers/02-reference/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://www.poloxue.com/backtrader/docs/14-sizers/02-reference/</guid><description>&lt;h1 id="参考"&gt;参考&lt;a class="anchor" href="#%e5%8f%82%e8%80%83"&gt;#&lt;/a&gt;&lt;/h1&gt;
&lt;h2 id="fixedsize"&gt;FixedSize&lt;a class="anchor" href="#fixedsize"&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-python" data-lang="python"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;class&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;backtrader&lt;/span&gt;&lt;span style="color:#f92672"&gt;.&lt;/span&gt;sizers&lt;span style="color:#f92672"&gt;.&lt;/span&gt;FixedSize()&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;此 Sizer 仅为任何操作返回固定大小。通过指定 &lt;code&gt;tranches&lt;/code&gt; 参数，可以控制系统希望用于逐步进入交易的批次数量。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;参数：&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;stake&lt;/code&gt;（默认：&lt;code&gt;1&lt;/code&gt;）&lt;/li&gt;
&lt;li&gt;&lt;code&gt;tranches&lt;/code&gt;（默认：&lt;code&gt;1&lt;/code&gt;）&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="fixedreverser"&gt;FixedReverser&lt;a class="anchor" href="#fixedreverser"&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-python" data-lang="python"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;class&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;backtrader&lt;/span&gt;&lt;span style="color:#f92672"&gt;.&lt;/span&gt;sizers&lt;span style="color:#f92672"&gt;.&lt;/span&gt;FixedReverser()&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;此 Sizer 返回反转已开头寸所需的固定大小或开仓所需的固定大小。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;开仓：返回参数 &lt;code&gt;stake&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;反转头寸：返回 &lt;code&gt;2 * stake&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;参数：&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;stake&lt;/code&gt;（默认：&lt;code&gt;1&lt;/code&gt;）&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="percentsizer"&gt;PercentSizer&lt;a class="anchor" href="#percentsizer"&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-python" data-lang="python"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;class&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;backtrader&lt;/span&gt;&lt;span style="color:#f92672"&gt;.&lt;/span&gt;sizers&lt;span style="color:#f92672"&gt;.&lt;/span&gt;PercentSizer()&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;此 Sizer 返回可用现金的百分比。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;参数：&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;percents&lt;/code&gt;（默认：&lt;code&gt;20&lt;/code&gt;）&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="allinsizer"&gt;AllInSizer&lt;a class="anchor" href="#allinsizer"&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-python" data-lang="python"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;class&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;backtrader&lt;/span&gt;&lt;span style="color:#f92672"&gt;.&lt;/span&gt;sizers&lt;span style="color:#f92672"&gt;.&lt;/span&gt;AllInSizer()&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;此 Sizer 返回经纪人所有可用现金。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;参数：&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;percents&lt;/code&gt;（默认：&lt;code&gt;100&lt;/code&gt;）&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="percentsizerint"&gt;PercentSizerInt&lt;a class="anchor" href="#percentsizerint"&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-python" data-lang="python"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;class&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;backtrader&lt;/span&gt;&lt;span style="color:#f92672"&gt;.&lt;/span&gt;sizers&lt;span style="color:#f92672"&gt;.&lt;/span&gt;PercentSizerInt()&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;此 Sizer 以整数形式返回可用现金的百分比，并将大小截断为整数。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;参数：&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;percents&lt;/code&gt;（默认：&lt;code&gt;20&lt;/code&gt;）&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="allinsizerint"&gt;AllInSizerInt&lt;a class="anchor" href="#allinsizerint"&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-python" data-lang="python"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;class&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;backtrader&lt;/span&gt;&lt;span style="color:#f92672"&gt;.&lt;/span&gt;sizers&lt;span style="color:#f92672"&gt;.&lt;/span&gt;AllInSizerInt()&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;此 Sizer 返回经纪人所有可用现金，并将大小截断为整数。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;参数：&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;percents&lt;/code&gt;（默认：&lt;code&gt;100&lt;/code&gt;）&lt;/li&gt;
&lt;/ul&gt;</description></item></channel></rss>