<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Commission on Backtrader 中文</title><link>https://www.poloxue.com/backtrader/docs/11-commission-schemes/</link><description>Recent content in Commission on Backtrader 中文</description><generator>Hugo</generator><language>zh-cn</language><atom:link href="https://www.poloxue.com/backtrader/docs/11-commission-schemes/index.xml" rel="self" type="application/rss+xml"/><item><title>佣金</title><link>https://www.poloxue.com/backtrader/docs/11-commission-schemes/01-commission-schemes/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://www.poloxue.com/backtrader/docs/11-commission-schemes/01-commission-schemes/</guid><description>&lt;h1 id="佣金"&gt;佣金&lt;a class="anchor" href="#%e4%bd%a3%e9%87%91"&gt;#&lt;/a&gt;&lt;/h1&gt;
&lt;h2 id="中立性"&gt;中立性&lt;a class="anchor" href="#%e4%b8%ad%e7%ab%8b%e6%80%a7"&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;在开始之前，让我们记住 backtrader 尝试保持数据代表内容的中立性。不同的佣金方案可以应用于相同的数据集。让我们看看如何做到这一点。&lt;/p&gt;
&lt;h2 id="经纪商快捷方式"&gt;经纪商快捷方式&lt;a class="anchor" href="#%e7%bb%8f%e7%ba%aa%e5%95%86%e5%bf%ab%e6%8d%b7%e6%96%b9%e5%bc%8f"&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;这使得最终用户远离 CommissionInfo 对象，因为可以通过一次函数调用创建/设置佣金方案。在常规的 cerebro 创建/设置过程中，只需在经纪商成员属性上添加一个调用 setcommission 的调用即可。&lt;/p&gt;
&lt;p&gt;以下调用设置了使用 Interactive Brokers 操作 Eurostoxx50 期货的常规佣金方案：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-python" data-lang="python"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;cerebro&lt;span style="color:#f92672"&gt;.&lt;/span&gt;broker&lt;span style="color:#f92672"&gt;.&lt;/span&gt;setcommission(commission&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;2.0&lt;/span&gt;, margin&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;2000.0&lt;/span&gt;, mult&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;10.0&lt;/span&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;由于大多数用户通常只测试单一工具，这已经足够。&lt;/p&gt;
&lt;p&gt;如果你为你的数据馈送命名，因为在图表上同时考虑了多个工具，这个调用可以稍微扩展如下：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-python" data-lang="python"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;cerebro&lt;span style="color:#f92672"&gt;.&lt;/span&gt;broker&lt;span style="color:#f92672"&gt;.&lt;/span&gt;setcommission(commission&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;2.0&lt;/span&gt;, margin&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;2000.0&lt;/span&gt;, mult&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;10.0&lt;/span&gt;, name&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#39;Eurostoxxx50&amp;#39;&lt;/span&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;在这种情况下，此即时佣金方案将仅应用于名称匹配 Eurostoxx50 的工具。&lt;/p&gt;
&lt;h2 id="setcommission-参数的含义"&gt;setcommission 参数的含义&lt;a class="anchor" href="#setcommission-%e5%8f%82%e6%95%b0%e7%9a%84%e5%90%ab%e4%b9%89"&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;commission&lt;/code&gt;（默认值：0.0）&lt;/p&gt;
&lt;p&gt;每次操作的货币单位，绝对值或百分比。在上述示例中，每份合约的买入和卖出费用分别为 2.0 欧元。
重要的是何时使用绝对值或百分比值。&lt;/p&gt;
&lt;p&gt;如果 margin 为 False（例如，它是 False、0 或 None），则将视为佣金表示为价格乘以操作数量的百分比。&lt;/p&gt;
&lt;p&gt;如果 margin 是其他值，则视为操作发生在类似期货的工具上，佣金是每张合约的固定价格。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;margin&lt;/code&gt;（默认值：None）&lt;/p&gt;
&lt;p&gt;操作期货类工具时需要的保证金。如上所述：&lt;/p&gt;
&lt;p&gt;如果没有设置 margin，则佣金将被视为百分比，并应用于买卖操作的价格 * 数量。&lt;/p&gt;
&lt;p&gt;如果设置了 margin，则佣金将被视为固定值，并乘以买卖操作的数量。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;mult&lt;/code&gt;（默认值：1.0）&lt;/p&gt;
&lt;p&gt;对于期货类工具，这决定了应用于损益计算的乘数。这使得期货同时具有吸引力和风险。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;name&lt;/code&gt;（默认值：None）&lt;/p&gt;
&lt;p&gt;将佣金方案应用于名称匹配的工具。可以在创建数据馈送时设置此值。如果未设置，则方案将适用于系统中的任何数据。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="两个示例股票-vs-期货"&gt;两个示例：股票 vs 期货&lt;a class="anchor" href="#%e4%b8%a4%e4%b8%aa%e7%a4%ba%e4%be%8b%e8%82%a1%e7%a5%a8-vs-%e6%9c%9f%e8%b4%a7"&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;期货的示例：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-python" data-lang="python"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;cerebro&lt;span style="color:#f92672"&gt;.&lt;/span&gt;broker&lt;span style="color:#f92672"&gt;.&lt;/span&gt;setcommission(commission&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;2.0&lt;/span&gt;, margin&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;2000.0&lt;/span&gt;, mult&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;10.0&lt;/span&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;股票的示例：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-python" data-lang="python"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;cerebro&lt;span style="color:#f92672"&gt;.&lt;/span&gt;broker&lt;span style="color:#f92672"&gt;.&lt;/span&gt;setcommission(commission&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;0.005&lt;/span&gt;) &lt;span style="color:#75715e"&gt;# 交易金额的 0.5%&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;注意&lt;/p&gt;
&lt;p&gt;第二种语法不设置 margin 和 mult，backtrader 试图通过将佣金视为百分比来进行智能处理。&lt;/p&gt;</description></item><item><title>扩展</title><link>https://www.poloxue.com/backtrader/docs/11-commission-schemes/02-commission-schemes-extending/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://www.poloxue.com/backtrader/docs/11-commission-schemes/02-commission-schemes-extending/</guid><description>&lt;h1 id="扩展佣金"&gt;扩展佣金&lt;a class="anchor" href="#%e6%89%a9%e5%b1%95%e4%bd%a3%e9%87%91"&gt;#&lt;/a&gt;&lt;/h1&gt;
&lt;p&gt;佣金及相关功能由一个单一的类 &lt;code&gt;CommissionInfo&lt;/code&gt; 管理，通常通过调用 &lt;code&gt;broker.setcommission&lt;/code&gt; 实例化。&lt;/p&gt;
&lt;p&gt;这个概念限于带有保证金和每合同固定佣金的期货和基于价格/数量百分比佣金的股票。这不是最灵活的方案，但它已经发挥了它的作用。&lt;/p&gt;
&lt;p&gt;GitHub 上的一个增强请求（#29）导致了一些重构，以便：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;保持 &lt;code&gt;CommissionInfo&lt;/code&gt; 和 &lt;code&gt;broker.setcommission&lt;/code&gt; 与原始行为兼容&lt;/li&gt;
&lt;li&gt;对代码进行一些清理&lt;/li&gt;
&lt;li&gt;使佣金方案灵活，以支持增强请求和进一步的可能性&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;在进入示例之前的实际工作：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-python" data-lang="python"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;class&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;CommInfoBase&lt;/span&gt;(with_metaclass(MetaParams)):
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; COMM_PERC, COMM_FIXED &lt;span style="color:#f92672"&gt;=&lt;/span&gt; range(&lt;span style="color:#ae81ff"&gt;2&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; params &lt;span style="color:#f92672"&gt;=&lt;/span&gt; (
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; (&lt;span style="color:#e6db74"&gt;&amp;#39;commission&amp;#39;&lt;/span&gt;, &lt;span style="color:#ae81ff"&gt;0.0&lt;/span&gt;), (&lt;span style="color:#e6db74"&gt;&amp;#39;mult&amp;#39;&lt;/span&gt;, &lt;span style="color:#ae81ff"&gt;1.0&lt;/span&gt;), (&lt;span style="color:#e6db74"&gt;&amp;#39;margin&amp;#39;&lt;/span&gt;, &lt;span style="color:#66d9ef"&gt;None&lt;/span&gt;),
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; (&lt;span style="color:#e6db74"&gt;&amp;#39;commtype&amp;#39;&lt;/span&gt;, &lt;span style="color:#66d9ef"&gt;None&lt;/span&gt;),
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; (&lt;span style="color:#e6db74"&gt;&amp;#39;stocklike&amp;#39;&lt;/span&gt;, &lt;span style="color:#66d9ef"&gt;False&lt;/span&gt;),
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; (&lt;span style="color:#e6db74"&gt;&amp;#39;percabs&amp;#39;&lt;/span&gt;, &lt;span style="color:#66d9ef"&gt;False&lt;/span&gt;),
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; )&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;引入了一个 &lt;code&gt;CommissionInfo&lt;/code&gt; 的基类，该类添加了新的参数：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;commtype&lt;/code&gt;（默认值：None）&lt;/p&gt;
&lt;p&gt;这是兼容性的关键。如果值为 None，&lt;code&gt;CommissionInfo&lt;/code&gt; 对象和 &lt;code&gt;broker.setcommission&lt;/code&gt; 的行为将与以前相同。具体如下：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;如果设置了 &lt;code&gt;margin&lt;/code&gt;，则佣金方案是期货，每合同有固定佣金&lt;/li&gt;
&lt;li&gt;如果未设置 &lt;code&gt;margin&lt;/code&gt;，则佣金方案是股票，采用百分比方法&lt;/li&gt;
&lt;li&gt;如果值是 &lt;code&gt;COMM_PERC&lt;/code&gt; 或 &lt;code&gt;COMM_FIXED&lt;/code&gt;（或派生类中的任何其他值），则显然决定了佣金是固定的还是基于百分比的&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;stocklike&lt;/code&gt;（默认值：False）&lt;/p&gt;
&lt;p&gt;如上所述，旧 &lt;code&gt;CommissionInfo&lt;/code&gt; 对象中的实际行为由 &lt;code&gt;margin&lt;/code&gt; 参数决定。&lt;/p&gt;
&lt;p&gt;如果 &lt;code&gt;commtype&lt;/code&gt; 设置为其他值，则此值指示资产是类似期货的资产（将使用保证金并进行基于条形图的现金调整）还是类似股票的资产。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;percabs&lt;/code&gt;（默认值：False）&lt;/p&gt;
&lt;p&gt;如果为 False，则百分比必须以相对术语传递（xx%）&lt;/p&gt;
&lt;p&gt;如果为 True，则百分比必须以绝对值传递（0.xx）&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;code&gt;CommissionInfo&lt;/code&gt; 是从 &lt;code&gt;CommInfoBase&lt;/code&gt; 派生的，将此参数的默认值更改为 True 以保持兼容行为。&lt;/p&gt;</description></item><item><title>自定义佣金</title><link>https://www.poloxue.com/backtrader/docs/11-commission-schemes/03-customization/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://www.poloxue.com/backtrader/docs/11-commission-schemes/03-customization/</guid><description>&lt;h1 id="自定义佣金"&gt;自定义佣金&lt;a class="anchor" href="#%e8%87%aa%e5%ae%9a%e4%b9%89%e4%bd%a3%e9%87%91"&gt;#&lt;/a&gt;&lt;/h1&gt;
&lt;p&gt;重新设计 &lt;code&gt;CommInfo&lt;/code&gt; 对象以实现当前版本的最重要部分包括：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;保留原始 &lt;code&gt;CommissionInfo&lt;/code&gt; 类和行为&lt;/li&gt;
&lt;li&gt;为轻松创建用户定义的佣金打开大门&lt;/li&gt;
&lt;li&gt;将格式 &lt;code&gt;xx%&lt;/code&gt; 作为新佣金方案的默认值，而不是 &lt;code&gt;0.xx&lt;/code&gt;（这只是个口味问题），同时保持行为可配置&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="定义佣金方案"&gt;定义佣金方案&lt;a class="anchor" href="#%e5%ae%9a%e4%b9%89%e4%bd%a3%e9%87%91%e6%96%b9%e6%a1%88"&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;这涉及 1 到 2 个步骤：&lt;/p&gt;
&lt;h3 id="子类化-comminfobase"&gt;子类化 &lt;code&gt;CommInfoBase&lt;/code&gt;&lt;a class="anchor" href="#%e5%ad%90%e7%b1%bb%e5%8c%96-comminfobase"&gt;#&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;仅更改默认参数可能就足够了。&lt;code&gt;backtrader&lt;/code&gt; 已经在模块 &lt;code&gt;backtrader.commissions&lt;/code&gt; 中使用一些定义进行了此操作。期货的常规行业标准是每合同和每轮固定金额。定义可以这样做：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-python" data-lang="python"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;class&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;CommInfo_Futures_Fixed&lt;/span&gt;(CommInfoBase):
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; params &lt;span style="color:#f92672"&gt;=&lt;/span&gt; (
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; (&lt;span style="color:#e6db74"&gt;&amp;#39;stocklike&amp;#39;&lt;/span&gt;, &lt;span style="color:#66d9ef"&gt;False&lt;/span&gt;),
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; (&lt;span style="color:#e6db74"&gt;&amp;#39;commtype&amp;#39;&lt;/span&gt;, CommInfoBase&lt;span style="color:#f92672"&gt;.&lt;/span&gt;COMM_FIXED),
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; )&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;对于股票和按百分比计算的佣金：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-python" data-lang="python"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;class&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;CommInfo_Stocks_Perc&lt;/span&gt;(CommInfoBase):
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; params &lt;span style="color:#f92672"&gt;=&lt;/span&gt; (
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; (&lt;span style="color:#e6db74"&gt;&amp;#39;stocklike&amp;#39;&lt;/span&gt;, &lt;span style="color:#66d9ef"&gt;True&lt;/span&gt;),
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; (&lt;span style="color:#e6db74"&gt;&amp;#39;commtype&amp;#39;&lt;/span&gt;, CommInfoBase&lt;span style="color:#f92672"&gt;.&lt;/span&gt;COMM_PERC),
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; )&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;如上所述，此处解释百分比的默认值（作为参数 &lt;code&gt;commission&lt;/code&gt; 传递）为：&lt;code&gt;xx%&lt;/code&gt;。如果需要旧的/其他行为 &lt;code&gt;0.xx&lt;/code&gt;，可以轻松实现：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-python" data-lang="python"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;class&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;CommInfo_Stocks_PercAbs&lt;/span&gt;(CommInfoBase):
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; params &lt;span style="color:#f92672"&gt;=&lt;/span&gt; (
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; (&lt;span style="color:#e6db74"&gt;&amp;#39;stocklike&amp;#39;&lt;/span&gt;, &lt;span style="color:#66d9ef"&gt;True&lt;/span&gt;),
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; (&lt;span style="color:#e6db74"&gt;&amp;#39;commtype&amp;#39;&lt;/span&gt;, CommInfoBase&lt;span style="color:#f92672"&gt;.&lt;/span&gt;COMM_PERC),
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; (&lt;span style="color:#e6db74"&gt;&amp;#39;percabs&amp;#39;&lt;/span&gt;, &lt;span style="color:#66d9ef"&gt;True&lt;/span&gt;),
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; )&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id="重写-_getcommission-方法如有必要"&gt;重写 &lt;code&gt;_getcommission&lt;/code&gt; 方法（如有必要）&lt;a class="anchor" href="#%e9%87%8d%e5%86%99-_getcommission-%e6%96%b9%e6%b3%95%e5%a6%82%e6%9c%89%e5%bf%85%e8%a6%81"&gt;#&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;定义如下：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-python" data-lang="python"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;def&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;_getcommission&lt;/span&gt;(self, size, price, pseudoexec):
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#39;&amp;#39;&amp;#39;Calculates the commission of an operation at a given price
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; pseudoexec: if True the operation has not yet been executed
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; &amp;#39;&amp;#39;&amp;#39;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;下面的实际示例中有更多详细信息。&lt;/p&gt;</description></item><item><title>利息</title><link>https://www.poloxue.com/backtrader/docs/11-commission-schemes/04-credit-interests/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://www.poloxue.com/backtrader/docs/11-commission-schemes/04-credit-interests/</guid><description>&lt;h1 id="利息"&gt;利息&lt;a class="anchor" href="#%e5%88%a9%e6%81%af"&gt;#&lt;/a&gt;&lt;/h1&gt;
&lt;p&gt;在某些情况下，由于资产操作包含利率，实际经纪商的现金金额可能会减少。例如：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;股票的卖空&lt;/li&gt;
&lt;li&gt;ETF 的多头和空头操作&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;该费用直接从经纪账户的现金余额中扣除。但它仍然可以看作是佣金方案的一部分。因此，它已在 &lt;code&gt;backtrader&lt;/code&gt; 中进行了建模。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;CommInfoBase&lt;/code&gt; 类（以及主要的 &lt;code&gt;CommissionInfo&lt;/code&gt; 接口对象）已扩展了：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;两个新参数，用于设置利率并确定是否仅应用于空头还是同时应用于多头和空头&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="参数"&gt;参数&lt;a class="anchor" href="#%e5%8f%82%e6%95%b0"&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;interest&lt;/code&gt;（默认值：0.0）&lt;/p&gt;
&lt;p&gt;如果非零，这是持有卖空头寸时收取的年度利息。这主要用于股票卖空。&lt;/p&gt;
&lt;p&gt;应用的默认公式：&lt;code&gt;days * price * size * (interest / 365)&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;必须以绝对值指定：0.05 -&amp;gt; 5%&lt;/p&gt;
&lt;p&gt;注意：可以通过重写方法 &lt;code&gt;get_credit_interest&lt;/code&gt; 来更改行为&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;interest_long&lt;/code&gt;（默认值：False）&lt;/p&gt;
&lt;p&gt;一些产品如 ETF，在多头和空头头寸上都收取利息。如果为 &lt;code&gt;True&lt;/code&gt; 并且 &lt;code&gt;interest&lt;/code&gt; 非零，则多头和空头方向都将收取利息。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="公式"&gt;公式&lt;a class="anchor" href="#%e5%85%ac%e5%bc%8f"&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;默认实现将使用以下公式：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-python" data-lang="python"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;days &lt;span style="color:#f92672"&gt;*&lt;/span&gt; abs(size) &lt;span style="color:#f92672"&gt;*&lt;/span&gt; price &lt;span style="color:#f92672"&gt;*&lt;/span&gt; (interest &lt;span style="color:#f92672"&gt;/&lt;/span&gt; &lt;span style="color:#ae81ff"&gt;365&lt;/span&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;其中：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;days&lt;/code&gt;：自头寸开立或上次利息计算以来经过的天数&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="重写公式"&gt;重写公式&lt;a class="anchor" href="#%e9%87%8d%e5%86%99%e5%85%ac%e5%bc%8f"&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;要更改公式，需要子类化 &lt;code&gt;CommissionInfo&lt;/code&gt;。需要重写的方法是：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-python" data-lang="python"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;def&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;_get_credit_interest&lt;/span&gt;(self, size, price, days, dt0, dt1):
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#39;&amp;#39;&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; 此方法返回经纪商收取的利息成本。
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; 对于 ``size &amp;gt; 0`` 的情况，仅在类参数 ``interest_long`` 为 ``True`` 时调用此方法。
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; 计算利率的公式为：
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; 公式：``days * price * abs(size) * (interest / 365)``
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; 参数：
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; - ``data``：收取利息的数据源
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; - ``size``：当前头寸大小。&amp;gt; 0 表示多头头寸，&amp;lt; 0 表示空头头寸（此参数不会为 ``0``）
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; - ``price``：当前头寸价格
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; - ``days``：自上次利息计算以来经过的天数（这是（dt0 - dt1）.days）
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; - ``dt0``：当前日期时间（datetime.datetime）
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; - ``dt1``：上次计算日期时间（datetime.datetime）
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; ``dt0`` 和 ``dt1`` 在默认实现中未使用，并作为重写方法的额外输入提供
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; &amp;#39;&amp;#39;&amp;#39;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;可能经纪商在计算利率时不考虑周末或银行假日。在这种情况下，子类如下：&lt;/p&gt;</description></item></channel></rss>