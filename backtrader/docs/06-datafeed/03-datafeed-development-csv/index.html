<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="CSV 数据源开发 # Backtrader 已经提供了一些通用 CSV 数据源和特定的 CSV 数据源。
GenericCSVData VisualChartCSVData YahooFinanceData（用于在线下载） YahooFinanceCSVData（用于已下载的数据） BacktraderCSVData（内部使用&mldr;用于测试目的，但也可以使用） 即使如此，最终用户可能仍希望开发对特定 CSV 数据源的支持。
通常的格言是：“说起来容易做起来难”。实际上，结构旨在使其变得简单。
步骤 # 从 backtrader.CSVDataBase 继承 根据需要定义任何参数 在 start 方法中进行任何初始化 在 stop 方法中进行任何清理 定义一个 _loadline 方法，其中实际工作发生。此方法接收一个参数：linetokens。 顾名思义，这包含根据分隔符参数（从基类继承）拆分当前行后的标记。
如果在完成其工作后有新数据……填充相应的行并返回 True。
如果没有可用的数据，因此解析已结束：返回 False。
如果后台代码发现没有更多行需要解析，则可能不需要返回 False。
已考虑的事项：
打开文件（或接收类似文件的对象） 跳过标头行（如果指示存在） 读取行 标记行 预加载支持（将整个数据源一次性加载到内存中） 通常一个示例胜过千言万语。让我们使用 BacktraderCSVData 中定义的内部 CSV 解析代码的简化版本。这个版本不需要初始化或清理（例如，这可能是打开一个套接字并稍后关闭它）。
注意：
backtrader 数据源包含通常的行业标准源，这些源是要填充的。即：
datetime open high low close volume openinterest 如果您的策略/算法或简单数据浏览只需要，例如收盘价，您可以不触碰其他字段（每次迭代会自动用 float('NaN') 值填充它们，然后用户代码有机会进行任何操作）。
在此示例中，仅支持每日格式：
import itertools import backtrader as bt class MyCSVData(bt."><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:title" content="开发 CSV 数据源"><meta property="og:description" content="CSV 数据源开发 # Backtrader 已经提供了一些通用 CSV 数据源和特定的 CSV 数据源。
GenericCSVData VisualChartCSVData YahooFinanceData（用于在线下载） YahooFinanceCSVData（用于已下载的数据） BacktraderCSVData（内部使用&mldr;用于测试目的，但也可以使用） 即使如此，最终用户可能仍希望开发对特定 CSV 数据源的支持。
通常的格言是：“说起来容易做起来难”。实际上，结构旨在使其变得简单。
步骤 # 从 backtrader.CSVDataBase 继承 根据需要定义任何参数 在 start 方法中进行任何初始化 在 stop 方法中进行任何清理 定义一个 _loadline 方法，其中实际工作发生。此方法接收一个参数：linetokens。 顾名思义，这包含根据分隔符参数（从基类继承）拆分当前行后的标记。
如果在完成其工作后有新数据……填充相应的行并返回 True。
如果没有可用的数据，因此解析已结束：返回 False。
如果后台代码发现没有更多行需要解析，则可能不需要返回 False。
已考虑的事项：
打开文件（或接收类似文件的对象） 跳过标头行（如果指示存在） 读取行 标记行 预加载支持（将整个数据源一次性加载到内存中） 通常一个示例胜过千言万语。让我们使用 BacktraderCSVData 中定义的内部 CSV 解析代码的简化版本。这个版本不需要初始化或清理（例如，这可能是打开一个套接字并稍后关闭它）。
注意：
backtrader 数据源包含通常的行业标准源，这些源是要填充的。即：
datetime open high low close volume openinterest 如果您的策略/算法或简单数据浏览只需要，例如收盘价，您可以不触碰其他字段（每次迭代会自动用 float('NaN') 值填充它们，然后用户代码有机会进行任何操作）。
在此示例中，仅支持每日格式：
import itertools import backtrader as bt class MyCSVData(bt."><meta property="og:type" content="article"><meta property="og:url" content="https://www.poloxue.com/backtrader/docs/06-datafeed/03-datafeed-development-csv/"><meta property="article:section" content="docs"><meta property="article:modified_time" content="2025-01-01T19:08:46+08:00"><title>开发 CSV 数据源 | Backtrader 中文</title><link rel=manifest href=/backtrader/manifest.json><link rel=icon href=/backtrader/favicon.png><link rel=canonical href=https://www.poloxue.com/backtrader/docs/06-datafeed/03-datafeed-development-csv/><link rel=stylesheet href=/backtrader/book.min.76e6146e9e8f93e877ba51d0a79fef85faf41d4eae91f7d6e526426b06e3b129.css integrity="sha256-duYUbp6Pk+h3ulHQp5/vhfr0HU6ukffW5SZCawbjsSk=" crossorigin=anonymous><script defer src=/backtrader/flexsearch.min.js></script>
<script defer src=/backtrader/en.search.min.3915da9a91c6b4ff6edc12a99d69d853ec999a339663fcdbb1fa832ddcf582b8.js integrity="sha256-ORXampHGtP9u3BKpnWnYU+yZmjOWY/zbsfqDLdz1grg=" crossorigin=anonymous></script>
<script defer src=/backtrader/sw.min.6e7f3387f593f3527ac4d321c3f23a8d1e0c070c219a9f97642913dc39d4b5ff.js integrity="sha256-bn8zh/WT81J6xNMhw/I6jR4MBwwhmp+XZCkT3DnUtf8=" crossorigin=anonymous></script>
<script data-goatcounter=https://poloxue.goatcounter.com/count async src=//gc.zgo.at/count.js></script>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7019080091542951" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/backtrader/><img src=/backtrader/logo.png alt=Logo><span>Backtrader 中文</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><a href=/backtrader/docs/01-introduction/>介绍</a><ul></ul></li><li><a href=/backtrader/docs/02-installation/>安装指南</a><ul></ul></li><li><input type=checkbox id=section-95668ec101c39e63e3d5df6c80dde0f6 class=toggle>
<label for=section-95668ec101c39e63e3d5df6c80dde0f6 class="flex justify-between"><a href=/backtrader/docs/03-quickstart/>快速开始</a></label><ul><li><a href=/backtrader/docs/03-quickstart/01-setup/>环境设置</a></li><li><a href=/backtrader/docs/03-quickstart/02-cash/>账户资金</a></li><li><a href=/backtrader/docs/03-quickstart/03-datafeed/>配置数据</a></li><li><a href=/backtrader/docs/03-quickstart/04-first-strategy/>第一个策略</a></li><li><a href=/backtrader/docs/03-quickstart/05-strategy-logic/>开始交易</a></li><li><a href=/backtrader/docs/03-quickstart/06-sell/>卖出操作</a></li><li><a href=/backtrader/docs/03-quickstart/07-commission/>交易监控</a></li><li><a href=/backtrader/docs/03-quickstart/08-parameters/>参数定义</a></li><li><a href=/backtrader/docs/03-quickstart/09-indicators/>技术指标</a></li><li><a href=/backtrader/docs/03-quickstart/10-plotting/>可视化</a></li><li><a href=/backtrader/docs/03-quickstart/11-optimization/>策略优化</a></li></ul></li><li><input type=checkbox id=section-bb9677043509e3b068956c8c9ed9898b class=toggle>
<label for=section-bb9677043509e3b068956c8c9ed9898b class="flex justify-between"><a href=/backtrader/docs/04-concepts/>核心概念</a></label><ul><li><a href=/backtrader/docs/04-concepts/01-platform-concepts/>平台概念</a><ul><li><a href=/backtrader/docs/04-concepts/01-platform-concepts/01-datafeed/>数据源 DataFeed</a></li><li><a href=/backtrader/docs/04-concepts/01-platform-concepts/02-params/>策略参数</a></li><li><a href=/backtrader/docs/04-concepts/01-platform-concepts/03-line/>线 Line 类</a></li><li><a href=/backtrader/docs/04-concepts/01-platform-concepts/04-index/>索引和切片</a></li><li><a href=/backtrader/docs/04-concepts/01-platform-concepts/05-operator/>运算符</a></li></ul></li><li><a href=/backtrader/docs/04-concepts/02-operate-the-platform/>平台操作</a><ul><li><a href=/backtrader/docs/04-concepts/02-operate-the-platform/01-iteration/>Line 迭代器</a></li><li><a href=/backtrader/docs/04-concepts/02-operate-the-platform/02-startup/>启动运行</a></li></ul></li></ul></li><li><input type=checkbox id=section-2dbf38c024ccf07a4139869f080cac43 class=toggle>
<label for=section-2dbf38c024ccf07a4139869f080cac43 class="flex justify-between"><a href=/backtrader/docs/05-cerebro/>Cerebro</a></label><ul><li><a href=/backtrader/docs/05-cerebro/01-cerebro/>Cerebro</a></li><li><a href=/backtrader/docs/05-cerebro/02-reference/>参数说明</a></li><li><a href=/backtrader/docs/05-cerebro/03-saving-memory/>节省内存</a></li><li><a href=/backtrader/docs/05-cerebro/04-optimization-improvements/>优化改进</a></li><li><a href=/backtrader/docs/05-cerebro/05-exceptions/>异常 Exceptions</a></li><li><a href=/backtrader/docs/05-cerebro/06-logging-writer/>日志 Logging - Writter</a></li></ul></li><li><input type=checkbox id=section-843b6ed139743e2982aebf2306cbe4ce class=toggle checked>
<label for=section-843b6ed139743e2982aebf2306cbe4ce class="flex justify-between"><a role=button>DataFeed</a></label><ul><li><a href=/backtrader/docs/06-datafeed/01-datafeeds/>Data Feeds</a></li><li><a href=/backtrader/docs/06-datafeed/02-datafeed-extending/>扩展数据源</a></li><li><a href=/backtrader/docs/06-datafeed/03-datafeed-development-csv/ class=active>开发 CSV 数据源</a></li><li><a href=/backtrader/docs/06-datafeed/04-datafeed-development-general/>开发 Binary 数据源</a></li><li><a href=/backtrader/docs/06-datafeed/05-datafeed-multiple-timeframes/>多时间框架</a></li><li><a href=/backtrader/docs/06-datafeed/06-datafeed-resampling/>重采样</a></li><li><a href=/backtrader/docs/06-datafeed/07-datafeed-replay/>数据回放</a></li><li><a href=/backtrader/docs/06-datafeed/08-datafeed-rollover/>数据滚动</a></li><li><span>过滤器 Filters</span><ul><li><a href=/backtrader/docs/06-datafeed/09-datafeed-filters/01-datafeed-filters/>过滤器 Filters</a></li><li><a href=/backtrader/docs/06-datafeed/09-datafeed-filters/02-datafeed-filters-referrence/>参考文档</a></li></ul></li><li><a href=/backtrader/docs/06-datafeed/10-datafeed-yahoo/>Yahoo 数据源说明</a></li><li><a href=/backtrader/docs/06-datafeed/11-datafeed-pandas/>Pandas 数据源示例</a></li><li><a href=/backtrader/docs/06-datafeed/12-datafeed-reference/>数据源参考</a></li></ul></li><li><input type=checkbox id=section-bcbccbe8e26b18858f97ca31830953b1 class=toggle>
<label for=section-bcbccbe8e26b18858f97ca31830953b1 class="flex justify-between"><a role=button>Strategy</a></label><ul><li><a href=/backtrader/docs/07-strategy/01-strategy/>Strategy</a></li><li><a href=/backtrader/docs/07-strategy/02-strategy-with-signals/>信号策略</a></li><li><a href=/backtrader/docs/07-strategy/03-strategy-references/>策略参考</a></li></ul></li><li><input type=checkbox id=section-9740d452082ecac05becbac5e45e18d6 class=toggle>
<label for=section-9740d452082ecac05becbac5e45e18d6 class="flex justify-between"><a role=button>Indicator</a></label><ul><li><a href=/backtrader/docs/08-indicators/01-using-indicators/>使用指标</a></li><li><a href=/backtrader/docs/08-indicators/02-indicators-development/>指标开发</a></li><li><a href=/backtrader/docs/08-indicators/03-timeframe-mixing/>周期混合</a></li><li><a href=/backtrader/docs/08-indicators/04-talib/>TA-Lib</a></li></ul></li><li><input type=checkbox id=section-59e40579f5dd90c6bfa3a78686223f8d class=toggle>
<label for=section-59e40579f5dd90c6bfa3a78686223f8d class="flex justify-between"><a role=button>Order</a></label><ul><li><a href=/backtrader/docs/09-orders/01-general/>订单</a></li><li><a href=/backtrader/docs/09-orders/02-creation-execution/>创建/执行</a></li><li><a href=/backtrader/docs/09-orders/03-target-orders/>目标订单</a></li><li><a href=/backtrader/docs/09-orders/04-oco-orders/>OCO 订单</a></li><li><a href=/backtrader/docs/09-orders/05-bracket-orders/>Bracket Orders</a></li><li><a href=/backtrader/docs/09-orders/06-future-spot-compensation/>期货和现货补偿</a></li><li><a href=/backtrader/docs/09-orders/07-stop-trails/>跟踪止损（限价）</a></li></ul></li><li><input type=checkbox id=section-a2ec82415885a0ff6263ba256d3c484b class=toggle>
<label for=section-a2ec82415885a0ff6263ba256d3c484b class="flex justify-between"><a role=button>Broker</a></label><ul><li><a href=/backtrader/docs/10-broker/01-broker/>Broker</a></li><li><a href=/backtrader/docs/10-broker/02-slippage/>滑点</a></li><li><a href=/backtrader/docs/10-broker/03-cheat-on-open/>开盘作弊</a></li><li><a href=/backtrader/docs/10-broker/04-volume-filling-filler/>填充器</a></li><li><a href=/backtrader/docs/10-broker/05-position/>Position</a></li><li><a href=/backtrader/docs/10-broker/06-trade/>Trade</a></li></ul></li><li><input type=checkbox id=section-93412194d6a690077dd9b0fce5dc50b8 class=toggle>
<label for=section-93412194d6a690077dd9b0fce5dc50b8 class="flex justify-between"><a role=button>Commission</a></label><ul><li><a href=/backtrader/docs/11-commission-schemes/01-commission-schemes/>佣金</a></li><li><a href=/backtrader/docs/11-commission-schemes/02-commission-schemes-extending/>扩展</a></li><li><a href=/backtrader/docs/11-commission-schemes/03-customization/>自定义佣金</a></li><li><a href=/backtrader/docs/11-commission-schemes/04-credit-interests/>利息</a></li></ul></li><li><input type=checkbox id=section-7ee30e1f85261a5ddc0f8b492d792a0e class=toggle>
<label for=section-7ee30e1f85261a5ddc0f8b492d792a0e class="flex justify-between"><a role=button>Analyzer</a></label><ul><li><a href=/backtrader/docs/12-analyzers/01-analyzers/>Analyzers</a></li><li><a href=/backtrader/docs/12-analyzers/02-pyfolio/>Pyfolio</a></li><li><a href=/backtrader/docs/12-analyzers/03-pyfolio-integration/>Pyfolio 集成</a></li><li><a href=/backtrader/docs/12-analyzers/04-reference/>Reference</a></li></ul></li><li><input type=checkbox id=section-c3d8936c432abd68dd8d40624a1e9ecd class=toggle>
<label for=section-c3d8936c432abd68dd8d40624a1e9ecd class="flex justify-between"><a role=button>Observer</a></label><ul><li><a href=/backtrader/docs/13-observers/01-statistics/>统计</a></li><li><a href=/backtrader/docs/13-observers/02-benchmarking/>基准测试</a></li><li><a href=/backtrader/docs/13-observers/03-reference/>参考</a></li></ul></li><li><input type=checkbox id=section-bf5851d3ea7d78f072d49c32fbc0116a class=toggle>
<label for=section-bf5851d3ea7d78f072d49c32fbc0116a class="flex justify-between"><a role=button>Sizer</a></label><ul><li><a href=/backtrader/docs/14-sizers/01-sizers/>sizers</a></li><li><a href=/backtrader/docs/14-sizers/02-reference/>参考</a></li></ul></li><li><input type=checkbox id=section-d914bc0b766cee7bc235dc30c39c783c class=toggle>
<label for=section-d914bc0b766cee7bc235dc30c39c783c class="flex justify-between"><a href=/backtrader/docs/15-livetrading/>实盘</a></label><ul><li><a href=/backtrader/docs/15-livetrading/01-interactive-brokers/>Interactive Brokers</a></li><li><a href=/backtrader/docs/15-livetrading/02-qanda-v1-0/>Qanda</a></li><li><a href=/backtrader/docs/15-livetrading/03-visual-chart/>Visual Chart</a></li></ul></li><li><input type=checkbox id=section-b0ac2f58c2fd8f0b64f94dbeb60a370a class=toggle>
<label for=section-b0ac2f58c2fd8f0b64f94dbeb60a370a class="flex justify-between"><a role=button>绘图</a></label><ul><li><a href=/backtrader/docs/16-plotting/01-plotting/>Plotting</a></li><li><a href=/backtrader/docs/16-plotting/02-ploting-date-ranges/>绘制日期范围</a></li><li><a href=/backtrader/docs/16-plotting/03-plotting-same-axis/>同轴绘图</a></li></ul></li><li><input type=checkbox id=section-696d63c91cb92679438b7f84ef95709e class=toggle>
<label for=section-696d63c91cb92679438b7f84ef95709e class="flex justify-between"><a role=button>日期时间</a></label><ul><li><a href=/backtrader/docs/17-datetime/01-management/>管理</a></li><li><a href=/backtrader/docs/17-datetime/02-timer/>定时器</a></li><li><a href=/backtrader/docs/17-datetime/03-trading-calendars/>交易日历</a></li></ul></li><li><a href=/backtrader/docs/18-automated-running/>自动运行</a><ul></ul></li><li><input type=checkbox id=section-d46c60132a1fb9ab45ebe733d651e644 class=toggle>
<label for=section-d46c60132a1fb9ab45ebe733d651e644 class="flex justify-between"><a role=button>官方文章</a></label><ul><li><a href=/backtrader/docs/19-articles/01-out-of-memory/>超大内存</a></li><li><a href=/backtrader/docs/19-articles/02-cross-backtesting-pitfalls/>跨平台回测的陷进</a></li><li><a href=/backtrader/docs/19-articles/03-fractional-sizes/>加密货币中的分位仓位</a></li><li><a href=/backtrader/docs/19-articles/04-beating-the-random-entry/>打败随机入场</a></li><li><a href=/backtrader/docs/19-articles/05-rebalancing-conserative/>保守型公式的再平衡</a></li><li><a href=/backtrader/docs/19-articles/06-mfi-generic/>MFI 通用版</a></li></ul></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/backtrader/svg/menu.svg class=book-icon alt=Menu></label>
<strong>开发 CSV 数据源</strong>
<label for=toc-control><img src=/backtrader/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#步骤>步骤</a></li><li><a href=#警告>警告</a></li><li><a href=#完成>完成</a></li></ul></nav></aside></header><article class="markdown book-article"><h1 id=csv-数据源开发>CSV 数据源开发
<a class=anchor href=#csv-%e6%95%b0%e6%8d%ae%e6%ba%90%e5%bc%80%e5%8f%91>#</a></h1><p><strong>Backtrader</strong> 已经提供了一些通用 CSV 数据源和特定的 CSV 数据源。</p><ul><li>GenericCSVData</li><li>VisualChartCSVData</li><li>YahooFinanceData（用于在线下载）</li><li>YahooFinanceCSVData（用于已下载的数据）</li><li>BacktraderCSVData（内部使用&mldr;用于测试目的，但也可以使用）</li></ul><p>即使如此，最终用户可能仍希望开发对特定 CSV 数据源的支持。</p><p>通常的格言是：“说起来容易做起来难”。实际上，结构旨在使其变得简单。</p><h2 id=步骤>步骤
<a class=anchor href=#%e6%ad%a5%e9%aa%a4>#</a></h2><ol><li>从 <code>backtrader.CSVDataBase</code> 继承</li><li>根据需要定义任何参数</li><li>在 <code>start</code> 方法中进行任何初始化</li><li>在 <code>stop</code> 方法中进行任何清理</li><li>定义一个 <code>_loadline</code> 方法，其中实际工作发生。此方法接收一个参数：<code>linetokens</code>。</li></ol><p>顾名思义，这包含根据分隔符参数（从基类继承）拆分当前行后的标记。</p><p>如果在完成其工作后有新数据……填充相应的行并返回 <code>True</code>。</p><p>如果没有可用的数据，因此解析已结束：返回 <code>False</code>。</p><p>如果后台代码发现没有更多行需要解析，则可能不需要返回 <code>False</code>。</p><p>已考虑的事项：</p><ul><li>打开文件（或接收类似文件的对象）</li><li>跳过标头行（如果指示存在）</li><li>读取行</li><li>标记行</li><li>预加载支持（将整个数据源一次性加载到内存中）</li></ul><p>通常一个示例胜过千言万语。让我们使用 BacktraderCSVData 中定义的内部 CSV 解析代码的简化版本。这个版本不需要初始化或清理（例如，这可能是打开一个套接字并稍后关闭它）。</p><p>注意：</p><p>backtrader 数据源包含通常的行业标准源，这些源是要填充的。即：</p><ul><li>datetime</li><li>open</li><li>high</li><li>low</li><li>close</li><li>volume</li><li>openinterest</li></ul><p>如果您的策略/算法或简单数据浏览只需要，例如收盘价，您可以不触碰其他字段（每次迭代会自动用 <code>float('NaN')</code> 值填充它们，然后用户代码有机会进行任何操作）。</p><p>在此示例中，仅支持每日格式：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> itertools
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> backtrader <span style=color:#66d9ef>as</span> bt
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MyCSVData</span>(bt<span style=color:#f92672>.</span>CSVDataBase):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>start</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#75715e># 对于此数据源类型无需做任何操作</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>stop</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#75715e># 对于此数据源类型无需做任何操作</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>_loadline</span>(self, linetokens):
</span></span><span style=display:flex><span>        i <span style=color:#f92672>=</span> itertools<span style=color:#f92672>.</span>count(<span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        dttxt <span style=color:#f92672>=</span> linetokens[next(i)]
</span></span><span style=display:flex><span>        <span style=color:#75715e># 格式为 YYYY-MM-DD</span>
</span></span><span style=display:flex><span>        y <span style=color:#f92672>=</span> int(dttxt[<span style=color:#ae81ff>0</span>:<span style=color:#ae81ff>4</span>])
</span></span><span style=display:flex><span>        m <span style=color:#f92672>=</span> int(dttxt[<span style=color:#ae81ff>5</span>:<span style=color:#ae81ff>7</span>])
</span></span><span style=display:flex><span>        d <span style=color:#f92672>=</span> int(dttxt[<span style=color:#ae81ff>8</span>:<span style=color:#ae81ff>10</span>])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        dt <span style=color:#f92672>=</span> datetime<span style=color:#f92672>.</span>datetime(y, m, d)
</span></span><span style=display:flex><span>        dtnum <span style=color:#f92672>=</span> date2num(dt)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>lines<span style=color:#f92672>.</span>datetime[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>=</span> dtnum
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>lines<span style=color:#f92672>.</span>open[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>=</span> float(linetokens[next(i)])
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>lines<span style=color:#f92672>.</span>high[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>=</span> float(linetokens[next(i)])
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>lines<span style=color:#f92672>.</span>low[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>=</span> float(linetokens[next(i)])
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>lines<span style=color:#f92672>.</span>close[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>=</span> float(linetokens[next(i)])
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>lines<span style=color:#f92672>.</span>volume[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>=</span> float(linetokens[next(i)])
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>lines<span style=color:#f92672>.</span>openinterest[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>=</span> float(linetokens[next(i)])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>True</span>
</span></span></code></pre></div><p>代码假设所有字段都到位且可转换为浮点数，除了日期时间，它具有固定的 YYYY-MM-DD 格式，可以不使用 <code>datetime.datetime.strptime</code> 进行解析。</p><p>通过添加一些代码行来处理空值和日期格式解析，可以满足更复杂的需求。GenericCSVData 就是这样做的。</p><h2 id=警告>警告
<a class=anchor href=#%e8%ad%a6%e5%91%8a>#</a></h2><p>使用现有的 GenericCSVData 和继承，可以实现很多格式支持。</p><p>让我们添加对 Sierra Chart 每日格式的支持（始终以 CSV 格式存储）。</p><p>定义（通过查看一个 &lsquo;.dly&rsquo; 数据文件）：</p><p>字段：Date, Open, High, Low, Close, Volume, OpenInterest</p><p>行业标准字段以及 GenericCSVData 已支持的字段，顺序相同（也是行业标准）</p><p>分隔符：,</p><p>日期格式：YYYY/MM/DD</p><p>一个用于这些文件的解析器：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SierraChartCSVData</span>(backtrader<span style=color:#f92672>.</span>feeds<span style=color:#f92672>.</span>GenericCSVData):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    params <span style=color:#f92672>=</span> ((<span style=color:#e6db74>&#39;dtformat&#39;</span>, <span style=color:#e6db74>&#39;%Y/%m/</span><span style=color:#e6db74>%d</span><span style=color:#e6db74>&#39;</span>),)
</span></span></code></pre></div><p>参数定义只是重新定义了基类中的一个现有参数。在这种情况下，只需要更改日期格式字符串。</p><h2 id=完成>完成
<a class=anchor href=#%e5%ae%8c%e6%88%90>#</a></h2><p>Sierra Chart 的解析器已经完成。</p><p>下面是 GenericCSVData 的参数定义作为提醒：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>GenericCSVData</span>(feed<span style=color:#f92672>.</span>CSVDataBase):
</span></span><span style=display:flex><span>    params <span style=color:#f92672>=</span> (
</span></span><span style=display:flex><span>        (<span style=color:#e6db74>&#39;nullvalue&#39;</span>, float(<span style=color:#e6db74>&#39;NaN&#39;</span>)),
</span></span><span style=display:flex><span>        (<span style=color:#e6db74>&#39;dtformat&#39;</span>, <span style=color:#e6db74>&#39;%Y-%m-</span><span style=color:#e6db74>%d</span><span style=color:#e6db74> %H:%M:%S&#39;</span>),
</span></span><span style=display:flex><span>        (<span style=color:#e6db74>&#39;tmformat&#39;</span>, <span style=color:#e6db74>&#39;%H:%M:%S&#39;</span>),
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        (<span style=color:#e6db74>&#39;datetime&#39;</span>, <span style=color:#ae81ff>0</span>),
</span></span><span style=display:flex><span>        (<span style=color:#e6db74>&#39;time&#39;</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>),
</span></span><span style=display:flex><span>        (<span style=color:#e6db74>&#39;open&#39;</span>, <span style=color:#ae81ff>1</span>),
</span></span><span style=display:flex><span>        (<span style=color:#e6db74>&#39;high&#39;</span>, <span style=color:#ae81ff>2</span>),
</span></span><span style=display:flex><span>        (<span style=color:#e6db74>&#39;low&#39;</span>, <span style=color:#ae81ff>3</span>),
</span></span><span style=display:flex><span>        (<span style=color:#e6db74>&#39;close&#39;</span>, <span style=color:#ae81ff>4</span>),
</span></span><span style=display:flex><span>        (<span style=color:#e6db74>&#39;volume&#39;</span>, <span style=color:#ae81ff>5</span>),
</span></span><span style=display:flex><span>        (<span style=color:#e6db74>&#39;openinterest&#39;</span>, <span style=color:#ae81ff>6</span>),
</span></span><span style=display:flex><span>    )
</span></span></code></pre></div></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/poloxue/docs.backtrader/commit/888101e0f7043e1fcc06ec70761e8d11787ba574 title='Last modified by poloxue.xue | Jan 1, 2025' target=_blank rel=noopener><img src=/backtrader/svg/calendar.svg class=book-icon alt=Calendar>
<span>Jan 1, 2025</span></a></div><div><a class="flex align-center" href=https://github.com/poloxue/docs.backtrader/blob/master/content/docs/06-datafeed/03-datafeed-development-csv.md target=_blank rel=noopener><img src=/backtrader/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this page</span></a></div></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments><script src=https://utteranc.es/client.js repo=poloxue/blog issue-term=pathname theme=github-dark crossorigin=anonymous async></script></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#步骤>步骤</a></li><li><a href=#警告>警告</a></li><li><a href=#完成>完成</a></li></ul></nav></div></aside></main></body></html>