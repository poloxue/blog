<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="订单#
Cerebro 是 backtrader 中的关键控制系统，而 Strategy（一个子类）是终端用户的关键控制点。后者需要一个连接系统其他部分的方法，这就是订单发挥关键作用的地方。
订单将策略中的逻辑决策转化为适合 Broker 执行操作的消息。这是通过以下方式完成的：
创建#
通过 Strategy 的方法：buy、sell 和 close（Strategy），这些方法返回一个订单实例作为参考。
取消#
通过 Strategy 的方法：cancel（Strategy），该方法需要一个订单实例来操作。
订单也作为一种通信方式反馈给用户，通知 Broker 中的执行情况。
通知#
通过 Strategy 的方法：notify_order（Strategy），该方法报告一个订单实例。
订单创建#
调用 buy、sell 和 close 时，以下参数适用于创建：

  
      
          参数名
          默认值
          描述
      
  
  
      
          data
          None
          为哪个数据创建订单。如果为 None，则使用系统中的第一个数据，self.datas[0] 或 self.data0（又名 self.data）。
      
      
          size
          None
          使用的单位数量。如果为 None，则使用通过 getsizer 获取的 sizer 实例来确定大小。
      
      
          price
          None
          使用的价格（实时 Broker 可能会对格式有实际限制，如果不符合最小刻度要求）。对于 Market 和 Close 订单，None 是有效的（市场决定价格）。对于 Limit、Stop 和 StopLimit 订单，该值决定触发点（在 Limit 的情况下，触发点显然是订单匹配的价格）。
      
      
          plimit
          None
          仅适用于 StopLimit 订单。这是在 Stop 触发后设置隐含 Limit 订单的价格。
      
      
          exectype
          None
          可能的值：- Order.Market 或 None：市场订单将以下一个可用价格执行。在回测中，这将是下一根K线的开盘价。- Order.Limit：只能在给定价格或更好的价格执行的订单。- Order.Stop：在价格触发时执行的订单，执行方式如同 Market 订单。- Order.StopLimit：在价格触发时执行的订单，作为隐含 Limit 订单执行，价格由 pricelimit 给定。
      
      
          valid
          None
          可能的值：- None：生成一个不会过期的订单（即 Good till cancel），并在市场中保留直到匹配或取消。实际上，Broker 往往会强制一个时间限制，但这通常是很长时间，所以认为它不会过期。- datetime.datetime 或 datetime.date 实例：使用给定的日期生成一个有效直到该日期的订单（即 Good till date）。- Order.DAY 或 0 或 timedelta()：生成一个有效期为一天的订单（即日订单），有效期直到会话结束。- 数值：假定为一个对应于 matplotlib 编码的日期时间值（backtrader 使用的），并用于生成一个有效期至该时间的订单（即 Good till date）。
      
      
          tradeid
          0
          这是 backtrader 用来跟踪同一资产上重叠交易的内部值。在通知订单状态变化时，该 tradeid 会返回给策略。
      
      
          **kwargs
          /
          额外的 Broker 实现可能支持额外的参数。backtrader 会将 kwargs 传递给创建的订单对象。
      
  

示例#
如果 backtrader 直接支持的 4 种订单执行类型不够，例如对于 Interactive Brokers，可以传递如下参数："><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://www.poloxue.com/backtrader/docs/09-orders/01-general/"><meta property="og:site_name" content="Backtrader 中文"><meta property="og:title" content="订单"><meta property="og:description" content="订单# Cerebro 是 backtrader 中的关键控制系统，而 Strategy（一个子类）是终端用户的关键控制点。后者需要一个连接系统其他部分的方法，这就是订单发挥关键作用的地方。
订单将策略中的逻辑决策转化为适合 Broker 执行操作的消息。这是通过以下方式完成的：
创建# 通过 Strategy 的方法：buy、sell 和 close（Strategy），这些方法返回一个订单实例作为参考。
取消# 通过 Strategy 的方法：cancel（Strategy），该方法需要一个订单实例来操作。
订单也作为一种通信方式反馈给用户，通知 Broker 中的执行情况。
通知# 通过 Strategy 的方法：notify_order（Strategy），该方法报告一个订单实例。
订单创建# 调用 buy、sell 和 close 时，以下参数适用于创建：
参数名 默认值 描述 data None 为哪个数据创建订单。如果为 None，则使用系统中的第一个数据，self.datas[0] 或 self.data0（又名 self.data）。 size None 使用的单位数量。如果为 None，则使用通过 getsizer 获取的 sizer 实例来确定大小。 price None 使用的价格（实时 Broker 可能会对格式有实际限制，如果不符合最小刻度要求）。对于 Market 和 Close 订单，None 是有效的（市场决定价格）。对于 Limit、Stop 和 StopLimit 订单，该值决定触发点（在 Limit 的情况下，触发点显然是订单匹配的价格）。 plimit None 仅适用于 StopLimit 订单。这是在 Stop 触发后设置隐含 Limit 订单的价格。 exectype None 可能的值：- Order.Market 或 None：市场订单将以下一个可用价格执行。在回测中，这将是下一根K线的开盘价。- Order.Limit：只能在给定价格或更好的价格执行的订单。- Order.Stop：在价格触发时执行的订单，执行方式如同 Market 订单。- Order.StopLimit：在价格触发时执行的订单，作为隐含 Limit 订单执行，价格由 pricelimit 给定。 valid None 可能的值：- None：生成一个不会过期的订单（即 Good till cancel），并在市场中保留直到匹配或取消。实际上，Broker 往往会强制一个时间限制，但这通常是很长时间，所以认为它不会过期。- datetime.datetime 或 datetime.date 实例：使用给定的日期生成一个有效直到该日期的订单（即 Good till date）。- Order.DAY 或 0 或 timedelta()：生成一个有效期为一天的订单（即日订单），有效期直到会话结束。- 数值：假定为一个对应于 matplotlib 编码的日期时间值（backtrader 使用的），并用于生成一个有效期至该时间的订单（即 Good till date）。 tradeid 0 这是 backtrader 用来跟踪同一资产上重叠交易的内部值。在通知订单状态变化时，该 tradeid 会返回给策略。 **kwargs / 额外的 Broker 实现可能支持额外的参数。backtrader 会将 kwargs 传递给创建的订单对象。 示例# 如果 backtrader 直接支持的 4 种订单执行类型不够，例如对于 Interactive Brokers，可以传递如下参数："><meta property="og:locale" content="zh_cn"><meta property="og:type" content="article"><meta property="article:section" content="docs"><meta property="article:modified_time" content="2025-01-02T20:37:01+08:00"><title>订单 | Backtrader 中文</title><link rel=icon href=/backtrader/favicon.png><link rel=manifest href=/backtrader/manifest.json><link rel=canonical href=https://www.poloxue.com/backtrader/docs/09-orders/01-general/><link rel=stylesheet href=/backtrader/book.min.f079ea268834b2e0459e63011be648e8a3cc0e4819a71206873f891528fbfdf6.css integrity="sha256-8HnqJog0suBFnmMBG+ZI6KPMDkgZpxIGhz+JFSj7/fY=" crossorigin=anonymous><script defer src=/backtrader/fuse.min.js></script><script defer src=/backtrader/en.search.min.28c0072bcb426eba2da739aceed7cf13edcc133474c849dae0ba197d767c4d54.js integrity="sha256-KMAHK8tCbrotpzms7tfPE+3MEzR0yEna4LoZfXZ8TVQ=" crossorigin=anonymous></script><script defer src=/backtrader/sw.min.6e7f3387f593f3527ac4d321c3f23a8d1e0c070c219a9f97642913dc39d4b5ff.js integrity="sha256-bn8zh/WT81J6xNMhw/I6jR4MBwwhmp+XZCkT3DnUtf8=" crossorigin=anonymous></script><script data-goatcounter=https://poloxue.goatcounter.com/count async src=//gc.zgo.at/count.js></script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7019080091542951" crossorigin=anonymous></script></head><body dir=ltr class="book-kind-page book-type-docs"><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/backtrader/><img src=/backtrader/logo.png alt=Logo><span>Backtrader 中文</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script><ul><li><a href=/backtrader/docs/01-introduction/>介绍</a><ul></ul></li><li><a href=/backtrader/docs/02-installation/>安装指南</a><ul></ul></li><li><input type=checkbox id=section-ef1b0f3b48f1accf5a8e12976586a132 class=toggle>
<label for=section-ef1b0f3b48f1accf5a8e12976586a132 class=flex><a href=/backtrader/docs/03-quickstart/>快速开始</a>
<img src=/backtrader/icons/chevron-right.svg class=book-icon></label><ul><li><a href=/backtrader/docs/03-quickstart/01-setup/>环境设置</a></li><li><a href=/backtrader/docs/03-quickstart/02-cash/>账户资金</a></li><li><a href=/backtrader/docs/03-quickstart/03-datafeed/>配置数据</a></li><li><a href=/backtrader/docs/03-quickstart/04-first-strategy/>第一个策略</a></li><li><a href=/backtrader/docs/03-quickstart/05-strategy-logic/>开始交易</a></li><li><a href=/backtrader/docs/03-quickstart/06-sell/>卖出操作</a></li><li><a href=/backtrader/docs/03-quickstart/07-commission/>交易监控</a></li><li><a href=/backtrader/docs/03-quickstart/08-parameters/>参数定义</a></li><li><a href=/backtrader/docs/03-quickstart/09-indicators/>技术指标</a></li><li><a href=/backtrader/docs/03-quickstart/10-plotting/>可视化</a></li><li><a href=/backtrader/docs/03-quickstart/11-optimization/>策略优化</a></li></ul></li><li><input type=checkbox id=section-8b6cc0ccf66e33ea233e54e3e1c71bd0 class=toggle>
<label for=section-8b6cc0ccf66e33ea233e54e3e1c71bd0 class=flex><a href=/backtrader/docs/04-concepts/>核心概念</a>
<img src=/backtrader/icons/chevron-right.svg class=book-icon></label><ul><li><a href=/backtrader/docs/04-concepts/01-platform-concepts/>平台概念</a><ul><li><a href=/backtrader/docs/04-concepts/01-platform-concepts/01-datafeed/>数据源 DataFeed</a></li><li><a href=/backtrader/docs/04-concepts/01-platform-concepts/02-params/>策略参数</a></li><li><a href=/backtrader/docs/04-concepts/01-platform-concepts/03-line/>线 Line 类</a></li><li><a href=/backtrader/docs/04-concepts/01-platform-concepts/04-index/>索引和切片</a></li><li><a href=/backtrader/docs/04-concepts/01-platform-concepts/05-operator/>运算符</a></li></ul></li><li><a href=/backtrader/docs/04-concepts/02-operate-the-platform/>平台操作</a><ul><li><a href=/backtrader/docs/04-concepts/02-operate-the-platform/01-iteration/>Line 迭代器</a></li><li><a href=/backtrader/docs/04-concepts/02-operate-the-platform/02-startup/>启动运行</a></li></ul></li></ul></li><li><input type=checkbox id=section-1d25046da157a996ab4b83cedd86be47 class=toggle>
<label for=section-1d25046da157a996ab4b83cedd86be47 class=flex><a href=/backtrader/docs/05-cerebro/>Cerebro</a>
<img src=/backtrader/icons/chevron-right.svg class=book-icon></label><ul><li><a href=/backtrader/docs/05-cerebro/01-cerebro/>Cerebro</a></li><li><a href=/backtrader/docs/05-cerebro/02-reference/>参数说明</a></li><li><a href=/backtrader/docs/05-cerebro/03-saving-memory/>节省内存</a></li><li><a href=/backtrader/docs/05-cerebro/04-optimization-improvements/>优化改进</a></li><li><a href=/backtrader/docs/05-cerebro/05-exceptions/>异常 Exceptions</a></li><li><a href=/backtrader/docs/05-cerebro/06-logging-writer/>日志 Logging - Writter</a></li></ul></li><li><input type=checkbox id=section-b39bf4495a5a92ed51fcc77b0cf4545f class=toggle>
<label for=section-b39bf4495a5a92ed51fcc77b0cf4545f class=flex><a role=button>DataFeed</a>
<img src=/backtrader/icons/chevron-right.svg class=book-icon></label><ul><li><a href=/backtrader/docs/06-datafeed/01-datafeeds/>Data Feeds</a></li><li><a href=/backtrader/docs/06-datafeed/02-datafeed-extending/>扩展数据源</a></li><li><a href=/backtrader/docs/06-datafeed/03-datafeed-development-csv/>开发 CSV 数据源</a></li><li><a href=/backtrader/docs/06-datafeed/04-datafeed-development-general/>开发 Binary 数据源</a></li><li><a href=/backtrader/docs/06-datafeed/05-datafeed-multiple-timeframes/>多时间框架</a></li><li><a href=/backtrader/docs/06-datafeed/06-datafeed-resampling/>重采样</a></li><li><a href=/backtrader/docs/06-datafeed/07-datafeed-replay/>数据回放</a></li><li><a href=/backtrader/docs/06-datafeed/08-datafeed-rollover/>数据滚动</a></li><li><a>过滤器 Filters</a><ul><li><a href=/backtrader/docs/06-datafeed/09-datafeed-filters/01-datafeed-filters/>过滤器 Filters</a></li><li><a href=/backtrader/docs/06-datafeed/09-datafeed-filters/02-datafeed-filters-referrence/>参考文档</a></li></ul></li><li><a href=/backtrader/docs/06-datafeed/10-datafeed-yahoo/>Yahoo 数据源说明</a></li><li><a href=/backtrader/docs/06-datafeed/11-datafeed-pandas/>Pandas 数据源示例</a></li><li><a href=/backtrader/docs/06-datafeed/12-datafeed-reference/>数据源参考</a></li></ul></li><li><input type=checkbox id=section-e3fe58eaef3418b317102036dce25013 class=toggle>
<label for=section-e3fe58eaef3418b317102036dce25013 class=flex><a role=button>Strategy</a>
<img src=/backtrader/icons/chevron-right.svg class=book-icon></label><ul><li><a href=/backtrader/docs/07-strategy/01-strategy/>Strategy</a></li><li><a href=/backtrader/docs/07-strategy/02-strategy-with-signals/>信号策略</a></li><li><a href=/backtrader/docs/07-strategy/03-strategy-references/>策略参考</a></li></ul></li><li><input type=checkbox id=section-cad109a715fc3bbeef472f4f0cad4358 class=toggle>
<label for=section-cad109a715fc3bbeef472f4f0cad4358 class=flex><a role=button>Indicator</a>
<img src=/backtrader/icons/chevron-right.svg class=book-icon></label><ul><li><a href=/backtrader/docs/08-indicators/01-using-indicators/>使用指标</a></li><li><a href=/backtrader/docs/08-indicators/02-indicators-development/>指标开发</a></li><li><a href=/backtrader/docs/08-indicators/03-timeframe-mixing/>周期混合</a></li><li><a href=/backtrader/docs/08-indicators/04-talib/>TA-Lib</a></li></ul></li><li><input type=checkbox id=section-56aaa6caa9d538f335a48813aa684f48 class=toggle checked>
<label for=section-56aaa6caa9d538f335a48813aa684f48 class=flex><a role=button>Order</a>
<img src=/backtrader/icons/chevron-right.svg class=book-icon></label><ul><li><a href=/backtrader/docs/09-orders/01-general/ class=active>订单</a></li><li><a href=/backtrader/docs/09-orders/02-creation-execution/>创建/执行</a></li><li><a href=/backtrader/docs/09-orders/03-target-orders/>目标订单</a></li><li><a href=/backtrader/docs/09-orders/04-oco-orders/>OCO 订单</a></li><li><a href=/backtrader/docs/09-orders/05-bracket-orders/>Bracket Orders</a></li><li><a href=/backtrader/docs/09-orders/06-future-spot-compensation/>期货和现货补偿</a></li><li><a href=/backtrader/docs/09-orders/07-stop-trails/>跟踪止损（限价）</a></li></ul></li><li><input type=checkbox id=section-44410e36d2de519599cb0e5e09a3b2ed class=toggle>
<label for=section-44410e36d2de519599cb0e5e09a3b2ed class=flex><a role=button>Broker</a>
<img src=/backtrader/icons/chevron-right.svg class=book-icon></label><ul><li><a href=/backtrader/docs/10-broker/01-broker/>Broker</a></li><li><a href=/backtrader/docs/10-broker/02-slippage/>滑点</a></li><li><a href=/backtrader/docs/10-broker/03-cheat-on-open/>开盘作弊</a></li><li><a href=/backtrader/docs/10-broker/04-volume-filling-filler/>填充器</a></li><li><a href=/backtrader/docs/10-broker/05-position/>Position</a></li><li><a href=/backtrader/docs/10-broker/06-trade/>Trade</a></li></ul></li><li><input type=checkbox id=section-ae52187dba190ff9aaf14da3856b7cd3 class=toggle>
<label for=section-ae52187dba190ff9aaf14da3856b7cd3 class=flex><a role=button>Commission</a>
<img src=/backtrader/icons/chevron-right.svg class=book-icon></label><ul><li><a href=/backtrader/docs/11-commission-schemes/01-commission-schemes/>佣金</a></li><li><a href=/backtrader/docs/11-commission-schemes/02-commission-schemes-extending/>扩展</a></li><li><a href=/backtrader/docs/11-commission-schemes/03-customization/>自定义佣金</a></li><li><a href=/backtrader/docs/11-commission-schemes/04-credit-interests/>利息</a></li></ul></li><li><input type=checkbox id=section-c06d50c5f364fda6157cd2e0322dd59c class=toggle>
<label for=section-c06d50c5f364fda6157cd2e0322dd59c class=flex><a role=button>Analyzer</a>
<img src=/backtrader/icons/chevron-right.svg class=book-icon></label><ul><li><a href=/backtrader/docs/12-analyzers/01-analyzers/>Analyzers</a></li><li><a href=/backtrader/docs/12-analyzers/02-pyfolio/>Pyfolio</a></li><li><a href=/backtrader/docs/12-analyzers/03-pyfolio-integration/>Pyfolio 集成</a></li><li><a href=/backtrader/docs/12-analyzers/04-reference/>Reference</a></li></ul></li><li><input type=checkbox id=section-c8768af388a3e3ade998ccab1da7af20 class=toggle>
<label for=section-c8768af388a3e3ade998ccab1da7af20 class=flex><a role=button>Observer</a>
<img src=/backtrader/icons/chevron-right.svg class=book-icon></label><ul><li><a href=/backtrader/docs/13-observers/01-statistics/>统计</a></li><li><a href=/backtrader/docs/13-observers/02-benchmarking/>基准测试</a></li><li><a href=/backtrader/docs/13-observers/03-reference/>参考</a></li></ul></li><li><input type=checkbox id=section-71aa242f05842258d04bb7390059ae0c class=toggle>
<label for=section-71aa242f05842258d04bb7390059ae0c class=flex><a role=button>Sizer</a>
<img src=/backtrader/icons/chevron-right.svg class=book-icon></label><ul><li><a href=/backtrader/docs/14-sizers/01-sizers/>sizers</a></li><li><a href=/backtrader/docs/14-sizers/02-reference/>参考</a></li></ul></li><li><input type=checkbox id=section-5787874ab2a916d11389152b4141fa73 class=toggle>
<label for=section-5787874ab2a916d11389152b4141fa73 class=flex><a href=/backtrader/docs/15-livetrading/>实盘</a>
<img src=/backtrader/icons/chevron-right.svg class=book-icon></label><ul><li><a href=/backtrader/docs/15-livetrading/01-interactive-brokers/>Interactive Brokers</a></li><li><a href=/backtrader/docs/15-livetrading/02-qanda-v1-0/>Qanda</a></li><li><a href=/backtrader/docs/15-livetrading/03-visual-chart/>Visual Chart</a></li></ul></li><li><input type=checkbox id=section-3dcf1c9f08afe4d22a0a825dccbf62c9 class=toggle>
<label for=section-3dcf1c9f08afe4d22a0a825dccbf62c9 class=flex><a role=button>绘图</a>
<img src=/backtrader/icons/chevron-right.svg class=book-icon></label><ul><li><a href=/backtrader/docs/16-plotting/01-plotting/>Plotting</a></li><li><a href=/backtrader/docs/16-plotting/02-ploting-date-ranges/>绘制日期范围</a></li><li><a href=/backtrader/docs/16-plotting/03-plotting-same-axis/>同轴绘图</a></li></ul></li><li><input type=checkbox id=section-b6e31488b3e951ce956583dfc7ccd8a2 class=toggle>
<label for=section-b6e31488b3e951ce956583dfc7ccd8a2 class=flex><a role=button>日期时间</a>
<img src=/backtrader/icons/chevron-right.svg class=book-icon></label><ul><li><a href=/backtrader/docs/17-datetime/01-management/>管理</a></li><li><a href=/backtrader/docs/17-datetime/02-timer/>定时器</a></li><li><a href=/backtrader/docs/17-datetime/03-trading-calendars/>交易日历</a></li></ul></li><li><a href=/backtrader/docs/18-automated-running/>自动运行</a><ul></ul></li><li><input type=checkbox id=section-1c57bab4ff24bdea61d636c257658085 class=toggle>
<label for=section-1c57bab4ff24bdea61d636c257658085 class=flex><a role=button>官方文章</a>
<img src=/backtrader/icons/chevron-right.svg class=book-icon></label><ul><li><a href=/backtrader/docs/19-articles/01-out-of-memory/>超大内存</a></li><li><a href=/backtrader/docs/19-articles/02-cross-backtesting-pitfalls/>跨平台回测的陷进</a></li><li><a href=/backtrader/docs/19-articles/03-fractional-sizes/>加密货币中的分位仓位</a></li><li><a href=/backtrader/docs/19-articles/04-beating-the-random-entry/>打败随机入场</a></li><li><a href=/backtrader/docs/19-articles/05-rebalancing-conserative/>保守型公式的再平衡</a></li><li><a href=/backtrader/docs/19-articles/06-mfi-generic/>MFI 通用版</a></li></ul></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/backtrader/icons/menu.svg class=book-icon alt=Menu></label><h3>订单</h3><label for=toc-control><img src=/backtrader/icons/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#创建>创建</a></li><li><a href=#取消>取消</a></li><li><a href=#通知>通知</a></li><li><a href=#订单创建>订单创建</a></li><li><a href=#示例>示例</a></li><li><a href=#订单通知>订单通知</a></li><li><a href=#订单状态值>订单状态值</a></li><li><a href=#引用order-及相关类>引用：Order 及相关类</a></li></ul></nav></aside></header><article class="markdown book-article"><h1 id=订单>订单<a class=anchor href=#%e8%ae%a2%e5%8d%95>#</a></h1><p>Cerebro 是 backtrader 中的关键控制系统，而 Strategy（一个子类）是终端用户的关键控制点。后者需要一个连接系统其他部分的方法，这就是订单发挥关键作用的地方。</p><p>订单将策略中的逻辑决策转化为适合 Broker 执行操作的消息。这是通过以下方式完成的：</p><h2 id=创建>创建<a class=anchor href=#%e5%88%9b%e5%bb%ba>#</a></h2><p>通过 Strategy 的方法：<code>buy</code>、<code>sell</code> 和 <code>close</code>（Strategy），这些方法返回一个订单实例作为参考。</p><h2 id=取消>取消<a class=anchor href=#%e5%8f%96%e6%b6%88>#</a></h2><p>通过 Strategy 的方法：<code>cancel</code>（Strategy），该方法需要一个订单实例来操作。</p><p>订单也作为一种通信方式反馈给用户，通知 Broker 中的执行情况。</p><h2 id=通知>通知<a class=anchor href=#%e9%80%9a%e7%9f%a5>#</a></h2><p>通过 Strategy 的方法：<code>notify_order</code>（Strategy），该方法报告一个订单实例。</p><h2 id=订单创建>订单创建<a class=anchor href=#%e8%ae%a2%e5%8d%95%e5%88%9b%e5%bb%ba>#</a></h2><p>调用 <code>buy</code>、<code>sell</code> 和 <code>close</code> 时，以下参数适用于创建：</p><table><thead><tr><th>参数名</th><th>默认值</th><th>描述</th></tr></thead><tbody><tr><td><code>data</code></td><td>None</td><td>为哪个数据创建订单。如果为 None，则使用系统中的第一个数据，<code>self.datas[0]</code> 或 <code>self.data0</code>（又名 <code>self.data</code>）。</td></tr><tr><td><code>size</code></td><td>None</td><td>使用的单位数量。如果为 None，则使用通过 <code>getsizer</code> 获取的 sizer 实例来确定大小。</td></tr><tr><td><code>price</code></td><td>None</td><td>使用的价格（实时 Broker 可能会对格式有实际限制，如果不符合最小刻度要求）。对于 Market 和 Close 订单，None 是有效的（市场决定价格）。对于 Limit、Stop 和 StopLimit 订单，该值决定触发点（在 Limit 的情况下，触发点显然是订单匹配的价格）。</td></tr><tr><td><code>plimit</code></td><td>None</td><td>仅适用于 StopLimit 订单。这是在 Stop 触发后设置隐含 Limit 订单的价格。</td></tr><tr><td><code>exectype</code></td><td>None</td><td>可能的值：<ul style=list-style-type:none;padding-left:0;margin-left:0><li>- <code>Order.Market</code> 或 None：市场订单将以下一个可用价格执行。在回测中，这将是下一根K线的开盘价。</li><li>- <code>Order.Limit</code>：只能在给定价格或更好的价格执行的订单。</li><li>- <code>Order.Stop</code>：在价格触发时执行的订单，执行方式如同 Market 订单。</li><li>- <code>Order.StopLimit</code>：在价格触发时执行的订单，作为隐含 Limit 订单执行，价格由 <code>pricelimit</code> 给定。</li></li></td></tr><tr><td><code>valid</code></td><td>None</td><td>可能的值：<ul style=list-style-type:none;padding-left:0;margin-left:0><li>- None：生成一个不会过期的订单（即 Good till cancel），并在市场中保留直到匹配或取消。实际上，Broker 往往会强制一个时间限制，但这通常是很长时间，所以认为它不会过期。</li><li>- <code>datetime.datetime</code> 或 <code>datetime.date</code> 实例：使用给定的日期生成一个有效直到该日期的订单（即 Good till date）。</li><li>- <code>Order.DAY</code> 或 0 或 <code>timedelta()</code>：生成一个有效期为一天的订单（即日订单），有效期直到会话结束。</li><li>- 数值：假定为一个对应于 <code>matplotlib</code> 编码的日期时间值（backtrader 使用的），并用于生成一个有效期至该时间的订单（即 Good till date）。</li></ul></td></tr><tr><td><code>tradeid</code></td><td>0</td><td>这是 backtrader 用来跟踪同一资产上重叠交易的内部值。在通知订单状态变化时，该 <code>tradeid</code> 会返回给策略。</td></tr><tr><td><code>**kwargs</code></td><td>/</td><td>额外的 Broker 实现可能支持额外的参数。backtrader 会将 kwargs 传递给创建的订单对象。</td></tr></tbody></table><h2 id=示例>示例<a class=anchor href=#%e7%a4%ba%e4%be%8b>#</a></h2><p>如果 backtrader 直接支持的 4 种订单执行类型不够，例如对于 Interactive Brokers，可以传递如下参数：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>orderType<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;LIT&#39;</span>, lmtPrice<span style=color:#f92672>=</span><span style=color:#ae81ff>10.0</span>, auxPrice<span style=color:#f92672>=</span><span style=color:#ae81ff>9.8</span></span></span></code></pre></div><p>这将覆盖 backtrader 的设置，生成一个触及价格为 9.8 且限价为 10.0 的 LIMIT IF TOUCHED 订单。</p><p><strong>注意：</strong></p><p><code>close</code> 方法将检查当前仓位，并相应地使用 <code>buy</code> 或 <code>sell</code> 有效地关闭仓位。除非参数由用户输入，否则大小也将自动计算，在这种情况下可以实现部分关闭或反转。</p><h2 id=订单通知>订单通知<a class=anchor href=#%e8%ae%a2%e5%8d%95%e9%80%9a%e7%9f%a5>#</a></h2><p>要接收通知，必须在用户子类的 Strategy 中重写 <code>notify_order</code> 方法（默认行为是什么都不做）。以下适用于这些通知：</p><ul><li>在策略的 <code>next</code> 方法调用之前发出。</li><li>在同一个 <code>next</code> 循环中，可能（并且会）多次发生相同或不同状态的相同订单通知。</li><li>订单可能会被提交给 Broker，被接受并在 <code>next</code> 再次调用之前完成执行。</li></ul><p>在这种情况下，至少会发生 3 次通知，状态值如下：</p><ul><li><code>Order.Submitted</code> 因为订单已发送给 Broker。</li><li><code>Order.Accepted</code> 因为订单已被 Broker 接受并等待执行。</li><li><code>Order.Completed</code> 因为在示例中订单已快速匹配并完全成交（通常适用于 Market 订单）。</li></ul><p>对于 <code>Order.Partial</code> 状态，即使在回测 Broker 中（不考虑匹配量）不会看到，但在实际 Broker 中肯定会看到。</p><p>实际 Broker 可能会在更新仓位之前发出一次或多次执行通知，这些执行将构成一个 <code>Order.Partial</code> 通知。</p><p>实际执行数据在属性：<code>order.executed</code> 中，这是一个 <code>OrderData</code> 类型的对象，具有常见的字段如大小和价格。</p><p>创建时的值存储在 <code>order.created</code> 中，在订单生命周期中保持不变。</p><h2 id=订单状态值>订单状态值<a class=anchor href=#%e8%ae%a2%e5%8d%95%e7%8a%b6%e6%80%81%e5%80%bc>#</a></h2><p>以下定义：</p><ul><li><code>Order.Created</code>：在创建订单实例时设置。除非手动创建订单实例，否则终端用户不会看到该状态。</li><li><code>Order.Submitted</code>：在订单实例已传输给 Broker 时设置。这只是意味着已发送。在回测模式中这是立即的，但在实际 Broker 中可能需要时间，可能在转发给交易所时才通知。</li><li><code>Order.Accepted</code>：Broker 已接受订单，并在系统中（或已在交易所）等待执行，参数如执行类型、大小、价格和有效期。</li><li><code>Order.Partial</code>：订单已部分执行。<code>order.executed</code> 包含当前填充的大小和平均价格。<ul><li><code>order.executed.exbits</code> 包含部分填充的完整执行位列表。</li></ul></li><li><code>Order.Complete</code>：订单已完全填充平均价格。</li><li><code>Order.Rejected</code>：Broker 拒绝了订单。可能是某个参数（如有效期）不被接受，订单无法接受。<ul><li>原因会通过策略的 <code>notify_store</code> 方法通知。虽然这可能显得奇怪，但实际 Broker 会通过事件通知，这可能与订单直接相关或无关。但可以在 <code>notify_store</code> 中看到 Broker 的通知。</li><li>在回测 Broker 中不会看到此状态。</li></ul></li><li><code>Order.Margin</code>：订单执行将导致保证金要求，之前接受的订单已从系统中移除。</li><li><code>Order.Cancelled</code>（或 <code>Order.Canceled</code>）：用户请求取消的确认。<ul><li>必须考虑，通过策略的 <code>cancel</code> 方法请求取消订单并不保证取消。订单可能已经执行，但此执行可能尚未被 Broker 通知，并且通知可能尚未传递给策略。</li></ul></li><li><code>Order.Expired</code>：之前接受的订单具有时间有效性，已过期并被从系统中移除。</li></ul><h2 id=引用order-及相关类>引用：Order 及相关类<a class=anchor href=#%e5%bc%95%e7%94%a8order-%e5%8f%8a%e7%9b%b8%e5%85%b3%e7%b1%bb>#</a></h2><p>这些对象是 backtrader 生态系统中的通用类。在与其他 Broker 操作时，它们可能已扩展和/或包含额外的嵌入信息。请参阅相应 Broker 的参考。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>backtrader</span><span style=color:#f92672>.</span>order<span style=color:#f92672>.</span>Order()</span></span></code></pre></div><p>持有创建/执行数据和订单类型的类。</p><p>订单可能具有以下状态：</p><ul><li><code>Submitted</code>：发送给 Broker，等待确认。</li><li><code>Accepted</code>：被 Broker 接受。</li><li><code>Partial</code>：部分执行。</li><li><code>Completed</code>：完全执行。</li><li><code>Canceled/Cancelled</code>：被用户取消。</li><li><code>Expired</code>：过期。</li><li><code>Margin</code>：没有足够的现金执行订单。</li><li><code>Rejected</code>：被 Broker 拒绝。<ul><li>这可能发生在订单提交期间（因此订单不会达到 <code>Accepted</code> 状态），或者在执行前因每根新K线价格变化，现金被其他来源（如期货类工具）抽取导致拒绝。</li></ul></li></ul><p>成员属性：</p><ul><li><code>ref</code>：唯一订单标识符。</li><li><code>created</code>：持有创建数据的 <code>OrderData</code>。</li><li><code>executed</code>：持有执行数据的 <code>OrderData</code>。</li><li><code>info</code>：通过 <code>addinfo()</code> 方法传递的自定义信息。以子类化的 <code>OrderedDict</code> 形式保存，键也可以使用<code>.</code>符号指定。</li></ul><p>用户方法：</p><ul><li><code>isbuy()</code>：返回一个布尔值，指示订单是否买入。</li><li><code>issell()</code>：返回一个布尔值，指示订单是否卖出。</li><li><code>alive()</code>：返回一个布尔值，如果订单状态为 <code>Partial</code> 或 <code>Accepted</code>。</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>backtrader</span><span style=color:#f92672>.</span>order<span style=color:#f92672>.</span>OrderData(dt<span style=color:#f92672>=</span><span style=color:#66d9ef>None</span>, size<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>, price<span style=color:#f92672>=</span><span style=color:#ae81ff>0.0</span>, pricelimit<span style=color:#f92672>=</span><span style=color:#ae81ff>0.0</span>, remsize
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>, pclose<span style=color:#f92672>=</span><span style=color:#ae81ff>0.0</span>, trailamount<span style=color:#f92672>=</span><span style=color:#ae81ff>0.0</span>, trailpercent<span style=color:#f92672>=</span><span style=color:#ae81ff>0.0</span>)</span></span></code></pre></div><p>持有创建和执行实际订单数据。</p><p>在创建情况下，请求的数据，在执行情况下，实际结果。</p><p>成员属性：</p><ul><li><code>exbits</code>：此 <code>OrderData</code> 的 <code>OrderExecutionBits</code> 的可迭代对象。</li><li><code>dt</code>：日期时间（浮点数）创建/执行时间。</li><li><code>size</code>：请求/执行大小。</li><li><code>price</code>：执行价格。注意：如果没有价格和 <code>pricelimit</code>，订单创建时的收盘价将作为参考。</li><li><code>pricelimit</code>：StopLimit 的价格限制（首先有触发）。</li><li><code>trailamount</code>：追踪止损的绝对价格距离。</li><li><code>trailpercent</code>：追踪止损的百分比价格距离。</li><li><code>value</code>：整个位大小的市场价值。</li><li><code>comm</code>：整个位执行的佣金。</li><li><code>pnl</code>：此位产生的盈亏（如果有关闭）。</li><li><code>margin</code>：订单产生的保证金（如果有）。</li><li><code>psize</code>：当前未平仓头寸大小。</li><li><code>pprice</code>：当前未平仓头寸价格。</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>backtrader</span><span style=color:#f92672>.</span>order<span style=color:#f92672>.</span>OrderExecutionBit(dt<span style=color:#f92672>=</span><span style=color:#66d9ef>None</span>, size<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>, price<span style=color:#f92672>=</span><span style=color:#ae81ff>0.0</span>, closed<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>, closedvalue<span style=color:#f92672>=</span><span style=color:#ae81ff>0.0</span>, closedcomm<span style=color:#f92672>=</span><span style=color:#ae81ff>0.0</span>, opened<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>, openedvalue<span style=color:#f92672>=</span><span style=color:#ae81ff>0.0</span>, openedcomm<span style=color:#f92672>=</span><span style=color:#ae81ff>0.0</span>, pnl<span style=color:#f92672>=</span><span style=color:#ae81ff>0.0</span>, psize<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>, pprice<span style=color:#f92672>=</span><span style=color:#ae81ff>0.0</span>)</span></span></code></pre></div><p>旨在持有订单执行信息。“位”不确定订单是否已完全/部分执行，只是持有信息。</p><p>成员属性：</p><ul><li><code>dt</code>：日期时间（浮点数）执行时间。</li><li><code>size</code>：执行数量。</li><li><code>price</code>：执行价格。</li><li><code>closed</code>：执行关闭了多少现有头寸。</li><li><code>opened</code>：执行打开了多少新头寸。</li><li><code>openedvalue</code>：新开部分的市场价值。</li><li><code>closedvalue</code>：关闭部分的市场价值。</li><li><code>closedcomm</code>：关闭部分的佣金。</li><li><code>openedcomm</code>：打开部分的佣金。</li><li><code>value</code>：整个位大小的市场价值。</li><li><code>comm</code>：整个位执行的佣金。</li><li><code>pnl</code>：此位产生的盈亏（如果有关闭）。</li><li><code>psize</code>：当前未平仓头寸大小。</li><li><code>pprice</code>：当前未平仓头寸价格。</li></ul></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div></div><div></div></div><div class="flex flex-wrap justify-between"><span><a href=/backtrader/docs/08-indicators/04-talib/ class="flex align-center"><img src=/backtrader/icons/backward.svg class=book-icon alt=Previous title=TA-Lib>
<span>TA-Lib</span>
</a></span><span><a href=/backtrader/docs/09-orders/02-creation-execution/ class="flex align-center"><span>创建/执行</span>
<img src=/backtrader/icons/forward.svg class=book-icon alt=Next title=创建/执行></a></span></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script><div class=book-comments><script src=https://utteranc.es/client.js repo=poloxue/blog issue-term=pathname theme=github-dark crossorigin=anonymous async></script></div></footer><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#创建>创建</a></li><li><a href=#取消>取消</a></li><li><a href=#通知>通知</a></li><li><a href=#订单创建>订单创建</a></li><li><a href=#示例>示例</a></li><li><a href=#订单通知>订单通知</a></li><li><a href=#订单状态值>订单状态值</a></li><li><a href=#引用order-及相关类>引用：Order 及相关类</a></li></ul></nav></div></aside></main></body></html>