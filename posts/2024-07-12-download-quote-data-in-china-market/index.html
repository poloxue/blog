<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>使用 Akshare 下载国内的期货（主力连续）、股票和指数的历史行情数据 - POLOXUE's BLOG</title><meta name=viewport content="width=device-width,initial-scale=1"><meta itemprop=name content="使用 Akshare 下载国内的期货（主力连续）、股票和指数的历史行情数据"><meta itemprop=description content="本文介绍如何使用 akshare 下载国内的期货、股票和指数的历史行情数据。"><meta itemprop=datePublished content="2024-07-12T18:10:16+08:00"><meta itemprop=dateModified content="2024-07-12T18:10:16+08:00"><meta itemprop=wordCount content="689"><meta itemprop=keywords content><meta property="og:title" content="使用 Akshare 下载国内的期货（主力连续）、股票和指数的历史行情数据"><meta property="og:description" content="本文介绍如何使用 akshare 下载国内的期货、股票和指数的历史行情数据。"><meta property="og:type" content="article"><meta property="og:url" content="https://www.poloxue.com/posts/2024-07-12-download-quote-data-in-china-market/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-07-12T18:10:16+08:00"><meta property="article:modified_time" content="2024-07-12T18:10:16+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="使用 Akshare 下载国内的期货（主力连续）、股票和指数的历史行情数据"><meta name=twitter:description content="本文介绍如何使用 akshare 下载国内的期货、股票和指数的历史行情数据。"><script data-goatcounter=https://poloxue.goatcounter.com/count async src=//gc.zgo.at/count.js></script>
<link rel=stylesheet type=text/css media=screen href=https://www.poloxue.com/css/normalize.css><link rel=stylesheet type=text/css media=screen href=https://www.poloxue.com/css/main.css><link rel=stylesheet type=text/css media=screen href=https://www.poloxue.com/css/extra.css><link id=dark-scheme rel=stylesheet type=text/css href=https://www.poloxue.com/css/dark.css><script src=https://www.poloxue.com/js/feather.min.js></script>
<script src=https://www.poloxue.com/js/main.js></script>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7019080091542951" crossorigin=anonymous></script></head><body><div class="container-wide wrapper"><div class=header><div class=avatar><a href=https://www.poloxue.com/><img src=/avatar.png alt="POLOXUE's BLOG"></a></div><h1 class=site-title><a href=https://www.poloxue.com/>POLOXUE's BLOG</a></h1><div class=site-description><nav class="nav social"><ul class=flat><li><a href=https://github.com/poloxue/ title=Github><i data-feather=github></i></a></li><li><a href=/posts/index.xml title=RSS><i data-feather=rss></i></a></li><li><a href=/ title=Wechat><i data-feather=message-circle></i></a></li><span class=scheme-toggle><a href=# id=scheme-toggle></a></ul></nav></div><nav class=nav><ul class=flat><li><a href=/>文章列表</a></li><li><a href=/tags>分类标签</a></li><li><a href=/about/about>关于我</a></li></ul></nav></div><div class=article-nav id=article-nav-id><div class=post><div class=post-header><div class=meta><div class=date><span class=day>12</span>
<span class=rest>Jul 2024</span></div></div><div class=matter><h1 class=title>使用 Akshare 下载国内的期货（主力连续）、股票和指数的历史行情数据</h1></div></div><aside class="show-on-mobile toc" id=static-toc><header><h3>Contents</h3></header><nav id=TableOfContents><ol><li><a href=#安装-akshare>安装 Akshare</a></li><li><a href=#下载期货数据>下载期货数据</a></li><li><a href=#南华期货指数>南华期货指数</a></li><li><a href=#下载股票数据>下载股票数据</a></li><li><a href=#下载指数数据>下载指数数据</a></li><li><a href=#主函数>主函数</a></li><li><a href=#示例使用>示例使用</a></li><li><a href=#指标计算>指标计算</a></li></ol></nav></aside><p><img src=https://cdn.jsdelivr.net/gh/poloxue/images@2024-07/2024-07-12-download-quote-data-in-china-market-00.webp alt></p><p>本文介绍如何使用 akshare 封装一个易用的下载国内期货、期货指数、股票和股票指数的历史行情数据接口。</p><p>目标接口的定义如下所示：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>history_bars(symbol, length<span style=color:#f92672>=</span><span style=color:#ae81ff>100</span>, equity_type<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;future&#34;</span>)
</span></span></code></pre></td></tr></table></div></div><p>这么封装也是为了便于使用。</p><p>如果不了解 akshare，我已经写过一篇关于 akshare 下载金融数据的文章：<a href=https://www.poloxue.com/posts/2024-11-02-financial-market-data/>通过 python 获取金融数据-akshare</a>。</p><h2 id=安装-akshare>安装 Akshare</h2><p>请确保已安装 Akshare，如下命令安装：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pip install akshare
</span></span></code></pre></td></tr></table></div></div><p>了解它的更多数据，可查看它的文档：<a href=https://akshare.akfamily.xyz/platform.html>akshare documentation</a></p><h2 id=下载期货数据>下载期货数据</h2><p>akshare 中的主力和连续合约的数据是从新浪财经下载的，要请求行情接口，首先要知道品种对应的 symbol 名称。它的 symbol 名称可以通过函数 <code>futures_display_main_sina</code> 拿到映射关系。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> akshare <span style=color:#66d9ef>as</span> aks
</span></span><span style=display:flex><span>print(aks<span style=color:#f92672>.</span>futures_display_main_sina())
</span></span></code></pre></td></tr></table></div></div><p>输出：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>   symbol exchange         name
</span></span><span style=display:flex><span><span style=color:#ae81ff>0</span>      V0      dce        PVC连续
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span>      P0      dce        棕榈油连续
</span></span><span style=display:flex><span><span style=color:#ae81ff>2</span>      B0      dce         豆二连续
</span></span><span style=display:flex><span><span style=color:#ae81ff>3</span>      M0      dce         豆粕连续
</span></span><span style=display:flex><span><span style=color:#ae81ff>4</span>      I0      dce        铁矿石连续
</span></span><span style=display:flex><span>..    ...      ...          ...
</span></span><span style=display:flex><span><span style=color:#ae81ff>72</span>    IC0    cffex  中证500指数期货连续
</span></span><span style=display:flex><span><span style=color:#ae81ff>73</span>    TS0    cffex    2年期国债期货连续
</span></span><span style=display:flex><span><span style=color:#ae81ff>74</span>    IM0    cffex   中证连续指数期货连续
</span></span><span style=display:flex><span><span style=color:#ae81ff>75</span>    SI0     gfex        工业硅连续
</span></span><span style=display:flex><span><span style=color:#ae81ff>76</span>    LC0     gfex        碳酸锂连续
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span><span style=color:#ae81ff>77</span> rows x <span style=color:#ae81ff>3</span> columns<span style=color:#f92672>]</span>
</span></span></code></pre></td></tr></table></div></div><p>现在将 symbol 传递给 <code>futures_main_sina</code> 函数即可下载合约的历史数据。</p><p>如上的 C0 表示的是玉米主力合约，下载它的日线行情：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>data <span style=color:#f92672>=</span> aks<span style=color:#f92672>.</span>futures_main_sina(
</span></span><span style=display:flex><span>    symbol<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;C0&#34;</span>,
</span></span><span style=display:flex><span>    start_date<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;20230101&#34;</span>
</span></span><span style=display:flex><span>)
</span></span></code></pre></td></tr></table></div></div><p>为便于统一封装到 <code>history_bars</code>，我们定义一个函数 <code>future_history_bars</code>，参数是 symbol 名称和长度，将输出结果转换为易读的格式。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>future_history_bars</span>(symbol, length<span style=color:#f92672>=</span><span style=color:#ae81ff>100</span>):
</span></span><span style=display:flex><span>    start_date <span style=color:#f92672>=</span> datetime<span style=color:#f92672>.</span>now() <span style=color:#f92672>-</span> timedelta(days<span style=color:#f92672>=</span>length <span style=color:#f92672>*</span> <span style=color:#ae81ff>2</span>)
</span></span><span style=display:flex><span>    data <span style=color:#f92672>=</span> aks<span style=color:#f92672>.</span>futures_main_sina(
</span></span><span style=display:flex><span>        symbol<span style=color:#f92672>=</span>symbol, start_date<span style=color:#f92672>=</span>start_date<span style=color:#f92672>.</span>strftime(<span style=color:#e6db74>&#34;%Y%m</span><span style=color:#e6db74>%d</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>    data <span style=color:#f92672>=</span> data<span style=color:#f92672>.</span>rename(
</span></span><span style=display:flex><span>        columns<span style=color:#f92672>=</span>{
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;日期&#34;</span>: <span style=color:#e6db74>&#34;date&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;开盘价&#34;</span>: <span style=color:#e6db74>&#34;open&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;最高价&#34;</span>: <span style=color:#e6db74>&#34;high&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;最低价&#34;</span>: <span style=color:#e6db74>&#34;low&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;收盘价&#34;</span>: <span style=color:#e6db74>&#34;close&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;成交量&#34;</span>: <span style=color:#e6db74>&#34;volume&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;持仓量&#34;</span>: <span style=color:#e6db74>&#34;open_interest&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;动态结算价&#34;</span>: <span style=color:#e6db74>&#34;settle_price&#34;</span>,
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>    data[<span style=color:#e6db74>&#34;open&#34;</span>] <span style=color:#f92672>=</span> data[<span style=color:#e6db74>&#34;open&#34;</span>]<span style=color:#f92672>.</span>astype(float)
</span></span><span style=display:flex><span>    data[<span style=color:#e6db74>&#34;high&#34;</span>] <span style=color:#f92672>=</span> data[<span style=color:#e6db74>&#34;high&#34;</span>]<span style=color:#f92672>.</span>astype(float)
</span></span><span style=display:flex><span>    data[<span style=color:#e6db74>&#34;low&#34;</span>] <span style=color:#f92672>=</span> data[<span style=color:#e6db74>&#34;low&#34;</span>]<span style=color:#f92672>.</span>astype(float)
</span></span><span style=display:flex><span>    data[<span style=color:#e6db74>&#34;close&#34;</span>] <span style=color:#f92672>=</span> data[<span style=color:#e6db74>&#34;close&#34;</span>]<span style=color:#f92672>.</span>astype(float)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> data<span style=color:#f92672>.</span>iloc[<span style=color:#f92672>-</span>length:]
</span></span></code></pre></td></tr></table></div></div><p>上面的参数和输出的定义看个人习惯，我比较习惯这样的使用方式，便于我计算指标。</p><blockquote><p><strong>提醒：</strong></p><p>上述的按 length 获取数据的方式没有按交易日历来，只是粗略地从当前时间往前推 <code>2*length</code> 个周期得到开始时间 <code>start_date</code>，如果 <code>length</code> 太小，例如两个周期，如果赶上假期，就可能获取不到数据，这点要注意的。</p><p>如果想长度精确，最简单的方式就是把数据存入数据库，通过 SOL 加载。或者是拿到交易日历，按日历计算交易天数。</p></blockquote><h2 id=南华期货指数>南华期货指数</h2><p>我最初封装这个接口是为了回测策略，但发现期货主连数据是未复权的数据，没有考虑换仓，不符合真实交易场景。</p><p>有没有满足需求的数据？</p><p>当然有！市面上有南华期货指数，它考虑了换仓的场景，经过复权编制出的数据，符合真实交易场景，可用来回测。</p><p>akshare 的文档中提供了南华指数的接口，我测试了下。很遗憾，几个接口都不能用了。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># aks.futures_index_symbol_table_nh() 南华 symbol 表格</span>
</span></span><span style=display:flex><span><span style=color:#75715e># aks.futures_price_index_nh() 南华价格指数</span>
</span></span><span style=display:flex><span><span style=color:#75715e># aks.futures_return_index_nh() 南华收益指数</span>
</span></span></code></pre></td></tr></table></div></div><p>我本希望这篇文章中都是免费数据，但确实没有找到好的渠道。如果确有需要，可从 tushare 下载，访问 <a href="https://www.tushare.pro/document/2?doc_id=155">南华期货指数日线行情</a>。</p><p>除了使用南华期货指数，也可自己计算，前提是知道主连合约的换仓时间。在 akshare 上没发现这个数据，如需要，也可从 tushare 下载，访问<a href="https://www.tushare.pro/document/2?doc_id=189">期货主力与连续合约</a>，其中包含了主连合约每天映射的实际合约。</p><p>将 tushare 的南华指数行情封装到成 <code>history_bars</code> 的形式。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>nanhua_future_history_bars</span>(symbol, length<span style=color:#f92672>=</span><span style=color:#ae81ff>100</span>):
</span></span><span style=display:flex><span>    start_date <span style=color:#f92672>=</span> (datetime<span style=color:#f92672>.</span>now() <span style=color:#f92672>-</span> timedelta(days<span style=color:#f92672>=</span>length <span style=color:#f92672>*</span> <span style=color:#ae81ff>2</span>))<span style=color:#f92672>.</span>strftime(<span style=color:#e6db74>&#34;%Y%m</span><span style=color:#e6db74>%d</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>    end_date <span style=color:#f92672>=</span> datetime<span style=color:#f92672>.</span>now()<span style=color:#f92672>.</span>strftime(<span style=color:#e6db74>&#34;%Y%m</span><span style=color:#e6db74>%d</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    pro <span style=color:#f92672>=</span> ts<span style=color:#f92672>.</span>pro_api()
</span></span><span style=display:flex><span>    data <span style=color:#f92672>=</span> pro<span style=color:#f92672>.</span>index_daily(ts_code<span style=color:#f92672>=</span>symbol, start_date<span style=color:#f92672>=</span>start_date, end_date<span style=color:#f92672>=</span>end_date)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> len(data):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    data<span style=color:#f92672>.</span>dropna(inplace<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>)
</span></span><span style=display:flex><span>    data<span style=color:#f92672>.</span>rename(columns<span style=color:#f92672>=</span>{<span style=color:#e6db74>&#34;trade_date&#34;</span>: <span style=color:#e6db74>&#34;date&#34;</span>, <span style=color:#e6db74>&#34;vol&#34;</span>: <span style=color:#e6db74>&#34;volume&#34;</span>}, inplace<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>)
</span></span><span style=display:flex><span>    data<span style=color:#f92672>.</span>sort_values(by<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;date&#34;</span>)
</span></span><span style=display:flex><span>    data[<span style=color:#e6db74>&#34;date&#34;</span>] <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>to_datetime(data[<span style=color:#e6db74>&#34;date&#34;</span>])
</span></span><span style=display:flex><span>    data<span style=color:#f92672>.</span>set_index(<span style=color:#e6db74>&#34;date&#34;</span>, inplace<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> data
</span></span></code></pre></td></tr></table></div></div><h2 id=下载股票数据>下载股票数据</h2><p>A 股股票数据可使用 <code>stock_zh_a_hist</code> 下载，它的输入参数包括股票代码、周期、复权方式和起始日期等参数。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>data <span style=color:#f92672>=</span> aks<span style=color:#f92672>.</span>stock_zh_a_hist(
</span></span><span style=display:flex><span>    symbol<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;000001&#34;</span>,
</span></span><span style=display:flex><span>    period<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;daily&#34;</span>,
</span></span><span style=display:flex><span>    adjust<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;qfq&#34;</span>,
</span></span><span style=display:flex><span>    start_date<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;20230101&#34;</span>
</span></span><span style=display:flex><span>)
</span></span></code></pre></td></tr></table></div></div><p>我们的习惯，一般默认前复权即可。</p><p>为了使用方便，同样可定义一个函数，易于使用：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>stock_history_bars</span>(symbol, length<span style=color:#f92672>=</span><span style=color:#ae81ff>100</span>):
</span></span><span style=display:flex><span>    start_date <span style=color:#f92672>=</span> datetime<span style=color:#f92672>.</span>now() <span style=color:#f92672>-</span> timedelta(days<span style=color:#f92672>=</span>length <span style=color:#f92672>*</span> <span style=color:#ae81ff>2</span>)
</span></span><span style=display:flex><span>    data <span style=color:#f92672>=</span> aks<span style=color:#f92672>.</span>stock_zh_a_hist(
</span></span><span style=display:flex><span>        symbol<span style=color:#f92672>=</span>symbol,
</span></span><span style=display:flex><span>        period<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;daily&#34;</span>,
</span></span><span style=display:flex><span>        adjust<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;qfq&#34;</span>,
</span></span><span style=display:flex><span>        start_date<span style=color:#f92672>=</span>start_date<span style=color:#f92672>.</span>strftime(<span style=color:#e6db74>&#34;%Y%m</span><span style=color:#e6db74>%d</span><span style=color:#e6db74>&#34;</span>),
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> data<span style=color:#f92672>.</span>rename(
</span></span><span style=display:flex><span>        columns<span style=color:#f92672>=</span>{
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;日期&#34;</span>: <span style=color:#e6db74>&#34;date&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;股票代码&#34;</span>: <span style=color:#e6db74>&#34;symbol&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;开盘&#34;</span>: <span style=color:#e6db74>&#34;open&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;最高&#34;</span>: <span style=color:#e6db74>&#34;high&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;最低&#34;</span>: <span style=color:#e6db74>&#34;low&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;收盘&#34;</span>: <span style=color:#e6db74>&#34;close&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;成交量&#34;</span>: <span style=color:#e6db74>&#34;volume&#34;</span>,
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    )[
</span></span><span style=display:flex><span>        [
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;date&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;symbol&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;open&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;high&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;low&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;close&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;volume&#34;</span>,
</span></span><span style=display:flex><span>        ]
</span></span><span style=display:flex><span>    ]<span style=color:#f92672>.</span>iloc[
</span></span><span style=display:flex><span>        <span style=color:#f92672>-</span>length:
</span></span><span style=display:flex><span>    ]
</span></span></code></pre></td></tr></table></div></div><p>我们可以定义一个函数，下载特定指数的历史数据，并将其转换为更易读的格式：</p><h2 id=下载指数数据>下载指数数据</h2><p>A 股指数数据可通过 <code>index_zh_a_hist</code> 函数实现。输入参数包括指数代码、周期和起始日期等参数。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>data <span style=color:#f92672>=</span> aks<span style=color:#f92672>.</span>index_zh_a_hist(
</span></span><span style=display:flex><span>    symbol<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;000001&#34;</span>,
</span></span><span style=display:flex><span>    period<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;daily&#34;</span>,
</span></span><span style=display:flex><span>    start_date<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;20230101&#34;</span>,
</span></span><span style=display:flex><span>    end_date<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;20231231&#34;</span>
</span></span><span style=display:flex><span>)
</span></span></code></pre></td></tr></table></div></div><p>将其实现为 history_bar 函数的形式，便于我的使用。如下所示：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>index_history_bars</span>(symbol, length<span style=color:#f92672>=</span><span style=color:#ae81ff>100</span>):
</span></span><span style=display:flex><span>    start_date <span style=color:#f92672>=</span> (datetime<span style=color:#f92672>.</span>now() <span style=color:#f92672>-</span> timedelta(days<span style=color:#f92672>=</span>length <span style=color:#f92672>*</span> <span style=color:#ae81ff>2</span>))<span style=color:#f92672>.</span>strftime(<span style=color:#e6db74>&#34;%Y%m</span><span style=color:#e6db74>%d</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>    end_date <span style=color:#f92672>=</span> datetime<span style=color:#f92672>.</span>now()<span style=color:#f92672>.</span>strftime(<span style=color:#e6db74>&#34;%Y%m</span><span style=color:#e6db74>%d</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>    data <span style=color:#f92672>=</span> aks<span style=color:#f92672>.</span>index_zh_a_hist(
</span></span><span style=display:flex><span>        symbol<span style=color:#f92672>=</span>symbol,
</span></span><span style=display:flex><span>        period<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;daily&#34;</span>,
</span></span><span style=display:flex><span>        start_date<span style=color:#f92672>=</span>start_date,
</span></span><span style=display:flex><span>        end_date<span style=color:#f92672>=</span>end_date,
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> data<span style=color:#f92672>.</span>rename(
</span></span><span style=display:flex><span>        columns<span style=color:#f92672>=</span>{
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;日期&#34;</span>: <span style=color:#e6db74>&#34;date&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;开盘&#34;</span>: <span style=color:#e6db74>&#34;open&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;最高&#34;</span>: <span style=color:#e6db74>&#34;high&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;最低&#34;</span>: <span style=color:#e6db74>&#34;low&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;收盘&#34;</span>: <span style=color:#e6db74>&#34;close&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;成交量&#34;</span>: <span style=color:#e6db74>&#34;volume&#34;</span>,
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    )[
</span></span><span style=display:flex><span>        [
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;date&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;open&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;high&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;low&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;close&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;volume&#34;</span>,
</span></span><span style=display:flex><span>        ]
</span></span><span style=display:flex><span>    ]<span style=color:#f92672>.</span>iloc[
</span></span><span style=display:flex><span>        <span style=color:#f92672>-</span>length:
</span></span><span style=display:flex><span>    ]
</span></span></code></pre></td></tr></table></div></div><p>现在，我们就已经有了三种不同交易品种的历史数据获取方法。</p><h2 id=主函数>主函数</h2><p>最后，还可以定义一个主函数，根据输入的类型下载相应的历史数据：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>history_bars</span>(symbol, length<span style=color:#f92672>=</span><span style=color:#ae81ff>100</span>, equity_type<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;stock&#34;</span>):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> equity_type <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;stock&#34;</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> stock_history_bar(symbol, length<span style=color:#f92672>=</span>length)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>elif</span> equity_type <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;future&#34;</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> future_history_bar(symbol, length<span style=color:#f92672>=</span>length)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>elif</span> equity_type <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;nan_future&#34;</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> nanhua_future_history_bar(symbol, length<span style=color:#f92672>=</span>length)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>elif</span> equity_type <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;index&#34;</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> index_history_bar(symbol, length<span style=color:#f92672>=</span>length)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>raise</span> <span style=color:#a6e22e>ValueError</span>(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Unsupported equity type: </span><span style=color:#e6db74>{</span>equity_type<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span></code></pre></td></tr></table></div></div><p>现在，是不是使用起来就非常方便了。</p><h2 id=示例使用>示例使用</h2><p>通过以下示例演示如何调用这些函数来获取不同品种的历史行情数据：</p><p>获取上证数据数据：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>symbol <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;000001&#34;</span>  <span style=color:#75715e># 上证指数</span>
</span></span><span style=display:flex><span>length <span style=color:#f92672>=</span> <span style=color:#ae81ff>100</span>
</span></span><span style=display:flex><span>equity_type <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;index&#34;</span>
</span></span><span style=display:flex><span>data <span style=color:#f92672>=</span> history_bars(symbol, length, equity_type)
</span></span><span style=display:flex><span>print(data)
</span></span></code></pre></td></tr></table></div></div><p>获取平安银行数据：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>symbol <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;000001&#34;</span>  <span style=color:#75715e># 平安银行</span>
</span></span><span style=display:flex><span>length <span style=color:#f92672>=</span> <span style=color:#ae81ff>100</span>
</span></span><span style=display:flex><span>equity_type <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;stock&#34;</span>
</span></span><span style=display:flex><span>data <span style=color:#f92672>=</span> history_bars(symbol, length, equity_type)
</span></span><span style=display:flex><span>print(data)
</span></span></code></pre></td></tr></table></div></div><p>获取甲醇行情数据：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>symbol <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;MA0&#34;</span>  <span style=color:#75715e># 甲醇主连</span>
</span></span><span style=display:flex><span>length <span style=color:#f92672>=</span> <span style=color:#ae81ff>100</span>
</span></span><span style=display:flex><span>equity_type <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;stock&#34;</span>
</span></span><span style=display:flex><span>data <span style=color:#f92672>=</span> history_bars(symbol, length, equity_type)
</span></span><span style=display:flex><span>print(data)
</span></span></code></pre></td></tr></table></div></div><p>通过以上代码，现在就有了轻松下载股票、指数和期货历史数据的能力。这为数据分析提供了有力的支持。</p><p><code>history_bars</code> 的代码请查看 <a href=https://gist.github.com/poloxue/a913534bc92c7fb29f0ffab5647a8ab3>hist_data.py</a>。</p><p>现在有了数据，就可以实现任何其他我们像实现的事情，如计算指标发送告警，绘制图表，如果有交易 API 接口，可直接报单，不过这个前提是有了好的策略。</p><h2 id=指标计算>指标计算</h2><p>简单演示下指标计算，如 rsi 上穿 30 可能表示短期价格有反弹，就可以发个报警，增加对这个标的的观察。</p><p>指标计算可用 talib 实现，如下所示：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> talib
</span></span><span style=display:flex><span>data <span style=color:#f92672>=</span> history_bars(<span style=color:#e6db74>&#34;000001&#34;</span>, length<span style=color:#f92672>=</span><span style=color:#ae81ff>100</span>, equity_type<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;stock&#34;</span>)
</span></span><span style=display:flex><span>rsi <span style=color:#f92672>=</span> talib<span style=color:#f92672>.</span>RSI(data[<span style=color:#e6db74>&#39;close&#39;</span>]<span style=color:#f92672>.</span>values)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>rsi0 <span style=color:#f92672>=</span> rsi[<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>]
</span></span><span style=display:flex><span>rsi1 <span style=color:#f92672>=</span> rsi[<span style=color:#f92672>-</span><span style=color:#ae81ff>2</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>crossover <span style=color:#f92672>=</span> rsi0 <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>30</span> <span style=color:#f92672>and</span> rsi1 <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>30</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> crossover:
</span></span><span style=display:flex><span>  print(<span style=color:#e6db74>&#34;触发报警条件&#34;</span>)
</span></span></code></pre></td></tr></table></div></div><p>希望本文对您有所帮助。如果有任何问题或建议，欢迎随时联系我。</p><div>本文来源于 <a href=https://www.poloxue.com>POLOXUE's BLOG</a>，地址： <a href=https://www.poloxue.com/posts/2024-07-12-download-quote-data-in-china-market/>使用 Akshare 下载国内的期货（主力连续）、股票和指数的历史行情数据</a></div></div><nav class="hide-on-mobile section-nav"><nav id=TableOfContents><ol><li><a href=#安装-akshare>安装 Akshare</a></li><li><a href=#下载期货数据>下载期货数据</a></li><li><a href=#南华期货指数>南华期货指数</a></li><li><a href=#下载股票数据>下载股票数据</a></li><li><a href=#下载指数数据>下载指数数据</a></li><li><a href=#主函数>主函数</a></li><li><a href=#示例使用>示例使用</a></li><li><a href=#指标计算>指标计算</a></li></ol></nav></nav></div><div class=post><hr class=footer-separator><div class=tags></div><div class=back><a href=https://www.poloxue.com/><span aria-hidden=true>← Back</span></a></div><div class=back></div></div><div class=post><img style=width:85% src=https://cdn.jsdelivr.net/gh/poloxue/images@main/wechat.png><div class=utterances></div><script src=https://utteranc.es/client.js repo=poloxue/blog issue-term=pathname theme=github-light crossorigin=anonymous async></script></div></div><div class="footer wrapper"><nav class=nav><div>2024 Polo Xue All rights reserved</div></nav></div><script>feather.replace()</script><script>var enableTruncate=!0,filterDepth=!1;const MAX_DEPTH=9;window.addEventListener("DOMContentLoaded",()=>{const e=new IntersectionObserver(e=>{e.reverse().forEach(e=>{const n=e.target.getAttribute("id");if(e.intersectionRatio>0){var t=document.querySelectorAll(`nav li a[href="#${n}"]`);t!=null&&t.forEach(e=>{if(e!=null){var t=getDepth(e.parentElement);filterDepth&&t<=MAX_DEPTH&&(clearActiveStatesInTableOfContents(),e.parentElement.classList.add("active"))}else filterDepth||(clearActiveStatesInTableOfContents(),e.parentElement.classList.add("active"))})}})});document.querySelectorAll("h1[id],h2[id],h3[id],h4[id]").forEach(t=>{e.observe(t)})});function isVisible(e){if(!(e instanceof Element))return!1;const n=getComputedStyle(e);if(n.display==="none")return!1;if(n.visibility!=="visible")return!1;if(n.opacity<.1)return!1;if(e.offsetWidth+e.offsetHeight+e.getBoundingClientRect().height+e.getBoundingClientRect().width===0)return!1;const t={x:e.getBoundingClientRect().left+e.offsetWidth/2,y:e.getBoundingClientRect().top+e.offsetHeight/2};if(t.x<0)return!1;if(t.x>(document.documentElement.clientWidth||window.innerWidth))return!1;if(t.y<0)return!1;if(t.y>(document.documentElement.clientHeight||window.innerHeight))return!1;let s=document.elementFromPoint(t.x,t.y);do if(s===e)return!0;while(s=s.parentNode)return!1}function clearActiveStatesInTableOfContents(){document.querySelectorAll("nav li").forEach(e=>{e.classList.remove("active")})}function getDepth(e){for(var t=0;e!==null&&e.tagName.toLowerCase()!=="ul";)t++,e=e.parentElement;return t}function navItems(){var e=document.querySelectorAll("nav nav li a");return Array.from(e).filter(e=>e.href!=null&&e.hash.startsWith("#"))}function lasItemInNavBarVisible(){var e=navItems().slice(-1)[0];return isVisible(e)}document.addEventListener("DOMContentLoaded",function(){if(!enableTruncate)return;var e=navItems();console.log(e),lasItemInNavBarVisible()||(filterDepth=!0,e.forEach(function(e){var t=getDepth(e.parentElement);t>MAX_DEPTH&&e.parentElement.classList.add("depth-nested")}))})</script></body></html>