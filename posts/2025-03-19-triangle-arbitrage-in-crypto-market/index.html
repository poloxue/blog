<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>实时监控加密货币现货市场的三角套利机会 - POLOXUE's BLOG</title><meta name=viewport content="width=device-width,initial-scale=1"><meta itemprop=name content="实时监控加密货币现货市场的三角套利机会"><meta itemprop=description content="本文继续介绍一个常见的套利策略，三角套利策略。"><meta itemprop=datePublished content="2025-03-19T17:04:44+08:00"><meta itemprop=dateModified content="2025-03-19T17:04:44+08:00"><meta itemprop=wordCount content="516"><meta itemprop=keywords content><meta property="og:title" content="实时监控加密货币现货市场的三角套利机会"><meta property="og:description" content="本文继续介绍一个常见的套利策略，三角套利策略。"><meta property="og:type" content="article"><meta property="og:url" content="https://www.poloxue.com/posts/2025-03-19-triangle-arbitrage-in-crypto-market/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-03-19T17:04:44+08:00"><meta property="article:modified_time" content="2025-03-19T17:04:44+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="实时监控加密货币现货市场的三角套利机会"><meta name=twitter:description content="本文继续介绍一个常见的套利策略，三角套利策略。"><script data-goatcounter=https://poloxue.goatcounter.com/count async src=//gc.zgo.at/count.js></script>
<link rel=stylesheet type=text/css media=screen href=https://www.poloxue.com/css/normalize.css><link rel=stylesheet type=text/css media=screen href=https://www.poloxue.com/css/main.css><link rel=stylesheet type=text/css media=screen href=https://www.poloxue.com/css/extra.css><link id=dark-scheme rel=stylesheet type=text/css href=https://www.poloxue.com/css/dark.css><script src=https://www.poloxue.com/js/feather.min.js></script>
<script src=https://www.poloxue.com/js/main.js></script>
<script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js></script>
<script>MathJax={tex:{displayMath:[["[","]"],["$$","$$"]],inlineMath:[["(",")"],["$","$"]]}}</script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7019080091542951" crossorigin=anonymous></script></head><body><div class="container-wide wrapper"><div class=header><div class=avatar><a href=https://www.poloxue.com/><img src=/avatar.png alt="POLOXUE's BLOG"></a></div><h1 class=site-title><a href=https://www.poloxue.com/>POLOXUE's BLOG</a></h1><div class=site-description><nav class="nav social"><ul class=flat><li><a href=https://github.com/poloxue/ title=Github><i data-feather=github></i></a></li><li><a href=/posts/index.xml title=RSS><i data-feather=rss></i></a></li><li><a href=/ title=Wechat><i data-feather=message-circle></i></a></li><span class=scheme-toggle><a href=# id=scheme-toggle></a></ul></nav></div><nav class=nav><ul class=flat><li><a href=/>文章列表</a></li><li><a href=/tags>分类标签</a></li><li><a href=/about/about>关于我</a></li></ul></nav></div><div class=article-nav id=article-nav-id><div class=post><div class=post-header><div class=meta><div class=date><span class=day>19</span>
<span class=rest>Mar 2025</span></div></div><div class=matter><h1 class=title>实时监控加密货币现货市场的三角套利机会</h1></div></div><aside class="show-on-mobile toc" id=static-toc><header><h3>Contents</h3></header><nav id=TableOfContents><ol><li><a href=#什么是三角套利>什么是三角套利？</a></li><li><a href=#实时监控工具>实时监控工具</a></li><li><a href=#实现思路>实现思路</a></li><li><a href=#三角交易对匹配>三角交易对匹配</a><ol><li><a href=#匹配限制>匹配限制</a></li><li><a href=#过滤规则>过滤规则</a></li><li><a href=#代码片段>代码片段</a></li></ol></li><li><a href=#监控兑换汇率>监控兑换汇率</a></li><li><a href=#灵活推算汇率公式>灵活推算汇率公式</a></li><li><a href=#总结>总结</a></li></ol></nav></aside><p>本文继续介绍一个常见的套利策略，三角套利策略。我将介绍如何实时监控加密货币现货市场上的三角套利机会。</p><p>如果你看过我的前几篇文章，应该知道我最近一直专注在数字货币套利策略的学习研究。至于是否有低费率权限、硬件配置、低延迟网络等客观条件，不是文章的重点。我更多还是放在介绍套利的主线逻辑，完成我的整个套利系列的文章和工具集。请把它们当成一个抛砖引玉的 demo 即可，当你有这方面需求，能给你提供一些参考和思考，那就是好的。</p><p>正式开始本篇文章。</p><h2 id=什么是三角套利>什么是三角套利？</h2><p>三角套利原本是一种针对外汇市场的套利策略，通过利用三种货币对间的汇率失衡实现无风险利润。其核心原理基于“交叉汇率”一致性。</p><p>例如有 A/B、B/C、C/A 三种货币对，它们的实际价格与理论换算值有偏差，即按 A→B→C→A 兑换路径得到的 A 价值高于兑换前 A 的价值，我们即可进行三步循环交易，锁定汇率修正前的差价收益。</p><p>这个策略同样适用于数字货币市场。</p><p>如某交易所内的三个交易对 BTC/USDT、ETH/BTC 和 ETH/USDT，它们的价格分别是 30000、0.05 和 1520。假设无滑点且每次手续费为 0.1%。</p><p>现按路径 USDT→BTC→ETH→USDT 完成兑换。</p><ul><li>USDT -> BTC: 10000 USDT 买入 10000 / 30000 = 0.3333 BTC；</li><li>BTC -> ETH: 0.3333 BTC 兑换 0.3333 / 0.05 = 6.666 ETH；</li><li>ETH -> USDT: 6.666 ETH 卖出 6.666 * 1520 = 10132 USDT；</li></ul><p>三次交易即要扣除手续费（约 10000 * 0.001 * 3 = 30 USDT）后净收益约 132-30 = 103 USDT。</p><p>这是不是看似很美好。</p><p>实际上，随着加密货币市场逐渐成熟，这种纯理论套利机会也不是很多。且这种操作通常依赖自动化瞬时完成，需精确计算成本与收益。</p><h2 id=实时监控工具>实时监控工具</h2><p>我实现了这样一个简单监控工具，看看当前市场是否存在这样的套利机会。</p><p>工具仓库地址 <a href=https://github.com/poloxue/seekoptrader/tree/v0.0.2>github.com/poloxue/seekoptrader</a></p><p>效果如下：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ export PYTHONPATH<span style=color:#f92672>=</span><span style=color:#e6db74>`</span>pwd<span style=color:#e6db74>`</span>
</span></span><span style=display:flex><span>$ python seekoptrader/__main__.py triangle --exchange-name okx
</span></span></code></pre></td></tr></table></div></div><p><img src=https://cdn.jsdelivr.net/gh/poloxue/images@seekoptrader/04.png alt></p><p>如上图有六个汇率值，这是因为以不同币种作为起点和选择不同的兑换路径，一个三角配对可以有六种汇率计算方式。</p><p>假设你的费率是 0.1%，不考虑滑点的情况下，如果你能发现汇率大于 1.003 的机会，就有机会获利。如果是质押借贷，还要考虑借贷利息。</p><p>注：暂时不建议在 binance 上尝试，因为它的上面币种太多了，跑不动。不过或许它有机会的概率会高些。</p><h2 id=实现思路>实现思路</h2><p>这个工具的实现和跨市场价差的监控类似，大致分三个步骤：</p><ul><li>首先，匹配到可形成三角闭环交易对，毕竟希望监控能尽量覆盖全量市场；</li><li>其次，实时监控订单薄消息，这个和之前的跨市场类似，为了提高实时性，建议批量监控；</li><li>最后，计算三角汇率，我考虑了正反交易方向与不同计价币种的组合，将会计算出六组汇率；</li></ul><p>与跨市场价差不同之处是，交易对的三角匹配和计算公式。</p><h2 id=三角交易对匹配>三角交易对匹配</h2><p>三角套利的匹配比起跨交易所的匹配要复杂些，说下我遇到的有几个点吧。</p><h3 id=匹配限制>匹配限制</h3><p>首先，前面说三角套利是基于 A/B、B/C、C/A 这样的交易对组合实现闭环交易。加密货币市场上，基本都是按照 B/A（BTC/USDT）、C/B（ETH/BTC）、C/A（ETH/USDT）形成三角配对。</p><p>我不了解外汇市场的币对是什么规则，可能更加灵活吧。</p><p>为了便于确定汇率计算公式，我严格限制了交易对必按 B/A -> C/B -> C/A 格式和顺序的才能匹配成功。这样一来， 在确定基准单位（兑换起点）和兑换路径后，汇率公式就能确定下来了。不过这样不知道会不会溜掉一些交易对。</p><p>如 <code>A -> B -> C -> A</code> 的兑换路径：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#ae81ff>1</span> / ask<span style=color:#f92672>(</span>B/A<span style=color:#f92672>)</span> / ask<span style=color:#f92672>(</span>C/B<span style=color:#f92672>)</span> * bid<span style=color:#f92672>(</span>C/A<span style=color:#f92672>)</span>
</span></span></code></pre></td></tr></table></div></div><p>而 <code>B -> C -> A -> B</code> 的兑换路径：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#ae81ff>1</span> / ask<span style=color:#f92672>(</span>C/B<span style=color:#f92672>)</span> * bid<span style=color:#f92672>(</span>C/A<span style=color:#f92672>)</span> / ask<span style=color:#f92672>(</span>B/A<span style=color:#f92672>)</span>
</span></span></code></pre></td></tr></table></div></div><p>其中的 ask 和 bid 表示最优卖价和买价。</p><h3 id=过滤规则>过滤规则</h3><p>在用 ccxt 加载现货市场交易对时，发现了法币加密币的交易对，这些大概率无法交易，我直接过滤掉了。我梳理了几个主流交易所（binance、bybit、okx、bitget 和 coinbase）的法币，或许还有遗漏吧。</p><p>此外，我还设置了一个条件，过滤掉存在两个稳定币的三角，防止数量过于膨胀。基本思路是，稳定币的价格变化太小，资源有限的情况下，优先监控非稳定币。</p><h3 id=代码片段>代码片段</h3><p>如下是加载配对某交易所可形成三角闭环交易对的代码：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>find_triangles</span>(self, markets):
</span></span><span style=display:flex><span>    G <span style=color:#f92672>=</span> nx<span style=color:#f92672>.</span>DiGraph()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> m <span style=color:#f92672>in</span> markets:
</span></span><span style=display:flex><span>        base, quote, symbol <span style=color:#f92672>=</span> m[<span style=color:#e6db74>&#34;base&#34;</span>], m[<span style=color:#e6db74>&#34;quote&#34;</span>], m[<span style=color:#e6db74>&#34;symbol&#34;</span>]
</span></span><span style=display:flex><span>        G<span style=color:#f92672>.</span>add_edge(base, quote, symbol<span style=color:#f92672>=</span>symbol)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    triangles <span style=color:#f92672>=</span> {}
</span></span><span style=display:flex><span>    currencies <span style=color:#f92672>=</span> G<span style=color:#f92672>.</span>nodes()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> b <span style=color:#f92672>in</span> currencies:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> a <span style=color:#f92672>in</span> G[b]:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> c <span style=color:#f92672>in</span> currencies:
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> c <span style=color:#f92672>==</span> b <span style=color:#f92672>or</span> c <span style=color:#f92672>==</span> a:
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> c <span style=color:#f92672>in</span> G <span style=color:#f92672>and</span> b <span style=color:#f92672>in</span> G[c]:
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>if</span> a <span style=color:#f92672>in</span> G[c]:
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>if</span> self<span style=color:#f92672>.</span>valid_currencies([b, a, c]):
</span></span><span style=display:flex><span>                            triangles[(a, b, c)] <span style=color:#f92672>=</span> (
</span></span><span style=display:flex><span>                                G[b][a][<span style=color:#e6db74>&#34;symbol&#34;</span>],
</span></span><span style=display:flex><span>                                G[c][b][<span style=color:#e6db74>&#34;symbol&#34;</span>],
</span></span><span style=display:flex><span>                                G[c][a][<span style=color:#e6db74>&#34;symbol&#34;</span>],
</span></span><span style=display:flex><span>                            )
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> triangles
</span></span></code></pre></td></tr></table></div></div><p>这里用了一个网络拓扑工具库 <code>networkx</code> 构建了一个有向图，从中搜索可形成闭环的三个交易对。其中的 <code>valid_currencies</code> 函数用于过滤一些配对，如法币或稳定币交易对。</p><h2 id=监控兑换汇率>监控兑换汇率</h2><p>因为要更多可能监控交易机会，不限制兑换路径和计价币种。如何理解呢？</p><p>还是以 BTC/USDT、ETH/BTC 和 ETH/USDT 为例。</p><p>最容易想到的兑换路径是 USDT -> BTC -> ETH -> USDT，但也可以是 USDT -> ETH -> BTC -> USDT，这两个路径都是以 USDT 为计价币。我还可以从 ETH 为基点，即 ETH 计价，那么兑换路径就是 ETH -> USDT -> BTC -> ETH，或是 ETH -> BTC -> USDT -> ETH。</p><p>一旦路径和基点变了，那计算的公式也就完全不同了。</p><p>如 <code>USDT -> BTC -> ETH -> USDT</code> 的兑换路径，公式是：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#ae81ff>1</span> / ask<span style=color:#f92672>(</span>BTC/USDT<span style=color:#f92672>)</span> / ask<span style=color:#f92672>(</span>ETH/BTC<span style=color:#f92672>)</span> * bid<span style=color:#f92672>(</span>ETH/USDT<span style=color:#f92672>)</span>
</span></span></code></pre></td></tr></table></div></div><p>而 <code>BTC -> ETH -> USDT -> BTC</code> 的兑换路径，公式是：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#ae81ff>1</span> / ask<span style=color:#f92672>(</span>ETH/BTC<span style=color:#f92672>)</span> * bid<span style=color:#f92672>(</span>ETH/USDT<span style=color:#f92672>)</span> / ask<span style=color:#f92672>(</span>BTC/USDT<span style=color:#f92672>)</span>
</span></span></code></pre></td></tr></table></div></div><p>这样组合起来，一个三角配对就有了 6 个交易路径，这也是为什么上面演示的工具中有 6 个 汇率的原因。</p><p>现在很多币种都可以质押借款，如果能抓住这瞬时的交易机会，在还掉借贷后，还能赚点币在手里，这就是利润。</p><h2 id=灵活推算汇率公式>灵活推算汇率公式</h2><p>除了前面按交易对模式固定死汇率公式，还可以更灵活的推算公式，只要提供兑换起点币种和三角交易对，就能推出三角兑换的汇率公式。</p><p>我已经把这个思路的核心逻辑代码写出了，借这篇文章保存下，万一哪天需要还能找到。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> collections <span style=color:#f92672>import</span> defaultdict
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>detect_arbitrage_ops</span>(start_currency, symbols):
</span></span><span style=display:flex><span>    graph <span style=color:#f92672>=</span> defaultdict(dict)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> symbol <span style=color:#f92672>in</span> symbols:
</span></span><span style=display:flex><span>        base, quote <span style=color:#f92672>=</span> symbol<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#34;/&#34;</span>)
</span></span><span style=display:flex><span>        graph[base][quote] <span style=color:#f92672>=</span> symbol  <span style=color:#75715e># 正向交易 base→quote</span>
</span></span><span style=display:flex><span>        graph[quote][base] <span style=color:#f92672>=</span> symbol  <span style=color:#75715e># 反向交易 quote→base</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    chains <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>    max_depth <span style=color:#f92672>=</span> <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>dfs</span>(current, path, ops<span style=color:#f92672>=</span>[], depth<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> depth <span style=color:#f92672>==</span> max_depth:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> current <span style=color:#f92672>==</span> start_currency:
</span></span><span style=display:flex><span>                chains<span style=color:#f92672>.</span>append(ops)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> next_currency <span style=color:#f92672>in</span> graph[current]:
</span></span><span style=display:flex><span>            symbol <span style=color:#f92672>=</span> graph[current][next_currency]
</span></span><span style=display:flex><span>            base, quote <span style=color:#f92672>=</span> symbol<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#34;/&#34;</span>)
</span></span><span style=display:flex><span>            new_op <span style=color:#f92672>=</span> <span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;*bid(</span><span style=color:#e6db74>{</span>symbol<span style=color:#e6db74>}</span><span style=color:#e6db74>)&#34;</span> <span style=color:#66d9ef>if</span> current <span style=color:#f92672>==</span> base <span style=color:#66d9ef>else</span> <span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;/ask(</span><span style=color:#e6db74>{</span>symbol<span style=color:#e6db74>}</span><span style=color:#e6db74>)&#34;</span>
</span></span><span style=display:flex><span>            dfs(next_currency, path <span style=color:#f92672>+</span> [next_currency], ops <span style=color:#f92672>+</span> [new_op], depth <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    dfs(start_currency, [start_currency])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> [<span style=color:#e6db74>&#34;1&#34;</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;&#34;</span><span style=color:#f92672>.</span>join(chain) <span style=color:#66d9ef>for</span> chain <span style=color:#f92672>in</span> chains]
</span></span></code></pre></td></tr></table></div></div><p>示例测试:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>base <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;ETH&#34;</span>
</span></span><span style=display:flex><span>pairs <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#34;BTC/USDT&#34;</span>, <span style=color:#e6db74>&#34;ETH/BTC&#34;</span>, <span style=color:#e6db74>&#34;ETH/USDT&#34;</span>]
</span></span><span style=display:flex><span>operations <span style=color:#f92672>=</span> detect_arbitrage_ops(base, pairs)
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#34;ETH 兑换起点:&#34;</span>, operations)
</span></span></code></pre></td></tr></table></div></div><p>输出：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ETH 兑换起点: <span style=color:#f92672>[</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;1*bid(ETH/BTC)*bid(BTC/USDT)/ask(ETH/USDT)&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;1*bid(ETH/USDT)/ask(BTC/USDT)/ask(ETH/BTC)&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>]</span>
</span></span></code></pre></td></tr></table></div></div><p>现在的已经简单够用，就没把这个设计集成到工具里。</p><h2 id=总结>总结</h2><p>本文简单介绍了三角套利，开发了一个监控小工具。这是我的一次尝试，如有建议请提出来。如果你对代码实现感兴趣，可查看：<a href=https://github.com/poloxue/seekoptrader/blob/v0.0.2/seekoptrader/arbitrage/triangle/monitor.py>triangle/monitor.py</a>。</p><p>最后，希望本文对你有用。</p><p>最近感冒不舒服，脑子有点不清楚，希望文中不要有太多错误。</p><div>本文来源于 <a href=https://www.poloxue.com>POLOXUE's BLOG</a>，地址： <a href=https://www.poloxue.com/posts/2025-03-19-triangle-arbitrage-in-crypto-market/>实时监控加密货币现货市场的三角套利机会</a></div></div><nav class="hide-on-mobile section-nav"><nav id=TableOfContents><ol><li><a href=#什么是三角套利>什么是三角套利？</a></li><li><a href=#实时监控工具>实时监控工具</a></li><li><a href=#实现思路>实现思路</a></li><li><a href=#三角交易对匹配>三角交易对匹配</a><ol><li><a href=#匹配限制>匹配限制</a></li><li><a href=#过滤规则>过滤规则</a></li><li><a href=#代码片段>代码片段</a></li></ol></li><li><a href=#监控兑换汇率>监控兑换汇率</a></li><li><a href=#灵活推算汇率公式>灵活推算汇率公式</a></li><li><a href=#总结>总结</a></li></ol></nav></nav></div><div class=post><hr class=footer-separator><div class=tags></div><div class=back><a href=https://www.poloxue.com/><span aria-hidden=true>← Back</span></a></div><div class=back></div></div><div class=post><img style=width:85% src=https://cdn.jsdelivr.net/gh/poloxue/images@main/wechat.png><div class=utterances></div><script src=https://utteranc.es/client.js repo=poloxue/blog issue-term=pathname theme=github-light crossorigin=anonymous async></script></div></div><div class="footer wrapper"><nav class=nav><div>2025 Polo Xue All rights reserved</div></nav></div><script>feather.replace()</script><script>var enableTruncate=!0,filterDepth=!1;const MAX_DEPTH=9;window.addEventListener("DOMContentLoaded",()=>{const e=new IntersectionObserver(e=>{e.reverse().forEach(e=>{const n=e.target.getAttribute("id");if(e.intersectionRatio>0){var t=document.querySelectorAll(`nav li a[href="#${n}"]`);t!=null&&t.forEach(e=>{if(e!=null){var t=getDepth(e.parentElement);filterDepth&&t<=MAX_DEPTH&&(clearActiveStatesInTableOfContents(),e.parentElement.classList.add("active"))}else filterDepth||(clearActiveStatesInTableOfContents(),e.parentElement.classList.add("active"))})}})});document.querySelectorAll("h1[id],h2[id],h3[id],h4[id]").forEach(t=>{e.observe(t)})});function isVisible(e){if(!(e instanceof Element))return!1;const n=getComputedStyle(e);if(n.display==="none")return!1;if(n.visibility!=="visible")return!1;if(n.opacity<.1)return!1;if(e.offsetWidth+e.offsetHeight+e.getBoundingClientRect().height+e.getBoundingClientRect().width===0)return!1;const t={x:e.getBoundingClientRect().left+e.offsetWidth/2,y:e.getBoundingClientRect().top+e.offsetHeight/2};if(t.x<0)return!1;if(t.x>(document.documentElement.clientWidth||window.innerWidth))return!1;if(t.y<0)return!1;if(t.y>(document.documentElement.clientHeight||window.innerHeight))return!1;let s=document.elementFromPoint(t.x,t.y);do if(s===e)return!0;while(s=s.parentNode)return!1}function clearActiveStatesInTableOfContents(){document.querySelectorAll("nav li").forEach(e=>{e.classList.remove("active")})}function getDepth(e){for(var t=0;e!==null&&e.tagName.toLowerCase()!=="ul";)t++,e=e.parentElement;return t}function navItems(){var e=document.querySelectorAll("nav nav li a");return Array.from(e).filter(e=>e.href!=null&&e.hash.startsWith("#"))}function lasItemInNavBarVisible(){var e=navItems().slice(-1)[0];return isVisible(e)}document.addEventListener("DOMContentLoaded",function(){if(!enableTruncate)return;var e=navItems();console.log(e),lasItemInNavBarVisible()||(filterDepth=!0,e.forEach(function(e){var t=getDepth(e.parentElement);t>MAX_DEPTH&&e.parentElement.classList.add("depth-nested")}))})</script></body></html>