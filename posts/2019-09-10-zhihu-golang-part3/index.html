<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>Go 问答汇总 Part Three - POLOXUE's BLOG</title><meta name=viewport content="width=device-width,initial-scale=1"><meta itemprop=name content="Go 问答汇总 Part Three"><meta itemprop=description content="第三篇 Go 问答总结，2019 年 8 月份总结，大约有 12 篇问答。前两遍地址如下：
Go 问答汇总 Part One Go 问答汇总 Part Two
问题大部分是来自于知乎和 segmentfault。本月有一个问题来自 stackoverflow，我的英文水平一般，读与翻译还行，但写起来还需要锻炼。虽然这一个回答没得到一个赞同，但能被题主采纳，我还是很荣幸的。
最近发现，我的回答经常会被 Go 语言中文网的周刊收录。对 Go 感兴趣的朋友可以关注下 Go 语言中文网的公众号，内容还是非常丰富的，每天都会推送关于 Go 的优秀文章。
开始正文！
dynamodbattribute.UnmarshalMap canges the type of my variable to map[string]interface{}
将 stackoverflow 的这篇回答放在首位吧，问题不是很难，重在第一次尝试，stackoverflow 上面有价值的问题还是很多的。
题主的目标是希望 map 类型转化成 struct 类型。将问题稍微简化下，题主希望通过类似如下这种写法将 map[string]interface{} 转化为 user 类型。
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 package main import &#34;fmt&#34; type User struct { Name string } func Item() interface{} { return User{} } func ItemMap(s map[string]interface{}, item *interface{}) { *item = s } func main() { m := Item() fmt."><meta itemprop=datePublished content="2019-09-10T15:47:12+08:00"><meta itemprop=dateModified content="2019-09-10T15:47:12+08:00"><meta itemprop=wordCount content="368"><meta itemprop=keywords content="Golang,"><meta property="og:title" content="Go 问答汇总 Part Three"><meta property="og:description" content="第三篇 Go 问答总结，2019 年 8 月份总结，大约有 12 篇问答。前两遍地址如下：
Go 问答汇总 Part One Go 问答汇总 Part Two
问题大部分是来自于知乎和 segmentfault。本月有一个问题来自 stackoverflow，我的英文水平一般，读与翻译还行，但写起来还需要锻炼。虽然这一个回答没得到一个赞同，但能被题主采纳，我还是很荣幸的。
最近发现，我的回答经常会被 Go 语言中文网的周刊收录。对 Go 感兴趣的朋友可以关注下 Go 语言中文网的公众号，内容还是非常丰富的，每天都会推送关于 Go 的优秀文章。
开始正文！
dynamodbattribute.UnmarshalMap canges the type of my variable to map[string]interface{}
将 stackoverflow 的这篇回答放在首位吧，问题不是很难，重在第一次尝试，stackoverflow 上面有价值的问题还是很多的。
题主的目标是希望 map 类型转化成 struct 类型。将问题稍微简化下，题主希望通过类似如下这种写法将 map[string]interface{} 转化为 user 类型。
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 package main import &#34;fmt&#34; type User struct { Name string } func Item() interface{} { return User{} } func ItemMap(s map[string]interface{}, item *interface{}) { *item = s } func main() { m := Item() fmt."><meta property="og:type" content="article"><meta property="og:url" content="https://www.poloxue.com/posts/2019-09-10-zhihu-golang-part3/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-09-10T15:47:12+08:00"><meta property="article:modified_time" content="2019-09-10T15:47:12+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Go 问答汇总 Part Three"><meta name=twitter:description content="第三篇 Go 问答总结，2019 年 8 月份总结，大约有 12 篇问答。前两遍地址如下：
Go 问答汇总 Part One Go 问答汇总 Part Two
问题大部分是来自于知乎和 segmentfault。本月有一个问题来自 stackoverflow，我的英文水平一般，读与翻译还行，但写起来还需要锻炼。虽然这一个回答没得到一个赞同，但能被题主采纳，我还是很荣幸的。
最近发现，我的回答经常会被 Go 语言中文网的周刊收录。对 Go 感兴趣的朋友可以关注下 Go 语言中文网的公众号，内容还是非常丰富的，每天都会推送关于 Go 的优秀文章。
开始正文！
dynamodbattribute.UnmarshalMap canges the type of my variable to map[string]interface{}
将 stackoverflow 的这篇回答放在首位吧，问题不是很难，重在第一次尝试，stackoverflow 上面有价值的问题还是很多的。
题主的目标是希望 map 类型转化成 struct 类型。将问题稍微简化下，题主希望通过类似如下这种写法将 map[string]interface{} 转化为 user 类型。
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 package main import &#34;fmt&#34; type User struct { Name string } func Item() interface{} { return User{} } func ItemMap(s map[string]interface{}, item *interface{}) { *item = s } func main() { m := Item() fmt."><script data-goatcounter=https://poloxue.goatcounter.com/count async src=//gc.zgo.at/count.js></script>
<link rel=stylesheet type=text/css media=screen href=https://www.poloxue.com/css/normalize.css><link rel=stylesheet type=text/css media=screen href=https://www.poloxue.com/css/main.css><link rel=stylesheet type=text/css media=screen href=https://www.poloxue.com/css/extra.css><link id=dark-scheme rel=stylesheet type=text/css href=https://www.poloxue.com/css/dark.css><script src=https://www.poloxue.com/js/feather.min.js></script>
<script src=https://www.poloxue.com/js/main.js></script>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7019080091542951" crossorigin=anonymous></script></head><body><div class="container wrapper"><div class=header><div class=avatar><a href=https://www.poloxue.com/><img src=/avatar.png alt="POLOXUE's BLOG"></a></div><h1 class=site-title><a href=https://www.poloxue.com/>POLOXUE's BLOG</a></h1><div class=site-description><nav class="nav social"><ul class=flat><li><a href=https://github.com/poloxue/ title=Github><i data-feather=github></i></a></li><li><a href=/posts/index.xml title=RSS><i data-feather=rss></i></a></li><li><a href=/ title=Wechat><i data-feather=message-circle></i></a></li><span class=scheme-toggle><a href=# id=scheme-toggle></a></ul></nav></div><nav class=nav><ul class=flat><li><a href=/>首页</a></li><li><a href=/posts>文章列表</a></li><li><a href=/tags>分类标签</a></li><li><a href=/about/>关于我</a></li></ul></nav></div><div class=post><div class=post-header><div class=meta><div class=date><span class=day>10</span>
<span class=rest>Sep 2019</span></div></div><div class=matter><h1 class=title>Go 问答汇总 Part Three</h1></div></div><p>第三篇 Go 问答总结，2019 年 8 月份总结，大约有 12 篇问答。前两遍地址如下：</p><p><a href=https://www.poloxue.com/posts/2019-07-22-zhihu-go-part1/>Go 问答汇总 Part One</a>
<a href=https://www.poloxue.com/posts/2019-08-10-zhihu-go-part2/>Go 问答汇总 Part Two</a></p><p>问题大部分是来自于知乎和 segmentfault。本月有一个问题来自 stackoverflow，我的英文水平一般，读与翻译还行，但写起来还需要锻炼。虽然这一个回答没得到一个赞同，但能被题主采纳，我还是很荣幸的。</p><p>最近发现，我的回答经常会被 Go 语言中文网的周刊收录。对 Go 感兴趣的朋友可以关注下 Go 语言中文网的公众号，内容还是非常丰富的，每天都会推送关于 Go 的优秀文章。</p><p><img src=https://blogimg.poloxue.com/0000-wechat-03-studygolang.jpeg alt></p><p>开始正文！</p><p><a href=https://stackoverflow.com/questions/57567917/dynamodbattribute-unmarshalmap-canges-the-type-of-my-variable-to-mapstringinte/57568211#57568211>dynamodbattribute.UnmarshalMap canges the type of my variable to map[string]interface{}</a></p><p>将 stackoverflow 的这篇回答放在首位吧，问题不是很难，重在第一次尝试，stackoverflow 上面有价值的问题还是很多的。</p><p>题主的目标是希望 map 类型转化成 struct 类型。将问题稍微简化下，题主希望通过类似如下这种写法将 map[string]interface{} 转化为 user 类型。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> <span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>User</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Name</span> <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>Item</span>() <span style=color:#66d9ef>interface</span>{} {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>User</span>{}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>ItemMap</span>(<span style=color:#a6e22e>s</span> <span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>interface</span>{}, <span style=color:#a6e22e>item</span> <span style=color:#f92672>*</span><span style=color:#66d9ef>interface</span>{}) {
</span></span><span style=display:flex><span>	<span style=color:#f92672>*</span><span style=color:#a6e22e>item</span> = <span style=color:#a6e22e>s</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>m</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>Item</span>()
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;%T\n&#34;</span>, <span style=color:#a6e22e>m</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;%v\n&#34;</span>, <span style=color:#a6e22e>m</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>s</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>interface</span>{}{
</span></span><span style=display:flex><span>		<span style=color:#e6db74>&#34;Name&#34;</span>: <span style=color:#e6db74>&#34;poloxue&#34;</span>,
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>ItemMap</span>(<span style=color:#a6e22e>s</span>, <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>m</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;%T\n&#34;</span>, <span style=color:#a6e22e>m</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;%v\n&#34;</span>, <span style=color:#a6e22e>m</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>首先，通过 Item() 方法创建一个 User 类型变量，但返回的类型是 interface{}，因而 main 主函数中的 m 通过类型推导，也就是 interface{} 类型，在 ItemMap 函数中将 map[string]interface{} 变量赋值给 m 的地址并不会有任何问题，因为虽然此时 m 类型的底层类型是 User，但赋值时并不会验查到这一层，经过一部分之后，m 的底层类型就由 User 转化成了 map[string]interface，并非完成了 map[string]interface{} 到 struct 的转化。</p><p>看样子，map 和 struct 的转化还是很常见的需求啊，上月的问答总结就有类似的问题。再次推荐 mapstructure 包。</p><p><a href=https://segmentfault.com/q/1010000020049743/a-1020000020165822>go源码的raceenable是做什么的，可否解答一二！</a></p><p>Go 是内置并发支持的语言，并发的常见问题就是出现竞态条件，Go 专门提供了一个工具用于检测这个问题，使用非常方便，只需要在执行程序时加上 -race 选项，Go 源码中的这个 raceenable 表示的意思即使是否启用了 raceenable。</p><p>前段时间翻译了一篇关于 go race 的文章，访问 <a href=https://juejin.im/post/5d5851aee51d4561c6784079>Go 译文之竞态检测器 race</a>。</p><p><a href=https://segmentfault.com/q/1010000020145507/a-1020000020146489>Golang中，runtime.Caller(skip)，为什么会保留编译器变量？</a></p><p>题主的目标是获取 Go 可执行文件的当前路径，但对于很多习惯了使用解释型语言的朋友，养成了源码文件路径即可执行文件路径的思维，而 runtine.Caller 可用于查看调用栈信息，正好可以保留编译时的源码文件信息。</p><p>但真实的项目部署的肯定是可执行文件，而非源码文件，而路径也是针对可执行文件的路径。如何获取到呢？请看回答吧！</p><p>再提醒一点，正因为很多朋友养成了解释型语言的思维，常会通过 go run 执行源码，然后获取可执行文件路径，但最终得到的确实一个看不懂的路径。这个问题在回答也有介绍。</p><p><a href=https://www.zhihu.com/question/341035336/answer/793308659>golang如何复用mysql连接？</a></p><p>golang 中的标准库 database/sql 已经提供了一份数据库管理的公共实现，同样涉及 mysql 连接复用的功能。</p><p>题主的问题是为什么没有达到复用的效果。</p><p>连接复用有一个重要前提就是资源使用结束后要记得释放，否则将会一直处于占用状态，至于有哪些情况会导致连接一直复用，查看回答！</p><p>回答中提到了一篇非常系统介绍 Go 中 database/sql 使用的教程，有兴趣可以仔细读读。</p><p><a href=https://segmentfault.com/q/1010000020100276/a-1020000020103898>goroutine 出现异常</a></p><p>这个问题稍微有点复杂。异常的原因，简单说来是 channel 发送者发送等待时间太长，导致异常出现。解析问题的核心思路在于，在发送者和接收之间增加一个 buffer，无论发送者发送了什么内容，先将消息接收到 buffer 中，待有空闲的接收者时将消息从 buffer 中发送出去。</p><p>题主是通过 chan 自带的 buffer 实现，创建了缓冲大小 50 的 chan。当然，更灵活的方式，还是自己实现 buffer 比较好。而且题主的场景是爬虫，可能对 buffer 的大小要求会比较高，可能适当考虑接入外部服务。</p><p><a href=https://www.zhihu.com/question/340587967/answer/791508607>go的reflect是否可以获取到同一个package中，其他文件定义的类型的私有方法的名称？</a></p><p>首先，要明确的是，Go 中的反射是无法看到类型的私有方法的。如果想达到这个目标，只能将方法定义为可导出方法。但私有方法也有它的好处，那就是外界无法使用这个方法。那将方法定义为公开可导出是否也可以做到让外界无法使用？</p><p>查看我的回答吧！</p><p><a href=https://segmentfault.com/q/1010000020063647/a-1020000020068775>beego 的缓存如何转结构体呢?</a></p><p>beego 中缓存的存储与获取的问题，很简单，没什么好说的！</p><p><a href=https://www.zhihu.com/question/340342212/answer/795661248>go语言里的select监听到底是怎么工作的?</a></p><p>问题的核心不在于 select 的工作机制，而是关于 Go 中 timer 定时器的使用问题。以下是问题的核心代码。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>for</span> {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>select</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>case</span> <span style=color:#a6e22e>num</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&lt;-</span><span style=color:#a6e22e>ch</span>:
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;get num is &#34;</span>, <span style=color:#a6e22e>num</span>)
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>case</span> <span style=color:#f92672>&lt;-</span><span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>After</span>(<span style=color:#ae81ff>2</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Second</span>):
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;time&#39;s up!!!&#34;</span>)
</span></span><span style=display:flex><span>			<span style=color:#75715e>//quit &lt;- true
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>		}
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}()
</span></span></code></pre></td></tr></table></div></div><p>题主的问题是为什么 timer 的 case 一直没有执行。这是因为 time.After 在每次循环都会创建的 chan，之前定时 chan 已经不再监听了。</p><p>我开始觉得，这种方式挺适合处理任务出现 timeout 的情况，经过一位朋友提醒，这里面存在着泄露风险。具体原因，阅读回答了解吧！</p><p><a href=https://www.zhihu.com/question/27170192/answer/808995623>在golang的设计里，为什么不能用switch实现select的功能？</a></p><p>主要是场景决定吧，channel 监听有点类似于异步 IO 的多路复用，select 可以说是多路复用的专用名字了，switch 是分支结构，硬要加上其他功能，也不便于理解，我的感觉是，独立出一个新的关键字会更好理解。</p><p><a href=https://segmentfault.com/q/1010000020110214/a-1020000020110738>go语言struct中有函数指数的示例讲解</a></p><p>题主要求用从浅入深的方式介绍，Go 中 struct 含有函数成员的问题。我觉得我也写得还不多，但是没有得到题主的采纳，只得到一个评论夸赞。</p><p><a href=https://segmentfault.com/q/1010000020128222/a-1020000020130806>golang 编译器分32和64版本吗？</a></p><p>肯定是分的，但我们不用关心，go 命令已经封装好了，它会依据平台选择不同的底层命令。</p><p>在 go 安装目录的 pkg 目录下有个 tools 目录，里面包含了编译链接时实际使用的命令，比如我的 Mac Pro，在 pkg/tool/darwin_amd64/ 下能找到 go 编译链接实际调用的命令 compile 和 link。darwin_amd64 中 drawin 表示操作系统，amd64 就是系统架构。</p><p>执行 go env 会发现其中有个环境变量 GOTOOLDIR，它是那些与我们平台相关工具的所在目录。我的 Mac 下得到的结果是：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>GOTOOLDIR=&#34;/usr/local/go/pkg/tool/darwin_amd64&#34;
</span></span></code></pre></td></tr></table></div></div><p><a href=https://segmentfault.com/q/1010000020244344/a-1020000020246932>正则如何匹配最后一个页码?</a></p><p>题主的问题是如何进行 html 的解析。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>&lt;<span style=color:#f92672>ul</span> <span style=color:#a6e22e>id</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;pages&#34;</span>&gt;
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>li</span>&gt;&lt;<span style=color:#f92672>a</span> <span style=color:#a6e22e>href</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;xxx1&#34;</span>&gt;1&lt;/<span style=color:#f92672>a</span>&gt;&lt;/<span style=color:#f92672>li</span>&gt;
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>li</span>&gt;&lt;<span style=color:#f92672>a</span> <span style=color:#a6e22e>href</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;xxx2&#34;</span>&gt;2&lt;/<span style=color:#f92672>a</span>&gt;&lt;/<span style=color:#f92672>li</span>&gt;
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>li</span>&gt;&lt;<span style=color:#f92672>a</span> <span style=color:#a6e22e>href</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;xxx3&#34;</span>&gt;3&lt;/<span style=color:#f92672>a</span>&gt;&lt;/<span style=color:#f92672>li</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>ul</span>&gt;
</span></span></code></pre></td></tr></table></div></div><p>这类问题一般是不推荐使用正则匹配，可以试试 goquery 这个库，它的用法类似 jquery，可用于解析 html 内容，使用非常方便。当然，回答中也介绍了正则的实现，不过代码的可读性看起来比较差。</p><p>本月的回答总结完毕，如果大家发现有不当的内容，欢迎批评指正，非常感谢。</p><p>博文地址：<a href=https://www.poloxue.com/2019-09-10-zhihu-golang-part3.md>Go 问答汇总 Part Three</a></p><hr class=footer-separator><div class=tags><ul class=flat><li class=tag-li><a href=/tags/golang>Golang</a></li></ul></div><div class=back><a href=https://www.poloxue.com/><span aria-hidden=true>← Back</span></a></div><div class=back></div></div><div class=post><img style=width:85% src=https://cdn.jsdelivr.net/gh/poloxue/images@main/wechat.png><div class=utterances></div><script src=https://utteranc.es/client.js repo=poloxue/blog issue-term=pathname theme=github-light crossorigin=anonymous async></script></div></div><div class="footer wrapper"><nav class=nav><div>2019 Polo Xue All rights reserved</div></nav></div><script>feather.replace()</script></body></html>