<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>mplfinance - 一个轻松绘制股票行情图表的 python 库 - POLOXUE's BLOG</title><meta name=viewport content="width=device-width,initial-scale=1"><meta itemprop=name content="mplfinance - 一个轻松绘制股票行情图表的 python 库"><meta itemprop=description content="mplfinance 是一个基于 matplotlib 的金融数据可视化工具，旨在方便地生成 OHLC、K线图和其他金融相关图表。本教程将逐步带你从基础到高级使用，帮助你熟练掌握 `mplfinance` 的使用技巧。"><meta itemprop=datePublished content="2024-12-10T15:17:39+08:00"><meta itemprop=dateModified content="2024-12-10T15:17:39+08:00"><meta itemprop=wordCount content="311"><meta itemprop=keywords content><meta property="og:title" content="mplfinance - 一个轻松绘制股票行情图表的 python 库"><meta property="og:description" content="mplfinance 是一个基于 matplotlib 的金融数据可视化工具，旨在方便地生成 OHLC、K线图和其他金融相关图表。本教程将逐步带你从基础到高级使用，帮助你熟练掌握 `mplfinance` 的使用技巧。"><meta property="og:type" content="article"><meta property="og:url" content="https://www.poloxue.com/posts/2024-12-11-mplfinance-chart-library/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-12-10T15:17:39+08:00"><meta property="article:modified_time" content="2024-12-10T15:17:39+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="mplfinance - 一个轻松绘制股票行情图表的 python 库"><meta name=twitter:description content="mplfinance 是一个基于 matplotlib 的金融数据可视化工具，旨在方便地生成 OHLC、K线图和其他金融相关图表。本教程将逐步带你从基础到高级使用，帮助你熟练掌握 `mplfinance` 的使用技巧。"><script data-goatcounter=https://poloxue.goatcounter.com/count async src=//gc.zgo.at/count.js></script>
<link rel=stylesheet type=text/css media=screen href=https://www.poloxue.com/css/normalize.css><link rel=stylesheet type=text/css media=screen href=https://www.poloxue.com/css/main.css><link rel=stylesheet type=text/css media=screen href=https://www.poloxue.com/css/extra.css><link id=dark-scheme rel=stylesheet type=text/css href=https://www.poloxue.com/css/dark.css><script src=https://www.poloxue.com/js/feather.min.js></script>
<script src=https://www.poloxue.com/js/main.js></script>
<script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js></script>
<script>MathJax={tex:{displayMath:[["[","]"],["$$","$$"]],inlineMath:[["(",")"],["$","$"]]}}</script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7019080091542951" crossorigin=anonymous></script></head><body><div class="container wrapper"><div class=header><div class=avatar><a href=https://www.poloxue.com/><img src=/avatar.png alt="POLOXUE's BLOG"></a></div><h1 class=site-title><a href=https://www.poloxue.com/>POLOXUE's BLOG</a></h1><div class=site-description><nav class="nav social"><ul class=flat><li><a href=https://github.com/poloxue/ title=Github><i data-feather=github></i></a></li><li><a href=/posts/index.xml title=RSS><i data-feather=rss></i></a></li><li><a href=/ title=Wechat><i data-feather=message-circle></i></a></li><span class=scheme-toggle><a href=# id=scheme-toggle></a></ul></nav></div><nav class=nav><ul class=flat><li><a href=/>文章列表</a></li><li><a href=/tags>分类标签</a></li><li><a href=https://crypto.poloxue.com/>每日币圈</a></li><li><a href=/about/about>关于我</a></li></ul></nav></div><div class=post><div class=post-header><div class=meta><div class=date><span class=day>10</span>
<span class=rest>Dec 2024</span></div></div><div class=matter><h1 class=title>mplfinance - 一个轻松绘制股票行情图表的 python 库</h1></div></div><p><img src=https://cdn.jsdelivr.net/gh/poloxue/images@2024-12/2024-12-11-mplfinance-chart-library-00.jpeg alt></p><p><code>mplfinance</code> 是一个基于 <code>matplotlib</code> 的金融数据可视化工具，旨在方便地生成 OHLC、K线图和其他金融相关图表。</p><p>本文将带你逐步从基础到高级使用，帮助你熟练掌握 <code>mplfinance</code> 的使用技巧。</p><hr><h2 id=安装-mplfinance>安装 <code>mplfinance</code></h2><p>在使用 <code>mplfinance</code> 前，需要先安装它。可以通过以下命令安装：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pip install --upgrade mplfinance
</span></span></code></pre></td></tr></table></div></div><p><code>mplfinance</code> 依赖于 <code>matplotlib</code> 和 <code>pandas</code>，确保你的环境中已安装这些库。</p><hr><h2 id=准备数据>准备数据</h2><p>在开始绘图之前，需要准备一个包含 OHLC 数据的 Pandas DataFrame。</p><p>我们从 Tushare 下载股票的历史数据：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> pandas <span style=color:#66d9ef>as</span> pd
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> datetime
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> tushare <span style=color:#66d9ef>as</span> ts
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>pro <span style=color:#f92672>=</span> ts<span style=color:#f92672>.</span>pro_api()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>data <span style=color:#f92672>=</span> pro<span style=color:#f92672>.</span>daily(ts_code<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;000001.SZ&#34;</span>, start_date<span style=color:#f92672>=</span>start_date<span style=color:#f92672>.</span>strftime(<span style=color:#e6db74>&#34;%Y%m</span><span style=color:#e6db74>%d</span><span style=color:#e6db74>&#34;</span>))
</span></span><span style=display:flex><span>data[<span style=color:#e6db74>&#34;trade_date&#34;</span>] <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>to_datetime(data[<span style=color:#e6db74>&#34;trade_date&#34;</span>])
</span></span><span style=display:flex><span>data<span style=color:#f92672>.</span>set_index(<span style=color:#e6db74>&#34;trade_date&#34;</span>, inplace<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>)
</span></span><span style=display:flex><span>data<span style=color:#f92672>.</span>index<span style=color:#f92672>.</span>name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Date&#34;</span>
</span></span><span style=display:flex><span>data <span style=color:#f92672>=</span> data[[<span style=color:#e6db74>&#34;open&#34;</span>, <span style=color:#e6db74>&#34;high&#34;</span>, <span style=color:#e6db74>&#34;low&#34;</span>, <span style=color:#e6db74>&#34;close&#34;</span>, <span style=color:#e6db74>&#34;vol&#34;</span>]]
</span></span><span style=display:flex><span>data<span style=color:#f92672>.</span>rename(
</span></span><span style=display:flex><span>    columns<span style=color:#f92672>=</span>{
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;open&#34;</span>: <span style=color:#e6db74>&#34;Open&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;high&#34;</span>: <span style=color:#e6db74>&#34;High&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;low&#34;</span>: <span style=color:#e6db74>&#34;Low&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;close&#34;</span>: <span style=color:#e6db74>&#34;Close&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;vol&#34;</span>: <span style=color:#e6db74>&#34;Volume&#34;</span>,
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    inplace<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>,
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>data<span style=color:#f92672>.</span>sort_index(ascending<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>, inplace<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>)
</span></span></code></pre></td></tr></table></div></div><p>数据示例如下：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>            Open  High   Low  Close      Volume
</span></span><span style=display:flex><span>Date
</span></span><span style=display:flex><span>2023-12-12  9.31  9.50  9.30   9.42   855016.42
</span></span><span style=display:flex><span>2023-12-13  9.38  9.39  9.15   9.16  1061301.65
</span></span><span style=display:flex><span>2023-12-14  9.21  9.28  9.15   9.15   742900.56
</span></span><span style=display:flex><span>2023-12-15  9.20  9.35  9.19   9.21   988939.42
</span></span><span style=display:flex><span>2023-12-18  9.18  9.24  9.09   9.13   654425.62
</span></span></code></pre></td></tr></table></div></div><p>只保留接下来会用到的数据列。</p><hr><h2 id=绘制基础图表>绘制基础图表</h2><p>现在，我们只要将数据导入 <code>mplfinance</code> 即可。</p><p>示例代码如下，调用 <code>plot</code> 方法，并传入从 tushare 得到的数据生成图表：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> mplfinance <span style=color:#66d9ef>as</span> mpf
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 绘制基础 K 线图</span>
</span></span><span style=display:flex><span>mpf<span style=color:#f92672>.</span>plot(data, volume<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>)
</span></span></code></pre></td></tr></table></div></div><p>你将看到一个简单的 OHLC 图表，显示指定时间范围内的开盘、收盘、最高和最低价。参数 <code>volume</code> 设置为 <code>True</code> 表示显示成交量。</p><p><img src=https://cdn.jsdelivr.net/gh/poloxue/images@2024-12/2024-12-11-mplfinance-chart-library-01.png alt></p><p>默认的图标类型按 ohlc 美国线风格显示，接着往下看，如何将其修改为蜡烛线。</p><hr><h3 id=更改图表类型>更改图表类型</h3><p><code>mplfinance</code> 提供多种图表类型，包括默认的 <code>ohlc</code>（美国线）、<code>candle</code>（K 线图）、<code>line</code>（折线图）、<code>renko</code>（砖型图） 和 <code>pnf</code>（点数图） 等。</p><p>示例：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>mpf<span style=color:#f92672>.</span>plot(data, type<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;candle&#39;</span>, volume<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>)
</span></span></code></pre></td></tr></table></div></div><p><img src=https://cdn.jsdelivr.net/gh/poloxue/images@2024-12/2024-12-11-mplfinance-chart-library-02.png alt></p><p>其他图标类型：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>mpf<span style=color:#f92672>.</span>plot(data, type<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;line&#39;</span>, volume<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>)
</span></span><span style=display:flex><span>mpf<span style=color:#f92672>.</span>plot(data, type<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;renko&#39;</span>, volume<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>)
</span></span><span style=display:flex><span>mpf<span style=color:#f92672>.</span>plot(data, type<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;pnf&#39;</span>, volume<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>)
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=添加移动平均线ma>添加移动平均线（MA）</h2><p>mplfinance 支持了对均线的支持，可以通过 <code>mav</code> 参数添加单个或多个移动平均线。</p><p>如添加单条移动平均线，示例：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>mpf<span style=color:#f92672>.</span>plot(data, type<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;ohlc&#39;</span>, mav<span style=color:#f92672>=</span><span style=color:#ae81ff>4</span>)
</span></span></code></pre></td></tr></table></div></div><p><img src=https://cdn.jsdelivr.net/gh/poloxue/images@2024-12/2024-12-11-mplfinance-chart-library-03.png alt></p><p>或添加多条移动平均线，示例：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>mpf<span style=color:#f92672>.</span>plot(data, type<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;candle&#39;</span>, mav<span style=color:#f92672>=</span>(<span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>6</span>, <span style=color:#ae81ff>9</span>))
</span></span></code></pre></td></tr></table></div></div><p><img src=https://cdn.jsdelivr.net/gh/poloxue/images@2024-12/2024-12-11-mplfinance-chart-library-04.png alt></p><hr><h2 id=其他指标>其他指标</h2><p>除了均线，我们也可以在图表中叠加自己的技术指标，如 EMA，还有布林带。</p><p>可以通过 talib 计算指标，示例如下：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>ema20 <span style=color:#f92672>=</span> ta<span style=color:#f92672>.</span>EMA(data[<span style=color:#e6db74>&#34;Close&#34;</span>], timeperiod<span style=color:#f92672>=</span><span style=color:#ae81ff>10</span>)
</span></span><span style=display:flex><span>upper, middle, lower <span style=color:#f92672>=</span> ta<span style=color:#f92672>.</span>BBANDS(
</span></span><span style=display:flex><span>    data[<span style=color:#e6db74>&#34;Close&#34;</span>], timeperiod<span style=color:#f92672>=</span><span style=color:#ae81ff>20</span>, nbdevup<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span>, nbdevdn<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span>, matype<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>plots <span style=color:#f92672>=</span> [
</span></span><span style=display:flex><span>    mpf<span style=color:#f92672>.</span>make_addplot(ema20, label<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;EMA10&#34;</span>),
</span></span><span style=display:flex><span>    mpf<span style=color:#f92672>.</span>make_addplot(upper, label<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;BB_UPPER&#34;</span>),
</span></span><span style=display:flex><span>    mpf<span style=color:#f92672>.</span>make_addplot(middle, label<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;BB_MIDDLE&#34;</span>),
</span></span><span style=display:flex><span>    mpf<span style=color:#f92672>.</span>make_addplot(lower, label<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;BB_LOWER&#34;</span>),
</span></span><span style=display:flex><span>]
</span></span><span style=display:flex><span>mpf<span style=color:#f92672>.</span>plot(
</span></span><span style=display:flex><span>    data,
</span></span><span style=display:flex><span>    type<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;candle&#34;</span>,
</span></span><span style=display:flex><span>    addplot<span style=color:#f92672>=</span>plots,
</span></span><span style=display:flex><span>)
</span></span></code></pre></td></tr></table></div></div><p><img src=https://cdn.jsdelivr.net/gh/poloxue/images@2024-12/2024-12-11-mplfinance-chart-library-05-v2.png alt></p><p>如上的示例中，只添加了图例，除此以外，<code>make_addplot</code> 还可以设置其他属性，如 color，type 之类的。</p><p>mplfinance 的代码库中中提供了大量的代码示例，想深入了解这个库，建议多看看这些案例，访问 <a href=https://github.com/matplotlib/mplfinance/tree/master/examples>examples</a>。</p><hr><h2 id=保存图表>保存图表</h2><p>绘制完成后，可以将图表保存为图片文件：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>mpf<span style=color:#f92672>.</span>plot(data, type<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;candle&#39;</span>, volume<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>, savefig<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;output.png&#39;</span>)
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=动画与实时更新>动画与实时更新</h2><p><code>mplfinance</code> 支持动态更新图表，适合实时显示金融数据。通过 <code>animation</code> 功能，可以生成动态图表，可参考官方文档中的示例：<a href=https://github.com/matplotlib/mplfinance/blob/master/markdown/animation.md>Animation/Updating plots</a>。这块就不展开介绍了，因为如果确有动态更新的需求，lightweight-charts 比 mplfinance 更合适。</p><hr><h2 id=总结>总结</h2><p><code>mplfinance</code> 是一个功能强大且易于使用的金融数据可视化工具，从基础的 K 线图到高级的技术分析图表都能轻松实现。</p><p>以下是几点建议：</p><ol><li><strong>先熟悉基础功能</strong>：学会加载数据并绘制简单图表。</li><li><strong>逐步扩展技巧</strong>：尝试添加移动平均线、成交量及自定义指标。</li><li><strong>参考官方教程</strong>：多浏览示例代码和文档。</li></ol><p>希望这篇教程能帮你快速上手 <code>mplfinance</code>！</p><div>本文来源于 <a href=https://www.poloxue.com>POLOXUE's BLOG</a>，地址： <a href=https://www.poloxue.com/posts/2024-12-11-mplfinance-chart-library/>mplfinance - 一个轻松绘制股票行情图表的 python 库</a><hr class=footer-separator><div class=tags></div><div class=back><a href=https://www.poloxue.com/><span aria-hidden=true>← Back</span></a></div><div class=back></div></div><div class=post>欢迎关注我的公众号：<img style=width:85% src=https://cdn.jsdelivr.net/gh/poloxue/images@main/wechat.png><div class=utterances></div><script src=https://utteranc.es/client.js repo=poloxue/blog issue-term=pathname theme=github-light crossorigin=anonymous async></script></div></div><div class="footer wrapper"><nav class=nav><div>2024 Polo Xue All rights reserved</div></nav></div><script>feather.replace()</script></body></html>