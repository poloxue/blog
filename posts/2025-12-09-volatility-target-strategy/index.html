<!doctype html><html><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><title>回测目标波动率策略 - POLOXUE's BLOG</title><meta name=viewport content="width=device-width,initial-scale=1"><meta itemprop=name content="回测目标波动率策略"><meta itemprop=description content="在做交易策略时，经常会碰到一个问题：**同一种策略在不同阶段表现完全不一样**。有时候波动大，你的仓位可能重了点；波动小，你又觉得仓位太轻，收益跟不上"><meta itemprop=datePublished content="2025-12-09T05:41:26+08:00"><meta itemprop=dateModified content="2025-12-09T05:41:26+08:00"><meta itemprop=wordCount content="165"><meta property="og:url" content="https://www.poloxue.com/posts/2025-12-09-volatility-target-strategy/"><meta property="og:site_name" content="POLOXUE's BLOG"><meta property="og:title" content="回测目标波动率策略"><meta property="og:description" content="在做交易策略时，经常会碰到一个问题：**同一种策略在不同阶段表现完全不一样**。有时候波动大，你的仓位可能重了点；波动小，你又觉得仓位太轻，收益跟不上"><meta property="og:locale" content="zh_cn"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-12-09T05:41:26+08:00"><meta property="article:modified_time" content="2025-12-09T05:41:26+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="回测目标波动率策略"><meta name=twitter:description content="在做交易策略时，经常会碰到一个问题：**同一种策略在不同阶段表现完全不一样**。有时候波动大，你的仓位可能重了点；波动小，你又觉得仓位太轻，收益跟不上"><script data-goatcounter=https://poloxue.goatcounter.com/count async src=//gc.zgo.at/count.js></script><link rel=stylesheet type=text/css media=screen href=https://www.poloxue.com/css/normalize.css><link rel=stylesheet type=text/css media=screen href=https://www.poloxue.com/css/main.css><link rel=stylesheet type=text/css media=screen href=https://www.poloxue.com/css/extra.css><link id=dark-scheme rel=stylesheet type=text/css href=https://www.poloxue.com/css/dark.css><script src=https://www.poloxue.com/js/feather.min.js></script><script src=https://www.poloxue.com/js/main.js></script><script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js></script><script>MathJax={tex:{displayMath:[["[","]"],["$$","$$"]],inlineMath:[["(",")"],["$","$"]]}}</script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7019080091542951" crossorigin=anonymous></script></head><body><div class="container wrapper"><div class=header><div class=avatar><a href=https://www.poloxue.com/><img src=/avatar.png alt="POLOXUE's BLOG"></a></div><h1 class=site-title><a href=https://www.poloxue.com/>POLOXUE's BLOG</a></h1><div class=site-description><nav class="nav social"><ul class=flat><li><a href=https://github.com/poloxue/ title=Github><i data-feather=github></i></a></li><li><a href=/posts/index.xml title=RSS><i data-feather=rss></i></a></li><li><a href=/ title=Wechat><i data-feather=message-circle></i></a></li><span class=scheme-toggle><a href=# id=scheme-toggle></a></ul></nav></div><nav class=nav><ul class=flat><li><a href=/>文章列表</a></li><li><a href=/tags>分类标签</a></li><li><a href=/about/about>关于我</a></li></ul></nav></div><div class=post><div class=post-header><div class=meta><div class=date><span class=day>09</span>
<span class=rest>Dec 2025</span></div></div><div class=matter><h1 class=title>回测目标波动率策略</h1></div></div><p>在做交易策略时，经常会碰到一个问题：<strong>同一种策略在不同阶段表现完全不一样</strong>。有时候波动大，你的仓位可能重了点；波动小，你又觉得仓位太轻，收益跟不上。</p><p>为了让整体风险变得可控，很多机构会使用一种非常“实用主义”的方法——<strong>目标波动率（Target Volatility）</strong>。</p><p>它的核心思想只有一句话：</p><blockquote><p><strong>让你的组合一直保持在预设的年化波动率，不多也不少。</strong></p></blockquote><p>这个想法其实很接近我们做 CTA、趋势策略时常说的“风险平价”，但目标波动率策略通常更简单、更直接，比较适合作为一个基础仓位管理模块。</p><hr><h2 id=为什么需要目标波动率>为什么需要目标波动率？</h2><p>做交易时，可能都有这种体验：</p><p>同一资产在不同年份的波动差距能大到离谱；震荡期仓位太重，会被洗到怀疑人生；单边大行情仓位太轻，看着涨但赚不到钱；策略性能的“稳定性”其实更多取决于仓位管理，而不是策略本身。</p><p>目标波动率的出发点就是：<strong>既然波动率影响收益和风险，那干脆用波动率来动态调整仓位。</strong></p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>波动高 → 仓位自动变轻
</span></span><span style=display:flex><span>波动低 → 仓位自然变重
</span></span></code></pre></td></tr></table></div></div><p>这样不用每天纠结现在是不是应该加仓或减仓，只需要按照公式让仓位自动收缩或扩张。</p><hr><h2 id=策略原理>策略原理</h2><p>策略其实只有一个核心公式：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>目标仓位权重 = 目标年化波动率 / 当前年化波动率
</span></span></code></pre></td></tr></table></div></div><p>例如，想把策略控制在 15% 的年化波动率，当前计算出来的波动率是 30%，那么你就应该只拿：<strong>15% / 30% = 0.5 倍仓位。</strong></p><p>如果你允许最大杠杆为 1.5，那么这个权重会自动裁剪：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>权重 = min(目标仓位权重, 最大杠杆)
</span></span></code></pre></td></tr></table></div></div><p>整个策略就靠这个仓位调整来运行。</p><hr><h2 id=使用-backtrader-回测>使用 Backtrader 回测</h2><p>我用了 SPY 这个品种回测了这个目标波动率的策略，策略的完整回测代码，请访问：<a href=https://github.com/poloxue/strategy_backtest/blob/main/voltarget.py>voltarget.py</a>。</p><p>我这里讲解代码中的一些核心指标计算与交易逻辑。</p><p>首先，波动率指标的计算，以当前的实际年化波动率作为基准。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>returns <span style=color:#f92672>=</span> bt<span style=color:#f92672>.</span>ind<span style=color:#f92672>.</span>PercentChange(self<span style=color:#f92672>.</span>data<span style=color:#f92672>.</span>close, period<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>std_dev <span style=color:#f92672>=</span> bt<span style=color:#f92672>.</span>ind<span style=color:#f92672>.</span>StandardDeviation(returns, period<span style=color:#f92672>=</span>self<span style=color:#f92672>.</span>p<span style=color:#f92672>.</span>period)
</span></span><span style=display:flex><span>self<span style=color:#f92672>.</span>volatility <span style=color:#f92672>=</span> std_dev <span style=color:#f92672>*</span> np<span style=color:#f92672>.</span>sqrt(self<span style=color:#f92672>.</span>p<span style=color:#f92672>.</span>annual_factor)
</span></span></code></pre></td></tr></table></div></div><p>通过计算的是 20 日的收益率标准差，并年化（乘上 √252）。这就是当前市场的“真实波动”。</p><p>在交易部分按波动率动态调整仓位</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>target_percent <span style=color:#f92672>=</span> min(
</span></span><span style=display:flex><span>    self<span style=color:#f92672>.</span>p<span style=color:#f92672>.</span>target_vol <span style=color:#f92672>/</span> self<span style=color:#f92672>.</span>volatility[<span style=color:#ae81ff>0</span>], 
</span></span><span style=display:flex><span>    self<span style=color:#f92672>.</span>p<span style=color:#f92672>.</span>max_leverage
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>target_size <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>broker<span style=color:#f92672>.</span>getvalue() <span style=color:#f92672>/</span> self<span style=color:#f92672>.</span>data<span style=color:#f92672>.</span>close[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>*</span> target_percent
</span></span><span style=display:flex><span>self<span style=color:#f92672>.</span>order_target_size(target<span style=color:#f92672>=</span>target_size)
</span></span></code></pre></td></tr></table></div></div><p>逻辑非常清晰：</p><ul><li><code>target_percent</code> 就是我们上面讲的核心公式；</li><li>使用 <code>order_target_size()</code> 自动把仓位调整到目标仓位。</li></ul><p>这让策略在波动小的时候自动加杠杆，在波动大时自动降杠杆，实现类似“风险再平衡”的效果。</p><h2 id=加载数据>加载数据</h2><p>用 YFinance 加载 SPY 标普 500 的历史数据。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>df <span style=color:#f92672>=</span> yf<span style=color:#f92672>.</span>download(
</span></span><span style=display:flex><span>    symbol,
</span></span><span style=display:flex><span>    start<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;2015-01-01&#34;</span>,
</span></span><span style=display:flex><span>    end<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;2025-11-30&#34;</span>,
</span></span><span style=display:flex><span>    multi_level_index<span style=color:#f92672>=</span><span style=color:#66d9ef>False</span>,
</span></span><span style=display:flex><span>    auto_adjust<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>,
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>)
</span></span></code></pre></td></tr></table></div></div><p>SPY 其实很适合这个策略，因为它大部分时间波动率稳定，偶尔波动巨大，用固定仓位很容易经历极端波动，而目标波动率策略可以让曲线变得相对 &ldquo;平滑&rdquo;。</p><p>如下是在最大杠杆 2 的净值表现：</p><p>调用方式：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>python script.py --symbol SPY --max-leverage 1.5 --target-volatility <span style=color:#ae81ff>2</span>
</span></span></code></pre></td></tr></table></div></div><p>输出评价指标：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>组合价值: <span style=color:#ae81ff>517871735.571006</span>
</span></span><span style=display:flex><span>夏普比率: <span style=color:#ae81ff>0.8689922727427503</span>
</span></span><span style=display:flex><span>最大回撤: <span style=color:#ae81ff>25.93392959742132</span>
</span></span><span style=display:flex><span>年化波动: <span style=color:#ae81ff>0.18463178961358762</span>
</span></span></code></pre></td></tr></table></div></div><p>净值绘图如下所示：</p><p><img src=https://cdn.jsdelivr.net/gh/poloxue/images@2025-12/2025-12-09-volatility-target-01.png alt></p><p>红色的净值曲线是目标波动率的净值曲线，蓝色是基准。</p><p>我回测了不同的市场，目标波动率策略在美股这种长期稳定向上，大部分时间波动率稳定，偶尔暴跌的指数有超额收益。而在 A 股和数字货币上并没有在降低波动率的同时还能保持收益。</p><hr><h2 id=7-总结>7. 总结</h2><p>目标波动率策略是一种“简单但好用”的工具。它不依赖方向、不依赖信号，而是利用波动率这个最基础的市场信息，动态调节仓位，实现一种自然的风险平衡。</p><div>本文来源于 <a href=https://www.poloxue.com>POLOXUE's BLOG</a>，地址： <a href=https://www.poloxue.com/posts/2025-12-09-volatility-target-strategy/>回测目标波动率策略</a><hr class=footer-separator><div class=tags></div><div class=back><a href=https://www.poloxue.com/><span aria-hidden=true>← Back</span></a></div><div class=back></div></div><div class=post>欢迎关注我的公众号：<img style=width:85% src=https://cdn.jsdelivr.net/gh/poloxue/images@main/wechat.png><div class=utterances></div><script src=https://utteranc.es/client.js repo=poloxue/blog issue-term=pathname theme=github-light crossorigin=anonymous async></script></div></div><div class="footer wrapper"><nav class=nav><div>2025 Polo Xue All rights reserved</div></nav></div><script>feather.replace()</script></body></html>