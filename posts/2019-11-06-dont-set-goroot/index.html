<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>你真的不用再设置 GOROOT 了 - POLOXUE's BLOG</title><meta name=viewport content="width=device-width,initial-scale=1"><meta itemprop=name content="你真的不用再设置 GOROOT 了"><meta itemprop=description content="为什么不再需要设置 GOROOT 呢？推荐读两篇英文文章，我意译了下，将它们放在了一篇里。
第一篇是关于 Go 1.10 之前，怎么设置 GOROOT，发表与 2013 年。第二篇 是从 Go 1.10 开始，如何处理 GOROOT，时间是 2018 年，Go 源码提交日志。这篇非常短小。
读完后，你会发现，大多数情况下，你都不用手动设置 GOROOT 了。
第一篇 作者：Dave Cheney | 地址：you-dont-need-to-set-goroot-really
一篇小短文，解释了为什么在编译和使用 Go 时，不需要设置 GOROOT。
概要性介绍 一般来说，在 Go 1.0 之后，编译和使用 GO 不再需要设置 GOROOT。事实上，如果你的电脑上存在多个版本的 Go 语言环境，设置 GOROOT 可能产生一些问题。
GOPATH 仍然需要设置。
从 Go 1.0 开始，GOPATH 就被强烈推荐。随着 Go 1.1 的发布，GOPATH 已经是强制性的了。
为什么不再要设置 GOROOT？ 谈些 Go 环境变量的历史吧！
Go 的资深老前辈们可能还记得，曾经的 Go 不仅要设置 GOROOT，还需要设置 GOOS 和 GOARCH。之所以要设置 GOROOT，是因为 Make 在编译构建的时候，引入了 GOROOT 中的内容，要提前设置 GOROOT 作为了它们的基本路径。"><meta itemprop=datePublished content="2019-11-06T12:42:29+08:00"><meta itemprop=dateModified content="2019-11-06T12:42:29+08:00"><meta itemprop=wordCount content="321"><meta itemprop=keywords content="Golang,"><meta property="og:title" content="你真的不用再设置 GOROOT 了"><meta property="og:description" content="为什么不再需要设置 GOROOT 呢？推荐读两篇英文文章，我意译了下，将它们放在了一篇里。
第一篇是关于 Go 1.10 之前，怎么设置 GOROOT，发表与 2013 年。第二篇 是从 Go 1.10 开始，如何处理 GOROOT，时间是 2018 年，Go 源码提交日志。这篇非常短小。
读完后，你会发现，大多数情况下，你都不用手动设置 GOROOT 了。
第一篇 作者：Dave Cheney | 地址：you-dont-need-to-set-goroot-really
一篇小短文，解释了为什么在编译和使用 Go 时，不需要设置 GOROOT。
概要性介绍 一般来说，在 Go 1.0 之后，编译和使用 GO 不再需要设置 GOROOT。事实上，如果你的电脑上存在多个版本的 Go 语言环境，设置 GOROOT 可能产生一些问题。
GOPATH 仍然需要设置。
从 Go 1.0 开始，GOPATH 就被强烈推荐。随着 Go 1.1 的发布，GOPATH 已经是强制性的了。
为什么不再要设置 GOROOT？ 谈些 Go 环境变量的历史吧！
Go 的资深老前辈们可能还记得，曾经的 Go 不仅要设置 GOROOT，还需要设置 GOOS 和 GOARCH。之所以要设置 GOROOT，是因为 Make 在编译构建的时候，引入了 GOROOT 中的内容，要提前设置 GOROOT 作为了它们的基本路径。"><meta property="og:type" content="article"><meta property="og:url" content="https://www.poloxue.com/posts/2019-11-06-dont-set-goroot/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-11-06T12:42:29+08:00"><meta property="article:modified_time" content="2019-11-06T12:42:29+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="你真的不用再设置 GOROOT 了"><meta name=twitter:description content="为什么不再需要设置 GOROOT 呢？推荐读两篇英文文章，我意译了下，将它们放在了一篇里。
第一篇是关于 Go 1.10 之前，怎么设置 GOROOT，发表与 2013 年。第二篇 是从 Go 1.10 开始，如何处理 GOROOT，时间是 2018 年，Go 源码提交日志。这篇非常短小。
读完后，你会发现，大多数情况下，你都不用手动设置 GOROOT 了。
第一篇 作者：Dave Cheney | 地址：you-dont-need-to-set-goroot-really
一篇小短文，解释了为什么在编译和使用 Go 时，不需要设置 GOROOT。
概要性介绍 一般来说，在 Go 1.0 之后，编译和使用 GO 不再需要设置 GOROOT。事实上，如果你的电脑上存在多个版本的 Go 语言环境，设置 GOROOT 可能产生一些问题。
GOPATH 仍然需要设置。
从 Go 1.0 开始，GOPATH 就被强烈推荐。随着 Go 1.1 的发布，GOPATH 已经是强制性的了。
为什么不再要设置 GOROOT？ 谈些 Go 环境变量的历史吧！
Go 的资深老前辈们可能还记得，曾经的 Go 不仅要设置 GOROOT，还需要设置 GOOS 和 GOARCH。之所以要设置 GOROOT，是因为 Make 在编译构建的时候，引入了 GOROOT 中的内容，要提前设置 GOROOT 作为了它们的基本路径。"><script data-goatcounter=https://poloxue.goatcounter.com/count async src=//gc.zgo.at/count.js></script>
<link rel=stylesheet type=text/css media=screen href=https://www.poloxue.com/css/normalize.css><link rel=stylesheet type=text/css media=screen href=https://www.poloxue.com/css/main.css><link rel=stylesheet type=text/css media=screen href=https://www.poloxue.com/css/extra.css><link id=dark-scheme rel=stylesheet type=text/css href=https://www.poloxue.com/css/dark.css><script src=https://www.poloxue.com/js/feather.min.js></script>
<script src=https://www.poloxue.com/js/main.js></script>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7019080091542951" crossorigin=anonymous></script></head><body><div class="container wrapper"><div class=header><div class=avatar><a href=https://www.poloxue.com/><img src=/avatar.png alt="POLOXUE's BLOG"></a></div><h1 class=site-title><a href=https://www.poloxue.com/>POLOXUE's BLOG</a></h1><div class=site-description><nav class="nav social"><ul class=flat><li><a href=https://github.com/poloxue/ title=Github><i data-feather=github></i></a></li><li><a href=/posts/index.xml title=RSS><i data-feather=rss></i></a></li><li><a href=/ title=Wechat><i data-feather=message-circle></i></a></li><span class=scheme-toggle><a href=# id=scheme-toggle></a></ul></nav></div><nav class=nav><ul class=flat><li><a href=/>文章列表</a></li><li><a href=/tags>分类标签</a></li><li><a href=/about/>关于我</a></li></ul></nav></div><div class=post><div class=post-header><div class=meta><div class=date><span class=day>06</span>
<span class=rest>Nov 2019</span></div></div><div class=matter><h1 class=title>你真的不用再设置 GOROOT 了</h1></div></div><p>为什么不再需要设置 <code>GOROOT</code> 呢？推荐读两篇英文文章，我意译了下，将它们放在了一篇里。</p><p><a href=https://dave.cheney.net/2013/06/14/you-dont-need-to-set-goroot-really>第一篇</a>是关于 Go 1.10 之前，怎么设置 <code>GOROOT</code>，发表与 2013 年。<a href=https://go-review.googlesource.com/c/go/+/42533/>第二篇</a> 是从 Go 1.10 开始，如何处理 <code>GOROOT</code>，时间是 2018 年，Go 源码提交日志。这篇非常短小。</p><p>读完后，你会发现，大多数情况下，你都不用手动设置 <code>GOROOT</code> 了。</p><h1 id=第一篇>第一篇</h1><p>作者：Dave Cheney | 地址：<a href=https://dave.cheney.net/2013/06/14/you-dont-need-to-set-goroot-really>you-dont-need-to-set-goroot-really</a></p><p>一篇小短文，解释了为什么在编译和使用 Go 时，不需要设置 <code>GOROOT</code>。</p><h2 id=概要性介绍>概要性介绍</h2><p>一般来说，在 Go 1.0 之后，编译和使用 GO 不再需要设置 <code>GOROOT</code>。事实上，如果你的电脑上存在多个版本的 Go 语言环境，设置 <code>GOROOT</code> 可能产生一些问题。</p><p><code>GOPATH</code> 仍然需要设置。</p><p>从 Go 1.0 开始，<code>GOPATH</code> 就被强烈推荐。随着 Go 1.1 的发布，<code>GOPATH</code> 已经是强制性的了。</p><h2 id=为什么不再要设置-goroot>为什么不再要设置 <code>GOROOT</code>？</h2><p><strong>谈些 Go 环境变量的历史吧！</strong></p><p>Go 的资深老前辈们可能还记得，曾经的 Go 不仅要设置 <code>GOROOT</code>，还需要设置 <code>GOOS</code> 和 <code>GOARCH</code>。之所以要设置 <code>GOROOT</code>，是因为 Make 在编译构建的时候，引入了 <code>GOROOT</code> 中的内容，要提前设置 <code>GOROOT</code> 作为了它们的基本路径。</p><p>随着 <code>go tool</code> 的引入，Go 1.0 之前，<code>GOOS</code> 和 <code>GOARCH</code> 已经变成可选了，因为构建脚本已经能自动检测出系统类别和 CPU 架构。在 Go 1.0 的发布后，引入了 cmd/dist 引导构建工具，<code>GOOS</code> 和 <code>GOARCH</code> 真正意义上是可选项了，仅仅在交叉编译时才会用到。</p><p><strong>不需要设置 <code>GOOS</code> 和 <code>GOARCH</code>，那 <code>GOROOT</code> 呢？</strong></p><p><code>GOROOT</code> 定义为指定安装 GO 的根目录。在之前的 Makefile 中，引入其他 Makefile 时，将它作为基础路径。而且，Go 1.0 之后，<code>go tool</code> 利用它查找 Go 编译器（保存在 <code>$GOROOT/pkg/tool/$GOOS_$GOARCH</code>）和标准库（在 <code>$GOROOT/pkg/$GOOS_$GOARCH</code>）。如果你是一名 Java 开发者，可以将 <code>GOROOT</code> 理解为 <code>JAVA_HOME</code>。</p><p>源码编译 Go，<code>GOROOT</code> 将自动发现（all.bash 的上级目录），然后设置到 go 工具链。</p><p>如下命令查看：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ echo $GOROOT
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ go env
</span></span><span style=display:flex><span>/home/dfc/go
</span></span></code></pre></td></tr></table></div></div><p>从 golang.org 下载的二进制包或者系统方式安装的 Go 环境，也已在工具链中设置了正确的 GOROOT。</p><p>一个例子，比如 Ubutun 12.04 下，安装了 Go 1.0。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ dpkg -l golang-<span style=color:#f92672>{</span>go,src<span style=color:#f92672>}</span> | grep ^ii
</span></span><span style=display:flex><span>$ go
</span></span><span style=display:flex><span>/usr/bin/go
</span></span><span style=display:flex><span>$ go env GOROOT
</span></span><span style=display:flex><span>/usr/lib/go
</span></span></code></pre></td></tr></table></div></div><p>我们可以看出，Go 工具链被安装在了 <code>/usr/bin/go</code> 下，<code>GOROOT</code> 内置为 <code>/usr/lib/go</code></p><p><strong>为什么不应该设置 <code>GOROOT</code></strong></p><p>我们不应该设置 <code>GOROOT</code>，是因为 Go 工具链已经内置了正确的值。</p><p>设置 <code>GOROOT</code> 将会覆盖掉保存在 go 工具链中的默认值，可能会导致 go 执行不同版本的编译器和标准库文件。</p><p>两种情况下，你需要设置 <code>GOROOT</code>。在官方的 <a href=http://golang.org/doc/install#install>安装介绍</a> 有相关的描述。</p><ul><li>如果你是 Linux、FreeBSD 或者 OS X 用户，下载了 zip 和 tarball 的二进制包安装环境。这些二进制的默认环境位于 /usr/local/go，建议你将 Go 安装到这个位置。如果选择不这么做，就必须设置到你指定的目录下。</li><li>如果你是 Windows 用户，使用 zip 二进制包安装，默认的 <code>GOROOT</code> 在 C:\Go 目录下。如果你将 Go 安装在其他位置，请设置 <code>GOROOT</code> 到指定的目录。</li></ul><h2 id=其他细节>其他细节</h2><p>本文已经介绍了当通过源码编译 Go 环境的时候，<code>GOROOT</code> 如何自动发现的。但如果 <code>GOROOT</code> 与 all.bash 所在位置并不匹配呢？比如，在临时目录下编译 Go 环境，如何正确地设置 <code>GOROOT</code> 呢？答案是使用 <code>GOROOT_FINAL</code>，它将被用于覆盖自动发现的 <code>GOROOT</code>，设置到 GO 工具链中。</p><p>举个例子，在 Debian/Ubuntu 上，构建程序会将 <code>GOROOT_FINAL</code> 的值设置为 /usr/lib/go。保持 <code>GOROOT</code> 是未设置状态，使构建编译愉快地执行。构建完成后，将 Go 工具链安装到 /usr/bin 目录下，编译器、源码和包安装到 /usr/lib/go 下。</p><h2 id=注意点>注意点</h2><p>如果使用二进制包安装 Go 环境，有些特殊情况需要处理，本文已经作了相关描述。</p><p>虽然构建系统能自动检测，但如果 all.bash 的父级目录不满足 <code>GOROOT</code> 要求，也需要另外处理。</p><h1 id=第二篇>第二篇</h1><p>翻译自 Go 的提交日志，地址：<a href=https://go-review.googlesource.com/c/go/+/42533/>use os.Executable to find GOROOT</a>。</p><p>Go 1.10 开始，通过 <code>use os.Executable</code> 查找 <code>GOROOT</code>。</p><p>之前，我们是通过 make.sh 编译构建 <code>GOROOT</code>，但如果将整个目录移动到新的路径下，这会使 Go 工具链无法正常工作。</p><p>如何解决这个问题呢？</p><p>一是可以将源码重新编译，但如果新位置在其他用户的目录下，可能就无法这么操作了。</p><p>二是，通过设置 <code>GOROOT</code> 环境变量的方式解决，但另外设置 <code>GOROOT</code> 是不推荐的，因为它可能使一个环境下 <code>go tool</code> 使用了另一个环境下 <code>compile</code>。</p><p>这次的修改，<code>go tool</code> 将通过相对路径的方式确定 <code>GOROOT</code>，通过使用 <code>os.Execute</code> 函数。同时，还会检查 <code>$GOROOT/pkg/tool</code> 目录是否存在，以避免下面的两种情况。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ ln -s $GOROOT/bin/go /usr/local/bin/go
</span></span></code></pre></td></tr></table></div></div><p>和</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ PATH<span style=color:#f92672>=</span>$HOME/bin:$PATH
</span></span><span style=display:flex><span>$ GOPATH<span style=color:#f92672>=</span>$HOME
</span></span><span style=display:flex><span>$ ln -s $GOROOT/bin/go $HOME/bin/go
</span></span></code></pre></td></tr></table></div></div><p>另外，如果当前的执行路径并不在 <code>GOROOT</code> 下，将会通过软连接找到真正的命令的位置，检查这个路径是否是 <code>GOROOT</code>。</p><div>本文来源于 <a href=https://www.poloxue.com>POLOXUE's BLOG</a>，地址： <a href=https://www.poloxue.com/posts/2019-11-06-dont-set-goroot/>你真的不用再设置 GOROOT 了</a><hr class=footer-separator><div class=tags><ul class=flat><li class=tag-li><a href=/tags/golang>Golang</a></li></ul></div><div class=back><a href=https://www.poloxue.com/><span aria-hidden=true>← Back</span></a></div><div class=back></div></div><div class=post>欢迎关注我的公众号：<img style=width:85% src=https://cdn.jsdelivr.net/gh/poloxue/images@main/wechat.png><div class=utterances></div><script src=https://utteranc.es/client.js repo=poloxue/blog issue-term=pathname theme=github-light crossorigin=anonymous async></script></div></div><div class="footer wrapper"><nav class=nav><div>2019 Polo Xue All rights reserved</div></nav></div><script>feather.replace()</script></body></html>