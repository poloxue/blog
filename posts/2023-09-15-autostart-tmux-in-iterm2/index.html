<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>iTerm2 启动时进入 Tmux 模式 - POLOXUE's BLOG</title><meta name=viewport content="width=device-width,initial-scale=1"><meta itemprop=name content="iTerm2 启动时进入 Tmux 模式"><meta itemprop=description content="介绍一个最快速的方式使 iTerm2 启动默认进入 Tmux 模式。默认情况下，每次启动 iTerm2，还需要一步输入 tmux attach 进入到 tmux 模式下。
我用 Tmux 是为了管理不同项目的工作区，常见的 IDE 一般够提供了打开提供给用户一个选择项目的界面。自然而然，iTerm2 + Tmux 是否也能实现类似的能力呢？
非常简单！
核心脚本介绍
首先，一段 bash 脚本:
1 tmux ls && read -p &#34;Select a session<default>:&#34; tmux_session && tmux attach -t ${tmux_session:-default} || tmux new -s ${tmux_session:-default} 这段脚本的说明如下：
tmux ls, 先输出当前可用的 session 列表，供用户输入使用； read xxx, 读取用户输入，将希望打开的会话名称存入 tmux_session 中； tmux attach，尝试打开会话，如果 tmux_session 为空，打开 default 会话； tmux new，如果开启失败，尝试创建一个新的会话； 说明：由于 read 命令使用了-p，必须要使用 bash 运行这段脚本。
配置 iTerm2 启动加载"><meta itemprop=datePublished content="2023-09-15T15:06:02+08:00"><meta itemprop=dateModified content="2023-09-15T15:06:02+08:00"><meta itemprop=wordCount content="414"><meta itemprop=keywords content="tmux,iTerm2,"><meta property="og:title" content="iTerm2 启动时进入 Tmux 模式"><meta property="og:description" content="介绍一个最快速的方式使 iTerm2 启动默认进入 Tmux 模式。默认情况下，每次启动 iTerm2，还需要一步输入 tmux attach 进入到 tmux 模式下。
我用 Tmux 是为了管理不同项目的工作区，常见的 IDE 一般够提供了打开提供给用户一个选择项目的界面。自然而然，iTerm2 + Tmux 是否也能实现类似的能力呢？
非常简单！
核心脚本介绍
首先，一段 bash 脚本:
1 tmux ls && read -p &#34;Select a session<default>:&#34; tmux_session && tmux attach -t ${tmux_session:-default} || tmux new -s ${tmux_session:-default} 这段脚本的说明如下：
tmux ls, 先输出当前可用的 session 列表，供用户输入使用； read xxx, 读取用户输入，将希望打开的会话名称存入 tmux_session 中； tmux attach，尝试打开会话，如果 tmux_session 为空，打开 default 会话； tmux new，如果开启失败，尝试创建一个新的会话； 说明：由于 read 命令使用了-p，必须要使用 bash 运行这段脚本。
配置 iTerm2 启动加载"><meta property="og:type" content="article"><meta property="og:url" content="https://www.poloxue.com/posts/2023-09-15-autostart-tmux-in-iterm2/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-09-15T15:06:02+08:00"><meta property="article:modified_time" content="2023-09-15T15:06:02+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="iTerm2 启动时进入 Tmux 模式"><meta name=twitter:description content="介绍一个最快速的方式使 iTerm2 启动默认进入 Tmux 模式。默认情况下，每次启动 iTerm2，还需要一步输入 tmux attach 进入到 tmux 模式下。
我用 Tmux 是为了管理不同项目的工作区，常见的 IDE 一般够提供了打开提供给用户一个选择项目的界面。自然而然，iTerm2 + Tmux 是否也能实现类似的能力呢？
非常简单！
核心脚本介绍
首先，一段 bash 脚本:
1 tmux ls && read -p &#34;Select a session<default>:&#34; tmux_session && tmux attach -t ${tmux_session:-default} || tmux new -s ${tmux_session:-default} 这段脚本的说明如下：
tmux ls, 先输出当前可用的 session 列表，供用户输入使用； read xxx, 读取用户输入，将希望打开的会话名称存入 tmux_session 中； tmux attach，尝试打开会话，如果 tmux_session 为空，打开 default 会话； tmux new，如果开启失败，尝试创建一个新的会话； 说明：由于 read 命令使用了-p，必须要使用 bash 运行这段脚本。
配置 iTerm2 启动加载"><script data-goatcounter=https://poloxue.goatcounter.com/count async src=//gc.zgo.at/count.js></script>
<link rel=stylesheet type=text/css media=screen href=https://www.poloxue.com/css/normalize.css><link rel=stylesheet type=text/css media=screen href=https://www.poloxue.com/css/main.css><link rel=stylesheet type=text/css media=screen href=https://www.poloxue.com/css/extra.css><link id=dark-scheme rel=stylesheet type=text/css href=https://www.poloxue.com/css/dark.css><script src=https://www.poloxue.com/js/feather.min.js></script>
<script src=https://www.poloxue.com/js/main.js></script></head><body><div class="container-wide wrapper"><div class=header><div class=avatar><a href=https://www.poloxue.com/><img src=/avatar.png alt="POLOXUE's BLOG"></a></div><h1 class=site-title><a href=https://www.poloxue.com/>POLOXUE's BLOG</a></h1><div class=site-description><nav class="nav social"><ul class=flat><li><a href=https://github.com/poloxue/ title=Github><i data-feather=github></i></a></li><li><a href=/posts/index.xml title=RSS><i data-feather=rss></i></a></li><span class=scheme-toggle><a href=# id=scheme-toggle></a></ul></nav></div><nav class=nav><ul class=flat><li><a href=/>首页</a></li><li><a href=/posts>文章列表</a></li><li><a href=/tags>分类标签</a></li><li><a href=/youtube>油管精选</a></li><li><a href=/about/>关于我</a></li></ul></nav></div><div class=article-nav id=article-nav-id><div class=post><div class=post-header><div class=meta><div class=date><span class=day>15</span>
<span class=rest>Sep 2023</span></div></div><div class=matter><h1 class=title>iTerm2 启动时进入 Tmux 模式</h1></div></div><aside class="show-on-mobile toc" id=static-toc><header><h3>Contents</h3></header><nav id=TableOfContents></nav></aside><p>介绍一个最快速的方式使 iTerm2 启动默认进入 Tmux 模式。默认情况下，每次启动 iTerm2，还需要一步输入 tmux attach 进入到 tmux 模式下。</p><p>我用 Tmux 是为了管理不同项目的工作区，常见的 IDE 一般够提供了打开提供给用户一个选择项目的界面。自然而然，iTerm2 + Tmux 是否也能实现类似的能力呢？</p><p>非常简单！</p><p><strong>核心脚本介绍</strong></p><p>首先，一段 bash 脚本:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>tmux ls <span style=color:#f92672>&amp;&amp;</span> read -p <span style=color:#e6db74>&#34;Select a session&lt;default&gt;:&#34;</span> tmux_session <span style=color:#f92672>&amp;&amp;</span> tmux attach -t <span style=color:#e6db74>${</span>tmux_session<span style=color:#66d9ef>:-</span>default<span style=color:#e6db74>}</span> <span style=color:#f92672>||</span> tmux new -s <span style=color:#e6db74>${</span>tmux_session<span style=color:#66d9ef>:-</span>default<span style=color:#e6db74>}</span>
</span></span></code></pre></td></tr></table></div></div><p>这段脚本的说明如下：</p><ul><li><code>tmux ls</code>, 先输出当前可用的 session 列表，供用户输入使用；</li><li><code>read xxx</code>, 读取用户输入，将希望打开的会话名称存入 tmux_session 中；</li><li><code>tmux attach</code>，尝试打开会话，如果 tmux_session 为空，打开 default 会话；</li><li><code>tmux new</code>，如果开启失败，尝试创建一个新的会话；</li></ul><p>说明：由于 <code>read</code> 命令使用了<code>-p</code>，必须要使用 bash 运行这段脚本。</p><p><strong>配置 iTerm2 启动加载</strong></p><p>选择 Preference -> Profile -> General -> Command -> Select &ldquo;Login Sell&rdquo;，并将代码放到 &ldquo;Send text at start&rdquo; 的输入框即可。</p><p>效果如下：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>hello: <span style=color:#ae81ff>1</span> windows <span style=color:#f92672>(</span>created Tue Sep <span style=color:#ae81ff>12</span> 17:13:54 2023<span style=color:#f92672>)</span> <span style=color:#f92672>(</span>group hello<span style=color:#f92672>)</span> <span style=color:#f92672>(</span>attached<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>default: <span style=color:#ae81ff>1</span> windows <span style=color:#f92672>(</span>created Wed Sep <span style=color:#ae81ff>13</span> 19:54:36 2023<span style=color:#f92672>)</span> <span style=color:#f92672>(</span>group default<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Select a session&lt;default&gt;:
</span></span></code></pre></td></tr></table></div></div><p>输入 &ldquo;hello&rdquo;，即可进入 &ldquo;hello&rdquo; 会话。简洁高效，有点想 IDE 启动的之后，让我们选择项目的感觉。</p><p>如果希望会话列表足够简洁，只有会话名称，可用 <code>tmux ls</code> 的输出格式化默认，将 <code>tmux ls</code> 进化为 <code>tmux -F '\#{session_name}'</code>；</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>hello
</span></span><span style=display:flex><span>default
</span></span></code></pre></td></tr></table></div></div><p><strong>尝试升级改进</strong></p><p>能不能只输入索引编号，实现快速选择呢？这种简单的 shell script 不容易实现。写了一段 Python 脚本，如下所示：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e>#!/usr/bin/env python</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> os
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>output <span style=color:#f92672>=</span> os<span style=color:#f92672>.</span>popen(<span style=color:#e6db74>&#34;tmux ls -F </span><span style=color:#ae81ff>\\</span><span style=color:#e6db74>#</span><span style=color:#e6db74>{session_name}</span><span style=color:#e6db74>&#34;</span>)<span style=color:#f92672>.</span>read()
</span></span><span style=display:flex><span>sessions <span style=color:#f92672>=</span> output<span style=color:#f92672>.</span>strip()<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#34;Sessions:&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> index <span style=color:#f92672>in</span> range(len(sessions)):
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{</span>index<span style=color:#e6db74>}</span><span style=color:#e6db74> - </span><span style=color:#e6db74>{</span>sessions[index]<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>input_value <span style=color:#f92672>=</span> input(<span style=color:#e6db74>&#34;Please select a session &lt;Index or Name&gt;(default):&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> input_value<span style=color:#f92672>.</span>isdigit():
</span></span><span style=display:flex><span>    sess_name <span style=color:#f92672>=</span> sessions[int(input_value)]
</span></span><span style=display:flex><span><span style=color:#66d9ef>elif</span> <span style=color:#f92672>not</span> input_value:
</span></span><span style=display:flex><span>    sess_name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;default&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>    sess_name <span style=color:#f92672>=</span> input_value
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> sess_name <span style=color:#f92672>not</span> <span style=color:#f92672>in</span> sessions:
</span></span><span style=display:flex><span>    answer <span style=color:#f92672>=</span> input(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;New a session `</span><span style=color:#e6db74>{</span>sess_name<span style=color:#e6db74>}</span><span style=color:#e6db74>`?(Y/N)&#34;</span>)
</span></span><span style=display:flex><span>    answer <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;Y&#34;</span> <span style=color:#f92672>and</span> os<span style=color:#f92672>.</span>system(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;tmux new -s </span><span style=color:#e6db74>{</span>sess_name<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)  <span style=color:#75715e># pyright: ignore</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>    os<span style=color:#f92672>.</span>system(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;tmux attach -t </span><span style=color:#e6db74>{</span>sess_name<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span></code></pre></td></tr></table></div></div><p>按上面的方式将脚本配置到 iTerm2 中，启动效果:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>❯ ~/tmux_selector
</span></span><span style=display:flex><span>Sessions:
</span></span><span style=display:flex><span><span style=color:#ae81ff>0</span> - hello
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span> - default
</span></span><span style=display:flex><span>Please <span style=color:#66d9ef>select</span> a session &lt;Index or Name&gt;<span style=color:#f92672>(</span>default<span style=color:#f92672>)</span>:
</span></span></code></pre></td></tr></table></div></div><p>这里只是一个小 demo，tmux ls 的输入还有其他格式化变量，有兴趣可以继续扩展。代码片段 <a href=https://gist.github.com/poloxue/37d3d79b35964ab8d885296b84ab4b5a>github 地址</a>。</p><p>总体上的体验还不错，但如果使用自带的功能，岂不是更好？继续探索吧。</p><p><strong>使用 tmux 内置菜单树</strong></p><p>进入 tmux 模式后，默认可以用快捷键 prefix-key + s 启动 tmux 选择菜单：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span>hello: <span style=color:#ae81ff>1</span> windows <span style=color:#f92672>(</span>created Tue Sep <span style=color:#ae81ff>12</span> 17:13:54 2023<span style=color:#f92672>)</span> <span style=color:#f92672>(</span>group hello<span style=color:#f92672>)</span> <span style=color:#f92672>(</span>attached<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>default: <span style=color:#ae81ff>1</span> windows <span style=color:#f92672>(</span>created Wed Sep <span style=color:#ae81ff>13</span> 19:54:36 2023<span style=color:#f92672>)</span> <span style=color:#f92672>(</span>group default<span style=color:#f92672>)</span>
</span></span></code></pre></td></tr></table></div></div><p>而且可以使用 jk 移动选择菜单。这个有没有办法在 iTerm2 启动时直接启动呢？想法很好，实现起来也不难。</p><p>首先，通过 <code>tmux list-keys</code> 检查 prefix-key + s 绑定的命令 tmux 命令。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span>$ tmux list-keys
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>bind-key    -T prefix       s                    choose-tree -Zs
</span></span><span style=display:flex><span>...
</span></span></code></pre></td></tr></table></div></div><p>通过 <code>choose-tree -Zs</code> 即可拉起菜单。在 tmux 模式下，使用 <code>tmux choose-tree -Zs</code> 测试一下效果，选择窗口成功拉起。</p><p>那么，接下来的问题是，如何配置到 iTerm2 启动命令呢？</p><p>因为这个命令必须在 tmux 模式下运行。如何做？通过 <code>tmux attach\; &lt;other commands running on tmux mode></code> 即可实现。</p><p>完整命令如下：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span>$ tmux attach<span style=color:#ae81ff>\;</span> choose-tree -zS
</span></span></code></pre></td></tr></table></div></div><p>试着在非 tmux 模式下测试下这段代码，看看是否能成功拉起菜单。确认没有问题后，将上面的语句配置到你的 iTerm2 启动时执行即可。</p><p>最后，为了防止首次进入没有 session，进一步优化，创建默认的 default 会话窗口。</p><p>完整 shell 代码如下：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ tmux attach<span style=color:#ae81ff>\;</span> choose-tree -Zs <span style=color:#f92672>||</span> read -p <span style=color:#e6db74>&#34;Create a default session?(Y/N)&#34;</span> anwser <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>[[</span> <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>anwser<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;Y&#34;</span> <span style=color:#f92672>]]</span> <span style=color:#f92672>&amp;&amp;</span> tmux new -t default
</span></span></code></pre></td></tr></table></div></div><p>但这里还有个缺点，默认 q 只能退出菜单，终端还是在 tmux 模式会话中，还要多一步 detach 才能退出，这算是和我们一般认为的步骤不太一样的地址吧。</p></div><nav class="hide-on-mobile section-nav"><nav id=TableOfContents></nav></nav></div><div class=post><hr class=footer-separator><div class=tags><ul class=flat><li class=tag-li><a href=/tags/tmux>tmux</a></li><li class=tag-li><a href=/tags/iterm2>iTerm2</a></li></ul></div><div class=back><a href=https://www.poloxue.com/><span aria-hidden=true>← Back</span></a></div><div class=back></div></div></div><div class="footer wrapper"><nav class=nav><div>2023 Polo Xue All rights reserved</div></nav></div><script>feather.replace()</script><script>var enableTruncate=!0,filterDepth=!1;const MAX_DEPTH=9;window.addEventListener("DOMContentLoaded",()=>{const e=new IntersectionObserver(e=>{e.reverse().forEach(e=>{const n=e.target.getAttribute("id");if(e.intersectionRatio>0){var t=document.querySelectorAll(`nav li a[href="#${n}"]`);t!=null&&t.forEach(e=>{if(e!=null){var t=getDepth(e.parentElement);filterDepth&&t<=MAX_DEPTH&&(clearActiveStatesInTableOfContents(),e.parentElement.classList.add("active"))}else filterDepth||(clearActiveStatesInTableOfContents(),e.parentElement.classList.add("active"))})}})});document.querySelectorAll("h1[id],h2[id],h3[id],h4[id]").forEach(t=>{e.observe(t)})});function isVisible(e){if(!(e instanceof Element))return!1;const n=getComputedStyle(e);if(n.display==="none")return!1;if(n.visibility!=="visible")return!1;if(n.opacity<.1)return!1;if(e.offsetWidth+e.offsetHeight+e.getBoundingClientRect().height+e.getBoundingClientRect().width===0)return!1;const t={x:e.getBoundingClientRect().left+e.offsetWidth/2,y:e.getBoundingClientRect().top+e.offsetHeight/2};if(t.x<0)return!1;if(t.x>(document.documentElement.clientWidth||window.innerWidth))return!1;if(t.y<0)return!1;if(t.y>(document.documentElement.clientHeight||window.innerHeight))return!1;let s=document.elementFromPoint(t.x,t.y);do if(s===e)return!0;while(s=s.parentNode)return!1}function clearActiveStatesInTableOfContents(){document.querySelectorAll("nav li").forEach(e=>{e.classList.remove("active")})}function getDepth(e){for(var t=0;e!==null&&e.tagName.toLowerCase()!=="ul";)t++,e=e.parentElement;return t}function navItems(){var e=document.querySelectorAll("nav nav li a");return Array.from(e).filter(e=>e.href!=null&&e.hash.startsWith("#"))}function lasItemInNavBarVisible(){var e=navItems().slice(-1)[0];return isVisible(e)}document.addEventListener("DOMContentLoaded",function(){if(!enableTruncate)return;var e=navItems();console.log(e),lasItemInNavBarVisible()||(filterDepth=!0,e.forEach(function(e){var t=getDepth(e.parentElement);t>MAX_DEPTH&&e.parentElement.classList.add("depth-nested")}))})</script></body></html>