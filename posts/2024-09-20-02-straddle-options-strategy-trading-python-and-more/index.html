<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>跨式期权交易和 Python - POLOXUE's BLOG</title><meta name=viewport content="width=device-width,initial-scale=1"><meta itemprop=name content="跨式期权交易和 Python"><meta itemprop=description content="期权作为一种灵活的工具提供了精准把控市场的可能性。在众多策略中，跨式期权策略有着简单性和潜在的收益最大化的特点。"><meta itemprop=datePublished content="2024-09-20T13:37:25+08:00"><meta itemprop=dateModified content="2024-09-20T13:37:25+08:00"><meta itemprop=wordCount content="442"><meta itemprop=keywords content><meta property="og:title" content="跨式期权交易和 Python"><meta property="og:description" content="期权作为一种灵活的工具提供了精准把控市场的可能性。在众多策略中，跨式期权策略有着简单性和潜在的收益最大化的特点。"><meta property="og:type" content="article"><meta property="og:url" content="https://www.poloxue.com/posts/2024-09-20-02-straddle-options-strategy-trading-python-and-more/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-09-20T13:37:25+08:00"><meta property="article:modified_time" content="2024-09-20T13:37:25+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="跨式期权交易和 Python"><meta name=twitter:description content="期权作为一种灵活的工具提供了精准把控市场的可能性。在众多策略中，跨式期权策略有着简单性和潜在的收益最大化的特点。"><script data-goatcounter=https://poloxue.goatcounter.com/count async src=//gc.zgo.at/count.js></script>
<link rel=stylesheet type=text/css media=screen href=https://www.poloxue.com/css/normalize.css><link rel=stylesheet type=text/css media=screen href=https://www.poloxue.com/css/main.css><link rel=stylesheet type=text/css media=screen href=https://www.poloxue.com/css/extra.css><link id=dark-scheme rel=stylesheet type=text/css href=https://www.poloxue.com/css/dark.css><script src=https://www.poloxue.com/js/feather.min.js></script>
<script src=https://www.poloxue.com/js/main.js></script>
<script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js></script>
<script>MathJax={tex:{displayMath:[["[","]"],["$$","$$"]],inlineMath:[["(",")"],["$","$"]]}}</script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7019080091542951" crossorigin=anonymous></script></head><body><div class="container-wide wrapper"><div class=header><div class=avatar><a href=https://www.poloxue.com/><img src=/avatar.png alt="POLOXUE's BLOG"></a></div><h1 class=site-title><a href=https://www.poloxue.com/>POLOXUE's BLOG</a></h1><div class=site-description><nav class="nav social"><ul class=flat><li><a href=https://github.com/poloxue/ title=Github><i data-feather=github></i></a></li><li><a href=/posts/index.xml title=RSS><i data-feather=rss></i></a></li><li><a href=/ title=Wechat><i data-feather=message-circle></i></a></li><span class=scheme-toggle><a href=# id=scheme-toggle></a></ul></nav></div><nav class=nav><ul class=flat><li><a href=/>文章列表</a></li><li><a href=/tags>分类标签</a></li><li><a href=https://crypto.poloxue.com/>每日资讯</a></li><li><a href=/about/about>关于我</a></li></ul></nav></div><div class=article-nav id=article-nav-id><div class=post><div class=post-header><div class=meta><div class=date><span class=day>20</span>
<span class=rest>Sep 2024</span></div></div><div class=matter><h1 class=title>跨式期权交易和 Python</h1></div></div><aside class="show-on-mobile toc" id=static-toc><header><h3>Contents</h3></header><nav id=TableOfContents><ol><li><a href=#什么是跨式期权策略>什么是跨式期权策略？</a></li><li><a href=#跨式期权策略的类型>跨式期权策略的类型</a><ol><li><a href=#买入跨式期权>买入跨式期权</a></li><li><a href=#跨式期权策略的要点>跨式期权策略的要点</a></li></ol></li><li><a href=#策略中的盈亏平衡点>策略中的盈亏平衡点</a></li><li><a href=#如何实践跨式期权策略>如何实践跨式期权策略</a></li><li><a href=#使用python实现跨式期权策略>使用Python实现跨式期权策略</a></li><li><a href=#用python计算跨式期权策略的收益>用Python计算跨式期权策略的收益</a><ol><li><a href=#步骤1导入库并定义参数>步骤1：导入库并定义参数</a></li><li><a href=#步骤2计算看涨期权收益>步骤2：计算看涨期权收益</a></li><li><a href=#步骤3计算看跌期权收益>步骤3：计算看跌期权收益</a></li><li><a href=#步骤4计算跨式期权策略的总收益>步骤4：计算跨式期权策略的总收益</a></li></ol></li><li><a href=#卖出跨式期权策略>卖出跨式期权策略</a></li><li><a href=#跨式期权策略的局限性及应对方法>跨式期权策略的局限性及应对方法</a></li><li><a href=#结论>结论</a></li></ol></nav></aside><ul><li><a href=https://blog.quantinsti.com/straddle-options-trading-strategy-python/>译文原文</a></li></ul><p>期权作为一种灵活的工具提供了精准把控市场的可能性。在众多策略中，跨式期权策略有着简单性和潜在的收益最大化的特点。</p><p>跨式期权策略的核心是同时购买相同行权价和到期日的看涨期权和看跌期权。这种双重策略让我们在不确定市场方向时，利用价格大幅波动获利。</p><p>本文将探讨跨式期权策略的原理和工作机制，以及如何用它构建有效的交易策略。本文的目的是提供一个关于跨式期权策略的入门，助你创建自己的跨式期权策略。</p><h2 id=什么是跨式期权策略>什么是跨式期权策略？</h2><p>跨式期权策略的逻辑在于其从市场波动性中获利的能力。当交易者预期标的资产的价格会有显著波动，但不确定价格方向时，该策略就可以派上用场。通过同时持有看涨期权和看跌期权，就可以在价格急剧波动时获利，无论标的资产的最终方向如何。</p><p>跨式期权的组成：<strong>看涨期权（Call Option）</strong> 和 <strong>看跌期权（Put Option）</strong>。</p><p>如果标的价格在到期日前有显著的波动，无论上涨下跌，如果其中一个期权的利润抵消另一个期权的损失，就会产生净利润。</p><p>这种策略仅在股票价格方向不确定但波动性较大时才有效，如特斯拉（TESLA），马斯克曾警告2024年的表现可能不如2023年出色。</p><p>以苹果公司（Apple Inc.，股票代码：AAPL）为例，更好地理解跨式期权策略。此例假设苹果公司即将发布季度财报，但市场预期波动较大，且对财报的好坏预期不一。然而，交易者预计市场会有剧烈的价格波动。</p><p>如果用跨式期权策略的交易，我们就会同时购买苹果公司股票的看涨和看跌期权，行权价为100美元，到期日为一个月后。</p><p>跨式策略的工作原理：</p><ul><li><strong>看涨期权</strong>：购买看涨期权，我们有权在到期日或之前以100美元的行权价购买苹果股票。如果股票价格大幅上涨，就可以以行权价买入股票，并以更高的市场价卖出。</li><li><strong>看跌期权</strong>：购买看跌期权，我们有权在到期日或之前以100美元的行权价卖出苹果股票。如果股票价格大幅下跌，就可以以行权价卖出股票，并从中获利。</li></ul><p>讨论两个可能的场景：</p><ul><li><strong>场景 1：财报好于预期</strong>：如果苹果公司的财报超出预期，股价可能飙升。在这种情况下，交易者可以行使看涨期权，低价买入股票并高价卖出，而看跌期权将变得毫无价值。</li><li><strong>场景 2：财报低于预期</strong>：如果财报不如预期，股价可能下跌。在这种情况下，交易者可以行使看跌期权，高价卖出股票，而看涨期权将变得毫无价值。</li></ul><p>在两个场景中，跨式期权策略能够从显著的价格波动中获利，和价格涨跌无关。</p><p>但值得注意的是，该策略获利的前提是价格波动要足够大，以覆盖同时购买两个期权的成本（即权利金费用）。</p><p>接下来，我们将讨论跨式期权策略的类型。</p><h2 id=跨式期权策略的类型>跨式期权策略的类型</h2><p>跨式期权策略有两种类型：</p><ul><li><strong>买入跨式（Long Straddle）</strong>：购买相同行权价的看涨期权和看跌期权时，称为买入跨式期权。</li><li><strong>卖出跨式（Short Straddle）</strong>：与买入跨式期权相反。</li></ul><h3 id=买入跨式期权>买入跨式期权</h3><p>这种策略通常在标的资产的价格接近行权价时进行，但也可以在其他情况下使用。</p><p>跨式期权策略在隐含波动率较低、期权成本较低的市场中表现良好，但要求标的资产价格有显著的波动。这种策略要求同时买入看涨期权和看跌期权，行权价相同，且有相同的到期日和标的资产。</p><p>买入跨式的到期收益图：</p><p><img src=https://d1rwhvwstyk9gu.cloudfront.net/2024/03/Straddle-Options-GIF.gif alt></p><h3 id=跨式期权策略的要点>跨式期权策略的要点</h3><p>策略中，我们关注购买期权时的实值程度，即期权相对于标的资产当前价格的状态。</p><p>图表展示了策略的不同组成和总体的盈亏情况：</p><p><strong>看涨期权（红线）</strong>：</p><ul><li>当股票价格上涨超过执行价格（100）时，买入看涨期权的收益将增加。</li><li>如果股票价格低于执行价格，损失则是支付的权利金（约为20）。</li></ul><p><strong>看跌期权（绿线）</strong>：</p><ul><li>当股票价格跌破执行价格时，买入看跌期权的收益将增加。</li><li>如果股票价格高于执行价格，损失也是支付的权利金。</li></ul><p><strong>长跨式策略（蓝线，V形）</strong>：</p><ul><li>这是同时买入看涨期权和看跌期权来构建的组合策略。</li><li>如果股票价格出现显著上涨或下跌，无论方向，策略都会有盈利。</li><li>如果股票价格维持在执行价格附近不动，则策略将遭遇最大亏损，即两个期权的权利金之和。</li></ul><p><strong>最大亏损：</strong> 发生在股票价格接近执行价格（100左右）时。这时，亏损为两个期权的权利金之和，即<strong>看涨期权权利金 + 看跌期权权利金</strong>。</p><h2 id=策略中的盈亏平衡点>策略中的盈亏平衡点</h2><p>若到期时，如果行权价与资产价格之差高于或低于权利金总额，则策略可达到盈亏平衡。</p><p>无论价格是高于还是低于行权价，如果一个期权的价值等于支付的权利金，另一个期权将失效。</p><p>盈亏平衡点可描述为：</p><ul><li><strong>向上盈亏平衡点</strong> = 行权价 + 支付的权利金</li><li><strong>向下盈亏平衡点</strong> = 行权价 - 支付的权利金</li></ul><p>接下来开始讨论如何运用跨式期权策略获利。</p><h2 id=如何实践跨式期权策略>如何实践跨式期权策略</h2><p>继续以上苹果公司的例子，假设标的资产价格大幅波动，或隐含波动率（IV）突然大幅上升，这时跨式期权可以带来利润。正如前面讨论的两种情境（财报好于预期或财报低于预期），交易者可以通过行使期权获得收益。</p><p>波动性越大，获利的可能性越高，这意味着潜在的利润可能会很大，而最大损失将仅限于支付的权利金。</p><p>但如果市场波动低于10%，该策略可能难以获利。如果标的资产的价格恰好在行权价时到期，风险最大，交易者将遭受最大损失。</p><p>接下来，我们将展示如何使用Python实现跨式期权策略。</p><h2 id=使用python实现跨式期权策略>使用Python实现跨式期权策略</h2><p>在这个示例中，我们将使用苹果公司（AAPL）的期权。</p><p>买入跨式期权策略获利的前提是标的资产的价格大幅波动，无论方向。苹果公司的股票价格就显示出了这种波动性。</p><p>以下是用Python绘制的过去一个月苹果股票价格变化的图表：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> yfinance <span style=color:#66d9ef>as</span> yf
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> matplotlib.pyplot <span style=color:#66d9ef>as</span> plt
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 定义股票代码</span>
</span></span><span style=display:flex><span>ticker_symbol <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;AAPL&#39;</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 设置数据获取的起止日期</span>
</span></span><span style=display:flex><span>start_date <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;2024-02-01&#39;</span>
</span></span><span style=display:flex><span>end_date <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;2024-03-18&#39;</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 从Yahoo Finance获取数据</span>
</span></span><span style=display:flex><span>data <span style=color:#f92672>=</span> yf<span style=color:#f92672>.</span>download(ticker_symbol, start<span style=color:#f92672>=</span>start_date, end<span style=color:#f92672>=</span>end_date)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 绘制收盘价图</span>
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>figure(figsize<span style=color:#f92672>=</span>(<span style=color:#ae81ff>10</span>, <span style=color:#ae81ff>6</span>))
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>plot(data[<span style=color:#e6db74>&#39;Close&#39;</span>], marker<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;o&#39;</span>, linestyle<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;-&#39;</span>)
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>title(<span style=color:#e6db74>&#39;过去一个月的AAPL收盘价&#39;</span>)
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>xlabel(<span style=color:#e6db74>&#39;日期&#39;</span>)
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>ylabel(<span style=color:#e6db74>&#39;收盘价（美元）&#39;</span>)
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>grid(<span style=color:#66d9ef>True</span>)
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>xticks(rotation<span style=color:#f92672>=</span><span style=color:#ae81ff>45</span>)
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>tight_layout()
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>show()
</span></span></code></pre></td></tr></table></div></div><p><img src=https://d1rwhvwstyk9gu.cloudfront.net/2024/03/AAPL_price.png alt></p><p>上图展示了过去一个月内苹果股票的价格波动，最高点为189美元，最低点为172.5美元。</p><p>如下是苹果公司2024年4月到期的期权链表，选择日期进行交易：</p><p><img src=https://d1rwhvwstyk9gu.cloudfront.net/2024/03/AAPL-Option-chain.png alt></p><p>该示例中，我们将买入1份实值 PUT 和1份虚值 CALL，行权价为200美元，到期日为2024.4.5。</p><p><img src=https://d1rwhvwstyk9gu.cloudfront.net/2024/03/AAPL-Puts-chain.png alt></p><p>我将为行权价为200美元的看涨期权支付0.04美元，为行权价为200美元的看跌期权支付29.25美元。期权将于2024年4月5日到期，要实现利润，苹果股票在此之前必须有大幅波动。</p><p>净权利金费用为29.29美元。</p><p>为了找到该策略的盈亏平衡点，我们可以进行如下计算：</p><ul><li><strong>向上盈亏平衡点（看涨期权）</strong>：行权价 + 支付的权利金 = 200 + 0.04 = 200.04美元。</li><li><strong>向下盈亏平衡点（看跌期权）</strong>：行权价 - 支付的权利金 = 200 - 29.25 = 170.75美元。</li></ul><p>该跨式期权策略的盈亏平衡点分别为：</p><ul><li><strong>向上盈亏平衡点</strong>：200.04美元。此时，看涨期权变得有利可图，而看跌期权可能失效。</li><li><strong>向下盈亏平衡点</strong>：170.75美元。此时，看跌期权变得有利可图，而看涨期权可能失效。</li></ul><p>接下来，我们将使用Python计算并绘制跨式期权策略的收益图。</p><h2 id=用python计算跨式期权策略的收益>用Python计算跨式期权策略的收益</h2><h3 id=步骤1导入库并定义参数>步骤1：导入库并定义参数</h3><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> numpy <span style=color:#66d9ef>as</span> np
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> matplotlib.pyplot <span style=color:#66d9ef>as</span> plt
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> seaborn
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 定义参数</span>
</span></span><span style=display:flex><span>spot_price <span style=color:#f92672>=</span> data[<span style=color:#e6db74>&#39;Close&#39;</span>][<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>]  <span style=color:#75715e># AAPL股票当前价格</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 买入看跌期权</span>
</span></span><span style=display:flex><span>strike_price_long_put <span style=color:#f92672>=</span> <span style=color:#ae81ff>200</span>
</span></span><span style=display:flex><span>premium_long_put <span style=color:#f92672>=</span> <span style=color:#ae81ff>29.25</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 买入看涨期权</span>
</span></span><span style=display:flex><span>strike_price_long_call <span style=color:#f92672>=</span> <span style=color:#ae81ff>200</span>
</span></span><span style=display:flex><span>premium_long_call <span style=color:#f92672>=</span> <span style=color:#ae81ff>0.04</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 到期时的股票价格范围</span>
</span></span><span style=display:flex><span>sT <span style=color:#f92672>=</span> np<span style=color:#f92672>.</span>arange(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>2</span> <span style=color:#f92672>*</span> spot_price, <span style=color:#ae81ff>1</span>)
</span></span></code></pre></td></tr></table></div></div><h3 id=步骤2计算看涨期权收益>步骤2：计算看涨期权收益</h3><p>定义一个函数，用于计算看涨期权的收益：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>call_payoff</span>(sT, strike_price, premium):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> np<span style=color:#f92672>.</span>where(sT <span style=color:#f92672>&gt;</span> strike_price, sT <span style=color:#f92672>-</span> strike_price, <span style=color:#ae81ff>0</span>) <span style=color:#f92672>-</span> premium
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>payoff_long_call <span style=color:#f92672>=</span> call_payoff(sT, strike_price_long_call, premium_long_call)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 绘图</span>
</span></span><span style=display:flex><span>fig, ax <span style=color:#f92672>=</span> plt<span style=color:#f92672>.</span>subplots()
</span></span><span style=display:flex><span>ax<span style=color:#f92672>.</span>spines[<span style=color:#e6db74>&#39;top&#39;</span>]<span style=color:#f92672>.</span>set_visible(<span style=color:#66d9ef>False</span>)
</span></span><span style=display:flex><span>ax<span style=color:#f92672>.</span>spines[<span style=color:#e6db74>&#39;right&#39;</span>]<span style=color:#f92672>.</span>set_visible(<span style=color:#66d9ef>False</span>)
</span></span><span style=display:flex><span>ax<span style=color:#f92672>.</span>spines[<span style=color:#e6db74>&#39;bottom&#39;</span>]<span style=color:#f92672>.</span>set_position(<span style=color:#e6db74>&#39;zero&#39;</span>)
</span></span><span style=display:flex><span>ax<span style=color:#f92672>.</span>plot(sT, payoff_long_call, label<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;Long Call&#39;</span>, color<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;r&#39;</span>)
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>xlabel(<span style=color:#e6db74>&#39;Stock Price&#39;</span>)
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>ylabel(<span style=color:#e6db74>&#39;Profit and loss&#39;</span>)
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>legend()
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>show()
</span></span></code></pre></td></tr></table></div></div><p><img src=https://d1rwhvwstyk9gu.cloudfront.net/2024/03/Long-call.png alt></p><h3 id=步骤3计算看跌期权收益>步骤3：计算看跌期权收益</h3><p>同样，我们定义一个函数计算看跌期权的收益：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>put_payoff</span>(sT, strike_price, premium):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> np<span style=color:#f92672>.</span>where(sT <span style=color:#f92672>&lt;</span> strike_price, strike_price <span style=color:#f92672>-</span> sT, <span style=color:#ae81ff>0</span>) <span style=color:#f92672>-</span> premium
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>payoff_long_put <span style=color:#f92672>=</span> put_payoff(sT, strike_price_long_put, premium_long_put)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 绘图</span>
</span></span><span style=display:flex><span>fig, ax <span style=color:#f92672>=</span> plt<span style=color:#f92672>.</span>subplots()
</span></span><span style=display:flex><span>ax<span style=color:#f92672>.</span>spines[<span style=color:#e6db74>&#39;top&#39;</span>]<span style=color:#f92672>.</span>set_visible(<span style=color:#66d9ef>False</span>)
</span></span><span style=display:flex><span>ax<span style=color:#f92672>.</span>spines[<span style=color:#e6db74>&#39;right&#39;</span>]<span style=color:#f92672>.</span>set_visible(<span style=color:#66d9ef>False</span>)
</span></span><span style=display:flex><span>ax<span style=color:#f92672>.</span>spines[<span style=color:#e6db74>&#39;bottom&#39;</span>]<span style=color:#f92672>.</span>set_position(<span style=color:#e6db74>&#39;zero&#39;</span>)
</span></span><span style=display:flex><span>ax<span style=color:#f92672>.</span>plot(sT, payoff_long_put, label<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;Long Put&#39;</span>, color<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;g&#39;</span>)
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>xlabel(<span style=color:#e6db74>&#39;Stock Price&#39;</span>)
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>ylabel(<span style=color:#e6db74>&#39;Profit and loss&#39;</span>)
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>legend()
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>show()
</span></span></code></pre></td></tr></table></div></div><p><img src=https://d1rwhvwstyk9gu.cloudfront.net/2024/03/Long-put.png alt></p><h3 id=步骤4计算跨式期权策略的总收益>步骤4：计算跨式期权策略的总收益</h3><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>payoff_straddle <span style=color:#f92672>=</span> payoff_long_call <span style=color:#f92672>+</span> payoff_long_put
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#34;最大收益：无限&#34;</span>)
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#34;最大亏损：&#34;</span>, min(payoff_straddle))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 绘图</span>
</span></span><span style=display:flex><span>fig, ax <span style=color:#f92672>=</span> plt<span style=color:#f92672>.</span>subplots()
</span></span><span style=display:flex><span>ax<span style=color:#f92672>.</span>spines[<span style=color:#e6db74>&#39;top&#39;</span>]<span style=color:#f92672>.</span>set_visible(<span style=color:#66d9ef>False</span>)
</span></span><span style=display:flex><span>ax<span style=color:#f92672>.</span>spines[<span style=color:#e6db74>&#39;right&#39;</span>]<span style=color:#f92672>.</span>set_visible(<span style=color:#66d9ef>False</span>)
</span></span><span style=display:flex><span>ax<span style=color:#f92672>.</span>spines[<span style=color:#e6db74>&#39;bottom&#39;</span>]<span style=color:#f92672>.</span>set_position(<span style=color:#e6db74>&#39;zero&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ax<span style=color:#f92672>.</span>plot(sT, payoff_long_call, <span style=color:#e6db74>&#39;--&#39;</span>, label<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;Long Call&#39;</span>, color<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;r&#39;</span>)
</span></span><span style=display:flex><span>ax<span style=color:#f92672>.</span>plot(sT, payoff_long_put, <span style=color:#e6db74>&#39;--&#39;</span>, label<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;Long Put&#39;</span>, color<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;g&#39;</span>)
</span></span><span style=display:flex><span>ax<span style=color:#f92672>.</span>plot(sT, payoff_straddle, label<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;Straddle&#39;</span>)
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>xlabel(<span style=color:#e6db74>&#39;Stock Price&#39;</span>)
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>ylabel(<span style=color:#e6db74>&#39;Profit and loss&#39;</span>)
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>legend()
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>show()
</span></span></code></pre></td></tr></table></div></div><p>最终输出如下：</p><p>最大收益：无限<br>最大亏损：29.29美元</p><p><img src=https://d1rwhvwstyk9gu.cloudfront.net/2024/03/Straddle-strategy.png alt></p><p>如图可知，跨式期权策略的最大收益无限，最大亏损则限制为支付的29.29美元的权利金。如前文的盈亏平衡点计算所示，向上的盈亏平衡点是200.04美元，向下的盈亏平衡点是170.75美元。</p><h2 id=卖出跨式期权策略>卖出跨式期权策略</h2><p>卖出跨式期权策略与买入跨式期权策略正好相反。然而，买入跨式期权策略在实践中更为常见。</p><p>接下来，我们将讨论该策略的一些局限性以及克服这些局限性的方法。</p><h2 id=跨式期权策略的局限性及应对方法>跨式期权策略的局限性及应对方法</h2><table><thead><tr><th>局限性</th><th>解释</th><th>应对策略</th></tr></thead><tbody><tr><td>高成本</td><td>跨式期权需要同时购买看涨期权和看跌期权，导致较高的初始成本。</td><td>通过使用较长到期日的期权或选择平值或轻度虚值期权来分摊权利金成本。</td></tr><tr><td>把握市场时机</td><td>跨式期权需要精准把握价格波动的时机。</td><td>分散投资组合，混合使用不同策略，并根据市场情况调整跨式期权的分配。</td></tr><tr><td>收益潜力有限</td><td>如果标的资产未能显著波动，跨式期权的收益潜力有限。</td><td>实施止损策略，以防市场未如预期波动，并确保保护潜在利润。</td></tr><tr><td>市场波动性</td><td>跨式期权在低波动性环境中效果较差，因为它依赖于显著的价格波动来产生利润。</td><td>监控波动性水平，并相应调整策略。探索低波动率受益的替代策略，如铁鹰策略或蝶式期权策略。</td></tr><tr><td>事件风险</td><td>跨式期权策略容易受到市场意外事件的影响，如突发市场变化或公告。</td><td>实施风险管理措施，如止损订单或头寸调整，以应对不利事件造成的潜在损失。</td></tr><tr><td>策略复杂</td><td>跨式期权可能较为复杂，需要对期权定价和市场动态有深入理解。</td><td>充分学习期权交易知识，并通过模拟交易或小规模操作来实践策略，避免投入过多资金。</td></tr><tr><td>流动性限制</td><td>低流动性的期权合约可能有更大的买卖价差，影响跨式期权策略的成本效益。</td><td>关注流动性好的期权合约，确保较小的买卖价差以降低交易成本并提高执行质量。</td></tr></tbody></table><p>通过采取主动的策略和风险管理技术，交易者可以克服跨式期权策略的局限性，并提高策略在市场中的整体表现。</p><h2 id=结论>结论</h2><p>在充满波动的金融市场中，期权为市场波动提供了一种灵活的工具。在这些策略中，跨式期权因其能够从显著的价格变动中获利而脱颖而出。本文通过深入分析和实现技术，助你利用Python有效地优化跨式期权策略。</p><p>但必须承认它的高成本、时机把握难度和市场波动性等局限性。通过采用主动的风险管理措施，并不断优化策略，交易者可以在多变的市场环境中提升跨式期权策略的盈利能力和韧性。</p><div>本文来源于 <a href=https://www.poloxue.com>POLOXUE's BLOG</a>，地址： <a href=https://www.poloxue.com/posts/2024-09-20-02-straddle-options-strategy-trading-python-and-more/>跨式期权交易和 Python</a></div></div><nav class="hide-on-mobile section-nav"><nav id=TableOfContents><ol><li><a href=#什么是跨式期权策略>什么是跨式期权策略？</a></li><li><a href=#跨式期权策略的类型>跨式期权策略的类型</a><ol><li><a href=#买入跨式期权>买入跨式期权</a></li><li><a href=#跨式期权策略的要点>跨式期权策略的要点</a></li></ol></li><li><a href=#策略中的盈亏平衡点>策略中的盈亏平衡点</a></li><li><a href=#如何实践跨式期权策略>如何实践跨式期权策略</a></li><li><a href=#使用python实现跨式期权策略>使用Python实现跨式期权策略</a></li><li><a href=#用python计算跨式期权策略的收益>用Python计算跨式期权策略的收益</a><ol><li><a href=#步骤1导入库并定义参数>步骤1：导入库并定义参数</a></li><li><a href=#步骤2计算看涨期权收益>步骤2：计算看涨期权收益</a></li><li><a href=#步骤3计算看跌期权收益>步骤3：计算看跌期权收益</a></li><li><a href=#步骤4计算跨式期权策略的总收益>步骤4：计算跨式期权策略的总收益</a></li></ol></li><li><a href=#卖出跨式期权策略>卖出跨式期权策略</a></li><li><a href=#跨式期权策略的局限性及应对方法>跨式期权策略的局限性及应对方法</a></li><li><a href=#结论>结论</a></li></ol></nav></nav></div><div class=post><hr class=footer-separator><div class=tags></div><div class=back><a href=https://www.poloxue.com/><span aria-hidden=true>← Back</span></a></div><div class=back></div></div><div class=post><img style=width:85% src=https://cdn.jsdelivr.net/gh/poloxue/images@main/wechat.png><div class=utterances></div><script src=https://utteranc.es/client.js repo=poloxue/blog issue-term=pathname theme=github-light crossorigin=anonymous async></script></div></div><div class="footer wrapper"><nav class=nav><div>2024 Polo Xue All rights reserved</div></nav></div><script>feather.replace()</script><script>var enableTruncate=!0,filterDepth=!1;const MAX_DEPTH=9;window.addEventListener("DOMContentLoaded",()=>{const e=new IntersectionObserver(e=>{e.reverse().forEach(e=>{const n=e.target.getAttribute("id");if(e.intersectionRatio>0){var t=document.querySelectorAll(`nav li a[href="#${n}"]`);t!=null&&t.forEach(e=>{if(e!=null){var t=getDepth(e.parentElement);filterDepth&&t<=MAX_DEPTH&&(clearActiveStatesInTableOfContents(),e.parentElement.classList.add("active"))}else filterDepth||(clearActiveStatesInTableOfContents(),e.parentElement.classList.add("active"))})}})});document.querySelectorAll("h1[id],h2[id],h3[id],h4[id]").forEach(t=>{e.observe(t)})});function isVisible(e){if(!(e instanceof Element))return!1;const n=getComputedStyle(e);if(n.display==="none")return!1;if(n.visibility!=="visible")return!1;if(n.opacity<.1)return!1;if(e.offsetWidth+e.offsetHeight+e.getBoundingClientRect().height+e.getBoundingClientRect().width===0)return!1;const t={x:e.getBoundingClientRect().left+e.offsetWidth/2,y:e.getBoundingClientRect().top+e.offsetHeight/2};if(t.x<0)return!1;if(t.x>(document.documentElement.clientWidth||window.innerWidth))return!1;if(t.y<0)return!1;if(t.y>(document.documentElement.clientHeight||window.innerHeight))return!1;let s=document.elementFromPoint(t.x,t.y);do if(s===e)return!0;while(s=s.parentNode)return!1}function clearActiveStatesInTableOfContents(){document.querySelectorAll("nav li").forEach(e=>{e.classList.remove("active")})}function getDepth(e){for(var t=0;e!==null&&e.tagName.toLowerCase()!=="ul";)t++,e=e.parentElement;return t}function navItems(){var e=document.querySelectorAll("nav nav li a");return Array.from(e).filter(e=>e.href!=null&&e.hash.startsWith("#"))}function lasItemInNavBarVisible(){var e=navItems().slice(-1)[0];return isVisible(e)}document.addEventListener("DOMContentLoaded",function(){if(!enableTruncate)return;var e=navItems();console.log(e),lasItemInNavBarVisible()||(filterDepth=!0,e.forEach(function(e){var t=getDepth(e.parentElement);t>MAX_DEPTH&&e.parentElement.classList.add("depth-nested")}))})</script></body></html>