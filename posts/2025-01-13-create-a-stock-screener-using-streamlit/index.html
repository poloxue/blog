<!doctype html><html><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><title>使用 Streamlit 打造一个股票筛选分析工具 - POLOXUE's BLOG</title><meta name=viewport content="width=device-width,initial-scale=1"><meta itemprop=name content="使用 Streamlit 打造一个股票筛选分析工具"><meta itemprop=description content="本文将通过 Python、Streamlit 和 Tushare，搭建一个简单易用的股票筛选器，它不仅可以筛选股票，还能查看详细数据并生成动态 K 线图，让你对股票市场有更全面的了解。"><meta itemprop=datePublished content="2025-01-13T16:20:35+08:00"><meta itemprop=dateModified content="2025-01-13T16:20:35+08:00"><meta itemprop=wordCount content="493"><meta property="og:url" content="https://www.poloxue.com/posts/2025-01-13-create-a-stock-screener-using-streamlit/"><meta property="og:site_name" content="POLOXUE's BLOG"><meta property="og:title" content="使用 Streamlit 打造一个股票筛选分析工具"><meta property="og:description" content="本文将通过 Python、Streamlit 和 Tushare，搭建一个简单易用的股票筛选器，它不仅可以筛选股票，还能查看详细数据并生成动态 K 线图，让你对股票市场有更全面的了解。"><meta property="og:locale" content="zh_cn"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-01-13T16:20:35+08:00"><meta property="article:modified_time" content="2025-01-13T16:20:35+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="使用 Streamlit 打造一个股票筛选分析工具"><meta name=twitter:description content="本文将通过 Python、Streamlit 和 Tushare，搭建一个简单易用的股票筛选器，它不仅可以筛选股票，还能查看详细数据并生成动态 K 线图，让你对股票市场有更全面的了解。"><script data-goatcounter=https://poloxue.goatcounter.com/count async src=//gc.zgo.at/count.js></script><link rel=stylesheet type=text/css media=screen href=https://www.poloxue.com/css/normalize.css><link rel=stylesheet type=text/css media=screen href=https://www.poloxue.com/css/main.css><link rel=stylesheet type=text/css media=screen href=https://www.poloxue.com/css/extra.css><link id=dark-scheme rel=stylesheet type=text/css href=https://www.poloxue.com/css/dark.css><script src=https://www.poloxue.com/js/feather.min.js></script><script src=https://www.poloxue.com/js/main.js></script><script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js></script><script>MathJax={tex:{displayMath:[["[","]"],["$$","$$"]],inlineMath:[["(",")"],["$","$"]]}}</script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7019080091542951" crossorigin=anonymous></script></head><body><div class="container-wide wrapper"><div class=header><div class=avatar><a href=https://www.poloxue.com/><img src=/avatar.png alt="POLOXUE's BLOG"></a></div><h1 class=site-title><a href=https://www.poloxue.com/>POLOXUE's BLOG</a></h1><div class=site-description><nav class="nav social"><ul class=flat><li><a href=https://github.com/poloxue/ title=Github><i data-feather=github></i></a></li><li><a href=/posts/index.xml title=RSS><i data-feather=rss></i></a></li><li><a href=/ title=Wechat><i data-feather=message-circle></i></a></li><span class=scheme-toggle><a href=# id=scheme-toggle></a></ul></nav></div><nav class=nav><ul class=flat><li><a href=/>文章列表</a></li><li><a href=/tags>分类标签</a></li><li><a href=/about/about>关于我</a></li></ul></nav></div><div class=article-nav id=article-nav-id><div class=post><div class=post-header><div class=meta><div class=date><span class=day>13</span>
<span class=rest>Jan 2025</span></div></div><div class=matter><h1 class=title>使用 Streamlit 打造一个股票筛选分析工具</h1></div></div><aside class="show-on-mobile toc" id=static-toc><header><h3>Contents</h3></header><nav id=TableOfContents><ol><li><a href=#概述><strong>概述</strong></a></li><li><a href=#准备开始>准备开始</a></li><li><a href=#股票数据><strong>股票数据</strong></a><ol><li><a href=#基础信息>基础信息</a></li><li><a href=#市值数据><strong>市值数据</strong></a></li></ol></li><li><a href=#界面和筛选条件><strong>界面和筛选条件</strong></a><ol><li><a href=#筛选实现>筛选实现</a></li><li><a href=#结果显示><strong>结果显示</strong></a></li></ol></li><li><a href=#单只股票详情><strong>单只股票详情</strong></a><ol><li><a href=#日线数据><strong>日线数据</strong></a></li><li><a href=#筛选界面>筛选界面</a></li><li><a href=#筛选逻辑>筛选逻辑</a></li><li><a href=#绘制-k-线图><strong>绘制 K 线图</strong></a></li><li><a href=#总结与扩展><strong>总结与扩展</strong></a></li></ol></li></ol></nav></aside><p><img src=https://cdn.jsdelivr.net/gh/poloxue/images@2025-01/2025-01-13-create-a-stock-screener-using-streamlit-00.png alt></p><p>本文将介绍如何通过 Python、Streamlit 和 Tushare，搭建一个简单易用的股票筛选器，它不仅可以筛选股票，还能查看某个股票的详细数据生成动态 K 线图，让你对股票市场有更全面的了解。</p><h2 id=概述><strong>概述</strong></h2><p>这个股票筛选器提供将提供几个筛选能力，包括市值范围、行业、地域条件。还支持股票的 K 线图，帮助用户直观分析价格走势。</p><p>效果如下：</p><p><img src=https://cdn.jsdelivr.net/gh/poloxue/images@2025-01/2025-01-13-create-a-stock-screener-using-streamlit-01.gif alt></p><p>这个小工具的实现离不开一个关键的 Python 开源库 - <strong>Streamlit</strong>。它可以快速构建交互式 Web 应用，只需几行代码，即可分享你的数据。对 streamlit 有兴趣可以深入了解下，这里不展开介绍。</p><p>如果不想看下面的详细步骤可直接从 <a href=https://gist.github.com/poloxue/b45324e478d97110e8f9969225e33e1a>github gist</a> 拿到代码，完成第一部分的准备即可运行。</p><p>想进一步扩展的话，还可以添加更多筛选指标，此外还可为单只股票增加技术指标（如均线、RSI）分析、多股票价格走势对比、实时数据更新、模拟投资组合功能甚至是按筛选分析结果生成股票分析报告等功能。</p><hr><p>接下来，讲解代码的每一步实现过程。</p><h2 id=准备开始>准备开始</h2><p>安装要用到 python 库：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pip install tushare ploty streamlit
</span></span></code></pre></td></tr></table></div></div><p>并提前导入依赖包：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> streamlit <span style=color:#66d9ef>as</span> st
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> tushare <span style=color:#66d9ef>as</span> ts
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> pandas <span style=color:#66d9ef>as</span> pd
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> plotly.graph_objects <span style=color:#66d9ef>as</span> go
</span></span></code></pre></td></tr></table></div></div><p>通过 <code>pro = ts.pro\_api()</code> 配置了 Tushare 接口，为数据获取做好准备。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>ts<span style=color:#f92672>.</span>set_token(<span style=color:#e6db74>&#34;Your API Token&#34;</span>)
</span></span><span style=display:flex><span>pro <span style=color:#f92672>=</span> ts<span style=color:#f92672>.</span>pro_api()
</span></span></code></pre></td></tr></table></div></div><p>注：tushare pro 依赖于 API Key，如果没有的话，到 tushare pro 平台注册获取。</p><hr><h2 id=股票数据><strong>股票数据</strong></h2><p>为了完成股票数据的筛选，要用到 tushare 的两个，分别是 <code>stock_basic</code> 股票基础数据和 <code>stock_daily</code> 每日最新指标，这里有要用到的市值数据。</p><h3 id=基础信息>基础信息</h3><p>首先，获取所有上市股票的基本信息，包括股票代码、名称、行业、地域和上市日期。如果某些行业或地域数据缺失，用 &ldquo;Unknown&rdquo; 填补空值。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#a6e22e>@st.cache_data</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_stock_list</span>():
</span></span><span style=display:flex><span>    df <span style=color:#f92672>=</span> pro<span style=color:#f92672>.</span>stock_basic(
</span></span><span style=display:flex><span>        exchange<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span>,
</span></span><span style=display:flex><span>        list_status<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;L&#34;</span>,
</span></span><span style=display:flex><span>        fields<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;ts_code,symbol,name,area,industry,list_date&#34;</span>,
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>    df[<span style=color:#e6db74>&#34;area&#34;</span>] <span style=color:#f92672>=</span> df[<span style=color:#e6db74>&#34;area&#34;</span>]<span style=color:#f92672>.</span>fillna(<span style=color:#e6db74>&#34;Unknown&#34;</span>)
</span></span><span style=display:flex><span>    df[<span style=color:#e6db74>&#34;industry&#34;</span>] <span style=color:#f92672>=</span> df[<span style=color:#e6db74>&#34;industry&#34;</span>]<span style=color:#f92672>.</span>fillna(<span style=color:#e6db74>&#34;Unknown&#34;</span>)
</span></span></code></pre></td></tr></table></div></div><p>为了提高性能和减少重复计算，这里用了 <code>@st.cache_data</code>  装饰器缓存数据结果，股票的基础数据是不怎么变化的，这样可避免每次交互重复加载数据。</p><h3 id=市值数据><strong>市值数据</strong></h3><p>为了筛选高市值股票，调用每日基础数据接口，获取市值数据，并将其与基本信息合并。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>market_cap_data <span style=color:#f92672>=</span> pro<span style=color:#f92672>.</span>daily_basic()
</span></span><span style=display:flex><span>market_cap_data[<span style=color:#e6db74>&#34;total_mv&#34;</span>] <span style=color:#f92672>=</span> market_cap_data[<span style=color:#e6db74>&#34;total_mv&#34;</span>] <span style=color:#f92672>/</span> <span style=color:#ae81ff>10000</span>  <span style=color:#75715e># 转换为&#34;亿&#34;</span>
</span></span><span style=display:flex><span>df <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>merge(df, market_cap_data, on<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;ts_code&#34;</span>, how<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;left&#34;</span>)
</span></span><span style=display:flex><span>df <span style=color:#f92672>=</span> df<span style=color:#f92672>.</span>rename(columns<span style=color:#f92672>=</span>{<span style=color:#e6db74>&#34;total_mv&#34;</span>: <span style=color:#e6db74>&#34;market_cap&#34;</span>})
</span></span></code></pre></td></tr></table></div></div><p>到这里，我们生成了一份包含公司基本信息和市值的完整股票列表，为后续筛选做好准备。</p><hr><h2 id=界面和筛选条件><strong>界面和筛选条件</strong></h2><p>接下来，创建用户界面和筛选项。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>st.title(&#34;Stock Screener&#34;)
</span></span><span style=display:flex><span>st.sidebar.header(&#34;Filter Options&#34;)
</span></span></code></pre></td></tr></table></div></div><p>侧边栏设置以下筛选条件：</p><ul><li><strong>市值范围</strong>：设置筛选股票的最小和最大市值。</li><li><strong>行业和地域</strong>：按行业或地域选择股票。</li><li><strong>上市日期范围</strong>：筛选符合时间条件的公司。</li></ul><h3 id=筛选实现>筛选实现</h3><p>以下代码实现了这些过滤功能：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># 股票的基本信息</span>
</span></span><span style=display:flex><span>stocks <span style=color:#f92672>=</span> get_stock_list()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 筛选市值范围</span>
</span></span><span style=display:flex><span>min_market_cap <span style=color:#f92672>=</span> st<span style=color:#f92672>.</span>sidebar<span style=color:#f92672>.</span>number_input(<span style=color:#e6db74>&#34;Minimum Market Cap (亿)&#34;</span>, min_value<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>, value<span style=color:#f92672>=</span><span style=color:#ae81ff>100</span>)
</span></span><span style=display:flex><span>max_market_cap <span style=color:#f92672>=</span> st<span style=color:#f92672>.</span>sidebar<span style=color:#f92672>.</span>number_input(<span style=color:#e6db74>&#34;Maximum Market Cap (亿)&#34;</span>, min_value<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>, value<span style=color:#f92672>=</span><span style=color:#ae81ff>1000</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 筛选行业和地域</span>
</span></span><span style=display:flex><span>industry_list <span style=color:#f92672>=</span> stocks[<span style=color:#e6db74>&#34;industry&#34;</span>]<span style=color:#f92672>.</span>unique()<span style=color:#f92672>.</span>tolist()
</span></span><span style=display:flex><span>selected_industry <span style=color:#f92672>=</span> st<span style=color:#f92672>.</span>sidebar<span style=color:#f92672>.</span>multiselect(<span style=color:#e6db74>&#34;Select Industry&#34;</span>, industry_list)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>area_list <span style=color:#f92672>=</span> stocks[<span style=color:#e6db74>&#34;area&#34;</span>]<span style=color:#f92672>.</span>unique()<span style=color:#f92672>.</span>tolist()
</span></span><span style=display:flex><span>selected_area <span style=color:#f92672>=</span> st<span style=color:#f92672>.</span>sidebar<span style=color:#f92672>.</span>multiselect(<span style=color:#e6db74>&#34;Select Area&#34;</span>, area_list)
</span></span></code></pre></td></tr></table></div></div><p>根据这些条件，我们过滤股票数据：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>filtered_stocks <span style=color:#f92672>=</span> stocks<span style=color:#f92672>.</span>copy()
</span></span><span style=display:flex><span>filtered_stocks <span style=color:#f92672>=</span> filtered_stocks[
</span></span><span style=display:flex><span>    (filtered_stocks[<span style=color:#e6db74>&#34;market_cap&#34;</span>] <span style=color:#f92672>&gt;=</span> min_market_cap) <span style=color:#f92672>&amp;</span>
</span></span><span style=display:flex><span>    (filtered_stocks[<span style=color:#e6db74>&#34;market_cap&#34;</span>] <span style=color:#f92672>&lt;=</span> max_market_cap)
</span></span><span style=display:flex><span>]
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> selected_industry:
</span></span><span style=display:flex><span>    filtered_stocks <span style=color:#f92672>=</span> filtered_stocks[filtered_stocks[<span style=color:#e6db74>&#34;industry&#34;</span>]<span style=color:#f92672>.</span>isin(selected_industry)]
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> selected_area:
</span></span><span style=display:flex><span>    filtered_stocks <span style=color:#f92672>=</span> filtered_stocks[filtered_stocks[<span style=color:#e6db74>&#34;area&#34;</span>]<span style=color:#f92672>.</span>isin(selected_area)]
</span></span></code></pre></td></tr></table></div></div><p>这样可以看到符合条件的股票列表。</p><hr><h3 id=结果显示><strong>结果显示</strong></h3><p>我们继续通过 <code>streamlit</code> 的表格形式展示筛选后的股票列表，按照市值大小排序。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>display_df <span style=color:#f92672>=</span> filtered_stocks<span style=color:#f92672>.</span>copy()
</span></span><span style=display:flex><span>display_df[<span style=color:#e6db74>&#34;market_cap&#34;</span>] <span style=color:#f92672>=</span> display_df[<span style=color:#e6db74>&#34;market_cap&#34;</span>]<span style=color:#f92672>.</span>round(<span style=color:#ae81ff>2</span>)
</span></span><span style=display:flex><span>display_df <span style=color:#f92672>=</span> display_df<span style=color:#f92672>.</span>sort_values(by<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;market_cap&#34;</span>, ascending<span style=color:#f92672>=</span><span style=color:#66d9ef>False</span>)
</span></span><span style=display:flex><span>st<span style=color:#f92672>.</span>dataframe(display_df)
</span></span></code></pre></td></tr></table></div></div><p>这样就可以清晰地看到结果，并快速找到目标股票。</p><hr><h2 id=单只股票详情><strong>单只股票详情</strong></h2><p>有了筛选的股票列表后，还可以继续扩展，查看单只股票的情况，如蜡烛图、价格表格。</p><h3 id=日线数据><strong>日线数据</strong></h3><p>先通过 Tushare 接口获取用户选择的股票的日线数据，并根据日期范围过滤。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#a6e22e>@st.cache_data</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_daily_data</span>(ts_code):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> pro<span style=color:#f92672>.</span>daily(ts_code<span style=color:#f92672>=</span>ts_code)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>daily_data <span style=color:#f92672>=</span> get_daily_data(stock_code)
</span></span><span style=display:flex><span>daily_data[<span style=color:#e6db74>&#34;trade_date&#34;</span>] <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>to_datetime(daily_data[<span style=color:#e6db74>&#34;trade_date&#34;</span>])
</span></span><span style=display:flex><span>daily_data <span style=color:#f92672>=</span> daily_data<span style=color:#f92672>.</span>sort_values(<span style=color:#e6db74>&#34;trade_date&#34;</span>, ascending<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>)
</span></span></code></pre></td></tr></table></div></div><h3 id=筛选界面>筛选界面</h3><p>配置筛选条件，包括股票选择框和日期范围。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># Show details for selected stock</span>
</span></span><span style=display:flex><span>selected_stock <span style=color:#f92672>=</span> st<span style=color:#f92672>.</span>selectbox(<span style=color:#e6db74>&#34;Select a stock to view details&#34;</span>, filtered_stocks[<span style=color:#e6db74>&#34;name&#34;</span>])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>today <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>Timestamp<span style=color:#f92672>.</span>today()
</span></span><span style=display:flex><span>col1, col2 <span style=color:#f92672>=</span> st<span style=color:#f92672>.</span>columns(<span style=color:#ae81ff>2</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>with</span> col1:
</span></span><span style=display:flex><span>    start_date <span style=color:#f92672>=</span> st<span style=color:#f92672>.</span>date_input(
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;Start date&#34;</span>, value<span style=color:#f92672>=</span>today <span style=color:#f92672>-</span> pd<span style=color:#f92672>.</span>Timedelta(days<span style=color:#f92672>=</span><span style=color:#ae81ff>365</span>), max_value<span style=color:#f92672>=</span>today
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span><span style=color:#66d9ef>with</span> col2:
</span></span><span style=display:flex><span>    end_date <span style=color:#f92672>=</span> st<span style=color:#f92672>.</span>date_input(
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;End date&#34;</span>, value<span style=color:#f92672>=</span>today, min_value<span style=color:#f92672>=</span>start_date, max_value<span style=color:#f92672>=</span>today
</span></span><span style=display:flex><span>    )
</span></span></code></pre></td></tr></table></div></div><h3 id=筛选逻辑>筛选逻辑</h3><p>如果设置了 <code>selected_stock</code> 进入到筛选逻辑中。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>if</span> selected_stock:
</span></span><span style=display:flex><span>    stock_code <span style=color:#f92672>=</span> filtered_stocks[filtered_stocks[<span style=color:#e6db74>&#34;name&#34;</span>] <span style=color:#f92672>==</span> selected_stock][
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;ts_code&#34;</span>
</span></span><span style=display:flex><span>    ]<span style=color:#f92672>.</span>values[<span style=color:#ae81ff>0</span>]
</span></span><span style=display:flex><span>    daily_data <span style=color:#f92672>=</span> get_daily_data(stock_code)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    daily_data[<span style=color:#e6db74>&#34;trade_date&#34;</span>] <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>to_datetime(daily_data[<span style=color:#e6db74>&#34;trade_date&#34;</span>])
</span></span><span style=display:flex><span>    daily_data <span style=color:#f92672>=</span> daily_data<span style=color:#f92672>.</span>sort_values(<span style=color:#e6db74>&#34;trade_date&#34;</span>, ascending<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># 按时间过滤</span>
</span></span><span style=display:flex><span>    daily_data <span style=color:#f92672>=</span> daily_data[
</span></span><span style=display:flex><span>        (daily_data[<span style=color:#e6db74>&#34;trade_date&#34;</span>] <span style=color:#f92672>&gt;=</span> pd<span style=color:#f92672>.</span>Timestamp(start_date))
</span></span><span style=display:flex><span>        <span style=color:#f92672>&amp;</span> (daily_data[<span style=color:#e6db74>&#34;trade_date&#34;</span>] <span style=color:#f92672>&lt;=</span> pd<span style=color:#f92672>.</span>Timestamp(end_date))
</span></span><span style=display:flex><span>    ]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># 检查缺失数据</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> daily_data[[<span style=color:#e6db74>&#34;open&#34;</span>, <span style=color:#e6db74>&#34;high&#34;</span>, <span style=color:#e6db74>&#34;low&#34;</span>, <span style=color:#e6db74>&#34;close&#34;</span>]]<span style=color:#f92672>.</span>isnull()<span style=color:#f92672>.</span>values<span style=color:#f92672>.</span>any():
</span></span><span style=display:flex><span>        st<span style=color:#f92672>.</span>warning(<span style=color:#e6db74>&#34;Some price data is missing - filling with previous values&#34;</span>)
</span></span><span style=display:flex><span>        daily_data[[<span style=color:#e6db74>&#34;open&#34;</span>, <span style=color:#e6db74>&#34;high&#34;</span>, <span style=color:#e6db74>&#34;low&#34;</span>, <span style=color:#e6db74>&#34;close&#34;</span>]] <span style=color:#f92672>=</span> daily_data[
</span></span><span style=display:flex><span>            [<span style=color:#e6db74>&#34;open&#34;</span>, <span style=color:#e6db74>&#34;high&#34;</span>, <span style=color:#e6db74>&#34;low&#34;</span>, <span style=color:#e6db74>&#34;close&#34;</span>]
</span></span><span style=display:flex><span>        ]<span style=color:#f92672>.</span>ffill()
</span></span></code></pre></td></tr></table></div></div><h3 id=绘制-k-线图><strong>绘制 K 线图</strong></h3><p>使用 Plotly 绘制动态 K 线图，让用户更直观地观察股票的价格变化。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>fig <span style=color:#f92672>=</span> go<span style=color:#f92672>.</span>Figure(
</span></span><span style=display:flex><span>    data<span style=color:#f92672>=</span>[
</span></span><span style=display:flex><span>        go<span style=color:#f92672>.</span>Candlestick(
</span></span><span style=display:flex><span>            x<span style=color:#f92672>=</span>daily_data[<span style=color:#e6db74>&#34;trade_date&#34;</span>],
</span></span><span style=display:flex><span>            open<span style=color:#f92672>=</span>daily_data[<span style=color:#e6db74>&#34;open&#34;</span>],
</span></span><span style=display:flex><span>            high<span style=color:#f92672>=</span>daily_data[<span style=color:#e6db74>&#34;high&#34;</span>],
</span></span><span style=display:flex><span>            low<span style=color:#f92672>=</span>daily_data[<span style=color:#e6db74>&#34;low&#34;</span>],
</span></span><span style=display:flex><span>            close<span style=color:#f92672>=</span>daily_data[<span style=color:#e6db74>&#34;close&#34;</span>],
</span></span><span style=display:flex><span>            increasing_line_color<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;green&#34;</span>,
</span></span><span style=display:flex><span>            decreasing_line_color<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;red&#34;</span>,
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>    ]
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>fig<span style=color:#f92672>.</span>update_layout(title<span style=color:#f92672>=</span><span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{</span>selected_stock<span style=color:#e6db74>}</span><span style=color:#e6db74> Candlestick Chart&#34;</span>, xaxis_title<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Date&#34;</span>, yaxis_title<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Price&#34;</span>)
</span></span><span style=display:flex><span>st<span style=color:#f92672>.</span>plotly_chart(fig, use_container_width<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>)
</span></span></code></pre></td></tr></table></div></div><hr><h3 id=总结与扩展><strong>总结与扩展</strong></h3><p>通过以上步骤简单构建了一个股票筛选分析工具，它支持按市值、行业、地域和上市日期筛选股票，可视化 K 线图。</p><p>希望本文对你有用，开始构建属于你的股票分析工具吧！</p><div>本文来源于 <a href=https://www.poloxue.com>POLOXUE's BLOG</a>，地址： <a href=https://www.poloxue.com/posts/2025-01-13-create-a-stock-screener-using-streamlit/>使用 Streamlit 打造一个股票筛选分析工具</a></div></div><nav class="hide-on-mobile section-nav"><nav id=TableOfContents><ol><li><a href=#概述><strong>概述</strong></a></li><li><a href=#准备开始>准备开始</a></li><li><a href=#股票数据><strong>股票数据</strong></a><ol><li><a href=#基础信息>基础信息</a></li><li><a href=#市值数据><strong>市值数据</strong></a></li></ol></li><li><a href=#界面和筛选条件><strong>界面和筛选条件</strong></a><ol><li><a href=#筛选实现>筛选实现</a></li><li><a href=#结果显示><strong>结果显示</strong></a></li></ol></li><li><a href=#单只股票详情><strong>单只股票详情</strong></a><ol><li><a href=#日线数据><strong>日线数据</strong></a></li><li><a href=#筛选界面>筛选界面</a></li><li><a href=#筛选逻辑>筛选逻辑</a></li><li><a href=#绘制-k-线图><strong>绘制 K 线图</strong></a></li><li><a href=#总结与扩展><strong>总结与扩展</strong></a></li></ol></li></ol></nav></nav></div><div class=post><hr class=footer-separator><div class=tags></div><div class=back><a href=https://www.poloxue.com/><span aria-hidden=true>← Back</span></a></div><div class=back></div></div><div class=post><img style=width:85% src=https://cdn.jsdelivr.net/gh/poloxue/images@main/wechat.png><div class=utterances></div><script src=https://utteranc.es/client.js repo=poloxue/blog issue-term=pathname theme=github-light crossorigin=anonymous async></script></div></div><div class="footer wrapper"><nav class=nav><div>2025 Polo Xue All rights reserved</div></nav></div><script>feather.replace()</script><script>var enableTruncate=!0,filterDepth=!1;const MAX_DEPTH=9;window.addEventListener("DOMContentLoaded",()=>{const e=new IntersectionObserver(e=>{e.reverse().forEach(e=>{const n=e.target.getAttribute("id");if(e.intersectionRatio>0){var t=document.querySelectorAll(`nav li a[href="#${n}"]`);t!=null&&t.forEach(e=>{if(e!=null){var t=getDepth(e.parentElement);filterDepth&&t<=MAX_DEPTH&&(clearActiveStatesInTableOfContents(),e.parentElement.classList.add("active"))}else filterDepth||(clearActiveStatesInTableOfContents(),e.parentElement.classList.add("active"))})}})});document.querySelectorAll("h1[id],h2[id],h3[id],h4[id]").forEach(t=>{e.observe(t)})});function isVisible(e){if(!(e instanceof Element))return!1;const n=getComputedStyle(e);if(n.display==="none")return!1;if(n.visibility!=="visible")return!1;if(n.opacity<.1)return!1;if(e.offsetWidth+e.offsetHeight+e.getBoundingClientRect().height+e.getBoundingClientRect().width===0)return!1;const t={x:e.getBoundingClientRect().left+e.offsetWidth/2,y:e.getBoundingClientRect().top+e.offsetHeight/2};if(t.x<0)return!1;if(t.x>(document.documentElement.clientWidth||window.innerWidth))return!1;if(t.y<0)return!1;if(t.y>(document.documentElement.clientHeight||window.innerHeight))return!1;let s=document.elementFromPoint(t.x,t.y);do if(s===e)return!0;while(s=s.parentNode)return!1}function clearActiveStatesInTableOfContents(){document.querySelectorAll("nav li").forEach(e=>{e.classList.remove("active")})}function getDepth(e){for(var t=0;e!==null&&e.tagName.toLowerCase()!=="ul";)t++,e=e.parentElement;return t}function navItems(){var e=document.querySelectorAll("nav nav li a");return Array.from(e).filter(e=>e.href!=null&&e.hash.startsWith("#"))}function lasItemInNavBarVisible(){var e=navItems().slice(-1)[0];return isVisible(e)}document.addEventListener("DOMContentLoaded",function(){if(!enableTruncate)return;var e=navItems();console.log(e),lasItemInNavBarVisible()||(filterDepth=!0,e.forEach(function(e){var t=getDepth(e.parentElement);t>MAX_DEPTH&&e.parentElement.classList.add("depth-nested")}))})</script></body></html>