<!doctype html><html><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><title>Go 中如何打印结构体？代码调试效率提升 - 菠萝学量化</title><meta name=viewport content="width=device-width,initial-scale=1"><meta itemprop=name content="Go 中如何打印结构体？代码调试效率提升"><meta itemprop=description content="不知道大家是否遇到打印结构体的需求呢？结构体就像是一个小盒子，里面可以放很多不同类型的东西，如数字、字符串、slice、map 或其他结构体。但，如果我们想看看盒子里都放了什么，该怎么办呢？"><meta itemprop=datePublished content="2024-02-01T08:00:00+08:00"><meta itemprop=dateModified content="2024-02-01T08:00:00+08:00"><meta itemprop=wordCount content="945"><meta property="og:url" content="https://www.poloxue.com/posts/2024-02-01-print-struct-in-golang/"><meta property="og:site_name" content="菠萝学量化"><meta property="og:title" content="Go 中如何打印结构体？代码调试效率提升"><meta property="og:description" content="不知道大家是否遇到打印结构体的需求呢？结构体就像是一个小盒子，里面可以放很多不同类型的东西，如数字、字符串、slice、map 或其他结构体。但，如果我们想看看盒子里都放了什么，该怎么办呢？"><meta property="og:locale" content="zh_cn"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-02-01T08:00:00+08:00"><meta property="article:modified_time" content="2024-02-01T08:00:00+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Go 中如何打印结构体？代码调试效率提升"><meta name=twitter:description content="不知道大家是否遇到打印结构体的需求呢？结构体就像是一个小盒子，里面可以放很多不同类型的东西，如数字、字符串、slice、map 或其他结构体。但，如果我们想看看盒子里都放了什么，该怎么办呢？"><script data-goatcounter=https://poloxue.goatcounter.com/count async src=//gc.zgo.at/count.js></script><link rel=stylesheet type=text/css media=screen href=https://www.poloxue.com/css/normalize.css><link rel=stylesheet type=text/css media=screen href=https://www.poloxue.com/css/main.css><link rel=stylesheet type=text/css media=screen href=https://www.poloxue.com/css/extra.css><link id=dark-scheme rel=stylesheet type=text/css href=https://www.poloxue.com/css/dark.css><script src=https://www.poloxue.com/js/feather.min.js></script><script src=https://www.poloxue.com/js/main.js></script><script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js></script><script>MathJax={tex:{displayMath:[["[","]"],["$$","$$"]],inlineMath:[["(",")"],["$","$"]]}}</script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7019080091542951" crossorigin=anonymous></script></head><body><div class="container-wide wrapper"><div class=header><div class=avatar><a href=https://www.poloxue.com/><img src=/avatar.png alt=菠萝学量化></a></div><h1 class=site-title><a href=https://www.poloxue.com/>菠萝学量化</a></h1><div class=site-description><nav class="nav social"><ul class=flat><li><a href=https://github.com/poloxue/ title=Github><i data-feather=github></i></a></li><li><a href=/posts/index.xml title=RSS><i data-feather=rss></i></a></li><li><a href=/ title=Wechat><i data-feather=message-circle></i></a></li><span class=scheme-toggle><a href=# id=scheme-toggle></a></ul></nav></div><nav class=nav><ul class=flat><li><a href=/>文章列表</a></li><li><a href=/tags>分类标签</a></li><li><a href=/about/about>关于我</a></li></ul></nav></div><div class=article-nav id=article-nav-id><div class=post><div class=post-header><div class=meta><div class=date><span class=day>01</span>
<span class=rest>Feb 2024</span></div></div><div class=matter><h1 class=title>Go 中如何打印结构体？代码调试效率提升</h1></div></div><aside class="show-on-mobile toc" id=static-toc><header><h3>Contents</h3></header><nav id=TableOfContents><ol><li><a href=#定义结构体>定义结构体</a></li><li><a href=#使用-fmtprintf>使用 <code>fmt.Printf</code></a></li><li><a href=#实现-string-方法>实现 <code>String</code> 方法</a></li><li><a href=#jsonmarshalindent><code>json.MarshalIndent</code></a></li><li><a href=#reflect-包打印复杂结构><code>reflect</code> 包打印复杂结构</a></li><li><a href=#性能压测>性能压测</a></li><li><a href=#三方库>三方库</a><ol><li><a href=#go-spew><code>go-spew</code></a></li><li><a href=#pretty>pretty</a></li></ol></li><li><a href=#结语>结语</a></li></ol></nav></aside><p><img src=https://cdn.jsdelivr.net/gh/poloxue/images@2024-02/2024-02-01-print-struct-in-golang-01.png alt></p><blockquote><p>嗨，大家好！本文是系列文章 Go 技巧第十一篇，系列文章查看：<a href="https://mp.weixin.qq.com/mp/appmsgalbum?action=getalbum&amp;album_id=3291066778475053060">Go 语言技巧</a>。</p></blockquote><p>不知道大家是否遇到打印结构体的需求？</p><p>结构体的特点是，它有点像是一个盒子，但不用于 slice 与 map，它里面可以放很多不同类型的东西，如数字、字符串、slice、map 或者其他结构体。</p><p><img src=https://cdn.jsdelivr.net/gh/poloxue/images@2024-02/2024-02-01-print-struct-in-golang-02.png alt></p><p>但，如果我们想看看盒子中内容，该怎么办呢？这时我们就要能打印结构体了。</p><p>打印结构体的能力其实挺重要的，它能帮我们检查理解代码，提高调试效率，确保代码运行正确。</p><p>本文让我们以此为话题，聊聊 GO 语言中如何打印结构体。本文中描述的方法基本也适用于如指针、切片、映射等深层次结构的打印。</p><p>让我们直接开始吧！</p><h2 id=定义结构体>定义结构体</h2><p>首先，我们来定义一个结构体，它会被接下来所有的方法用到。</p><p>代码如下所示：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Author</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Name</span> <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Age</span>  <span style=color:#66d9ef>int8</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Sex</span>  <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Article</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>ID</span>      <span style=color:#66d9ef>int64</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Title</span>   <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Author</span>  <span style=color:#f92672>*</span><span style=color:#a6e22e>Author</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Content</span> <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>我们定义了一个 <code>Article</code> 结构体用于表示一篇文章，内部包含内部实现了 <code>ID</code>、<code>Title</code> 和 <code>Content</code> 基础属性，还有一个字段是 <code>Author</code> 结构体指针，用于保存作者信息。</p><p>我将先介绍四种基本的方式。</p><p><img src=https://cdn.jsdelivr.net/gh/poloxue/images@2024-02/2024-02-01-print-struct-in-golang-03.png alt></p><h2 id=使用-fmtprintf>使用 <code>fmt.Printf</code></h2><p>最简单的方法是使用 <code>fmt.Printf</code> 函数，如果希望显示一些详情，可和 <code>%+v</code> 格式化符号配合。这样可以直接打印出结构体的字段名和值。</p><p>我们可以这样打印它，代码如下：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>article</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>Article</span>{
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>ID</span>:      <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>Title</span>:   <span style=color:#e6db74>&#34;How to Print a Structure in Golang&#34;</span>,
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>Author</span>:  <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>Author</span>{<span style=color:#e6db74>&#34;poloxue&#34;</span>, <span style=color:#ae81ff>18</span>, <span style=color:#e6db74>&#34;male&#34;</span>},
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>Content</span>: <span style=color:#e6db74>&#34;This is a blog post&#34;</span>,
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;%+v\n&#34;</span>, <span style=color:#a6e22e>article</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>输出：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>{</span>ID:1 Title:How to Print a Structure in Golang Author:0xc0000900c0 Content:This is a blog post<span style=color:#f92672>}</span>
</span></span></code></pre></td></tr></table></div></div><p>如上所示，这段代码会打印出 <code>article</code> 结构体的所有字段值。不过，如果仔细观察，会发现它的 <code>Author</code> 字段只打印了指针地址 - <code>Author:0xc0000900c0 </code>，没有输出它的内容。</p><p>这其实是符合预期的。<code>*Author</code> 是指针类型，它的值自然就是地址。</p><p>如果我就想打印 <code>Author</code> 字段的内容，可通过用 <code>fmt.Printf</code> 打印指针实际指向内容。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Print</span>(<span style=color:#e6db74>&#34;%+v\n&#34;</span>, <span style=color:#a6e22e>article</span>.<span style=color:#a6e22e>Author</span>)
</span></span></code></pre></td></tr></table></div></div><p>输出：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>&amp;<span style=color:#f92672>{</span>Name:poloxue Age:18 Sex:male<span style=color:#f92672>}</span>
</span></span></code></pre></td></tr></table></div></div><p>我在测试的时候，发现个有趣的现象：</p><p>如果打印的是结构体指针，它会自动解引用，即能把内容打印出来。如上的代码所示，无论是</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;%+v\n&#34;</span>, <span style=color:#a6e22e>article</span>.<span style=color:#a6e22e>Author</span>)
</span></span></code></pre></td></tr></table></div></div><p>还是</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;%\n&#34;</span>, <span style=color:#f92672>*</span><span style=color:#a6e22e>article</span>.<span style=color:#a6e22e>Author</span>)
</span></span></code></pre></td></tr></table></div></div><p>都能打印出结构体的内容。</p><p>但如果打印的结构体，包含结构体指针字段，则不会将内容打印出来，而只会打印地址，即指针值。</p><p>我猜测，如此设计的原因是为了防止深层递归，或者循环引用。</p><p><img src=https://cdn.jsdelivr.net/gh/poloxue/images@2024-02/2024-02-01-print-struct-in-golang-04.png alt></p><p>想明白的话，似乎是个显而易见的事情。</p><h2 id=实现-string-方法>实现 <code>String</code> 方法</h2><p>除了以上将 <code>Author</code> 字段单独拿出打印，我们还有其他方法实现吗？当然有，这就是本节要说的 - 实现 <code>String</code> 方法。</p><p>这其实是 Go 提供的一种机制，一个类型如果满足 <code>Stringer</code> 接口，即实现了 <code>String</code> 方法，打印时返回的就是 <code>String</code> 方法的返回内容。</p><p><code>Stringer</code> 定义如下：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Stringer</span> <span style=color:#66d9ef>interface</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>String</span>() <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>当我们使用 <code>fmt.Printf</code> 打印结构体时，就会调用定义的 <code>String</code> 方法，控制结构体的输出格式。例如：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>a</span> <span style=color:#a6e22e>Article</span>) <span style=color:#a6e22e>String</span>() <span style=color:#66d9ef>string</span> {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Sprintf</span>(<span style=color:#e6db74>&#34;Title: %s, Author: %s, Content: %s&#34;</span>, <span style=color:#a6e22e>a</span>.<span style=color:#a6e22e>Title</span>, <span style=color:#a6e22e>a</span>.<span style=color:#a6e22e>Author</span>.<span style=color:#a6e22e>Name</span>, <span style=color:#a6e22e>a</span>.<span style=color:#a6e22e>Content</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>article</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>Article</span>{
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>ID</span>:      <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>Title</span>:   <span style=color:#e6db74>&#34;How to Print a Structure in Golang&#34;</span>,
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>Author</span>:  <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>Author</span>{<span style=color:#e6db74>&#34;poloxue&#34;</span>, <span style=color:#ae81ff>18</span>, <span style=color:#e6db74>&#34;male&#34;</span>},
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>Content</span>: <span style=color:#e6db74>&#34;This is a blog post&#34;</span>,
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#a6e22e>article</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>输出：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>Title: How to Print a Structure in Golang, Author: poloxue, Content: This is a blog post
</span></span></code></pre></td></tr></table></div></div><p>检查结果，的确是 <code>String</code> 方法中定义的形式。现在，我们可以随心所欲定义打印格式了。</p><p>这种方式还有一个特点，就是性能高。毕竟，它没有任何啰嗦，直接到拿到结果。</p><p><img src=https://cdn.jsdelivr.net/gh/poloxue/images@2024-02/2024-02-01-print-struct-in-golang-05.png alt></p><p>到这里，我们已经有能力打印结构体了。但这里也有些缺点。</p><p>首先，不够美观，输出结构易读性差。这不利于快速定位。</p><p>其次，每次都要自定义输出。如果只是为了 debug 调试代码，而不是功能代码，希望有更方便方式直接打印。</p><h2 id=jsonmarshalindent><code>json.MarshalIndent</code></h2><p>首先，如何美化输出呢？</p><p>如果你想要一个更美观的输出格式，可以使用 <code>json.MarshalIndent</code> 函数。这个函数会将结构体转换为 JSON 格式，且能控制缩进，使输出更易于阅读。</p><p>示例代码，如下所示：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;encoding/json&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>article</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>Article</span>{
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>ID</span>:      <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>Title</span>:   <span style=color:#e6db74>&#34;How to Print a Structure in Golang&#34;</span>,
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>Author</span>:  <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>Author</span>{<span style=color:#e6db74>&#34;poloxue&#34;</span>, <span style=color:#ae81ff>18</span>, <span style=color:#e6db74>&#34;male&#34;</span>},
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>Content</span>: <span style=color:#e6db74>&#34;This is a blog post&#34;</span>,
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>articleJSON</span>, <span style=color:#a6e22e>_</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>json</span>.<span style=color:#a6e22e>MarshalIndent</span>(<span style=color:#a6e22e>article</span>, <span style=color:#e6db74>&#34;&#34;</span>, <span style=color:#e6db74>&#34;    &#34;</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(string(<span style=color:#a6e22e>articleJSON</span>))
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>如上的代码中，<code>json.MarshalIndent</code> 的第三个参数表示缩进的大小。我们看下代码的输出吧。</p><p>输出：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;ID&#34;</span>: <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;Title&#34;</span>: <span style=color:#e6db74>&#34;How to Print a Structure in Golang&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;Author&#34;</span>: {
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;Name&#34;</span>: <span style=color:#e6db74>&#34;poloxue&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;Age&#34;</span>: <span style=color:#ae81ff>18</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;Sex&#34;</span>: <span style=color:#e6db74>&#34;male&#34;</span>
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;Content&#34;</span>: <span style=color:#e6db74>&#34;This is a blog post&#34;</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>以这样美观的 JSON 格式打印的 <code>Article</code> 结构体，明显易读了许多。</p><h2 id=reflect-包打印复杂结构><code>reflect</code> 包打印复杂结构</h2><p>如果想完全控制结构体打印，还可使用 <code>reflect</code> 包。它不仅仅是可以拿到 Go 变量的值，其他信息，如结构体的字段名和类型，都可轻而易举拿到。</p><p>这也是为什么可通过 <code>reflect</code> 包最大粒度控制输出格式。</p><p>示例代码，如下所示：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;reflect&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>article</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>Article</span>{
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>ID</span>:      <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>Title</span>:   <span style=color:#e6db74>&#34;How to Print a Structure in Golang&#34;</span>,
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>Author</span>:  <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>Author</span>{<span style=color:#e6db74>&#34;poloxue&#34;</span>, <span style=color:#ae81ff>18</span>, <span style=color:#e6db74>&#34;male&#34;</span>},
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>Content</span>: <span style=color:#e6db74>&#34;This is a blog post&#34;</span>,
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>val</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>reflect</span>.<span style=color:#a6e22e>ValueOf</span>(<span style=color:#a6e22e>article</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>for</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> &lt; <span style=color:#a6e22e>val</span>.<span style=color:#a6e22e>NumField</span>(); <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>field</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>val</span>.<span style=color:#a6e22e>Type</span>().<span style=color:#a6e22e>Field</span>(<span style=color:#a6e22e>i</span>)
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(
</span></span><span style=display:flex><span>			<span style=color:#e6db74>&#34;Type: %v, Field: %s, Value: %v\n&#34;</span>,
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>field</span>.<span style=color:#a6e22e>Type</span>,
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>field</span>.<span style=color:#a6e22e>Name</span>,
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>val</span>.<span style=color:#a6e22e>Field</span>(<span style=color:#a6e22e>i</span>),
</span></span><span style=display:flex><span>		)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>输出：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>Type: int64, Field: ID, Value: <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>Type: string, Field: Title, Value: How to Print a Structure in Golang
</span></span><span style=display:flex><span>Type: *main.Author, Field: Author, Value: &amp;<span style=color:#f92672>{</span>poloxue <span style=color:#ae81ff>18</span> male<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>Type: string, Field: Content, Value: This is a blog post
</span></span></code></pre></td></tr></table></div></div><p>我们输出了字段类型、名称和值。</p><p>当然，<code>reflect</code> 提供了灵活性，但具体的打印格式，我们就要自己按需求自行定义。前面介绍的 <code>Printf</code> 函数，内部实现本质上也依赖了 <code>reflect</code> 的实现。</p><p>如果想要深度打印信息，即使是指针类型字段，也可通过 <code>reflect</code> 继续深度打印。</p><p>代码类似于：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#a6e22e>field</span>.<span style=color:#a6e22e>Type</span>.<span style=color:#a6e22e>Kind</span>() <span style=color:#f92672>==</span> <span style=color:#a6e22e>reflect</span>.<span style=color:#a6e22e>Pointer</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#a6e22e>val</span>.<span style=color:#a6e22e>Field</span>(<span style=color:#a6e22e>i</span>).<span style=color:#a6e22e>Elem</span>())
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>即 <code>Elem()</code> 继续深入它的内部。</p><p>当然，如果你希望得到结构体类型相关信息，<code>reflect</code> 甚至可以在结构体没有实例化打印其类型的详情。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>printStructType</span>(<span style=color:#a6e22e>t</span> <span style=color:#a6e22e>reflect</span>.<span style=color:#a6e22e>Type</span>) {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>for</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> &lt; <span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>NumField</span>(); <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>field</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>Field</span>(<span style=color:#a6e22e>i</span>)
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;%s: %s\n&#34;</span>, <span style=color:#a6e22e>field</span>.<span style=color:#a6e22e>Name</span>, <span style=color:#a6e22e>field</span>.<span style=color:#a6e22e>Type</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>t</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>reflect</span>.<span style=color:#a6e22e>TypeOf</span>((<span style=color:#f92672>*</span><span style=color:#a6e22e>Article</span>)(<span style=color:#66d9ef>nil</span>)).<span style=color:#a6e22e>Elem</span>()
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>printStructType</span>(<span style=color:#a6e22e>t</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>核心就是那句 <code>(*Article)(nil)</code> 得到一个类型为 <code>*Article</code> 的 <code>nil</code>，避免了内存空间的占用。</p><h2 id=性能压测>性能压测</h2><p>我尝试了不同的打印方法后，也进行了一个简单的性能测试。</p><p><img src=https://cdn.jsdelivr.net/gh/poloxue/images@2024-02/2024-02-01-print-struct-in-golang-06.png alt></p><p>测试结果如下所示：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>BenchmarkFmtPrintf-16              2631248	    447.3 ns/op
</span></span><span style=display:flex><span>BenchmarkJSONMarshalIndent-16       997448	     <span style=color:#ae81ff>1016</span> ns/op
</span></span><span style=display:flex><span>BenchmarkCustomStringMethod-16     5135541	    225.5 ns/op
</span></span><span style=display:flex><span>BenchmarkReflection-16             2030233	    594.9 ns/op
</span></span></code></pre></td></tr></table></div></div><p>测试结果显示，使用自定义的 <code>String</code> 方法是最快的，而 <code>json.MarshalIndent</code> 则是最慢的。</p><p>这意味着如果你关心程序的运行速度，最好使用自定义的<code>String</code>方法来打印结构体。</p><p>这里单独提醒一点，因为 <code>fmt.Printf</code> 的内部是使用反射，所以要能测试出 <code>String()</code> 自定义的效果，内部实现就不要用 <code>fmt.Sprintf</code> 等方法格式化字符，而是推荐使用 <code>strconv</code> 中的一些函数。</p><p>示例代码：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>a</span> <span style=color:#a6e22e>Article</span>) <span style=color:#a6e22e>String</span>() <span style=color:#66d9ef>string</span> {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;{ID:&#34;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>strconv</span>.<span style=color:#a6e22e>Itoa</span>(int(<span style=color:#a6e22e>a</span>.<span style=color:#a6e22e>ID</span>)) <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;, Title:&#34;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>a</span>.<span style=color:#a6e22e>Title</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;,AuthorName:&#34;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>a</span>.<span style=color:#a6e22e>Author</span>.<span style=color:#a6e22e>Name</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;}&#34;</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>这样才能真正意义上测试出 <code>String</code> 自定义的优势。不要套娃，最终得到用了 <code>String</code> 等于没用的效果。</p><p>如果想知道为什么 <code>strconv</code> 更快，可阅读我之前的一篇文章：<a href=https://www.poloxue.com/posts/2024-01-20-int-to-string-in-golang/>GO 中高效 int 转换 string 的方法与源码剖析</a></p><h2 id=三方库>三方库</h2><p>前面介绍了 4 种打印结构内容的方案，。特别是第四种，提供了最大化的自由度。但缺点是要自定义，非常麻烦。</p><p>接下来，我尝试推荐一些好用的三方库，它们将我们常用的一些模式实践成库，便于我们使用。</p><h3 id=go-spew><code>go-spew</code></h3><p>我们首先来看看一个叫做 <code>go-spew</code> 的第三方库。</p><p>这个库提供了深度打印 Go 数据结构的功能，对于调试非常有用。它可以递归地打印出结构体的字段，即使是嵌套的结构体也能打印出来。</p><p>例如：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>import</span> <span style=color:#e6db74>&#34;github.com/davecgh/go-spew/spew&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>article</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>Article</span>{
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>ID</span>:      <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>Title</span>:   <span style=color:#e6db74>&#34;How to Print a Structure in Golang&#34;</span>,
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>Author</span>:  <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>Author</span>{<span style=color:#e6db74>&#34;poloxue&#34;</span>, <span style=color:#ae81ff>18</span>, <span style=color:#e6db74>&#34;male&#34;</span>},
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>Content</span>: <span style=color:#e6db74>&#34;This is a blog post&#34;</span>,
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>spew</span>.<span style=color:#a6e22e>Dump</span>(<span style=color:#a6e22e>article</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>这样会详细地打印出 <code>article</code> 结构体的所有内容。</p><p>输出如下：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>(</span>main.Article<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span> ID: <span style=color:#f92672>(</span>int64<span style=color:#f92672>)</span> 1,
</span></span><span style=display:flex><span> Title: <span style=color:#f92672>(</span>string<span style=color:#f92672>)</span> <span style=color:#f92672>(</span>len<span style=color:#f92672>=</span>34<span style=color:#f92672>)</span> <span style=color:#e6db74>&#34;How to Print a Structure in Golang&#34;</span>,
</span></span><span style=display:flex><span> Author: <span style=color:#f92672>(</span>*main.Author<span style=color:#f92672>)(</span>0xc000100330<span style=color:#f92672>)({</span>
</span></span><span style=display:flex><span>  Name: <span style=color:#f92672>(</span>string<span style=color:#f92672>)</span> <span style=color:#f92672>(</span>len<span style=color:#f92672>=</span>7<span style=color:#f92672>)</span> <span style=color:#e6db74>&#34;poloxue&#34;</span>,
</span></span><span style=display:flex><span>  Age: <span style=color:#f92672>(</span>int8<span style=color:#f92672>)</span> 18,
</span></span><span style=display:flex><span>  Sex: <span style=color:#f92672>(</span>string<span style=color:#f92672>)</span> <span style=color:#f92672>(</span>len<span style=color:#f92672>=</span>4<span style=color:#f92672>)</span> <span style=color:#e6db74>&#34;male&#34;</span>
</span></span><span style=display:flex><span> <span style=color:#f92672>})</span>,
</span></span><span style=display:flex><span> Content: <span style=color:#f92672>(</span>string<span style=color:#f92672>)</span> <span style=color:#f92672>(</span>len<span style=color:#f92672>=</span>19<span style=color:#f92672>)</span> <span style=color:#e6db74>&#34;This is a blog post&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>可以看出，上面的输出内容包含的信息非常丰富。</p><p>如果希望自定义打印格式，可通过 <code>spew</code> 提供的 <code>ConfigState</code> 配置，如缩进，打印深度。</p><p>示例代码：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// 设置 spew 的配置</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>spewConfig</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>spew</span>.<span style=color:#a6e22e>ConfigState</span>{
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Indent</span>:                  <span style=color:#e6db74>&#34;\t&#34;</span>, <span style=color:#75715e>// 索引为 Tab</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>DisableMethods</span>:          <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>DisablePointerMethods</span>:   <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>DisablePointerAddresses</span>: <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>MaxDepth</span>:                <span style=color:#ae81ff>1</span>, <span style=color:#75715e>// 设置打印深度为 1</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>spewConfig</span>.<span style=color:#a6e22e>Dump</span>(<span style=color:#a6e22e>article</span>)
</span></span></code></pre></td></tr></table></div></div><p>输出：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>(</span>main.Article<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>	ID: <span style=color:#f92672>(</span>int64<span style=color:#f92672>)</span> 1,
</span></span><span style=display:flex><span>	Title: <span style=color:#f92672>(</span>string<span style=color:#f92672>)</span> <span style=color:#f92672>(</span>len<span style=color:#f92672>=</span>34<span style=color:#f92672>)</span> <span style=color:#e6db74>&#34;How to Print a Structure in Golang&#34;</span>,
</span></span><span style=display:flex><span>	Author: <span style=color:#f92672>(</span>*main.Author<span style=color:#f92672>)({</span>
</span></span><span style=display:flex><span>		&lt;max depth reached&gt;
</span></span><span style=display:flex><span>	<span style=color:#f92672>})</span>,
</span></span><span style=display:flex><span>	Content: <span style=color:#f92672>(</span>string<span style=color:#f92672>)</span> <span style=color:#f92672>(</span>len<span style=color:#f92672>=</span>19<span style=color:#f92672>)</span> <span style=color:#e6db74>&#34;This is a blog post&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></td></tr></table></div></div><p>因为，我将打印深度配置为 1，可以看到 <code>Author</code> 的字段的内容是没有打印的。</p><p>更多能力可自行探索。</p><h3 id=pretty>pretty</h3><p>除了 <code>go-spew</code>，还有一些没那么强大，但也还不错的库，方便我们调试复杂数据结构，如 <a href=https://github.com/kr/pretty><code>pretty</code></a>。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;github.com/kr/pretty&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>  <span style=color:#75715e>// 省略 ...</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;%# v\n&#34;</span>, <span style=color:#a6e22e>pretty</span>.<span style=color:#a6e22e>Formatter</span>(<span style=color:#a6e22e>article</span>))
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>输出：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>main.Article<span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    ID:      1,
</span></span><span style=display:flex><span>    Title:   <span style=color:#e6db74>&#34;How to Print a Structure in Golang&#34;</span>,
</span></span><span style=display:flex><span>    Author:  &amp;main.Author<span style=color:#f92672>{</span>Name:<span style=color:#e6db74>&#34;poloxue&#34;</span>, Age:18, Sex:<span style=color:#e6db74>&#34;male&#34;</span><span style=color:#f92672>}</span>,
</span></span><span style=display:flex><span>    Content: <span style=color:#e6db74>&#34;This is a blog post&#34;</span>,
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></td></tr></table></div></div><p>输出结果为格式化的结构体输出。</p><h2 id=结语>结语</h2><p>本文主要介绍了 Go 语言中打印结构体的不同方法。我们从简单的 <code>fmt.Printf</code> 到使用反射，甚至是第三方库，我们是有很多选择。</p><p>简单主题深入起来，扩展内容也可很丰富。</p><p>关于打印结构体这个主题，还有一个部分没有谈到，就是日志如何记录类似结构体等复杂结构类型的变量，毕竟日志对于问题调试至关重要。后面有机会，可单独谈下这个主题。</p><p>最后，希望这篇文章能帮助你在打印调试 GO 结构体等复杂结构时，不再迷茫。</p><p>感谢阅读。</p><p>博文地址：<a href=https://www.poloxue.com/2024-02-01-print-struct-in-golang>Go 中打印结构体？代码调试效率提升</a></p><div>本文来源于 <a href=https://www.poloxue.com>POLOXUE's BLOG</a>，地址： <a href=https://www.poloxue.com/posts/2024-02-01-print-struct-in-golang/>Go 中如何打印结构体？代码调试效率提升</a></div></div><nav class="hide-on-mobile section-nav"><nav id=TableOfContents><ol><li><a href=#定义结构体>定义结构体</a></li><li><a href=#使用-fmtprintf>使用 <code>fmt.Printf</code></a></li><li><a href=#实现-string-方法>实现 <code>String</code> 方法</a></li><li><a href=#jsonmarshalindent><code>json.MarshalIndent</code></a></li><li><a href=#reflect-包打印复杂结构><code>reflect</code> 包打印复杂结构</a></li><li><a href=#性能压测>性能压测</a></li><li><a href=#三方库>三方库</a><ol><li><a href=#go-spew><code>go-spew</code></a></li><li><a href=#pretty>pretty</a></li></ol></li><li><a href=#结语>结语</a></li></ol></nav></nav></div><div class=post><hr class=footer-separator><div class=tags></div><div class=back><a href=https://www.poloxue.com/><span aria-hidden=true>← Back</span></a></div><div class=back></div></div><div class=post><img style=width:85% src=https://cdn.jsdelivr.net/gh/poloxue/images@main/wechat.png><div class=utterances></div><script src=https://utteranc.es/client.js repo=poloxue/blog issue-term=pathname theme=github-light crossorigin=anonymous async></script></div></div><div class="footer wrapper"><nav class=nav><div>2024 Polo Xue All rights reserved</div></nav></div><script>feather.replace()</script><script>var enableTruncate=!0,filterDepth=!1;const MAX_DEPTH=9;window.addEventListener("DOMContentLoaded",()=>{const e=new IntersectionObserver(e=>{e.reverse().forEach(e=>{const n=e.target.getAttribute("id");if(e.intersectionRatio>0){var t=document.querySelectorAll(`nav li a[href="#${n}"]`);t!=null&&t.forEach(e=>{if(e!=null){var t=getDepth(e.parentElement);filterDepth&&t<=MAX_DEPTH&&(clearActiveStatesInTableOfContents(),e.parentElement.classList.add("active"))}else filterDepth||(clearActiveStatesInTableOfContents(),e.parentElement.classList.add("active"))})}})});document.querySelectorAll("h1[id],h2[id],h3[id],h4[id]").forEach(t=>{e.observe(t)})});function isVisible(e){if(!(e instanceof Element))return!1;const n=getComputedStyle(e);if(n.display==="none")return!1;if(n.visibility!=="visible")return!1;if(n.opacity<.1)return!1;if(e.offsetWidth+e.offsetHeight+e.getBoundingClientRect().height+e.getBoundingClientRect().width===0)return!1;const t={x:e.getBoundingClientRect().left+e.offsetWidth/2,y:e.getBoundingClientRect().top+e.offsetHeight/2};if(t.x<0)return!1;if(t.x>(document.documentElement.clientWidth||window.innerWidth))return!1;if(t.y<0)return!1;if(t.y>(document.documentElement.clientHeight||window.innerHeight))return!1;let s=document.elementFromPoint(t.x,t.y);do if(s===e)return!0;while(s=s.parentNode)return!1}function clearActiveStatesInTableOfContents(){document.querySelectorAll("nav li").forEach(e=>{e.classList.remove("active")})}function getDepth(e){for(var t=0;e!==null&&e.tagName.toLowerCase()!=="ul";)t++,e=e.parentElement;return t}function navItems(){var e=document.querySelectorAll("nav nav li a");return Array.from(e).filter(e=>e.href!=null&&e.hash.startsWith("#"))}function lasItemInNavBarVisible(){var e=navItems().slice(-1)[0];return isVisible(e)}document.addEventListener("DOMContentLoaded",function(){if(!enableTruncate)return;var e=navItems();console.log(e),lasItemInNavBarVisible()||(filterDepth=!0,e.forEach(function(e){var t=getDepth(e.parentElement);t>MAX_DEPTH&&e.parentElement.classList.add("depth-nested")}))})</script></body></html>