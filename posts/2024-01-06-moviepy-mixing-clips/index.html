<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>Python 视频剪辑库 - Moviepy 的混合剪辑 mixing clips - POLOXUE's BLOG</title><meta name=viewport content="width=device-width,initial-scale=1"><meta itemprop=name content="Python 视频剪辑库 - Moviepy 的混合剪辑 mixing clips"><meta itemprop=description content="今天我们来介绍 MoviePy 的混合剪辑 - mixing clips。"><meta itemprop=datePublished content="2024-01-06T20:35:11+08:00"><meta itemprop=dateModified content="2024-01-06T20:35:11+08:00"><meta itemprop=wordCount content="536"><meta itemprop=keywords content><meta property="og:title" content="Python 视频剪辑库 - Moviepy 的混合剪辑 mixing clips"><meta property="og:description" content="今天我们来介绍 MoviePy 的混合剪辑 - mixing clips。"><meta property="og:type" content="article"><meta property="og:url" content="https://www.poloxue.com/posts/2024-01-06-moviepy-mixing-clips/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-01-06T20:35:11+08:00"><meta property="article:modified_time" content="2024-01-06T20:35:11+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Python 视频剪辑库 - Moviepy 的混合剪辑 mixing clips"><meta name=twitter:description content="今天我们来介绍 MoviePy 的混合剪辑 - mixing clips。"><script data-goatcounter=https://poloxue.goatcounter.com/count async src=//gc.zgo.at/count.js></script>
<link rel=stylesheet type=text/css media=screen href=https://www.poloxue.com/css/normalize.css><link rel=stylesheet type=text/css media=screen href=https://www.poloxue.com/css/main.css><link rel=stylesheet type=text/css media=screen href=https://www.poloxue.com/css/extra.css><link id=dark-scheme rel=stylesheet type=text/css href=https://www.poloxue.com/css/dark.css><script src=https://www.poloxue.com/js/feather.min.js></script>
<script src=https://www.poloxue.com/js/main.js></script>
<script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js></script>
<script>MathJax={tex:{displayMath:[["[","]"],["$$","$$"]],inlineMath:[["(",")"],["$","$"]]}}</script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7019080091542951" crossorigin=anonymous></script></head><body><div class="container-wide wrapper"><div class=header><div class=avatar><a href=https://www.poloxue.com/><img src=/avatar.png alt="POLOXUE's BLOG"></a></div><h1 class=site-title><a href=https://www.poloxue.com/>POLOXUE's BLOG</a></h1><div class=site-description><nav class="nav social"><ul class=flat><li><a href=https://github.com/poloxue/ title=Github><i data-feather=github></i></a></li><li><a href=/posts/index.xml title=RSS><i data-feather=rss></i></a></li><li><a href=/ title=Wechat><i data-feather=message-circle></i></a></li><span class=scheme-toggle><a href=# id=scheme-toggle></a></ul></nav></div><nav class=nav><ul class=flat><li><a href=/>文章列表</a></li><li><a href=/tags>分类标签</a></li><li><a href=https://crypto.poloxue.com/>每日资讯</a></li><li><a href=/about/about>关于我</a></li></ul></nav></div><div class=article-nav id=article-nav-id><div class=post><div class=post-header><div class=meta><div class=date><span class=day>06</span>
<span class=rest>Jan 2024</span></div></div><div class=matter><h1 class=title>Python 视频剪辑库 - Moviepy 的混合剪辑 mixing clips</h1></div></div><aside class="show-on-mobile toc" id=static-toc><header><h3>Contents</h3></header><nav id=TableOfContents><ol><li><a href=#前言概述>前言概述</a></li><li><a href=#基于时间---concatenate-clips>基于时间 - concatenate clips</a><ol><li><a href=#视频合成>视频合成</a></li><li><a href=#音频合成>音频合成</a></li></ol></li><li><a href=#基于空间---clips_array>基于空间 - clips_array</a></li><li><a href=#自由合成---composite-clips>自由合成 - composite clips</a><ol><li><a href=#视频合成-1>视频合成</a></li><li><a href=#音频合成-1>音频合成</a></li></ol></li><li><a href=#特别说明>特别说明</a></li><li><a href=#总结>总结</a></li></ol></nav></aside><p><img src=https://cdn.jsdelivr.net/gh/poloxue/images@2024-01/2024-01-06-moviepy-mix-clips-07.png alt></p><p>今天，介绍下 MoviePy 的混合剪辑 - mixing clips，即如何将多个 clip 合并为一个 clip 生成最终视频。</p><h2 id=前言概述>前言概述</h2><p>混合剪辑，主要指的是如何将多个 Clip 合成为一个 Clip。Clip 的类型可以是 VideoClip、或者是 AudioClip。</p><p>MoviePy 中的混合剪辑 mixing clips 提供的方法，我大致上分三类，即是基于时间的 concantenate_clips、基于空间 clips_array 和随意合成 CompositeClips。不过，因为 audio 音频没有空间的概念，clips_array 只适用于 VideoClip 对象。</p><p>Ok, 那让我们具体介绍具体的使用吧。</p><h2 id=基于时间---concatenate-clips>基于时间 - concatenate clips</h2><p>首先，我们介绍 concatenate clips 基于时间的视频合成。所谓，基于时间，即按时间依次播放片段。</p><h3 id=视频合成>视频合成</h3><p>假设，我们要制作一个视频，依次播放 &ldquo;1st second&rdquo;、&ldquo;2nd second&rdquo; 和 &ldquo;3rd second&rdquo;。我们可以通过 <code>TextClip</code> 依次创建三个视频片段，然后通过 concantenate_video_clip 合并。</p><p>实现代码如下所示：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> moviepy.editor <span style=color:#f92672>import</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>clip1 <span style=color:#f92672>=</span> TextClip(<span style=color:#e6db74>&#34;1st second&#34;</span>, color<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;white&#34;</span>, size<span style=color:#f92672>=</span>(<span style=color:#ae81ff>1280</span>, <span style=color:#ae81ff>720</span>))<span style=color:#f92672>.</span>set_duration(<span style=color:#ae81ff>1</span>)<span style=color:#f92672>.</span>set_fps(<span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>clip2 <span style=color:#f92672>=</span> TextClip(<span style=color:#e6db74>&#34;2nd second&#34;</span>, color<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;white&#34;</span>, size<span style=color:#f92672>=</span>(<span style=color:#ae81ff>1280</span>, <span style=color:#ae81ff>720</span>))<span style=color:#f92672>.</span>set_duration(<span style=color:#ae81ff>1</span>)<span style=color:#f92672>.</span>set_fps(<span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>clip3 <span style=color:#f92672>=</span> TextClip(<span style=color:#e6db74>&#34;3rd second&#34;</span>, color<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;white&#34;</span>, size<span style=color:#f92672>=</span>(<span style=color:#ae81ff>1280</span>, <span style=color:#ae81ff>720</span>))<span style=color:#f92672>.</span>set_duration(<span style=color:#ae81ff>1</span>)<span style=color:#f92672>.</span>set_fps(<span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>video <span style=color:#f92672>=</span> concatenate_videoclips([clip1, clip2, clip3])
</span></span><span style=display:flex><span>video<span style=color:#f92672>.</span>write_videofile(<span style=color:#e6db74>&#34;concatenate_videoclips.mp4&#34;</span>)
</span></span></code></pre></td></tr></table></div></div><p>视频如下所示，按时间依次播放片段。</p><p><img src=https://cdn.jsdelivr.net/gh/poloxue/images@2024-01/2024-01-06-moviepy-mix-clips-02.gif alt></p><h3 id=音频合成>音频合成</h3><p>如果希望基于时间合成音频，直接使用 concantenate_audio_clips 方法，如假设我当前有 &ldquo;1st-second.wav&rdquo;, &ldquo;2nd-second.wav&rdquo;, &ldquo;3rd-second.wav&rdquo; 音频文件。</p><p>如下代码即可将代码按时间合成。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>clip1 <span style=color:#f92672>=</span> AudioFileClip(<span style=color:#e6db74>&#34;1st-second.wav&#34;</span>)
</span></span><span style=display:flex><span>clip2 <span style=color:#f92672>=</span> AudioFileClip(<span style=color:#e6db74>&#34;2nd-second.wav&#34;</span>)
</span></span><span style=display:flex><span>clip3 <span style=color:#f92672>=</span> AudioFileClip(<span style=color:#e6db74>&#34;3rd-second.wav&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>audio <span style=color:#f92672>=</span> concatenate_audioclips([clip1, clip2, clip3])
</span></span><span style=display:flex><span>audio<span style=color:#f92672>.</span>write_audiofile(<span style=color:#e6db74>&#34;concatenate_audioclips.wav&#34;</span>)
</span></span></code></pre></td></tr></table></div></div><p>最终生成的音频文件效果，将依次朗读 &ldquo;1st second&rdquo;，&ldquo;2nd second&rdquo;、&ldquo;3rd second&rdquo;。</p><h2 id=基于空间---clips_array>基于空间 - clips_array</h2><p>如果想让多个 Clip 在同一时刻显示且平铺开，直接使用 clips_array，按空间平铺多个 clip。</p><blockquote><p>说明：音频不存在空间概念，故而 clips_array 只适用于操作视频。</p></blockquote><p>我们还是使用 TextClip 创建 Clip，然后使用 clips_array 按数组拼接起来。</p><p>实现代码，如下所示：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> moviepy.editor <span style=color:#f92672>import</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>clip1 <span style=color:#f92672>=</span> TextClip(<span style=color:#e6db74>&#34;1st second&#34;</span>, color<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;white&#34;</span>, bg_color<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;gray&#34;</span>, size<span style=color:#f92672>=</span>(<span style=color:#ae81ff>1280</span>, <span style=color:#ae81ff>720</span>))<span style=color:#f92672>.</span>set_duration(<span style=color:#ae81ff>1</span>)<span style=color:#f92672>.</span>set_fps(<span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>clip2 <span style=color:#f92672>=</span> TextClip(<span style=color:#e6db74>&#34;2nd second&#34;</span>, color<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;white&#34;</span>, bg_color<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;gray&#34;</span>, size<span style=color:#f92672>=</span>(<span style=color:#ae81ff>1280</span>, <span style=color:#ae81ff>720</span>))<span style=color:#f92672>.</span>set_duration(<span style=color:#ae81ff>1</span>)<span style=color:#f92672>.</span>set_fps(<span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>clip3 <span style=color:#f92672>=</span> TextClip(<span style=color:#e6db74>&#34;3rd second&#34;</span>, color<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;white&#34;</span>, bg_color<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;gray&#34;</span>, size<span style=color:#f92672>=</span>(<span style=color:#ae81ff>1280</span>, <span style=color:#ae81ff>720</span>))<span style=color:#f92672>.</span>set_duration(<span style=color:#ae81ff>1</span>)<span style=color:#f92672>.</span>set_fps(<span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>clip4 <span style=color:#f92672>=</span> TextClip(<span style=color:#e6db74>&#34;4th second&#34;</span>, color<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;white&#34;</span>, bg_color<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;gray&#34;</span>, size<span style=color:#f92672>=</span>(<span style=color:#ae81ff>1280</span>, <span style=color:#ae81ff>720</span>))<span style=color:#f92672>.</span>set_duration(<span style=color:#ae81ff>1</span>)<span style=color:#f92672>.</span>set_fps(<span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>clip1 <span style=color:#f92672>=</span> clip1<span style=color:#f92672>.</span>margin(<span style=color:#ae81ff>10</span>)
</span></span><span style=display:flex><span>clip2 <span style=color:#f92672>=</span> clip2<span style=color:#f92672>.</span>margin(<span style=color:#ae81ff>10</span>)
</span></span><span style=display:flex><span>clip3 <span style=color:#f92672>=</span> clip3<span style=color:#f92672>.</span>margin(<span style=color:#ae81ff>10</span>)
</span></span><span style=display:flex><span>clip4 <span style=color:#f92672>=</span> clip4<span style=color:#f92672>.</span>margin(<span style=color:#ae81ff>10</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>video <span style=color:#f92672>=</span> clips_array([[clip1, clip2], [clip3, clip4]])
</span></span><span style=display:flex><span>video<span style=color:#f92672>.</span>write_videofile(<span style=color:#e6db74>&#34;clips_array.mp4&#34;</span>)
</span></span></code></pre></td></tr></table></div></div><p>clips_array 的参数是一个二维数组，假设有一个 2 x 2 的数组，位置是：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>[</span>行1列1, 行1列2<span style=color:#f92672>]</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>[</span>行2列1, 行2列2<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span><span style=color:#f92672>]</span>
</span></span></code></pre></td></tr></table></div></div><p>我们最终合成视频的效果如下所示：</p><p><img src=https://cdn.jsdelivr.net/gh/poloxue/images@2024-01/2024-01-06-moviepy-mix-clips-03.gif alt></p><h2 id=自由合成---composite-clips>自由合成 - composite clips</h2><p>无论是基于空间，还是基于时间，都是基于一个固定的模式合成。如果不希望局限于这种模式，就要使用 Composite Clips 类，自由合成。</p><h3 id=视频合成-1>视频合成</h3><p>我们使用 moviepy 的 CompositeVideoClips 类可随意合成视频。</p><p>自由合成多个 Clip 的话，即某个 Clip 出现的时间和空间和其他 Clip 无关，意味我们要单独定义视频位置与播放的时间区域。</p><h4 id=设置位置>设置位置</h4><p>如何设置视频 Clip 位置呢？</p><p>VideoClip 提供了一个 set_position 方法，用它即可设置视频的位置，参数是 x y 坐标点。</p><p>坐标系如何确认呢？</p><p>使用 ConcompositeVideoClip 合成的 Clip，大小 size 默认是参数 clips 数组的第一个 Clip 的 size，而位置的 x 与 y 便是基于这第一个 Clip 而定的。</p><p>坐标系的原点位于左上角的位置，x 轴的方式从左向右，而 y 轴的方向是从上到下，如下图所示：</p><p><img src=https://cdn.jsdelivr.net/gh/poloxue/images@2024-01/2024-01-06-moviepy-mix-clips-04.jpeg alt></p><p>现在，我们尝试下，目标是将一个 TextClip 添加一个视频上，居中显示视频标题。</p><p>实现代码，如下所示：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>title <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;MoviePy Basic Usage&#34;</span>
</span></span><span style=display:flex><span>video <span style=color:#f92672>=</span> VideoFileClip(<span style=color:#e6db74>&#34;input_video2.mp4&#34;</span>)
</span></span><span style=display:flex><span>txt_clip <span style=color:#f92672>=</span> TextClip(title, fontsize<span style=color:#f92672>=</span><span style=color:#ae81ff>80</span>, color<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;orange&#34;</span>)<span style=color:#f92672>.</span>set_duration(video<span style=color:#f92672>.</span>duration)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 计算居中坐标位置</span>
</span></span><span style=display:flex><span>width, height <span style=color:#f92672>=</span> video<span style=color:#f92672>.</span>size
</span></span><span style=display:flex><span>txt_width, txt_height <span style=color:#f92672>=</span> txt_clip<span style=color:#f92672>.</span>size
</span></span><span style=display:flex><span>x <span style=color:#f92672>=</span> (width <span style=color:#f92672>-</span> txt_width) <span style=color:#f92672>/</span><span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>y <span style=color:#f92672>=</span> (height <span style=color:#f92672>-</span> txt_height) <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>position <span style=color:#f92672>=</span> (x, y)
</span></span><span style=display:flex><span>txt_clip <span style=color:#f92672>=</span> txt_clip<span style=color:#f92672>.</span>set_position(position)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>video <span style=color:#f92672>=</span> CompositeVideoClip([video, txt_clip])
</span></span><span style=display:flex><span>video<span style=color:#f92672>.</span>write_videofile(<span style=color:#e6db74>&#34;CompositeVideoClip.mp4&#34;</span>)
</span></span></code></pre></td></tr></table></div></div><p>最终效果如下所示：</p><p><img src=https://cdn.jsdelivr.net/gh/poloxue/images@2024-01/2024-01-06-moviepy-mix-clips-05.png alt></p><p>示例代码中，有一串代码用于计算居中的位置。对于常见的对齐方式，如居中，在 moviepy 可直接使用 &ldquo;center&rdquo; 指定，其他 left，right, top, bottom 也是如此。</p><p>可通过如下代码直接将 txt_clip 居中。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>txt_clip <span style=color:#f92672>=</span> txt_clip<span style=color:#f92672>.</span>set_position((<span style=color:#e6db74>&#34;center&#34;</span>, <span style=color:#e6db74>&#34;center&#34;</span>))
</span></span></code></pre></td></tr></table></div></div><h4 id=设置出现时间段>设置出现时间段</h4><p>本段介绍下如何配置 Clip 的显示时间，其核心是三个函数，<code>set_start</code>、<code>set_end</code> 和 <code>set_duration</code>，分别用于设置 Clip 的开始时间、结束时间和时间长度。</p><p>一个案例，假设我们想在视频添加另一个片段，依次显示 &ldquo;3&rdquo;、&ldquo;2&rdquo;、&ldquo;1&rdquo;，实现倒计时的效果。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> moviepy.editor <span style=color:#f92672>import</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>video <span style=color:#f92672>=</span> VideoFileClip(<span style=color:#e6db74>&#34;input_video2.mp4&#34;</span>)
</span></span><span style=display:flex><span>txt_clips <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>start <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>duration <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> text <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>0</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>):
</span></span><span style=display:flex><span>    txt_clip <span style=color:#f92672>=</span> TextClip(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{</span>text<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>, color<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;white&#34;</span>, fontsize<span style=color:#f92672>=</span><span style=color:#ae81ff>128</span>)<span style=color:#f92672>.</span>set_start(start)<span style=color:#f92672>.</span>set_duration(duration)<span style=color:#f92672>.</span>set_fps(<span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>    txt_clip <span style=color:#f92672>=</span> txt_clip<span style=color:#f92672>.</span>set_position((<span style=color:#e6db74>&#34;center&#34;</span>, <span style=color:#e6db74>&#34;center&#34;</span>))
</span></span><span style=display:flex><span>    txt_clips<span style=color:#f92672>.</span>append(txt_clip)
</span></span><span style=display:flex><span>    start <span style=color:#f92672>+=</span> duration
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>video <span style=color:#f92672>=</span> CompositeVideoClip([video] <span style=color:#f92672>+</span> txt_clips)
</span></span></code></pre></td></tr></table></div></div><p>通过 for 循环依次生成 TextClip 并设置每个 Clip 的显示时间段。</p><p>效果如下所示：</p><p><img src=https://cdn.jsdelivr.net/gh/poloxue/images@2024-01/2024-01-06-moviepy-mix-clips-06.gif alt></p><h3 id=音频合成-1>音频合成</h3><p>我们使用 CompositeAudioClip 类合成音频。常见的场景是，我们想在原视频的基础上，添加背景音乐。</p><p>由于，音频不存在位置的问题，就简单了很多，我们主要关注如何时间设置即可。</p><p>一个案例，我们有三个音频文件，分别 1st-second.wav、2nd-second.wav 和 3rd-second.wav，我们使用 concatenate_videoclips 依次播放，且在 1-5 秒加上背景因为。</p><p>演示代码如下所示：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> moviepy.editor <span style=color:#f92672>import</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>clip1 <span style=color:#f92672>=</span> AudioFileClip(<span style=color:#e6db74>&#34;./1st-second.wav&#34;</span>)
</span></span><span style=display:flex><span>clip2 <span style=color:#f92672>=</span> AudioFileClip(<span style=color:#e6db74>&#34;./2nd-second.wav&#34;</span>)
</span></span><span style=display:flex><span>clip3 <span style=color:#f92672>=</span> AudioFileClip(<span style=color:#e6db74>&#34;./3rd-second.wav&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>bg_music <span style=color:#f92672>=</span> AudioFileClip(<span style=color:#e6db74>&#34;./bg-music.mp3&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>clip1 <span style=color:#f92672>=</span> clip1<span style=color:#f92672>.</span>set_start(<span style=color:#ae81ff>0</span>)<span style=color:#f92672>.</span>set_duration(<span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>clip2 <span style=color:#f92672>=</span> clip2<span style=color:#f92672>.</span>set_start(<span style=color:#ae81ff>1</span>)<span style=color:#f92672>.</span>set_duration(<span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>clip3 <span style=color:#f92672>=</span> clip3<span style=color:#f92672>.</span>set_start(<span style=color:#ae81ff>2</span>)<span style=color:#f92672>.</span>set_duration(<span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>bg_music <span style=color:#f92672>=</span> bg_music<span style=color:#f92672>.</span>set_start(<span style=color:#ae81ff>1</span>)<span style=color:#f92672>.</span>set_duration(<span style=color:#ae81ff>4</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>clips <span style=color:#f92672>=</span> [clip1, clip2, clip3, bg_music]
</span></span><span style=display:flex><span>audio <span style=color:#f92672>=</span> CompositeAudioClip(clips)<span style=color:#f92672>.</span>set_fps(<span style=color:#ae81ff>44100</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>audio<span style=color:#f92672>.</span>write_audiofile(<span style=color:#e6db74>&#34;CompositeAudioClip.mp3&#34;</span>)
</span></span></code></pre></td></tr></table></div></div><p>如此，我们就生成了一个带有背景音乐的音频文件。</p><h2 id=特别说明>特别说明</h2><p>Clip 的合成要在相同类型 Clip 上进行，怎么理解？</p><p>简单来说，假设要在视频上添加音频，直接通过 set_audio 添加，视频上添加蒙层 mask 使用 set_mask 添加即可，而不是使用 concantenate_clips 或者 CompositeClips 实现。</p><h2 id=总结>总结</h2><p>本博文详细介绍了 MoviePy 的各种混合剪辑方法，这块内容算是 MoviePy 中比较难理解的内容了，希望帮助大家更好地理解和使用这些功能。</p><div>本文来源于 <a href=https://www.poloxue.com>POLOXUE's BLOG</a>，地址： <a href=https://www.poloxue.com/posts/2024-01-06-moviepy-mixing-clips/>Python 视频剪辑库 - Moviepy 的混合剪辑 mixing clips</a></div></div><nav class="hide-on-mobile section-nav"><nav id=TableOfContents><ol><li><a href=#前言概述>前言概述</a></li><li><a href=#基于时间---concatenate-clips>基于时间 - concatenate clips</a><ol><li><a href=#视频合成>视频合成</a></li><li><a href=#音频合成>音频合成</a></li></ol></li><li><a href=#基于空间---clips_array>基于空间 - clips_array</a></li><li><a href=#自由合成---composite-clips>自由合成 - composite clips</a><ol><li><a href=#视频合成-1>视频合成</a></li><li><a href=#音频合成-1>音频合成</a></li></ol></li><li><a href=#特别说明>特别说明</a></li><li><a href=#总结>总结</a></li></ol></nav></nav></div><div class=post><hr class=footer-separator><div class=tags></div><div class=back><a href=https://www.poloxue.com/><span aria-hidden=true>← Back</span></a></div><div class=back></div></div><div class=post><img style=width:85% src=https://cdn.jsdelivr.net/gh/poloxue/images@main/wechat.png><div class=utterances></div><script src=https://utteranc.es/client.js repo=poloxue/blog issue-term=pathname theme=github-light crossorigin=anonymous async></script></div></div><div class="footer wrapper"><nav class=nav><div>2024 Polo Xue All rights reserved</div></nav></div><script>feather.replace()</script><script>var enableTruncate=!0,filterDepth=!1;const MAX_DEPTH=9;window.addEventListener("DOMContentLoaded",()=>{const e=new IntersectionObserver(e=>{e.reverse().forEach(e=>{const n=e.target.getAttribute("id");if(e.intersectionRatio>0){var t=document.querySelectorAll(`nav li a[href="#${n}"]`);t!=null&&t.forEach(e=>{if(e!=null){var t=getDepth(e.parentElement);filterDepth&&t<=MAX_DEPTH&&(clearActiveStatesInTableOfContents(),e.parentElement.classList.add("active"))}else filterDepth||(clearActiveStatesInTableOfContents(),e.parentElement.classList.add("active"))})}})});document.querySelectorAll("h1[id],h2[id],h3[id],h4[id]").forEach(t=>{e.observe(t)})});function isVisible(e){if(!(e instanceof Element))return!1;const n=getComputedStyle(e);if(n.display==="none")return!1;if(n.visibility!=="visible")return!1;if(n.opacity<.1)return!1;if(e.offsetWidth+e.offsetHeight+e.getBoundingClientRect().height+e.getBoundingClientRect().width===0)return!1;const t={x:e.getBoundingClientRect().left+e.offsetWidth/2,y:e.getBoundingClientRect().top+e.offsetHeight/2};if(t.x<0)return!1;if(t.x>(document.documentElement.clientWidth||window.innerWidth))return!1;if(t.y<0)return!1;if(t.y>(document.documentElement.clientHeight||window.innerHeight))return!1;let s=document.elementFromPoint(t.x,t.y);do if(s===e)return!0;while(s=s.parentNode)return!1}function clearActiveStatesInTableOfContents(){document.querySelectorAll("nav li").forEach(e=>{e.classList.remove("active")})}function getDepth(e){for(var t=0;e!==null&&e.tagName.toLowerCase()!=="ul";)t++,e=e.parentElement;return t}function navItems(){var e=document.querySelectorAll("nav nav li a");return Array.from(e).filter(e=>e.href!=null&&e.hash.startsWith("#"))}function lasItemInNavBarVisible(){var e=navItems().slice(-1)[0];return isVisible(e)}document.addEventListener("DOMContentLoaded",function(){if(!enableTruncate)return;var e=navItems();console.log(e),lasItemInNavBarVisible()||(filterDepth=!0,e.forEach(function(e){var t=getDepth(e.parentElement);t>MAX_DEPTH&&e.parentElement.classList.add("depth-nested")}))})</script></body></html>