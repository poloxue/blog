<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>永续合约资金费率数据的搜集 - POLOXUE's BLOG</title><meta name=viewport content="width=device-width,initial-scale=1"><meta itemprop=name content="永续合约资金费率数据的搜集"><meta itemprop=description content="在上一篇博文中，我介绍了永续合约资金费率套利的原理。任何一个交易策略如果想要长期使用，必须挖掘和分析它在不同行情下的表现，而这一过程离不开获取历史数据。"><meta itemprop=datePublished content="2024-07-01T03:57:08+08:00"><meta itemprop=dateModified content="2024-07-01T03:57:08+08:00"><meta itemprop=wordCount content="366"><meta itemprop=keywords content><meta property="og:title" content="永续合约资金费率数据的搜集"><meta property="og:description" content="在上一篇博文中，我介绍了永续合约资金费率套利的原理。任何一个交易策略如果想要长期使用，必须挖掘和分析它在不同行情下的表现，而这一过程离不开获取历史数据。"><meta property="og:type" content="article"><meta property="og:url" content="https://www.poloxue.com/posts/2024-06-27-collect-the-funding-rate-data/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-07-01T03:57:08+08:00"><meta property="article:modified_time" content="2024-07-01T03:57:08+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="永续合约资金费率数据的搜集"><meta name=twitter:description content="在上一篇博文中，我介绍了永续合约资金费率套利的原理。任何一个交易策略如果想要长期使用，必须挖掘和分析它在不同行情下的表现，而这一过程离不开获取历史数据。"><script data-goatcounter=https://poloxue.goatcounter.com/count async src=//gc.zgo.at/count.js></script>
<link rel=stylesheet type=text/css media=screen href=https://www.poloxue.com/css/normalize.css><link rel=stylesheet type=text/css media=screen href=https://www.poloxue.com/css/main.css><link rel=stylesheet type=text/css media=screen href=https://www.poloxue.com/css/extra.css><link id=dark-scheme rel=stylesheet type=text/css href=https://www.poloxue.com/css/dark.css><script src=https://www.poloxue.com/js/feather.min.js></script>
<script src=https://www.poloxue.com/js/main.js></script>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7019080091542951" crossorigin=anonymous></script></head><body><div class="container wrapper"><div class=header><div class=avatar><a href=https://www.poloxue.com/><img src=/avatar.png alt="POLOXUE's BLOG"></a></div><h1 class=site-title><a href=https://www.poloxue.com/>POLOXUE's BLOG</a></h1><div class=site-description><nav class="nav social"><ul class=flat><li><a href=https://github.com/poloxue/ title=Github><i data-feather=github></i></a></li><li><a href=/posts/index.xml title=RSS><i data-feather=rss></i></a></li><li><a href=/ title=Wechat><i data-feather=message-circle></i></a></li><span class=scheme-toggle><a href=# id=scheme-toggle></a></ul></nav></div><nav class=nav><ul class=flat><li><a href=/>首页</a></li><li><a href=/posts>文章列表</a></li><li><a href=/tags>分类标签</a></li><li><a href=/about/>关于我</a></li></ul></nav></div><div class=post><div class=post-header><div class=meta><div class=date><span class=day>01</span>
<span class=rest>Jul 2024</span></div></div><div class=matter><h1 class=title>永续合约资金费率数据的搜集</h1></div></div><p>在上一篇博文中，我介绍了永续合约资金费率套利的原理。任何一个交易策略如果想要长期使用，必须挖掘和分析它在不同行情下的表现，而这一过程离不开获取历史数据。</p><p>本文将重点介绍如何收集资金费率数据。</p><h2 id=交易所页面>交易所页面</h2><p>资金费率是由每家交易所计算的，因此，最先想到的数据来源自然是交易所本身。</p><p>早期，交易所只提供最新的资金费率，过期数据无法获取。然而，随着资金费率套利的增多，交易所开始提供全量或近几个月的资金费率数据供用户下载。</p><p>如下图所示，Binance交易页实时计算的下一次资金费率：</p><p><img src=https://cdn.jsdelivr.net/gh/poloxue/images@2024-06/2024-06-27-collect-the-funding-rate-data-02.png alt></p><p>这个值并不是固定的，随着行情变化会有所波动。它只是预测下一次的资金费率，而非历史数据。</p><p>那么如何获取历史数据呢？</p><p>以Binance为例，它提供了一个可以查看和下载全量资金费率历史数据的页面，访问 <a href=https://www.binance.com/en/futures/funding-history/perpetual/funding-fee-history>Funding Rate History</a>。</p><p>如下图所示，我们只需点击右上角的 &ldquo;Save as CSV&rdquo; 即可下载所有数据：</p><p><img src=https://cdn.jsdelivr.net/gh/poloxue/images@2024-06/2024-06-27-collect-the-funding-rate-data-03-v1.png alt></p><p>其他交易所的获取方式也基本一致，如Bybit和OKX，它们也提供了类似的历史资金费率页面。</p><ul><li><a href=https://www.bybit.com/en/announcement-info/fund-rate/>Bybit - Funding Rate History</a>，Bybit和Binance一样，提供全量数据下载。</li><li><a href=https://www.okx.com/trade-market/funding/swap>OKX - Funding Rate History</a>，OKX只提供近三个月的数据，无法下载全量数据，这是一个缺点。</li></ul><p>对于数据分析而言，从页面下载已经足够。如果是实盘交易，则需要借助交易所的API，实时分析历史数据和获取下一次的资金费率。</p><h2 id=交易所的api接口>交易所的API接口</h2><p>接下来介绍如何通过API获取资金费率。这需要你至少了解一种编程语言，如Python，并且能够调用交易所API。</p><p>以下是三个主流交易所的资金费率API文档：</p><ul><li><a href=https://binance-docs.github.io/apidocs/delivery/en/#get-funding-rate-history-of-perpetual-futures>Binance Coin-M - Funding Rate History API</a></li><li><a href=https://binance-docs.github.io/apidocs/futures/en/#get-funding-rate-history>Binance USDⓈ-M - Funding Rate History API</a></li><li><a href=https://bybit-exchange.github.io/docs/v5/market/history-fund-rate>Bybit - Funding Rate History API</a></li><li><a href=https://www.okx.com/docs-v5/en/#public-data-rest-api-get-funding-rate-history>OKX - Funding Rate History API</a></li></ul><p>Binance的正向合约和反向合约需要分别调用不同的API，这是对接时要注意的点。为了简化API对接，我将使用Python的第三方包ccxt来连接不同的交易所。</p><p>安装（已有 Python 环境）：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pip install ccxt
</span></span></code></pre></td></tr></table></div></div><p>我们只需通过ccxt提供的<code>fetch_funding_rate_history</code>方法调用上述API文档中的接口。以下是使用API从Binance下载资金费率数据，以永续合约BTCUSDT为例。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> ccxt
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>binance <span style=color:#f92672>=</span> ccxt<span style=color:#f92672>.</span>binanceusdm()
</span></span><span style=display:flex><span>funding_rates <span style=color:#f92672>=</span> binance<span style=color:#f92672>.</span>fetch_funding_rate_history(symbol<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;BTCUSDT&#34;</span>)
</span></span><span style=display:flex><span>print(funding_rates)
</span></span></code></pre></td></tr></table></div></div><p>输出数据包含多个时间点的资金费率数组，如下所示：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;info&#39;</span>: <span style=color:#f92672>{</span><span style=color:#e6db74>&#39;symbol&#39;</span>: <span style=color:#e6db74>&#39;BTCUSDT&#39;</span>, <span style=color:#e6db74>&#39;fundingTime&#39;</span>: <span style=color:#e6db74>&#39;1716624000000&#39;</span>, <span style=color:#e6db74>&#39;fundingRate&#39;</span>: <span style=color:#e6db74>&#39;0.00010000&#39;</span>, <span style=color:#e6db74>&#39;markPrice&#39;</span>: <span style=color:#e6db74>&#39;68775.00000000&#39;</span><span style=color:#f92672>}</span>, 
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;symbol&#39;</span>: <span style=color:#e6db74>&#39;BTC/USDT:USDT&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;fundingRate&#39;</span>: 0.0001, 
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;timestamp&#39;</span>: 1716624000000,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;datetime&#39;</span>: <span style=color:#e6db74>&#39;2024-05-25T08:00:00.000Z&#39;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;info&#39;</span>: <span style=color:#f92672>{</span><span style=color:#e6db74>&#39;symbol&#39;</span>: <span style=color:#e6db74>&#39;BTCUSDT&#39;</span>, <span style=color:#e6db74>&#39;fundingTime&#39;</span>: <span style=color:#e6db74>&#39;1716652800000&#39;</span>, <span style=color:#e6db74>&#39;fundingRate&#39;</span>: <span style=color:#e6db74>&#39;0.00010000&#39;</span>, <span style=color:#e6db74>&#39;markPrice&#39;</span>: <span style=color:#e6db74>&#39;68945.95530496&#39;</span><span style=color:#f92672>}</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;symbol&#39;</span>: <span style=color:#e6db74>&#39;BTC/USDT:USDT&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;fundingRate&#39;</span>: 0.0001,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;timestamp&#39;</span>: 1716652800000,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;datetime&#39;</span>: <span style=color:#e6db74>&#39;2024-05-25T16:00:00.000Z&#39;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>,
</span></span><span style=display:flex><span>  ...
</span></span><span style=display:flex><span><span style=color:#f92672>]</span>
</span></span></code></pre></td></tr></table></div></div><p><code>info</code>字段是API返回的原始信息，其他字段是ccxt整合不同交易所后生成的通用字段。</p><p>仔细观察程序打印结果，你会发现API返回的并非全量数据。由于API每次返回的数据量有限，需要多次循环才能获取全量数据。</p><p>我将这个过程封装为一个函数，代码如下：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>binance_fetch_all_funding_rate_history</span>(symbol, limit<span style=color:#f92672>=</span><span style=color:#ae81ff>100</span>):
</span></span><span style=display:flex><span>    all_funding_rates <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>    since <span style=color:#f92672>=</span> <span style=color:#66d9ef>None</span>
</span></span><span style=display:flex><span>    end <span style=color:#f92672>=</span> <span style=color:#66d9ef>None</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> symbol<span style=color:#f92672>.</span>endswith(<span style=color:#e6db74>&#34;USD&#34;</span>):
</span></span><span style=display:flex><span>        binance <span style=color:#f92672>=</span> ccxt<span style=color:#f92672>.</span>binanceusdm()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>        binance <span style=color:#f92672>=</span> ccxt<span style=color:#f92672>.</span>binancecoinm()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>while</span> <span style=color:#66d9ef>True</span>:
</span></span><span style=display:flex><span>        funding_rates <span style=color:#f92672>=</span> binance<span style=color:#f92672>.</span>fetch_funding_rate_history(
</span></span><span style=display:flex><span>            symbol, since<span style=color:#f92672>=</span>since, limit<span style=color:#f92672>=</span>limit, params<span style=color:#f92672>=</span>{<span style=color:#e6db74>&#34;endTime&#34;</span>: end}
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> funding_rates:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>break</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        all_funding_rates <span style=color:#f92672>=</span> funding_rates <span style=color:#f92672>+</span> all_funding_rates
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        oldest_timestamp <span style=color:#f92672>=</span> funding_rates[<span style=color:#ae81ff>0</span>][<span style=color:#e6db74>&#34;timestamp&#34;</span>]
</span></span><span style=display:flex><span>        end <span style=color:#f92672>=</span> oldest_timestamp <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>        since <span style=color:#f92672>=</span> oldest_timestamp <span style=color:#f92672>-</span> limit <span style=color:#f92672>*</span> <span style=color:#ae81ff>8</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>3600000</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        time<span style=color:#f92672>.</span>sleep(<span style=color:#ae81ff>0.2</span>) <span style=color:#75715e># 防止触发频率限制</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> all_funding_rates
</span></span></code></pre></td></tr></table></div></div><p>现在，只需调用<code>binance_fetch_all_funding_rate_history</code>函数获取数据并将其保存即可。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> pandas <span style=color:#66d9ef>as</span> pd
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>main</span>():
</span></span><span style=display:flex><span>    funding_rates <span style=color:#f92672>=</span> binance_fetch_all_funding_rate_history(<span style=color:#e6db74>&#34;BTCUSDT&#34;</span>)
</span></span><span style=display:flex><span>    data <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>DataFrame(funding_rates)
</span></span><span style=display:flex><span>    data[[<span style=color:#e6db74>&#34;datetime&#34;</span>, <span style=color:#e6db74>&#34;fundingRate&#34;</span>]]<span style=color:#f92672>.</span>to_csv(<span style=color:#e6db74>&#34;binance_BTCUSDT.csv&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;__main__&#34;</span>:
</span></span><span style=display:flex><span>    main()
</span></span></code></pre></td></tr></table></div></div><p>这里保存了两个重要字段：<code>datetime</code>和<code>fundingRate</code>，并将其保存为名为<code>binance_BTCUSDT.csv</code>的文件。</p><p>Bybit和OKX的实现代码可查看我的Github Gist - <a href=https://gist.github.com/poloxue/e8403ac7cf6e70d5d7ab42b0bdce4af4>资金费率下载</a>。需要提醒的是，OKX无论是从页面还是通过API下载，都只能获得最近三个月的数据。</p><p>在实盘场景下，查看交易所最近预测的资金费率，也可通过ccxt直接的方法获取。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> ccxt
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>proxies <span style=color:#f92672>=</span> {}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>binance <span style=color:#f92672>=</span> ccxt<span style=color:#f92672>.</span>binanceusdm({<span style=color:#e6db74>&#34;proxies&#34;</span>: proxies})
</span></span><span style=display:flex><span>funding_rate <span style=color:#f92672>=</span> binance<span style=color:#f92672>.</span>fetch_funding_rate(symbol<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;BTCUSDT&#34;</span>)
</span></span><span style=display:flex><span>print(funding_rate)
</span></span></code></pre></td></tr></table></div></div><p>输出结果如下：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;info&#39;</span>: <span style=color:#f92672>{</span><span style=color:#e6db74>&#39;symbol&#39;</span>: <span style=color:#e6db74>&#39;BTCUSDT&#39;</span>, <span style=color:#e6db74>&#39;markPrice&#39;</span>: <span style=color:#e6db74>&#39;61979.80000000&#39;</span>, <span style=color:#e6db74>&#39;indexPrice&#39;</span>: <span style=color:#e6db74>&#39;61987.25595745&#39;</span>, <span style=color:#e6db74>&#39;estimatedSettlePrice&#39;</span>: <span style=color:#e6db74>&#39;61972.26180915&#39;</span>, <span style=color:#e6db74>&#39;lastFundingRate&#39;</span>: <span style=color:#e6db74>&#39;0.00010000&#39;</span>, <span style=color:#e6db74>&#39;interestRate&#39;</span>: <span style=color:#e6db74>&#39;0.00010000&#39;</span>, <span style=color:#e6db74>&#39;nextFundingTime&#39;</span>: <span style=color:#e6db74>&#39;1719792000000&#39;</span>, <span style=color:#e6db74>&#39;time&#39;</span>: <span style=color:#e6db74>&#39;1719776533000&#39;</span><span style=color:#f92672>}</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;symbol&#39;</span>: <span style=color:#e6db74>&#39;BTC/USDT:USDT&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;markPrice&#39;</span>: 61979.8,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;indexPrice&#39;</span>: 61987.25595745,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;interestRate&#39;</span>: 0.0001,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;estimatedSettlePrice&#39;</span>: 61972.26180915,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;timestamp&#39;</span>: 1719776533000,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;datetime&#39;</span>: <span style=color:#e6db74>&#39;2024-06-30T19:42:13.000Z&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;fundingRate&#39;</span>: 0.0001,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;fundingTimestamp&#39;</span>: 1719792000000,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;fundingDatetime&#39;</span>: <span style=color:#e6db74>&#39;2024-07-01T00:00:00.000Z&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;nextFundingRate&#39;</span>: None,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;nextFundingTimestamp&#39;</span>: None,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;nextFundingDatetime&#39;</span>: None,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;previousFundingRate&#39;</span>: None,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;previousFundingTimestamp&#39;</span>: None,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;previousFundingDatetime&#39;</span>: None
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></td></tr></table></div></div><p>有了这些基础数据，我们就可以进入下一步，分析资金费率的套利空间。</p><h2 id=第三方平台>第三方平台</h2><p>如果你不想自己整理数据，也有一些三方平台，如Coinglass，提供了资金费率分析的工具，聚合了大部分主流交易所的数据，并提供了一些简单对比分析图表。</p><p>访问地址：<a href=https://www.coinglass.com/FundingRate>Funding Rate</a>。</p><p><img src=https://cdn.jsdelivr.net/gh/poloxue/images@2024-06/2024-06-27-collect-the-funding-rate-data-04.png alt></p><p>如果你不需要深入分析甚至甚至是回测，这或许是一个不错的选择。</p><hr class=footer-separator><div class=tags></div><div class=back><a href=https://www.poloxue.com/><span aria-hidden=true>← Back</span></a></div><div class=back></div></div><div class=post>欢迎关注我的公众号：<img style=width:85% src=https://cdn.jsdelivr.net/gh/poloxue/images@main/wechat.png><div class=utterances></div><script src=https://utteranc.es/client.js repo=poloxue/blog issue-term=pathname theme=github-light crossorigin=anonymous async></script></div></div><div class="footer wrapper"><nav class=nav><div>2024 Polo Xue All rights reserved</div></nav></div><script>feather.replace()</script></body></html>