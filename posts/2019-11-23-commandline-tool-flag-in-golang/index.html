<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>Go 命令行解析 flag 包之快速上手 - POLOXUE's BLOG</title><meta name=viewport content="width=device-width,initial-scale=1"><meta itemprop=name content="Go 命令行解析 flag 包之快速上手"><meta itemprop=description content="本篇文章是 Go 标准库 flag 包的快速上手篇。
概述 开发一个命令行工具，视复杂程度，一般要选择一个合适的命令行解析库，简单的需求用 Go 标准库 flag 就够了，flag 的使用非常简单。
当然，除了标准库 flag 外，也有不少的第三方库。比如，为了替代 flag 而生的 pflag，它支持 POSIX 风格的命令行解析。关于 POSIX 风格，本文末尾有个简单的介绍。
更多与命令行处理相关的库，可以打开 awesome-go#command-line 命令行一节查看，star 最多的是 spf13/cobra 和 urfave/cli ，与 flag / pflag 相比，它们更加复杂，是一个完全的全功能的框架。
有兴趣都可以了解下。
目标案例 回归主题，继续介绍 flag 吧。通过案例介绍包的使用会比较直观。
举一个例子说明吧。假设，现在要开发一个 Go 语言环境的版本管理工具，gvg（go version management by go）。
命令行的帮助信息如下：
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 NAME: gvg - go version management by go USAGE: gvg [global options] command [command options] [arguments."><meta itemprop=datePublished content="2019-11-23T16:21:33+08:00"><meta itemprop=dateModified content="2019-11-23T16:21:33+08:00"><meta itemprop=wordCount content="486"><meta itemprop=keywords content="Golang,"><meta property="og:title" content="Go 命令行解析 flag 包之快速上手"><meta property="og:description" content="本篇文章是 Go 标准库 flag 包的快速上手篇。
概述 开发一个命令行工具，视复杂程度，一般要选择一个合适的命令行解析库，简单的需求用 Go 标准库 flag 就够了，flag 的使用非常简单。
当然，除了标准库 flag 外，也有不少的第三方库。比如，为了替代 flag 而生的 pflag，它支持 POSIX 风格的命令行解析。关于 POSIX 风格，本文末尾有个简单的介绍。
更多与命令行处理相关的库，可以打开 awesome-go#command-line 命令行一节查看，star 最多的是 spf13/cobra 和 urfave/cli ，与 flag / pflag 相比，它们更加复杂，是一个完全的全功能的框架。
有兴趣都可以了解下。
目标案例 回归主题，继续介绍 flag 吧。通过案例介绍包的使用会比较直观。
举一个例子说明吧。假设，现在要开发一个 Go 语言环境的版本管理工具，gvg（go version management by go）。
命令行的帮助信息如下：
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 NAME: gvg - go version management by go USAGE: gvg [global options] command [command options] [arguments."><meta property="og:type" content="article"><meta property="og:url" content="https://www.poloxue.com/posts/2019-11-23-commandline-tool-flag-in-golang/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-11-23T16:21:33+08:00"><meta property="article:modified_time" content="2019-11-23T16:21:33+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Go 命令行解析 flag 包之快速上手"><meta name=twitter:description content="本篇文章是 Go 标准库 flag 包的快速上手篇。
概述 开发一个命令行工具，视复杂程度，一般要选择一个合适的命令行解析库，简单的需求用 Go 标准库 flag 就够了，flag 的使用非常简单。
当然，除了标准库 flag 外，也有不少的第三方库。比如，为了替代 flag 而生的 pflag，它支持 POSIX 风格的命令行解析。关于 POSIX 风格，本文末尾有个简单的介绍。
更多与命令行处理相关的库，可以打开 awesome-go#command-line 命令行一节查看，star 最多的是 spf13/cobra 和 urfave/cli ，与 flag / pflag 相比，它们更加复杂，是一个完全的全功能的框架。
有兴趣都可以了解下。
目标案例 回归主题，继续介绍 flag 吧。通过案例介绍包的使用会比较直观。
举一个例子说明吧。假设，现在要开发一个 Go 语言环境的版本管理工具，gvg（go version management by go）。
命令行的帮助信息如下：
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 NAME: gvg - go version management by go USAGE: gvg [global options] command [command options] [arguments."><script data-goatcounter=https://poloxue.goatcounter.com/count async src=//gc.zgo.at/count.js></script>
<link rel=stylesheet type=text/css media=screen href=https://www.poloxue.com/css/normalize.css><link rel=stylesheet type=text/css media=screen href=https://www.poloxue.com/css/main.css><link rel=stylesheet type=text/css media=screen href=https://www.poloxue.com/css/extra.css><link id=dark-scheme rel=stylesheet type=text/css href=https://www.poloxue.com/css/dark.css><script src=https://www.poloxue.com/js/feather.min.js></script>
<script src=https://www.poloxue.com/js/main.js></script>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7019080091542951" crossorigin=anonymous></script></head><body><div class="container-wide wrapper"><div class=header><div class=avatar><a href=https://www.poloxue.com/><img src=/avatar.png alt="POLOXUE's BLOG"></a></div><h1 class=site-title><a href=https://www.poloxue.com/>POLOXUE's BLOG</a></h1><div class=site-description><nav class="nav social"><ul class=flat><li><a href=https://github.com/poloxue/ title=Github><i data-feather=github></i></a></li><li><a href=/posts/index.xml title=RSS><i data-feather=rss></i></a></li><li><a href=/ title=Wechat><i data-feather=message-circle></i></a></li><span class=scheme-toggle><a href=# id=scheme-toggle></a></ul></nav></div><nav class=nav><ul class=flat><li><a href=/>首页</a></li><li><a href=/posts>文章列表</a></li><li><a href=/tags>分类标签</a></li><li><a href=/about/>关于我</a></li></ul></nav></div><div class=article-nav id=article-nav-id><div class=post><div class=post-header><div class=meta><div class=date><span class=day>23</span>
<span class=rest>Nov 2019</span></div></div><div class=matter><h1 class=title>Go 命令行解析 flag 包之快速上手</h1></div></div><aside class="show-on-mobile toc" id=static-toc><header><h3>Contents</h3></header><nav id=TableOfContents><ol><li><a href=#概述>概述</a></li><li><a href=#目标案例>目标案例</a></li><li><a href=#选项表示>选项表示</a></li><li><a href=#更多类型>更多类型</a></li><li><a href=#长短选项>长短选项</a></li><li><a href=#命令行解析>命令行解析</a></li><li><a href=#使用命令>使用命令</a></li><li><a href=#命令行风格>命令行风格</a></li><li><a href=#总结>总结</a></li></ol></nav></aside><p>本篇文章是 Go 标准库 flag 包的快速上手篇。</p><h2 id=概述>概述</h2><p>开发一个命令行工具，视复杂程度，一般要选择一个合适的命令行解析库，简单的需求用 Go 标准库 flag 就够了，flag 的使用非常简单。</p><p>当然，除了标准库 flag 外，也有不少的第三方库。比如，为了替代 flag 而生的 <a href=github.com/spf13/pflag>pflag</a>，它支持 POSIX 风格的命令行解析。关于 POSIX 风格，本文末尾有个简单的介绍。</p><p>更多与命令行处理相关的库，可以打开 <a href=https://awesome-go.com/#command-line>awesome-go#command-line</a> 命令行一节查看，star 最多的是 <a href=https://github.com/spf13/cobra>spf13/cobra</a> 和 <a href=https://github.com/urfave/cli>urfave/cli</a> ，与 flag / pflag 相比，它们更加复杂，是一个完全的全功能的框架。</p><p>有兴趣都可以了解下。</p><h2 id=目标案例>目标案例</h2><p>回归主题，继续介绍 flag 吧。通过案例介绍包的使用会比较直观。</p><p>举一个例子说明吧。假设，现在要开发一个 Go 语言环境的版本管理工具，gvg（go version management by go）。</p><p>命令行的帮助信息如下：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>NAME:
</span></span><span style=display:flex><span>   gvg - go version management by go
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>USAGE:
</span></span><span style=display:flex><span>   gvg [global options] command [command options] [arguments...]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>VERSION:
</span></span><span style=display:flex><span>   0.0.1
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>COMMANDS:
</span></span><span style=display:flex><span>   list       list go versions
</span></span><span style=display:flex><span>   install    install a go version
</span></span><span style=display:flex><span>   info       show go version info
</span></span><span style=display:flex><span>   use        select a version
</span></span><span style=display:flex><span>   uninstall  uninstall a go version
</span></span><span style=display:flex><span>   get        get the latest code
</span></span><span style=display:flex><span>   uninstall  uninstall a go version
</span></span><span style=display:flex><span>   help, h    Shows a list of commands or help for one command
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>GLOBAL OPTIONS:
</span></span><span style=display:flex><span>   --help, -h     show help
</span></span><span style=display:flex><span>   --version, -v  print the version
</span></span></code></pre></td></tr></table></div></div><p>这个命令不仅包含了全局的选项，还有 8 个子命令，部分子命令支持参数和选项。暂时，子命令的选项参数先不列出来了，实现时再看。</p><p>接下来，我们试着通过 flag 实现这个效果。本文只介绍 GLOBAL OPTIONS（全局选项）的实现。</p><blockquote><p>如果想了解什么是 Go 语言环境的版本管理，可以查看 <a href=https://mp.weixin.qq.com/s/OMZ3epByc_bQoMIr4OoetQ>如何灵活地进行 Go 版本管理</a> 一文。</p></blockquote><h2 id=选项表示>选项表示</h2><p>最简单的命令不需要任何参数和选项，复杂一点，要支持参数和选项的配置。gvg 没有全局参数，或者说全局参数是子命令，全局选项有 <code>--help -h</code> 和 <code>--version -h</code>。</p><p>一个选项在 flag 包中用一个 <code>Flag</code> 表示，那 <code>-h</code> 可以用一个 <code>Flag</code> 表示。一个选项通常由几个部分组成，如名称、使用说明和默认值。如果将 <code>-h</code> 用代码表示，如下：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>h</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>flag</span>.<span style=color:#a6e22e>Bool</span>(<span style=color:#e6db74>&#34;h&#34;</span>, <span style=color:#66d9ef>false</span>, <span style=color:#e6db74>&#34;show help&#34;</span>)
</span></span></code></pre></td></tr></table></div></div><p>定义了一个布尔类型的 <code>Flag</code>，名为 <code>h</code>，默认值是 false，使用说明为 &ldquo;show help&rdquo;。变量 <code>h</code> 是一个布尔型的指针，通过它可以取出命令行传入的值。</p><p>除了使用 <code>flag.Bool</code>，还可以使用另外一种方式，<code>Flag.BoolVar</code> 定义一个 <code>Flag</code>。我们可以用这种方式定义 <code>-v</code> 选项。</p><p>代码如下：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>v</span> <span style=color:#66d9ef>bool</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>flag</span>.<span style=color:#a6e22e>BoolVar</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>v</span>, <span style=color:#e6db74>&#34;v&#34;</span>, <span style=color:#66d9ef>false</span>, <span style=color:#e6db74>&#34;print the version&#34;</span>)
</span></span></code></pre></td></tr></table></div></div><p>最后的三个参数含义与 <code>flag.Bool</code> 相同，主要区别在值的获取方式，<code>flag.BoolVar</code> 是通过将变量地址传入获取值。从经验来看，第二种方式使用的较多，或许因为第一种方式会发生变量逃逸。</p><h2 id=更多类型>更多类型</h2><p>除了布尔类型，<code>Flag</code> 的类型还有整数（int、int64、uint、uint64）、浮点数（float64）、字符串（string）和时长（time.Duration）。</p><p>假设 gvg 的案例中，支持配置文件选项 <code>--config-path</code>。实现代码如下：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>configPath</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>flag</span>.<span style=color:#a6e22e>StringVar</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>configPath</span>, <span style=color:#e6db74>&#34;config-path&#34;</span>, <span style=color:#e6db74>&#34;&#34;</span>, <span style=color:#e6db74>&#34;config file path&#34;</span>)
</span></span></code></pre></td></tr></table></div></div><p>通过 <code>StringVar</code> 定义了新的 <code>Flag</code>。使用方式与 <code>BoolVar</code> 相同，最后的三个参数分别是选项名称、默认值和使用说明。</p><p>虽然 flag 支持的内置类型并不多，但已经满足大部分需求了。如果有自定义的需求，也可以扩展新的类型实现，这部分内容下篇介绍。</p><h2 id=长短选项>长短选项</h2><p>现在已经完成了 <code>-h</code> 和 <code>-v</code> 两个选项，但目标是 <code>-v --version</code> 和 <code>-h --help</code>，即同时支持长短选项。</p><p>一个 <code>Flag</code> 应该有长短两种形式，但 flag 包并不支持这种风格，需要曲线救国才能实现。（注：本文开开头提到的 pflag 支持。）</p><p>这里以 <code>-v --version</code> 为例，代码如下：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>flag</span>.<span style=color:#a6e22e>BoolVar</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>v</span>, <span style=color:#e6db74>&#34;v&#34;</span>, <span style=color:#66d9ef>false</span>, <span style=color:#e6db74>&#34;print the version&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>flag</span>.<span style=color:#a6e22e>BoolVar</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>v</span>, <span style=color:#e6db74>&#34;version&#34;</span>, <span style=color:#66d9ef>false</span>, <span style=color:#e6db74>&#34;print the version&#34;</span>)
</span></span></code></pre></td></tr></table></div></div><p>定义了两个 <code>Flag</code>，同时绑定到了一个变量上。这种效果只能用 <code>flag.BoolVar</code> 方式定义新的 <code>Flag</code>，<code>flag.Bool</code> 没办法做到将同一个变量同时绑定两个 <code>Flag</code>。</p><p>但其实这种也有缺点，先不说了，后面介绍帮助信息打印时就明白了。</p><h2 id=命令行解析>命令行解析</h2><p>定义好所有 <code>Flag</code>，还需要一步解析才能拿到正确的结果。这一步非常简单，调用 <code>flag.Parse()</code> 即可。</p><p>如下是完整的代码：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>h</span> <span style=color:#f92672>*</span><span style=color:#66d9ef>bool</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>v</span> <span style=color:#66d9ef>bool</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>init</span>() {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>flag</span>.<span style=color:#a6e22e>BoolVar</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>h</span>, <span style=color:#e6db74>&#34;h&#34;</span>, <span style=color:#66d9ef>false</span>, <span style=color:#e6db74>&#34;show help&#34;</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>flag</span>.<span style=color:#a6e22e>BoolVar</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>h</span>, <span style=color:#e6db74>&#34;help&#34;</span>, <span style=color:#66d9ef>false</span>, <span style=color:#e6db74>&#34;show help&#34;</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>flag</span>.<span style=color:#a6e22e>BoolVar</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>v</span>, <span style=color:#e6db74>&#34;v&#34;</span>, <span style=color:#66d9ef>false</span>, <span style=color:#e6db74>&#34;print the version&#34;</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>flag</span>.<span style=color:#a6e22e>BoolVar</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>v</span>, <span style=color:#e6db74>&#34;version&#34;</span>, <span style=color:#66d9ef>false</span>, <span style=color:#e6db74>&#34;print the version&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>flag</span>.<span style=color:#a6e22e>Parse</span>()
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;version&#34;</span>, <span style=color:#a6e22e>v</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;help&#34;</span>, <span style=color:#a6e22e>h</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>通过 <code>flag.Parse()</code> 解析完成，打印下 <code>v</code> 和 <code>h</code> 变量，确认下是否成功获取到了值。</p><p>到此，代码就告一段落了，现在将它编译为 gvg 命令吧。</p><h2 id=使用命令>使用命令</h2><p>在正式使用命令前，先介绍下 flag 的语法。官方文档说明，命令行中 flag 选项的使用语法有如下几种形式。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>-flag
</span></span><span style=display:flex><span>-flag<span style=color:#f92672>=</span>x
</span></span><span style=display:flex><span>-flag x // 非布尔类型才支持这种方式
</span></span></code></pre></td></tr></table></div></div><p>但其实，&ndash; 也是支持的。因此，上面才可以实现 <code>--version</code> 的曲线救国。</p><p>使用下这个命令，将 <code>help</code> 设置为 <code>false</code> 和 <code>version</code> 设置为 <code>true</code>。我尽量把所有可能的写法都列出来。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ gvg -v
</span></span><span style=display:flex><span>$ gvg -version -h<span style=color:#f92672>=</span>false  <span style=color:#75715e># 单个 - ，即 -version 支持</span>
</span></span><span style=display:flex><span>$ gvg --version<span style=color:#f92672>=</span>true --help<span style=color:#f92672>=</span>false
</span></span><span style=display:flex><span>$ gvg --version<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> --help<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>$ gvg --version<span style=color:#f92672>=</span>t --help<span style=color:#f92672>=</span>f
</span></span><span style=display:flex><span>$ gvg --version<span style=color:#f92672>=</span>T --help<span style=color:#f92672>=</span>F
</span></span><span style=display:flex><span>$ gvg --version true --help true <span style=color:#75715e># 写法错误，因为无法识别出是 bool 值，还是参数或子命令</span>
</span></span><span style=display:flex><span>$ gvg -vh  <span style=color:#75715e># 不支持这种风格</span>
</span></span></code></pre></td></tr></table></div></div><p>执行命令，输出结果：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>version true
</span></span><span style=display:flex><span>help false
</span></span></code></pre></td></tr></table></div></div><p>到这里，flag 的快速入门就介绍完了。参数留在子命令的时候介绍。</p><h2 id=命令行风格>命令行风格</h2><p>由于一些历史原因，Unix 出现过很多不同的分支，命令行的风格也因此有很多标准，比如：</p><ul><li>Unix 风格，选项采用单 <code>-</code> 加一个字母，比如 <code>-v</code>，短选项就是它，优点是足够简洁;</li><li>BSD 风格，选项没有 <code>-</code>，没有任何的前缀，不知道有参数的情况怎么处理，没有研究;</li><li>GNU 风格，采用 <code>--</code>，如 <code>--version</code>，长选项，扩展性好，但是要多打几个字母;</li></ul><p>在网上找到一个搞笑漫画。</p><p><img src=https://cdn.jsdelivr.net/gh/poloxue/images@main/2019-11-23-commandline-tool-flag-in-golang-01.jpeg alt></p><p>查看系统进程有两种写法， <code>ps aux</code>（BSD 风格） 和 <code>ps -elf</code>（Unix 风格）。之前，我一直很郁闷为什么有这个区别。现在算是明白了。哈哈。</p><p>POSIX 的命令行风格算是取长补短的集合吧。什么是 POSIX 风格？可以查看这篇文档 <a href=http://www.gnu.org/software/libc/manual/html_node/Argument-Syntax.html>命令参数语法</a>。它同时提供了长短选项的标准。</p><p>要明白的是，标准终究只是标准，很多命令其实并不遵循它。但自己在设计命令行规范的时候，最好还是要有一套标准，而参考最统一的标准肯定是没错的。</p><h2 id=总结>总结</h2><p>本文介绍了 Go 中 flag 包的使用，一般的场景已经足够使用了。</p></div><nav class="hide-on-mobile section-nav"><nav id=TableOfContents><ol><li><a href=#概述>概述</a></li><li><a href=#目标案例>目标案例</a></li><li><a href=#选项表示>选项表示</a></li><li><a href=#更多类型>更多类型</a></li><li><a href=#长短选项>长短选项</a></li><li><a href=#命令行解析>命令行解析</a></li><li><a href=#使用命令>使用命令</a></li><li><a href=#命令行风格>命令行风格</a></li><li><a href=#总结>总结</a></li></ol></nav></nav></div><div class=post><hr class=footer-separator><div class=tags><ul class=flat><li class=tag-li><a href=/tags/golang>Golang</a></li></ul></div><div class=back><a href=https://www.poloxue.com/><span aria-hidden=true>← Back</span></a></div><div class=back></div></div></div><div class="footer wrapper"><nav class=nav><div>2019 Polo Xue All rights reserved</div></nav></div><script>feather.replace()</script><script>var enableTruncate=!0,filterDepth=!1;const MAX_DEPTH=9;window.addEventListener("DOMContentLoaded",()=>{const e=new IntersectionObserver(e=>{e.reverse().forEach(e=>{const n=e.target.getAttribute("id");if(e.intersectionRatio>0){var t=document.querySelectorAll(`nav li a[href="#${n}"]`);t!=null&&t.forEach(e=>{if(e!=null){var t=getDepth(e.parentElement);filterDepth&&t<=MAX_DEPTH&&(clearActiveStatesInTableOfContents(),e.parentElement.classList.add("active"))}else filterDepth||(clearActiveStatesInTableOfContents(),e.parentElement.classList.add("active"))})}})});document.querySelectorAll("h1[id],h2[id],h3[id],h4[id]").forEach(t=>{e.observe(t)})});function isVisible(e){if(!(e instanceof Element))return!1;const n=getComputedStyle(e);if(n.display==="none")return!1;if(n.visibility!=="visible")return!1;if(n.opacity<.1)return!1;if(e.offsetWidth+e.offsetHeight+e.getBoundingClientRect().height+e.getBoundingClientRect().width===0)return!1;const t={x:e.getBoundingClientRect().left+e.offsetWidth/2,y:e.getBoundingClientRect().top+e.offsetHeight/2};if(t.x<0)return!1;if(t.x>(document.documentElement.clientWidth||window.innerWidth))return!1;if(t.y<0)return!1;if(t.y>(document.documentElement.clientHeight||window.innerHeight))return!1;let s=document.elementFromPoint(t.x,t.y);do if(s===e)return!0;while(s=s.parentNode)return!1}function clearActiveStatesInTableOfContents(){document.querySelectorAll("nav li").forEach(e=>{e.classList.remove("active")})}function getDepth(e){for(var t=0;e!==null&&e.tagName.toLowerCase()!=="ul";)t++,e=e.parentElement;return t}function navItems(){var e=document.querySelectorAll("nav nav li a");return Array.from(e).filter(e=>e.href!=null&&e.hash.startsWith("#"))}function lasItemInNavBarVisible(){var e=navItems().slice(-1)[0];return isVisible(e)}document.addEventListener("DOMContentLoaded",function(){if(!enableTruncate)return;var e=navItems();console.log(e),lasItemInNavBarVisible()||(filterDepth=!0,e.forEach(function(e){var t=getDepth(e.parentElement);t>MAX_DEPTH&&e.parentElement.classList.add("depth-nested")}))})</script></body></html>