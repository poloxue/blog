<!doctype html><html><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><title>一个 Python 轻量级交易图表库 - lightweight-charts-python - 菠萝学量化</title><meta name=viewport content="width=device-width,initial-scale=1"><meta itemprop=name content="一个 Python 轻量级交易图表库 - lightweight-charts-python"><meta itemprop=description content="这两天发现一个可在 Python 显示交易图表的库，名为 lightweight-charts-python。顾名思义，它是基于 tradingview 轻量级库 lightweight-charts 开发而来。"><meta itemprop=datePublished content="2024-05-13T16:23:09+08:00"><meta itemprop=dateModified content="2024-05-13T16:23:09+08:00"><meta itemprop=wordCount content="552"><meta property="og:url" content="https://www.poloxue.com/posts/2024-05-10-lightweight-charts-python/"><meta property="og:site_name" content="菠萝学量化"><meta property="og:title" content="一个 Python 轻量级交易图表库 - lightweight-charts-python"><meta property="og:description" content="这两天发现一个可在 Python 显示交易图表的库，名为 lightweight-charts-python。顾名思义，它是基于 tradingview 轻量级库 lightweight-charts 开发而来。"><meta property="og:locale" content="zh_cn"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-05-13T16:23:09+08:00"><meta property="article:modified_time" content="2024-05-13T16:23:09+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="一个 Python 轻量级交易图表库 - lightweight-charts-python"><meta name=twitter:description content="这两天发现一个可在 Python 显示交易图表的库，名为 lightweight-charts-python。顾名思义，它是基于 tradingview 轻量级库 lightweight-charts 开发而来。"><script data-goatcounter=https://poloxue.goatcounter.com/count async src=//gc.zgo.at/count.js></script><link rel=stylesheet type=text/css media=screen href=https://www.poloxue.com/css/normalize.css><link rel=stylesheet type=text/css media=screen href=https://www.poloxue.com/css/main.css><link rel=stylesheet type=text/css media=screen href=https://www.poloxue.com/css/extra.css><link id=dark-scheme rel=stylesheet type=text/css href=https://www.poloxue.com/css/dark.css><script src=https://www.poloxue.com/js/feather.min.js></script><script src=https://www.poloxue.com/js/main.js></script><script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js></script><script>MathJax={tex:{displayMath:[["[","]"],["$$","$$"]],inlineMath:[["(",")"],["$","$"]]}}</script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7019080091542951" crossorigin=anonymous></script></head><body><div class="container-wide wrapper"><div class=header><div class=avatar><a href=https://www.poloxue.com/><img src=/avatar.png alt=菠萝学量化></a></div><h1 class=site-title><a href=https://www.poloxue.com/>菠萝学量化</a></h1><div class=site-description><nav class="nav social"><ul class=flat><li><a href=https://github.com/poloxue/ title=Github><i data-feather=github></i></a></li><li><a href=/posts/index.xml title=RSS><i data-feather=rss></i></a></li><li><a href=/ title=Wechat><i data-feather=message-circle></i></a></li><span class=scheme-toggle><a href=# id=scheme-toggle></a></ul></nav></div><nav class=nav><ul class=flat><li><a href=/>文章列表</a></li><li><a href=/about/about>关于我</a></li></ul></nav></div><div class=article-nav id=article-nav-id><div class=post><div class=post-header><div class=meta><div class=date><span class=day>13</span>
<span class=rest>May 2024</span></div></div><div class=matter><h1 class=title>一个 Python 轻量级交易图表库 - lightweight-charts-python</h1></div></div><aside class="show-on-mobile toc" id=static-toc><header><h3>Contents</h3></header><nav id=TableOfContents><ol><li><a href=#安装命令>安装命令</a></li><li><a href=#行情数据>行情数据</a></li><li><a href=#快速上手>快速上手</a></li><li><a href=#新增-bartick>新增 Bar/Tick</a></li><li><a href=#指标创建>指标创建</a></li><li><a href=#启用图例>启用图例</a></li><li><a href=#多图表支持>多图表支持</a></li><li><a href=#其他更多>其他更多</a></li></ol></nav></aside><p><img src=https://cdn.jsdelivr.net/gh/poloxue/images@2024-05/2024-05-10-lightweight-charts-python-01.png alt></p><p>今天这篇可能有点跨域了，其实这段时间，我一直在做交易。如果大家对自动化交易感兴趣，我也有很多内容可以写。</p><p>这两天发现一个可在 Python 显示交易图表的库，名为 lightweight-charts-python。顾名思义，它是基于 tradingview 轻量级库 lightweight-charts 开发而来。</p><p>TradingView 是一款非常流行的交易行情分析软件，而 lightweight-charts 是它提供的精简版 Js 开源库。因为 TradingView 本身就是一款专注交易的软件，lightweight-charts 有这高性能和用户体验友好的特点。</p><p><img src=https://cdn.jsdelivr.net/gh/poloxue/images@2024-05/2024-05-10-lightweight-charts-python-02.png alt></p><p>它的实现是 Python 通过 webview 集成 lightweight-charts 开发而来的库，使用 Python 的小伙伴无需学习 Javascript 也能使用 lightweight-charts 了。</p><p>通过 Python 实现，还有个优势，容易与其他框架结合，如国内非常流行的实盘框架 vnpy，它的 GUI 界面就是用 pyside6 实现，这个库非常容易集成到 pyside6 中，从而集成到 vnpy。</p><p>OK，让我们正式开始演示这个库的使用吧。</p><h2 id=安装命令>安装命令</h2><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pip install lightweight-charts
</span></span></code></pre></td></tr></table></div></div><h2 id=行情数据>行情数据</h2><p>为了体验 lightweight-charts-python 库的使用，提前准备行情数据必要的步骤。</p><p>lightweight-charts-python 的 GitHub 仓库中提供了一些样例数据，我们也可以从一些交易软件下载。不过，既然都来看这篇文章了，肯定都是会编程的，我推荐开源库获取数据。</p><p>我将用 tushare 下载行情数据，或者也可以用 akshare 等一些开源库。假设下载代码为 000001.SZ 的平安银行。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> tushare <span style=color:#66d9ef>as</span> ts
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>pro <span style=color:#f92672>=</span> ts<span style=color:#f92672>.</span>pro_api()
</span></span><span style=display:flex><span>code <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;000001.SZ&#34;</span>
</span></span><span style=display:flex><span>df <span style=color:#f92672>=</span> pro<span style=color:#f92672>.</span>query(<span style=color:#e6db74>&#34;daily&#34;</span>, ts_code<span style=color:#f92672>=</span>code, start_date<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;20180701&#34;</span>, end_date<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;20240510&#34;</span>)
</span></span></code></pre></td></tr></table></div></div><p>通过 pandas 将其整理为满足 lightweight-charts 目标的数据格式，即包含 date、open、high、low、close、volume 字段，还要保证 date 为日期格式，且数据按日期升序排列。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>df[<span style=color:#e6db74>&#34;date&#34;</span>] <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>to_datetime(df[<span style=color:#e6db74>&#34;trade_date&#34;</span>])
</span></span><span style=display:flex><span>df <span style=color:#f92672>=</span> df<span style=color:#f92672>.</span>sort_values(by<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;date&#34;</span>, ascending<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>)
</span></span><span style=display:flex><span>df<span style=color:#f92672>.</span>rename(columns<span style=color:#f92672>=</span>{<span style=color:#e6db74>&#34;vol&#34;</span>: <span style=color:#e6db74>&#34;volume&#34;</span>}, inplace<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>)
</span></span><span style=display:flex><span>df <span style=color:#f92672>=</span> df[[<span style=color:#e6db74>&#34;date&#34;</span>, <span style=color:#e6db74>&#34;open&#34;</span>, <span style=color:#e6db74>&#34;high&#34;</span>, <span style=color:#e6db74>&#34;low&#34;</span>, <span style=color:#e6db74>&#34;close&#34;</span>, <span style=color:#e6db74>&#34;volume&#34;</span>]]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>df<span style=color:#f92672>.</span>to_csv(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;D_</span><span style=color:#e6db74>{</span>code<span style=color:#e6db74>}</span><span style=color:#e6db74>.csv&#34;</span>)
</span></span></code></pre></td></tr></table></div></div><p>目录就有了名为 D_000001.SZ.csv 的行情数据文件。依次类推，还可下载周线和月线。分钟线数据好像需要更高积分才能下载。</p><h2 id=快速上手>快速上手</h2><p>首先，体验下它最基础使用方法，显示历史 K 线图表。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> time
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> pandas <span style=color:#66d9ef>as</span> pd
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> lightweight_charts <span style=color:#f92672>import</span> Chart
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>main</span>():
</span></span><span style=display:flex><span>  chart <span style=color:#f92672>=</span> Chart()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  df <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>read_csv(<span style=color:#e6db74>&#34;D_000001.SZ.csv&#34;</span>)
</span></span><span style=display:flex><span>  chart<span style=color:#f92672>.</span>set(df)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  chart<span style=color:#f92672>.</span>show(block<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;__main__&#34;</span>:
</span></span><span style=display:flex><span>  main()
</span></span></code></pre></td></tr></table></div></div><p>如上的代码中，<code>Chart</code> 是它的核心类，通过 pandas 的读取 csv 文件数据并将其 DataFrame 传递给 chart 即可完成历史行情的设置。</p><p>运行代码，你将能看到如下的效果：</p><p><img src=https://cdn.jsdelivr.net/gh/poloxue/images@2024-05/2024-05-10-lightweight-charts-python-03.png alt></p><h2 id=新增-bartick>新增 Bar/Tick</h2><p>如要实时的行情，我们可通过 <code>Chart</code> 提供的方法更新图表。它提供了两个方法，分别是 <code>update</code> 可用于更新 Bar 蜡烛图和 <code>update_from_tick</code> 从 tick 数据更新图表。</p><p>首先，演示新增 bar 更新图表。我们将之前准备的数据截断，<code>df.iloc[-10:]</code> 保留 10 个 bar 为演示数据。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>chart <span style=color:#f92672>=</span> Chart()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>df <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>read_csv(<span style=color:#e6db74>&#34;D_000001.SZ.csv&#34;</span>)
</span></span><span style=display:flex><span>chart<span style=color:#f92672>.</span>set(df<span style=color:#f92672>.</span>iloc[:<span style=color:#f92672>-</span><span style=color:#ae81ff>10</span>])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>chart<span style=color:#f92672>.</span>show()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> i, bar <span style=color:#f92672>in</span> df<span style=color:#f92672>.</span>iloc[<span style=color:#f92672>-</span><span style=color:#ae81ff>10</span>:]<span style=color:#f92672>.</span>iterrows():
</span></span><span style=display:flex><span>    chart<span style=color:#f92672>.</span>update(bar)
</span></span><span style=display:flex><span>    time<span style=color:#f92672>.</span>sleep(<span style=color:#ae81ff>1</span>)
</span></span></code></pre></td></tr></table></div></div><p>每隔 1 秒，新增 1 个 bar。动图效果如下：</p><p><img src=https://cdn.jsdelivr.net/gh/poloxue/images@2024-05/2024-05-10-lightweight-charts-python-04.gif alt></p><p>实际场景下，实时更新 tick 才是我们的目标。只要将实时 tick 不断投喂给 chart 即可。我暂时没有接入实时数据，将用随机模拟的方式生成后续数据。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>chart <span style=color:#f92672>=</span> Chart()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>df <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>read_csv(<span style=color:#e6db74>&#34;D_000001.SZ.csv&#34;</span>, parse_dates<span style=color:#f92672>=</span>[<span style=color:#e6db74>&#34;date&#34;</span>])
</span></span><span style=display:flex><span>chart<span style=color:#f92672>.</span>set(df)
</span></span><span style=display:flex><span>chart<span style=color:#f92672>.</span>show()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>last_time <span style=color:#f92672>=</span> df<span style=color:#f92672>.</span>iloc[<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>][<span style=color:#e6db74>&#34;date&#34;</span>] <span style=color:#f92672>+</span> datetime<span style=color:#f92672>.</span>timedelta(days<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>last_price <span style=color:#f92672>=</span> df<span style=color:#f92672>.</span>iloc[<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>][<span style=color:#e6db74>&#34;close&#34;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>while</span> <span style=color:#66d9ef>True</span>:
</span></span><span style=display:flex><span>    time<span style=color:#f92672>.</span>sleep(<span style=color:#ae81ff>0.1</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    change_percent <span style=color:#f92672>=</span> <span style=color:#ae81ff>0.002</span>
</span></span><span style=display:flex><span>    change <span style=color:#f92672>=</span> last_price <span style=color:#f92672>*</span> random<span style=color:#f92672>.</span>uniform(<span style=color:#f92672>-</span>change_percent, change_percent)
</span></span><span style=display:flex><span>    new_price <span style=color:#f92672>=</span> last_price <span style=color:#f92672>+</span> change
</span></span><span style=display:flex><span>    new_time <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>to_datetime(last_time) <span style=color:#f92672>+</span> datetime<span style=color:#f92672>.</span>timedelta(hours<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    tick <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>Series({<span style=color:#e6db74>&#34;time&#34;</span>: new_time, <span style=color:#e6db74>&#34;price&#34;</span>: new_price})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    chart<span style=color:#f92672>.</span>update_from_tick(tick)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    last_price <span style=color:#f92672>=</span> new_price
</span></span><span style=display:flex><span>    last_time <span style=color:#f92672>=</span> new_time
</span></span></code></pre></td></tr></table></div></div><p>随机数据基于最新的价格和时间生成，重点就是其中这一段代码：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>change_percent <span style=color:#f92672>=</span> <span style=color:#ae81ff>0.002</span>
</span></span><span style=display:flex><span>change <span style=color:#f92672>=</span> last_price <span style=color:#f92672>*</span> random<span style=color:#f92672>.</span>uniform(<span style=color:#f92672>-</span>change_percent, change_percent)
</span></span><span style=display:flex><span>new_price <span style=color:#f92672>=</span> last_price <span style=color:#f92672>+</span> change
</span></span><span style=display:flex><span>new_time <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>to_datetime(last_time) <span style=color:#f92672>+</span> datetime<span style=color:#f92672>.</span>timedelta(hours<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>)
</span></span></code></pre></td></tr></table></div></div><p>将其组织成 lightweight-charts 要求的 tick 数据格式传递给 chart 即可。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>tick <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>Series({<span style=color:#e6db74>&#34;time&#34;</span>: new_time, <span style=color:#e6db74>&#34;price&#34;</span>: new_price})
</span></span><span style=display:flex><span>chart<span style=color:#f92672>.</span>update_from_tick(tick)
</span></span></code></pre></td></tr></table></div></div><p>动图效果如下：</p><p><img src=https://cdn.jsdelivr.net/gh/poloxue/images@2024-05/2024-05-10-lightweight-charts-python-05.gif alt></p><h2 id=指标创建>指标创建</h2><p>指标 Indicator 是交易图表不可缺少的部分，用 lightweight-charts 要实现指标只要通过 chart 的方法 <code>create_line</code> 创建一条 line，设置 line 数据即可。如果你的指标不是线条，而是直方图，Chart 也提供了 <code>create_histogram</code>。</p><p>我就以简单移动平均作为演示吧。指标计算函数如下：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>sma</span>(df, period: int <span style=color:#f92672>=</span> <span style=color:#ae81ff>50</span>):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> pd<span style=color:#f92672>.</span>DataFrame(
</span></span><span style=display:flex><span>        {<span style=color:#e6db74>&#34;time&#34;</span>: df[<span style=color:#e6db74>&#34;date&#34;</span>], <span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;SMA </span><span style=color:#e6db74>{</span>period<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>: df[<span style=color:#e6db74>&#34;close&#34;</span>]<span style=color:#f92672>.</span>rolling(window<span style=color:#f92672>=</span>period)<span style=color:#f92672>.</span>mean()}
</span></span><span style=display:flex><span>    )<span style=color:#f92672>.</span>dropna()
</span></span></code></pre></td></tr></table></div></div><p>从如上的计算函数可知，提供给 line 的数据要求包含时间和指标值，而指标值的列名要和 Line 的名称相同。主函数中新增两行代码引入指标 Line：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># 保持与 sma 返回的 SMA {period} 相同</span>
</span></span><span style=display:flex><span>line <span style=color:#f92672>=</span> chart<span style=color:#f92672>.</span>create_line(<span style=color:#e6db74>&#34;SMA 30&#34;</span>)
</span></span><span style=display:flex><span>line<span style=color:#f92672>.</span>set(sma(df, period<span style=color:#f92672>=</span><span style=color:#ae81ff>30</span>))
</span></span></code></pre></td></tr></table></div></div><p>效果如下：</p><p><img src=https://cdn.jsdelivr.net/gh/poloxue/images@2024-05/2024-05-10-lightweight-charts-python-06.png alt></p><p>如果要实时更新的话，计算后续数值并通过 <code>line.update</code> 方法更新上去即可。</p><p>SMA 均线还是主图指标，如果希望在副图上显示指标，可通过 <code>chart.create_subchart</code> 创建副图，在其中显示副图指标。</p><p>核心代码如下所示：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>chart <span style=color:#f92672>=</span> Chart(inner_height<span style=color:#f92672>=</span><span style=color:#ae81ff>0.7</span>)
</span></span><span style=display:flex><span>chart<span style=color:#f92672>.</span>time_scale(visible<span style=color:#f92672>=</span><span style=color:#66d9ef>False</span>) <span style=color:#75715e># 将主图的时间轴隐藏</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 获取数据省略</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># sync 参数保持与主图同步</span>
</span></span><span style=display:flex><span>rsi_chart <span style=color:#f92672>=</span> chart<span style=color:#f92672>.</span>create_subchart(height<span style=color:#f92672>=</span><span style=color:#ae81ff>0.3</span>, width<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>, sync<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>)
</span></span><span style=display:flex><span>rsi_line <span style=color:#f92672>=</span> rsi_chart<span style=color:#f92672>.</span>create_line(<span style=color:#e6db74>&#34;RSI&#34;</span>)
</span></span><span style=display:flex><span>rsi_line<span style=color:#f92672>.</span>set(rsi(df))
</span></span></code></pre></td></tr></table></div></div><p>如下 rsi 计算函数部分，其中的 RSI 指标用的是 talib 实现。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>rsi</span>(df, period: int <span style=color:#f92672>=</span> <span style=color:#ae81ff>14</span>):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> pd<span style=color:#f92672>.</span>DataFrame(
</span></span><span style=display:flex><span>        {<span style=color:#e6db74>&#34;time&#34;</span>: df[<span style=color:#e6db74>&#34;date&#34;</span>], <span style=color:#e6db74>&#34;RSI&#34;</span>: talib<span style=color:#f92672>.</span>RSI(df[<span style=color:#e6db74>&#34;close&#34;</span>], timeperiod<span style=color:#f92672>=</span><span style=color:#ae81ff>14</span>)}
</span></span><span style=display:flex><span>    )
</span></span></code></pre></td></tr></table></div></div><p>效果如下：</p><p><img src=https://cdn.jsdelivr.net/gh/poloxue/images@2024-05/2024-05-10-lightweight-charts-python-08.png alt></p><h2 id=启用图例>启用图例</h2><p>我们已经添加了指标，但只看到线条，如想查看实际数值，通过 <code>chart.legend(True)</code> 启用图例即可。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>chart<span style=color:#f92672>.</span>legend(<span style=color:#66d9ef>True</span>) <span style=color:#75715e># 主图</span>
</span></span><span style=display:flex><span>rsi_chart<span style=color:#f92672>.</span>legend(<span style=color:#66d9ef>True</span>) <span style=color:#75715e># 副图</span>
</span></span></code></pre></td></tr></table></div></div><p>效果如下：</p><p><img src=https://cdn.jsdelivr.net/gh/poloxue/images@2024-05/2024-05-10-lightweight-charts-python-07-v2.png alt></p><h2 id=多图表支持>多图表支持</h2><p>前面通过 <code>create_subchart</code> 创建副图来展示副图指标，其实我们还可以基于它创建多图表。交易员可能要在不同的图表上展示不同周期或不同资产的行情，以便于寻找交易机会。</p><p>我将以在不同图表展示统一个资产的日线、周线和月线为例，演示它的使用。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>chart <span style=color:#f92672>=</span> Chart(inner_width<span style=color:#f92672>=</span><span style=color:#ae81ff>0.5</span>, inner_height<span style=color:#f92672>=</span><span style=color:#ae81ff>0.5</span>)
</span></span><span style=display:flex><span>weekly_chart <span style=color:#f92672>=</span> chart<span style=color:#f92672>.</span>create_subchart(width<span style=color:#f92672>=</span><span style=color:#ae81ff>0.5</span>, height<span style=color:#f92672>=</span><span style=color:#ae81ff>0.5</span>, sync<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>)
</span></span><span style=display:flex><span>monthly_chart <span style=color:#f92672>=</span> chart<span style=color:#f92672>.</span>create_subchart(width<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>, height<span style=color:#f92672>=</span><span style=color:#ae81ff>0.5</span>, sync<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>df <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>read_csv(<span style=color:#e6db74>&#34;D_000001.SZ.csv&#34;</span>)
</span></span><span style=display:flex><span>weekly_df <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>read_csv(<span style=color:#e6db74>&#34;W_000001.SZ.csv&#34;</span>)
</span></span><span style=display:flex><span>monthly_df <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>read_csv(<span style=color:#e6db74>&#34;M_000001.SZ.csv&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>chart<span style=color:#f92672>.</span>set(df)
</span></span><span style=display:flex><span>weekly_chart<span style=color:#f92672>.</span>set(weekly_df)
</span></span><span style=display:flex><span>monthly_chart<span style=color:#f92672>.</span>set(monthly_df)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>chart<span style=color:#f92672>.</span>show(block<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>)
</span></span></code></pre></td></tr></table></div></div><p>如上代码创建了三个周期的 chart，分别展示日线、周线和月线。其中的周线和月线图表都是基于日线 chart 创建的。它默认是按从左到右从上到下排列的，创建的时候注意设置 chart 的宽高即可。</p><p>最终效果如下：</p><p><img src=https://cdn.jsdelivr.net/gh/poloxue/images@2024-05/2024-05-10-lightweight-charts-python-09.png alt></p><p>我在测试时发现它的同步有点问题，好像只能在父子间同步,即在日线可以同步周线和月线，在周线或月线可以同步日线，但不能保持周线和月线的同步。或许要看 JS 库才能解决了吧?</p><h2 id=其他更多>其他更多</h2><p>更多内容就不一一展开了，如果大家有兴趣的话，可留言说明，我可以继续完成其他部分，如周期切换、按 symbol 搜索，指标选择自定义等等，甚至与实盘框架集成，实盘下单，如 vnpy 实盘框架，vnpy 作者自研了一个图表，但功能有限，lightweight-charts 也可直接与 PySide6 集成，集成到 vnpy 框架中。</p><p>有了这个库，我们可以做一些自己想要的能力，如手动回放回测、或者自动策略与手动相结合的回测，一切尽在掌握。毕竟，自己编程，才能丰衣足食。</p><div>本文来源于 <a href=https://www.poloxue.com>POLOXUE's BLOG</a>，地址： <a href=https://www.poloxue.com/posts/2024-05-10-lightweight-charts-python/>一个 Python 轻量级交易图表库 - lightweight-charts-python</a></div></div><nav class="hide-on-mobile section-nav"><nav id=TableOfContents><ol><li><a href=#安装命令>安装命令</a></li><li><a href=#行情数据>行情数据</a></li><li><a href=#快速上手>快速上手</a></li><li><a href=#新增-bartick>新增 Bar/Tick</a></li><li><a href=#指标创建>指标创建</a></li><li><a href=#启用图例>启用图例</a></li><li><a href=#多图表支持>多图表支持</a></li><li><a href=#其他更多>其他更多</a></li></ol></nav></nav></div><div class=post><hr class=footer-separator><div class=tags></div><div class=back><a href=https://www.poloxue.com/><span aria-hidden=true>← Back</span></a></div><div class=back></div></div><div class=post><img style=width:85% src=https://cdn.jsdelivr.net/gh/poloxue/images@main/wechat.png><div class=utterances></div><script src=https://utteranc.es/client.js repo=poloxue/blog issue-term=pathname theme=github-light crossorigin=anonymous async></script></div></div><div class="footer wrapper"><nav class=nav><div>2024 Polo Xue All rights reserved</div></nav></div><script>feather.replace()</script><script>var enableTruncate=!0,filterDepth=!1;const MAX_DEPTH=9;window.addEventListener("DOMContentLoaded",()=>{const e=new IntersectionObserver(e=>{e.reverse().forEach(e=>{const n=e.target.getAttribute("id");if(e.intersectionRatio>0){var t=document.querySelectorAll(`nav li a[href="#${n}"]`);t!=null&&t.forEach(e=>{if(e!=null){var t=getDepth(e.parentElement);filterDepth&&t<=MAX_DEPTH&&(clearActiveStatesInTableOfContents(),e.parentElement.classList.add("active"))}else filterDepth||(clearActiveStatesInTableOfContents(),e.parentElement.classList.add("active"))})}})});document.querySelectorAll("h1[id],h2[id],h3[id],h4[id]").forEach(t=>{e.observe(t)})});function isVisible(e){if(!(e instanceof Element))return!1;const n=getComputedStyle(e);if(n.display==="none")return!1;if(n.visibility!=="visible")return!1;if(n.opacity<.1)return!1;if(e.offsetWidth+e.offsetHeight+e.getBoundingClientRect().height+e.getBoundingClientRect().width===0)return!1;const t={x:e.getBoundingClientRect().left+e.offsetWidth/2,y:e.getBoundingClientRect().top+e.offsetHeight/2};if(t.x<0)return!1;if(t.x>(document.documentElement.clientWidth||window.innerWidth))return!1;if(t.y<0)return!1;if(t.y>(document.documentElement.clientHeight||window.innerHeight))return!1;let s=document.elementFromPoint(t.x,t.y);do if(s===e)return!0;while(s=s.parentNode)return!1}function clearActiveStatesInTableOfContents(){document.querySelectorAll("nav li").forEach(e=>{e.classList.remove("active")})}function getDepth(e){for(var t=0;e!==null&&e.tagName.toLowerCase()!=="ul";)t++,e=e.parentElement;return t}function navItems(){var e=document.querySelectorAll("nav nav li a");return Array.from(e).filter(e=>e.href!=null&&e.hash.startsWith("#"))}function lasItemInNavBarVisible(){var e=navItems().slice(-1)[0];return isVisible(e)}document.addEventListener("DOMContentLoaded",function(){if(!enableTruncate)return;var e=navItems();console.log(e),lasItemInNavBarVisible()||(filterDepth=!0,e.forEach(function(e){var t=getDepth(e.parentElement);t>MAX_DEPTH&&e.parentElement.classList.add("depth-nested")}))})</script></body></html>