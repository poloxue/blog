<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>Backtrader 教程二：安装与快速开始 - POLOXUE's BLOG</title><meta name=viewport content="width=device-width,initial-scale=1"><meta itemprop=name content="Backtrader 教程二：安装与快速开始"><meta itemprop=description content="本文将一步步完成 Backtrader 的安装，并通过两个简单策略——买入持有与均线交叉策略，带你快速熟悉 Backtrader 的结构与用法。
快速安装 Backtrader 的安装过程非常简单，即使你是刚接触 Python，也能快速搞定。
打开你的命令终端（比如 Windows 的 CMD 或 Mac 的终端），敲入这行代码：
1 pip install backtrader 输入 &ldquo;Enter&rdquo; 确认就能很快安装就完成。
简单例子 先通过一个最小化的可运行示例，模拟用历史数据加载苹果股票（AAPL），并通过 Backtrader 运行并画图。
这个例子不带任何交易策略，仅用于感受框架整体流程。
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 import backtrader as bt from datetime import datetime import yfinance as yf import pandas as pd # 使用 yfinance 下载苹果股票数据并转换为 Pandas DataFrame raw_data = yf."><meta itemprop=datePublished content="2025-07-05T10:02:36+08:00"><meta itemprop=dateModified content="2025-07-05T10:02:36+08:00"><meta itemprop=wordCount content="368"><meta itemprop=keywords content><meta property="og:title" content="Backtrader 教程二：安装与快速开始"><meta property="og:description" content="本文将一步步完成 Backtrader 的安装，并通过两个简单策略——买入持有与均线交叉策略，带你快速熟悉 Backtrader 的结构与用法。
快速安装 Backtrader 的安装过程非常简单，即使你是刚接触 Python，也能快速搞定。
打开你的命令终端（比如 Windows 的 CMD 或 Mac 的终端），敲入这行代码：
1 pip install backtrader 输入 &ldquo;Enter&rdquo; 确认就能很快安装就完成。
简单例子 先通过一个最小化的可运行示例，模拟用历史数据加载苹果股票（AAPL），并通过 Backtrader 运行并画图。
这个例子不带任何交易策略，仅用于感受框架整体流程。
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 import backtrader as bt from datetime import datetime import yfinance as yf import pandas as pd # 使用 yfinance 下载苹果股票数据并转换为 Pandas DataFrame raw_data = yf."><meta property="og:type" content="article"><meta property="og:url" content="https://www.poloxue.com/posts/2025-07-05-backtrader-tutorial-p2/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-07-05T10:02:36+08:00"><meta property="article:modified_time" content="2025-07-05T10:02:36+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Backtrader 教程二：安装与快速开始"><meta name=twitter:description content="本文将一步步完成 Backtrader 的安装，并通过两个简单策略——买入持有与均线交叉策略，带你快速熟悉 Backtrader 的结构与用法。
快速安装 Backtrader 的安装过程非常简单，即使你是刚接触 Python，也能快速搞定。
打开你的命令终端（比如 Windows 的 CMD 或 Mac 的终端），敲入这行代码：
1 pip install backtrader 输入 &ldquo;Enter&rdquo; 确认就能很快安装就完成。
简单例子 先通过一个最小化的可运行示例，模拟用历史数据加载苹果股票（AAPL），并通过 Backtrader 运行并画图。
这个例子不带任何交易策略，仅用于感受框架整体流程。
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 import backtrader as bt from datetime import datetime import yfinance as yf import pandas as pd # 使用 yfinance 下载苹果股票数据并转换为 Pandas DataFrame raw_data = yf."><script data-goatcounter=https://poloxue.goatcounter.com/count async src=//gc.zgo.at/count.js></script>
<link rel=stylesheet type=text/css media=screen href=https://www.poloxue.com/css/normalize.css><link rel=stylesheet type=text/css media=screen href=https://www.poloxue.com/css/main.css><link rel=stylesheet type=text/css media=screen href=https://www.poloxue.com/css/extra.css><link id=dark-scheme rel=stylesheet type=text/css href=https://www.poloxue.com/css/dark.css><script src=https://www.poloxue.com/js/feather.min.js></script>
<script src=https://www.poloxue.com/js/main.js></script>
<script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js></script>
<script>MathJax={tex:{displayMath:[["[","]"],["$$","$$"]],inlineMath:[["(",")"],["$","$"]]}}</script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7019080091542951" crossorigin=anonymous></script></head><body><div class="container wrapper"><div class=header><div class=avatar><a href=https://www.poloxue.com/><img src=/avatar.png alt="POLOXUE's BLOG"></a></div><h1 class=site-title><a href=https://www.poloxue.com/>POLOXUE's BLOG</a></h1><div class=site-description><nav class="nav social"><ul class=flat><li><a href=https://github.com/poloxue/ title=Github><i data-feather=github></i></a></li><li><a href=/posts/index.xml title=RSS><i data-feather=rss></i></a></li><li><a href=/ title=Wechat><i data-feather=message-circle></i></a></li><span class=scheme-toggle><a href=# id=scheme-toggle></a></ul></nav></div><nav class=nav><ul class=flat><li><a href=/>文章列表</a></li><li><a href=/tags>分类标签</a></li><li><a href=/about/about>关于我</a></li></ul></nav></div><div class=post><div class=post-header><div class=meta><div class=date><span class=day>05</span>
<span class=rest>Jul 2025</span></div></div><div class=matter><h1 class=title>Backtrader 教程二：安装与快速开始</h1></div></div><p>本文将一步步完成 Backtrader 的安装，并通过两个简单策略——买入持有与均线交叉策略，带你快速熟悉 Backtrader 的结构与用法。</p><h2 id=快速安装>快速安装</h2><p>Backtrader 的安装过程非常简单，即使你是刚接触 Python，也能快速搞定。</p><p>打开你的命令终端（比如 Windows 的 CMD 或 Mac 的终端），敲入这行代码：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pip install backtrader
</span></span></code></pre></td></tr></table></div></div><p>输入 &ldquo;Enter&rdquo; 确认就能很快安装就完成。</p><h2 id=简单例子>简单例子</h2><p>先通过一个最小化的可运行示例，模拟用历史数据加载苹果股票（AAPL），并通过 Backtrader 运行并画图。</p><p>这个例子不带任何交易策略，仅用于感受框架整体流程。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> backtrader <span style=color:#66d9ef>as</span> bt
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> datetime <span style=color:#f92672>import</span> datetime
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> yfinance <span style=color:#66d9ef>as</span> yf
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> pandas <span style=color:#66d9ef>as</span> pd
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 使用 yfinance 下载苹果股票数据并转换为 Pandas DataFrame</span>
</span></span><span style=display:flex><span>raw_data <span style=color:#f92672>=</span> yf<span style=color:#f92672>.</span>download(<span style=color:#e6db74>&#39;AAPL&#39;</span>, start<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;2020-01-01&#39;</span>, end<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;2021-01-01&#39;</span>, multi_level_index<span style=color:#f92672>=</span><span style=color:#66d9ef>False</span>)
</span></span><span style=display:flex><span>raw_data<span style=color:#f92672>.</span>reset_index(inplace<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 转换为 Backtrader 可识别的 Pandas 数据源</span>
</span></span><span style=display:flex><span>apple_data <span style=color:#f92672>=</span> bt<span style=color:#f92672>.</span>feeds<span style=color:#f92672>.</span>PandasData(dataname<span style=color:#f92672>=</span>raw_data)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cerebro <span style=color:#f92672>=</span> bt<span style=color:#f92672>.</span>Cerebro()
</span></span><span style=display:flex><span>cerebro<span style=color:#f92672>.</span>broker<span style=color:#f92672>.</span>setcash(<span style=color:#ae81ff>1e8</span>)
</span></span><span style=display:flex><span>cerebro<span style=color:#f92672>.</span>adddata(apple_data)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Initial portfolio value: </span><span style=color:#e6db74>{</span>cerebro<span style=color:#f92672>.</span>broker<span style=color:#f92672>.</span>getcash()<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>cerebro<span style=color:#f92672>.</span>run()
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Final portfolio value: </span><span style=color:#e6db74>{</span>cerebro<span style=color:#f92672>.</span>broker<span style=color:#f92672>.</span>getcash()<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cerebro<span style=color:#f92672>.</span>plot()
</span></span></code></pre></td></tr></table></div></div><p>这将生成一个图表，显示价格走势与策略执行情况，能让你第一时间看到回测结果。</p><p><img src=https://cdn.jsdelivr.net/gh/poloxue/images@2025-07/2025-07-05-backtrader-tutorial-p2-01.png alt></p><p>图表上的资产净值从开始就没有变化，因为这个例子中没有添加任何的策略。</p><p>简单介绍下这段代码吧。</p><ul><li>第一步，创建回测引擎并设置初始资金：</li></ul><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>cerebro <span style=color:#f92672>=</span> bt<span style=color:#f92672>.</span>Cerebro()
</span></span><span style=display:flex><span>cerebro<span style=color:#f92672>.</span>broker<span style=color:#f92672>.</span>setcash(<span style=color:#ae81ff>1e8</span>)
</span></span></code></pre></td></tr></table></div></div><p>cerebro 是整个大脑，负责管理策略逻辑、数据源、资金、回测过程等。</p><ul><li>第二步，加载数据，以 apple 股票数据为例：</li></ul><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>apple_data <span style=color:#f92672>=</span> bt<span style=color:#f92672>.</span>feeds<span style=color:#f92672>.</span>PandasData(dataname<span style=color:#f92672>=</span>raw_data)
</span></span><span style=display:flex><span>cerebro<span style=color:#f92672>.</span>adddata(apple_data)
</span></span></code></pre></td></tr></table></div></div><p>这里使用的是 yfinance 下载的 DataFrame 数据，并通过 <code>PandasData</code> 转为 Backtrader 所能识别的数据格式。</p><ul><li>第三步，执行回测：</li></ul><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>cerebro<span style=color:#f92672>.</span>run()
</span></span></code></pre></td></tr></table></div></div><p>Backtrader 会从头到尾执行策略逻辑，即使此时你没有写具体的交易逻辑，它也会完整遍历数据。</p><ul><li>最后一步画图展示：</li></ul><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>cerebro<span style=color:#f92672>.</span>plot()
</span></span></code></pre></td></tr></table></div></div><p>这个例子没有写一行策略代码就能跑起来，很适合初学者快速上手。</p><h2 id=买入持有策略>买入持有策略</h2><p>开始用 backtrader 回测一个最简单的策略：买入持有。</p><p>买入并持有是一个朴素的投资理念，很多人会说：“如果一直持有不卖，现在早赚翻了！”。尝试用 backtrader 的代码实现这个简单的投资逻辑。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>BuyHold</span>(bt<span style=color:#f92672>.</span>Strategy):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>next</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> self<span style=color:#f92672>.</span>position:
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>buy()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cerebro <span style=color:#f92672>=</span> bt<span style=color:#f92672>.</span>Cerebro()
</span></span><span style=display:flex><span>cerebro<span style=color:#f92672>.</span>addstrategy(BuyHold)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cerebro<span style=color:#f92672>.</span>adddata(apple_data)
</span></span><span style=display:flex><span>cerebro<span style=color:#f92672>.</span>broker<span style=color:#f92672>.</span>setcash(<span style=color:#ae81ff>100000</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Initial portfolio value: </span><span style=color:#e6db74>{</span>cerebro<span style=color:#f92672>.</span>broker<span style=color:#f92672>.</span>getcash()<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>cerebro<span style=color:#f92672>.</span>run()
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Final portfolio value: </span><span style=color:#e6db74>{</span>cerebro<span style=color:#f92672>.</span>broker<span style=color:#f92672>.</span>getcash()<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>cerebro<span style=color:#f92672>.</span>plot()
</span></span></code></pre></td></tr></table></div></div><p>输出：</p><p><img src=https://cdn.jsdelivr.net/gh/poloxue/images@2025-07/2025-07-05-backtrader-tutorial-p2-02.png alt></p><p>执行策略，就可以清楚看到，策略在第一个交易日买入股票后就再也没有新的动作，账户资金和股价变化基本保持一致。</p><p>理解三个点：</p><ul><li><p>第一，策略是通过 <code>cerebro.addstrategy()</code> 这句代码加载进回测引擎的，这就像是把你的交易逻辑交给“大脑”去执行；</p></li><li><p>第二，策略本身的逻辑是通过继承 <code>bt.Strategy</code> 并实现 <code>next()</code> 方法来定义的。</p><p>Backtrader 每处理一根 K 线数据，都会自动调用策略的 <code>next()</code> 方法。这个方法就像策略的“心跳”，交易逻辑都在这里。</p></li><li><p>第三，策略实现部分，通过 <code>self.position</code> 判断当前是否持仓，是最基础也最重要的条件判断语句之一。</p><p>当你写下 <code>if not self.position: self.buy()</code> 时，已经完成了一个完整的量化判断过程：检查当前是否有仓位，然后在满足条件时买入。</p></li></ul><p>这个代码整体既直观，又具备强大的扩展能力。接下来，再尝试实现一个更加复杂的策略吧！</p><h2 id=均线交叉策略>均线交叉策略</h2><p>在交易策略里，“金叉买入，死叉卖出”绝对是老生常谈。但真实情况如何呢？</p><p>通过 Backtrader 亲自测试下吧。</p><p>如下是均线交叉策略的实现：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SMACross</span>(bt<span style=color:#f92672>.</span>Strategy):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __init__(self):
</span></span><span style=display:flex><span>        <span style=color:#75715e># 初始化时定义两个均线指标：快速和慢速</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>fast_ma <span style=color:#f92672>=</span> bt<span style=color:#f92672>.</span>indicators<span style=color:#f92672>.</span>SMA(period<span style=color:#f92672>=</span><span style=color:#ae81ff>10</span>)
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>slow_ma <span style=color:#f92672>=</span> bt<span style=color:#f92672>.</span>indicators<span style=color:#f92672>.</span>SMA(period<span style=color:#f92672>=</span><span style=color:#ae81ff>30</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>next</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#75715e># 每根K线都会调用此方法，执行一次策略判断逻辑</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> self<span style=color:#f92672>.</span>position:
</span></span><span style=display:flex><span>            <span style=color:#75715e># 没持仓时，若发生金叉（快线由下向上穿过慢线），则买入</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> self<span style=color:#f92672>.</span>fast_ma[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>&gt;</span> self<span style=color:#f92672>.</span>slow_ma[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>and</span> self<span style=color:#f92672>.</span>fast_ma[<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>] <span style=color:#f92672>&lt;=</span> self<span style=color:#f92672>.</span>slow_ma[<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>]:
</span></span><span style=display:flex><span>                self<span style=color:#f92672>.</span>buy()
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>            <span style=color:#75715e># 已持仓时，若发生死叉（快线由上向下穿过慢线），则卖出</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> self<span style=color:#f92672>.</span>fast_ma[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>&lt;</span> self<span style=color:#f92672>.</span>slow_ma[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>and</span> self<span style=color:#f92672>.</span>fast_ma[<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>] <span style=color:#f92672>&gt;=</span> self<span style=color:#f92672>.</span>slow_ma[<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>]:
</span></span><span style=display:flex><span>                self<span style=color:#f92672>.</span>sell()
</span></span></code></pre></td></tr></table></div></div><p>输出：</p><p><img src=https://cdn.jsdelivr.net/gh/poloxue/images@2025-07/2025-07-05-backtrader-tutorial-p2-03.png alt></p><p>直观感受到“金叉买入，死叉卖出”的效果到底如何，收益和亏损都会清晰地展现了出来。</p><p>这个策略用 backtrader 内置技术指标 <code>bt.indicators.SMA</code> 计算移动平均线。</p><p>在 next() 方法中，通过判断当前与前一根K线的均线关系，识别出“金叉”与“死叉”信号。</p><p>如果想简化 <code>if</code> 金叉死叉的判断条件，还可以通过 <code>bt.ind</code> 的 <code>CrossUp</code> 和 <code>CrossDown</code> 计算是否发生了交叉。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>self<span style=color:#f92672>.</span>crossup <span style=color:#f92672>=</span> bt<span style=color:#f92672>.</span>ind<span style=color:#f92672>.</span>CrossUp(self<span style=color:#f92672>.</span>fast_ma, self<span style=color:#f92672>.</span>slow_ma)
</span></span><span style=display:flex><span>self<span style=color:#f92672>.</span>crossdown <span style=color:#f92672>=</span> bt<span style=color:#f92672>.</span>ind<span style=color:#f92672>.</span>CrossDown(self<span style=color:#f92672>.</span>fast_ma, self<span style=color:#f92672>.</span>slow_ma)
</span></span></code></pre></td></tr></table></div></div><p>买入条件就是：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>self<span style=color:#f92672>.</span>crossup[<span style=color:#ae81ff>0</span>]
</span></span></code></pre></td></tr></table></div></div><p>卖出条件就是：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>self<span style=color:#f92672>.</span>crossdown[<span style=color:#ae81ff>0</span>]
</span></span></code></pre></td></tr></table></div></div><p>Backtrader 指标系统简化了策略实现过程，提高了可读性稳定性。</p><p>现在只要将 <code>cerebro.addstrategy</code> 中 <code>BuyHold</code> 策略修改为 <code>SMACross</code> 即可用新策略回测了。</p><h2 id=六简单介绍分析指标>六、简单介绍分析指标</h2><p>在使用 Backtrader 时，你还可以轻松添加各种分析指标，比如年化收益率、夏普比率、最大回撤等。这些指标能帮你快速、清楚地评估策略表现，从而更科学地判断策略好坏。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>cerebro<span style=color:#f92672>.</span>addanalyzer(bt<span style=color:#f92672>.</span>analyzers<span style=color:#f92672>.</span>SharpeRatio, _name<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;sharpe&#39;</span>)
</span></span><span style=display:flex><span>results <span style=color:#f92672>=</span> cerebro<span style=color:#f92672>.</span>run()
</span></span><span style=display:flex><span>sharpe_ratio <span style=color:#f92672>=</span> results[<span style=color:#ae81ff>0</span>]<span style=color:#f92672>.</span>analyzers<span style=color:#f92672>.</span>sharpe<span style=color:#f92672>.</span>get_analysis()
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#34;夏普比率：&#34;</span>, sharpe_ratio)
</span></span></code></pre></td></tr></table></div></div><p>Backtrader 内置了大量分析工具可以直接调用。例如：</p><ul><li><code>DrawDown</code>：查看回撤表现，衡量风险暴露</li><li><code>Returns</code>：计算每日或周期收益率</li><li><code>TradeAnalyzer</code>：输出每一笔交易的盈亏、胜率等细节</li><li><code>SQN</code>：系统质量指数（System Quality Number），衡量策略整体表现</li><li><code>TimeReturn</code>：用于时间序列的收益计算</li></ul><p>这些分析器都可以像 Sharpe 一样通过 <code>addanalyzer()</code> 方法添加，并通过 <code>get_analysis()</code> 获取结果。</p><p>有了这些分析指标，你的交易评估会更加全面和精准。使用得当，它们能帮助你对策略进行多维度评价，辅助决策与优化。</p><h2 id=总结>总结</h2><p>本文从 Backtrader 的安装开始，带你跑通了最基础的回测流程。</p><p>从加载数据、创建回测引擎，到实现两个基础策略（买入持有与均线交叉），基本过了下 Backtrader 基本结构和用法。</p><p>此外，还初步接触了如何使用分析器评估策略表现。</p><p>希望这些内容能助你对 Backtrader 有了初步的认识，建立起对量化回测的整体感知。</p><div>本文来源于 <a href=https://www.poloxue.com>POLOXUE's BLOG</a>，地址： <a href=https://www.poloxue.com/posts/2025-07-05-backtrader-tutorial-p2/>Backtrader 教程二：安装与快速开始</a><hr class=footer-separator><div class=tags></div><div class=back><a href=https://www.poloxue.com/><span aria-hidden=true>← Back</span></a></div><div class=back></div></div><div class=post>欢迎关注我的公众号：<img style=width:85% src=https://cdn.jsdelivr.net/gh/poloxue/images@main/wechat.png></div></div><div class="footer wrapper"><nav class=nav><div>2025 Polo Xue All rights reserved</div></nav></div><script>feather.replace()</script></body></html>