<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>使用 Python 绘制 BTC 期权的波动率曲面 - POLOXUE's BLOG</title><meta name=viewport content="width=device-width,initial-scale=1"><meta itemprop=name content="使用 Python 绘制 BTC 期权的波动率曲面"><meta itemprop=description content="波动率曲面（Volatility Surface）是期权交易中展示隐含波动率随行权价（strike price）和到期时间（expiry time）变化的一种三维图形。"><meta itemprop=datePublished content="2024-09-21T11:20:44+08:00"><meta itemprop=dateModified content="2024-09-21T11:20:44+08:00"><meta itemprop=wordCount content="440"><meta itemprop=keywords content><meta property="og:title" content="使用 Python 绘制 BTC 期权的波动率曲面"><meta property="og:description" content="波动率曲面（Volatility Surface）是期权交易中展示隐含波动率随行权价（strike price）和到期时间（expiry time）变化的一种三维图形。"><meta property="og:type" content="article"><meta property="og:url" content="https://www.poloxue.com/posts/2024-09-16-plot-btc-iv-3d-surface/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-09-21T11:20:44+08:00"><meta property="article:modified_time" content="2024-09-21T11:20:44+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="使用 Python 绘制 BTC 期权的波动率曲面"><meta name=twitter:description content="波动率曲面（Volatility Surface）是期权交易中展示隐含波动率随行权价（strike price）和到期时间（expiry time）变化的一种三维图形。"><script data-goatcounter=https://poloxue.goatcounter.com/count async src=//gc.zgo.at/count.js></script>
<link rel=stylesheet type=text/css media=screen href=https://www.poloxue.com/css/normalize.css><link rel=stylesheet type=text/css media=screen href=https://www.poloxue.com/css/main.css><link rel=stylesheet type=text/css media=screen href=https://www.poloxue.com/css/extra.css><link id=dark-scheme rel=stylesheet type=text/css href=https://www.poloxue.com/css/dark.css><script src=https://www.poloxue.com/js/feather.min.js></script>
<script src=https://www.poloxue.com/js/main.js></script>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7019080091542951" crossorigin=anonymous></script></head><body><div class="container-wide wrapper"><div class=header><div class=avatar><a href=https://www.poloxue.com/><img src=/avatar.png alt="POLOXUE's BLOG"></a></div><h1 class=site-title><a href=https://www.poloxue.com/>POLOXUE's BLOG</a></h1><div class=site-description><nav class="nav social"><ul class=flat><li><a href=https://github.com/poloxue/ title=Github><i data-feather=github></i></a></li><li><a href=/posts/index.xml title=RSS><i data-feather=rss></i></a></li><li><a href=/ title=Wechat><i data-feather=message-circle></i></a></li><span class=scheme-toggle><a href=# id=scheme-toggle></a></ul></nav></div><nav class=nav><ul class=flat><li><a href=/>文章列表</a></li><li><a href=/tags>分类标签</a></li><li><a href=/about/>关于我</a></li></ul></nav></div><div class=article-nav id=article-nav-id><div class=post><div class=post-header><div class=meta><div class=date><span class=day>21</span>
<span class=rest>Sep 2024</span></div></div><div class=matter><h1 class=title>使用 Python 绘制 BTC 期权的波动率曲面</h1></div></div><aside class="show-on-mobile toc" id=static-toc><header><h3>Contents</h3></header><nav id=TableOfContents><ol><li><a href=#准备工作>准备工作</a></li><li><a href=#期权市场数据>期权市场数据</a></li><li><a href=#期权市场数据-1>期权市场数据</a></li><li><a href=#提取行权价和隐含波动率>提取行权价和隐含波动率</a></li><li><a href=#绘制波动率曲面>绘制波动率曲面</a></li><li><a href=#结语>结语</a></li></ol></nav></aside><p>波动率曲面（Volatility Surface）是期权交易中展示隐含波动率随行权价（strike price）和到期时间（expiry time）变化的一种三维图形。</p><p>本文尝试通过 Python，通过 ccxt 基于从交易所获取期权的指标数据绘制构建 BTC 波动率曲面。</p><h2 id=准备工作>准备工作</h2><p>首先，安装所需的库，确保环境可与交易所交互并绘制图表。</p><ul><li><code>ccxt</code>: 一个用于便于连接加密货币交易所的库。</li><li><code>pandas</code>: 用于数据处理，本文主要用于将 datetime 字符串转为 timestamp。</li><li><code>matplotlib</code>: 用于绘图。</li><li><code>mpl_toolkits.mplot3d</code>: 用于绘制三维图表。</li></ul><p>安装命令：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pip install ccxt matplotlib pandas
</span></span></code></pre></td></tr></table></div></div><h2 id=期权市场数据>期权市场数据</h2><p>通过 <code>ccxt</code> 库可以方便地获取加密货币交易所的期权数据。本例中，我们使用 ccxt 的 Bybit API 获取 BTC 期权的市场数据。</p><h2 id=期权市场数据-1>期权市场数据</h2><p>通过 ccxt 的 API <code>fetch_option_markets</code> 即可获取期权的市场数据。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> ccxt
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> collections <span style=color:#f92672>import</span> defaultdict
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 初始化ccxt并连接到Bybit交易所</span>
</span></span><span style=display:flex><span>bybit <span style=color:#f92672>=</span> ccxt<span style=color:#f92672>.</span>bybit(
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;options&#34;</span>: {<span style=color:#e6db74>&#34;loadAllOptions&#34;</span>: <span style=color:#66d9ef>True</span>}, <span style=color:#75715e># 获取所有的期权数据</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 获取BTC期权市场数据</span>
</span></span><span style=display:flex><span>option_markets <span style=color:#f92672>=</span> bybit<span style=color:#f92672>.</span>fetch_option_markets({<span style=color:#e6db74>&#34;baseCoin&#34;</span>: <span style=color:#e6db74>&#34;BTC&#34;</span>})
</span></span></code></pre></td></tr></table></div></div><p>通过在初始化交易所 API 实例时配置 <code>loadAllOptions</code> 和 <code>fetch_option_markets</code> 参数 <code>baseCoin</code> 为 <code>BTC</code> 指定获取所有 BTC 期权合约数据</p><p>输出 <code>option_markets</code> 中的数据查看下结构：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plain data-lang=plain><span style=display:flex><span>{&#39;id&#39;: &#39;BTC-20SEP24-70000-P&#39;, &#39;lowercaseId&#39;: None, &#39;symbol&#39;: &#39;BTC/USDC:USDC-240920-70000-P&#39;, &#39;base&#39;: &#39;BTC&#39;, &#39;quote&#39;: &#39;USDC&#39;, &#39;settle&#39;: &#39;USDC&#39;, &#39;baseId&#39;: &#39;BTC&#39;, &#39;quoteId&#39;: &#39;USDC&#39;, &#39;settleId&#39;: &#39;USDC&#39;, &#39;type&#39;: &#39;option&#39;, &#39;spot&#39;: False, &#39;margin&#39;: False, &#39;swap&#39;: False, &#39;future&#39;: False, &#39;option&#39;: True, &#39;index&#39;: None, &#39;active&#39;: True, &#39;contract&#39;: True, &#39;linear&#39;: None, &#39;inverse&#39;: None, &#39;subType&#39;: None, &#39;taker&#39;: 0.0006, &#39;maker&#39;: 0.0001, &#39;contractSize&#39;: 0.01, &#39;expiry&#39;: 1726819200000, &#39;expiryDatetime&#39;: &#39;2024-09-20T08:00:00.000Z&#39;, &#39;strike&#39;: 70000.0, &#39;optionType&#39;: &#39;put&#39;, &#39;precision&#39;: {&#39;amount&#39;: 0.01, &#39;price&#39;: 5.0}, &#39;limits&#39;: {&#39;leverage&#39;: {&#39;min&#39;: None, &#39;max&#39;: None}, &#39;amount&#39;: {&#39;min&#39;: 0.01, &#39;max&#39;: 500.0}, &#39;price&#39;: {&#39;min&#39;: 5.0, &#39;max&#39;: 10000000.0}, &#39;cost&#39;: {&#39;min&#39;: None, &#39;max&#39;: None}}, &#39;created&#39;: 1724918400000, &#39;info&#39;: {&#39;symbol&#39;: &#39;BTC-20SEP24-70000-P&#39;, &#39;status&#39;: &#39;Trading&#39;, &#39;baseCoin&#39;: &#39;BTC&#39;, &#39;quoteCoin&#39;: &#39;USDC&#39;, &#39;settleCoin&#39;: &#39;USDC&#39;, &#39;optionsType&#39;: &#39;Put&#39;, &#39;launchTime&#39;: &#39;1724918400000&#39;, &#39;deliveryTime&#39;: &#39;1726819200000&#39;, &#39;deliveryFeeRate&#39;: &#39;0.00015&#39;, &#39;priceFilter&#39;: {&#39;minPrice&#39;: &#39;5&#39;, &#39;maxPrice&#39;: &#39;10000000&#39;, &#39;tickSize&#39;: &#39;5&#39;}, &#39;lotSizeFilter&#39;: {&#39;maxOrderQty&#39;: &#39;500&#39;, &#39;minOrderQty&#39;: &#39;0.01&#39;, &#39;qtyStep&#39;: &#39;0.01&#39;}}}
</span></span></code></pre></td></tr></table></div></div><p>其中的 <code>strike</code> 为行权价，<code>optionType</code> 为期权类型（call 和 put），<code>expiryDatetime</code> 为到期时间。</p><p>为了分析，我要将期权按到期时间（<code>expiryDatetime</code>）排序，且只过滤看涨期权（call）和活跃中的期权合约。</p><p>将这部分数据提取出来，如下所示：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># 将期权按到期时间分类</span>
</span></span><span style=display:flex><span>expiry_option_markets <span style=color:#f92672>=</span> defaultdict(list)
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> option_market <span style=color:#f92672>in</span> option_markets:
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> option_market[<span style=color:#e6db74>&#34;active&#34;</span>] <span style=color:#f92672>and</span> option_market[<span style=color:#e6db74>&#34;optionType&#34;</span>] <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;call&#34;</span>:
</span></span><span style=display:flex><span>        expiry_option_markets[option_market[<span style=color:#e6db74>&#34;expiryDatetime&#34;</span>]]<span style=color:#f92672>.</span>append(option_market)
</span></span></code></pre></td></tr></table></div></div><h2 id=提取行权价和隐含波动率>提取行权价和隐含波动率</h2><p>将数据按到期时间排序，确保后续的其他的数据按到期日期顺序排列。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># 先对到期时间进行排序</span>
</span></span><span style=display:flex><span>sorted_expiry_dates <span style=color:#f92672>=</span> sorted(
</span></span><span style=display:flex><span>    expiry_option_markets<span style=color:#f92672>.</span>keys(), key<span style=color:#f92672>=</span><span style=color:#66d9ef>lambda</span> d: pd<span style=color:#f92672>.</span>to_datetime(d)<span style=color:#f92672>.</span>timestamp()
</span></span><span style=display:flex><span>)
</span></span></code></pre></td></tr></table></div></div><p>接下来就是从期权市场数据中提取出行权价（<code>strike</code>）和隐含波动率（<code>implied volatility</code>）。</p><p>隐含波动率通常是由交易所计算并提供的，我们通过 <code>fetch_greeks</code> 提取交易所的数据，不自己计算。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># 行权价和隐含波动率数据的存储</span>
</span></span><span style=display:flex><span>strike_prices <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>expiry_times <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>implied_vols <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 遍历每个到期时间，收集行权价和隐含波动率</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> expiry_date <span style=color:#f92672>in</span> sorted_expiry_dates:
</span></span><span style=display:flex><span>    option_markets <span style=color:#f92672>=</span> expiry_option_markets[expiry_date]
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> option_market <span style=color:#f92672>in</span> option_markets:
</span></span><span style=display:flex><span>        greeks <span style=color:#f92672>=</span> bybit<span style=color:#f92672>.</span>fetch_greeks(symbol<span style=color:#f92672>=</span>option_market[<span style=color:#e6db74>&#34;id&#34;</span>])  <span style=color:#75715e># 获取希腊字母和波动率</span>
</span></span><span style=display:flex><span>        strike_price <span style=color:#f92672>=</span> option_market[<span style=color:#e6db74>&#34;strike&#34;</span>]
</span></span><span style=display:flex><span>        implied_volatility <span style=color:#f92672>=</span> greeks[<span style=color:#e6db74>&#34;markImpliedVolatility&#34;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># 将数据添加到列表中</span>
</span></span><span style=display:flex><span>        strike_prices<span style=color:#f92672>.</span>append(strike_price)
</span></span><span style=display:flex><span>        expiry_times<span style=color:#f92672>.</span>append(pd<span style=color:#f92672>.</span>to_datetime(expiry_date)<span style=color:#f92672>.</span>timestamp())  <span style=color:#75715e># 转为时间戳</span>
</span></span><span style=display:flex><span>        implied_vols<span style=color:#f92672>.</span>append(implied_volatility)
</span></span></code></pre></td></tr></table></div></div><p>这个步骤中，通过 Bybit 的 API 获取了每个期权的隐含波动率（标记价格的隐含波动率），存储起来便于绘图。</p><p>如果有获取希腊字母的需求，如 delta、gamma、theta、vega 等，这个接口中也有相应的字段，可自行查看。</p><p>现在我们有了行权价-<code>strikes</code>，到期日期 <code>expiry_times</code> 和对应的隐含波动率 <code>implied_vols</code>。</p><h2 id=绘制波动率曲面>绘制波动率曲面</h2><p>数据准备就绪后，我们使用 <code>matplotlib</code> 库绘制三维波动率曲面图。这张图的三维轴分别表示行权价（X轴）、到期时间（Y轴）和隐含波动率（Z轴）。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> numpy <span style=color:#66d9ef>as</span> np
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> pandas <span style=color:#66d9ef>as</span> pd
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> matplotlib.pyplot <span style=color:#66d9ef>as</span> plt
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> mpl_toolkits.mplot3d <span style=color:#f92672>import</span> Axes3D
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 创建图形</span>
</span></span><span style=display:flex><span>fig <span style=color:#f92672>=</span> plt<span style=color:#f92672>.</span>figure(figsize<span style=color:#f92672>=</span>(<span style=color:#ae81ff>12</span>, <span style=color:#ae81ff>8</span>))
</span></span><span style=display:flex><span>ax <span style=color:#f92672>=</span> fig<span style=color:#f92672>.</span>add_subplot(<span style=color:#ae81ff>111</span>, projection<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;3d&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 绘制三维曲面</span>
</span></span><span style=display:flex><span>surf <span style=color:#f92672>=</span> ax<span style=color:#f92672>.</span>plot_trisurf(strike_prices, expiry_times, implied_vols, cmap<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;viridis&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 设置坐标轴标签</span>
</span></span><span style=display:flex><span>ax<span style=color:#f92672>.</span>set_xlabel(<span style=color:#e6db74>&#34;Strike Price&#34;</span>)
</span></span><span style=display:flex><span>ax<span style=color:#f92672>.</span>set_ylabel(<span style=color:#e6db74>&#34;Expiry Time&#34;</span>)
</span></span><span style=display:flex><span>ax<span style=color:#f92672>.</span>set_zlabel(<span style=color:#e6db74>&#34;Implied Volatility&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 设置标题</span>
</span></span><span style=display:flex><span>ax<span style=color:#f92672>.</span>set_title(<span style=color:#e6db74>&#34;Implied Volatility Surface&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 显示图形</span>
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>show()
</span></span></code></pre></td></tr></table></div></div><p>如下所示:</p><p><img src=https://cdn.jsdelivr.net/gh/poloxue/images@2024-09/2024-09-18-plot-btc-iv-3d-surface-02.png alt></p><p>看着有点怪怪的，没发现问题，应该是对的吧。</p><p>解释：</p><ul><li><strong>X 轴（行权价）</strong>: 期权的行权价格。它决定了期权持有者是否会在到期时行使期权。</li><li><strong>Y 轴（到期时间）</strong>: 期权的到期时间，通常表示为 UNIX 时间戳。</li><li><strong>Z 轴（隐含波动率）</strong>: 隐含波动率反映了市场对于标的资产未来波动的预期。</li></ul><p><code>plot_trisurf</code> 函数通过三角剖分来绘制不规则网格的数据点，使得我们能够直观地观察隐含波动率随行权价和到期时间的变化。</p><h2 id=结语>结语</h2><p>本文介绍了如何使用 Python 获取交易所 BTC 期权数据，并通过隐含波动率绘制波动率曲面。</p><p>我还在不断学习中，希望这篇文章对你有用！</p><div>本文来源于 <a href=https://www.poloxue.com>POLOXUE's BLOG</a>，地址： <a href=https://www.poloxue.com/posts/2024-09-16-plot-btc-iv-3d-surface/>使用 Python 绘制 BTC 期权的波动率曲面</a></div></div><nav class="hide-on-mobile section-nav"><nav id=TableOfContents><ol><li><a href=#准备工作>准备工作</a></li><li><a href=#期权市场数据>期权市场数据</a></li><li><a href=#期权市场数据-1>期权市场数据</a></li><li><a href=#提取行权价和隐含波动率>提取行权价和隐含波动率</a></li><li><a href=#绘制波动率曲面>绘制波动率曲面</a></li><li><a href=#结语>结语</a></li></ol></nav></nav></div><div class=post><hr class=footer-separator><div class=tags></div><div class=back><a href=https://www.poloxue.com/><span aria-hidden=true>← Back</span></a></div><div class=back></div></div><div class=post><img style=width:85% src=https://cdn.jsdelivr.net/gh/poloxue/images@main/wechat.png><div class=utterances></div><script src=https://utteranc.es/client.js repo=poloxue/blog issue-term=pathname theme=github-light crossorigin=anonymous async></script></div></div><div class="footer wrapper"><nav class=nav><div>2024 Polo Xue All rights reserved</div></nav></div><script>feather.replace()</script><script>var enableTruncate=!0,filterDepth=!1;const MAX_DEPTH=9;window.addEventListener("DOMContentLoaded",()=>{const e=new IntersectionObserver(e=>{e.reverse().forEach(e=>{const n=e.target.getAttribute("id");if(e.intersectionRatio>0){var t=document.querySelectorAll(`nav li a[href="#${n}"]`);t!=null&&t.forEach(e=>{if(e!=null){var t=getDepth(e.parentElement);filterDepth&&t<=MAX_DEPTH&&(clearActiveStatesInTableOfContents(),e.parentElement.classList.add("active"))}else filterDepth||(clearActiveStatesInTableOfContents(),e.parentElement.classList.add("active"))})}})});document.querySelectorAll("h1[id],h2[id],h3[id],h4[id]").forEach(t=>{e.observe(t)})});function isVisible(e){if(!(e instanceof Element))return!1;const n=getComputedStyle(e);if(n.display==="none")return!1;if(n.visibility!=="visible")return!1;if(n.opacity<.1)return!1;if(e.offsetWidth+e.offsetHeight+e.getBoundingClientRect().height+e.getBoundingClientRect().width===0)return!1;const t={x:e.getBoundingClientRect().left+e.offsetWidth/2,y:e.getBoundingClientRect().top+e.offsetHeight/2};if(t.x<0)return!1;if(t.x>(document.documentElement.clientWidth||window.innerWidth))return!1;if(t.y<0)return!1;if(t.y>(document.documentElement.clientHeight||window.innerHeight))return!1;let s=document.elementFromPoint(t.x,t.y);do if(s===e)return!0;while(s=s.parentNode)return!1}function clearActiveStatesInTableOfContents(){document.querySelectorAll("nav li").forEach(e=>{e.classList.remove("active")})}function getDepth(e){for(var t=0;e!==null&&e.tagName.toLowerCase()!=="ul";)t++,e=e.parentElement;return t}function navItems(){var e=document.querySelectorAll("nav nav li a");return Array.from(e).filter(e=>e.href!=null&&e.hash.startsWith("#"))}function lasItemInNavBarVisible(){var e=navItems().slice(-1)[0];return isVisible(e)}document.addEventListener("DOMContentLoaded",function(){if(!enableTruncate)return;var e=navItems();console.log(e),lasItemInNavBarVisible()||(filterDepth=!0,e.forEach(function(e){var t=getDepth(e.parentElement);t>MAX_DEPTH&&e.parentElement.classList.add("depth-nested")}))})</script></body></html>