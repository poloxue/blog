<!doctype html><html><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><title>如何通过 Python 获取加密货币的历史实时行情 - POLOXUE's BLOG</title><meta name=viewport content="width=device-width,initial-scale=1"><meta itemprop=name content="如何通过 Python 获取加密货币的历史实时行情"><meta itemprop=description content="如果你想参与加密货币市场，获取实时、准确的市场数据就是重要的第一步。"><meta itemprop=datePublished content="2025-02-10T15:08:29+08:00"><meta itemprop=dateModified content="2025-02-10T15:08:29+08:00"><meta itemprop=wordCount content="604"><meta property="og:url" content="https://www.poloxue.com/posts/2025-02-10-crypto-currency-market-data-using-ccxt/"><meta property="og:site_name" content="POLOXUE's BLOG"><meta property="og:title" content="如何通过 Python 获取加密货币的历史实时行情"><meta property="og:description" content="如果你想参与加密货币市场，获取实时、准确的市场数据就是重要的第一步。"><meta property="og:locale" content="zh_cn"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-02-10T15:08:29+08:00"><meta property="article:modified_time" content="2025-02-10T15:08:29+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="如何通过 Python 获取加密货币的历史实时行情"><meta name=twitter:description content="如果你想参与加密货币市场，获取实时、准确的市场数据就是重要的第一步。"><script data-goatcounter=https://poloxue.goatcounter.com/count async src=//gc.zgo.at/count.js></script><link rel=stylesheet type=text/css media=screen href=https://www.poloxue.com/css/normalize.css><link rel=stylesheet type=text/css media=screen href=https://www.poloxue.com/css/main.css><link rel=stylesheet type=text/css media=screen href=https://www.poloxue.com/css/extra.css><link id=dark-scheme rel=stylesheet type=text/css href=https://www.poloxue.com/css/dark.css><script src=https://www.poloxue.com/js/feather.min.js></script><script src=https://www.poloxue.com/js/main.js></script><script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js></script><script>MathJax={tex:{displayMath:[["[","]"],["$$","$$"]],inlineMath:[["(",")"],["$","$"]]}}</script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7019080091542951" crossorigin=anonymous></script></head><body><div class="container-wide wrapper"><div class=header><div class=avatar><a href=https://www.poloxue.com/><img src=/avatar.png alt="POLOXUE's BLOG"></a></div><h1 class=site-title><a href=https://www.poloxue.com/>POLOXUE's BLOG</a></h1><div class=site-description><nav class="nav social"><ul class=flat><li><a href=https://github.com/poloxue/ title=Github><i data-feather=github></i></a></li><li><a href=/posts/index.xml title=RSS><i data-feather=rss></i></a></li><li><a href=/ title=Wechat><i data-feather=message-circle></i></a></li><span class=scheme-toggle><a href=# id=scheme-toggle></a></ul></nav></div><nav class=nav><ul class=flat><li><a href=/>文章列表</a></li><li><a href=/tags>分类标签</a></li><li><a href=/about/about>关于我</a></li></ul></nav></div><div class=article-nav id=article-nav-id><div class=post><div class=post-header><div class=meta><div class=date><span class=day>10</span>
<span class=rest>Feb 2025</span></div></div><div class=matter><h1 class=title>如何通过 Python 获取加密货币的历史实时行情</h1></div></div><aside class="show-on-mobile toc" id=static-toc><header><h3>Contents</h3></header><nav id=TableOfContents><ol><li><a href=#概要说明>概要说明</a></li><li><a href=#什么是-ccxt>什么是 ccxt</a></li><li><a href=#安装-ccxt>安装 ccxt</a></li><li><a href=#初始化交易所>初始化交易所</a></li><li><a href=#实时价格>实时价格</a></li><li><a href=#历史行情>历史行情</a></li><li><a href=#订单簿市场深度>订单簿（市场深度）</a></li><li><a href=#实时监听>实时监听</a></li><li><a href=#总结>总结</a></li></ol></nav></aside><p>如果你想参与加密货币市场，获取实时、准确的市场数据就是重要的第一步。</p><p>不同于传统金融市场，加密货币市场上的交易所有两类，分别 DEX 和 CEX，即中心化交易所和去中心化交易所。两者的区别这里就不展开了，我们大部分人接触的一般都是中心化交易所。和传统金融市场一样，加密货币市场上的数据，我们也可找专业的数据提供商，但基本都是付费的。</p><p>本文将介绍如何通过 Python 从中心化交易所拿到行情数据，包括历史和实时数据，包括直接从 websocket 监控数据，可用来实时监听不对交易对间的价差数据。</p><h2 id=概要说明>概要说明</h2><p>从去中心化交易所拿到交易所数据，可直接通过访问它的 HTTP 和 Websocket 接口，如欧易 OKX 的接口，查看它的官方文档：<a href=https://www.okx.com/docs-v5/zh/>欧易 API 文档</a>，其他每个交易所也都有这类文档，可查看其支持的 API 接口。</p><p>不过市面上的中心化交易所很多，而且如果要获取账户级别的信息，还有经过认证流程。本文为了简化流程，覆盖更多的去中心化交易所，我会使用一个非常流行的 Python 库 ccxt 演示，从而把重点集中在数据的获取方法上。</p><h2 id=什么是-ccxt>什么是 ccxt</h2><p>ccxt，全称 CryptoCurrency eXchange Trading，这个开源库能让你用统一的代码访问全球上百家数字货币交易所。它支持多个编程语言，如 Javascript、Python 和 PHP。</p><p>ccxt，除了可用来获取数据，还可以支持直接下单、订单管理、访问仓位、账户等，用来实现一个自动化交易人。</p><hr><p>接下来开始正文吧！</p><p>本文将从最简单的价格获取到复杂的订单簿处理，带你一步步深入。</p><h2 id=安装-ccxt>安装 ccxt</h2><p>打开终端，输入如下命令，安装 ccxt 库：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pip install ccxt
</span></span></code></pre></td></tr></table></div></div><h2 id=初始化交易所>初始化交易所</h2><p>以币安为例，先创建一个交易所对象：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> ccxt
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>exchange <span style=color:#f92672>=</span> ccxt<span style=color:#f92672>.</span>binance({
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;enableRateLimit&#39;</span>: <span style=color:#66d9ef>True</span>,  <span style=color:#75715e># 必须开启！防止被交易所封IP</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;timeout&#39;</span>: <span style=color:#ae81ff>15000</span>          <span style=color:#75715e># 超时设为15秒</span>
</span></span><span style=display:flex><span>})
</span></span></code></pre></td></tr></table></div></div><p>交易所的API都有严格的调用频率限制，<code>enableRateLimit</code> 会启用频率限制能力，防止触发交易所的 API 调用频率。</p><p>如果遇到网络问题，也可通过设置 <code>proxies</code> 切换网络环境：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>exchange <span style=color:#f92672>=</span> ccxt<span style=color:#f92672>.</span>okx({
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;proxies&#34;</span>: {
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;http&#34;</span>: <span style=color:#e6db74>&#34;http://127.0.0.1:7890&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;https&#34;</span>: <span style=color:#e6db74>&#34;http://127.0.0.1:7890&#34;</span>,
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>})
</span></span></code></pre></td></tr></table></div></div><p>获取交易所上的所有品种：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>markets <span style=color:#f92672>=</span> exchange<span style=color:#f92672>.</span>load_markets()
</span></span><span style=display:flex><span>print(list(markets<span style=color:#f92672>.</span>keys)[:<span style=color:#ae81ff>10</span>])
</span></span></code></pre></td></tr></table></div></div><p>输出如下：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span><span style=color:#e6db74>&#39;ETH/BTC&#39;</span>, <span style=color:#e6db74>&#39;LTC/BTC&#39;</span>, <span style=color:#e6db74>&#39;BNB/BTC&#39;</span>, <span style=color:#e6db74>&#39;NEO/BTC&#39;</span>, <span style=color:#e6db74>&#39;QTUM/ETH&#39;</span>, <span style=color:#e6db74>&#39;EOS/ETH&#39;</span>, <span style=color:#e6db74>&#39;SNT/ETH&#39;</span>, <span style=color:#e6db74>&#39;BNT/ETH&#39;</span>, <span style=color:#e6db74>&#39;BCC/BTC&#39;</span>, <span style=color:#e6db74>&#39;GAS/BTC&#39;</span><span style=color:#f92672>]</span>
</span></span></code></pre></td></tr></table></div></div><p>在开始其他操作前，这一步是必要的，否则你可能会遇到品种不存在的问题。</p><hr><h2 id=实时价格>实时价格</h2><p>首先，示例如何通过 ccxt 获取某个品种当前的价格，主要依赖于 <code>fetch_ticker</code> 函数接口。</p><p>示例代码，读取 <code>BTC/USDT</code> 交易对的最新价。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>ticker <span style=color:#f92672>=</span> exchange<span style=color:#f92672>.</span>fetch_ticker(<span style=color:#e6db74>&#39;BTC/USDT&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>实时价格：
</span></span></span><span style=display:flex><span><span style=color:#e6db74>- 最新价：</span><span style=color:#e6db74>{</span>ticker[<span style=color:#e6db74>&#39;last&#39;</span>]<span style=color:#e6db74>}</span><span style=color:#e6db74> USDT
</span></span></span><span style=display:flex><span><span style=color:#e6db74>- 24小时最高：</span><span style=color:#e6db74>{</span>ticker[<span style=color:#e6db74>&#39;high&#39;</span>]<span style=color:#e6db74>}</span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>- 24小时成交量：</span><span style=color:#e6db74>{</span>ticker[<span style=color:#e6db74>&#39;quoteVolume&#39;</span>]<span style=color:#e6db74>}</span><span style=color:#e6db74> USDT
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&#34;&#34;&#34;</span>)
</span></span></code></pre></td></tr></table></div></div><p>输出：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>实时价格：
</span></span><span style=display:flex><span>- 最新价：97004.87 USDT
</span></span><span style=display:flex><span>- 24小时最高：97640.02
</span></span><span style=display:flex><span>- 24小时成交量：1743212485.2952676 USDT
</span></span></code></pre></td></tr></table></div></div><p>ticker 的结构体可查看官方文档 <a href="https://docs.ccxt.com/#/README?id=ticker-structure">Ticker Structure</a>。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>{{</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;symbol&#39;</span>:        string 类型，表示市场的交易对（例如：<span style=color:#e6db74>&#39;BTC/USD&#39;</span>, <span style=color:#e6db74>&#39;ETH/BTC&#39;</span> 等），
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;info&#39;</span>:          原始未修改的交易所 API 回复信息（未经解析的原始数据），
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;timestamp&#39;</span>:     integer 类型，64 位 Unix 时间戳，单位为毫秒，自 <span style=color:#ae81ff>1970</span> 年 <span style=color:#ae81ff>1</span> 月 <span style=color:#ae81ff>1</span> 日起，
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;datetime&#39;</span>:      ISO8601 格式的日期时间字符串（带毫秒），
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;high&#39;</span>:          float 类型，市场的最高价格，
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;low&#39;</span>:           float 类型，市场的最低价格，
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;bid&#39;</span>:           float 类型，当前最佳买入价，
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;bidVolume&#39;</span>:     float 类型，当前最佳买入量（可能缺失或未定义），
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;ask&#39;</span>:           float 类型，当前最佳卖出价，
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;askVolume&#39;</span>:     float 类型，当前最佳卖出量（可能缺失或未定义），
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;vwap&#39;</span>:          float 类型，加权平均价格，
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;open&#39;</span>:          float 类型，开盘价，
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;close&#39;</span>:         float 类型，最后交易价格（当前周期的收盘价），
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;last&#39;</span>:          float 类型，等同于 <span style=color:#e6db74>`</span>close<span style=color:#e6db74>`</span>，为方便重复表示，
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;previousClose&#39;</span>: float 类型，上一个周期的收盘价，
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;change&#39;</span>:        float 类型，绝对变化，<span style=color:#e6db74>`</span>last - open<span style=color:#e6db74>`</span>，
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;percentage&#39;</span>:    float 类型，相对变化，<span style=color:#e6db74>`</span><span style=color:#f92672>(</span>change/open<span style=color:#f92672>)</span> * 100<span style=color:#e6db74>`</span>，
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;average&#39;</span>:       float 类型，平均价格，<span style=color:#e6db74>`</span><span style=color:#f92672>(</span>last + open<span style=color:#f92672>)</span> / 2<span style=color:#e6db74>`</span>，
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;baseVolume&#39;</span>:    float 类型，过去 <span style=color:#ae81ff>24</span> 小时内交易的基础货币的交易量，
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;quoteVolume&#39;</span>:   float 类型，过去 <span style=color:#ae81ff>24</span> 小时内交易的报价货币的交易量，
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></td></tr></table></div></div><p>简言之，<code>fetch_ticker</code> 返回的是某个交易对的当前最新的市场数据。</p><hr><h2 id=历史行情>历史行情</h2><p>除了最新行情，历史行情对于交易也非常有帮助，如我们用它来计算指标，识别模式，产生交易信号。</p><p>如下是获取 <code>BTC/USDT</code> 的日线数据的代码：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># 获取最近3天的日线数据</span>
</span></span><span style=display:flex><span>ohlcvs <span style=color:#f92672>=</span> exchange<span style=color:#f92672>.</span>fetch_ohlcv(
</span></span><span style=display:flex><span>    symbol<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;BTC/USDT&#39;</span>,
</span></span><span style=display:flex><span>    timeframe<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;1d&#39;</span>,  <span style=color:#75715e># 可选：1m, 5m, 1h, 1d 等</span>
</span></span><span style=display:flex><span>    limit<span style=color:#f92672>=</span><span style=color:#ae81ff>5</span>          <span style=color:#75715e># 获取条数</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>print(ohlcvs)
</span></span></code></pre></td></tr></table></div></div><p>参数设置获取 <code>BTC/USDT</code> 的历史行情，时间周期为 <code>1d</code>，数量为 5。</p><p>输出：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[[</span>1739138760000, 94897.63, 95052.0, 94884.44, 95047.09, 17.96677<span style=color:#f92672>]</span>,
</span></span><span style=display:flex><span> <span style=color:#f92672>[</span>1739138820000, 95047.1, 95128.75, 95047.1, 95118.36, 12.27411<span style=color:#f92672>]</span>, 
</span></span><span style=display:flex><span> <span style=color:#f92672>[</span>1739138880000, 95118.36, 95135.99, 95051.65, 95122.51, 10.40116<span style=color:#f92672>]</span>,
</span></span><span style=display:flex><span> <span style=color:#f92672>[</span>1739138940000, 95122.52, 95178.69, 95104.42, 95178.57, 7.81859<span style=color:#f92672>]</span>,
</span></span><span style=display:flex><span> <span style=color:#f92672>[</span>1739139000000, 95178.57, 95246.13, 95160.0, 95246.13, 48.00226<span style=color:#f92672>]]</span>
</span></span></code></pre></td></tr></table></div></div><p>列表中的每个元素依然是一个列表，从左到右分别是时间戳、开盘价、最高价、最低价、收盘价和交易量。</p><p>可以将其转为更加易读的 pandas 格式，如下所示；</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>data <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>DataFrame(ohlcvs, columns<span style=color:#f92672>=</span>[<span style=color:#e6db74>&#34;timestamp_ms&#34;</span>, <span style=color:#e6db74>&#34;open&#34;</span>, <span style=color:#e6db74>&#34;high&#34;</span>, <span style=color:#e6db74>&#34;low&#34;</span>, <span style=color:#e6db74>&#34;close&#34;</span>, <span style=color:#e6db74>&#34;volume&#34;</span>])
</span></span><span style=display:flex><span>print(data)
</span></span></code></pre></td></tr></table></div></div><p>输出：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>    timestamp_ms      open      high       low     close    volume
</span></span><span style=display:flex><span><span style=color:#ae81ff>0</span>  <span style=color:#ae81ff>1739139000000</span>  95178.57  95246.13  95160.00  95246.13  48.00226
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span>  <span style=color:#ae81ff>1739139060000</span>  95246.12  95436.12  95230.02  95429.63  24.59766
</span></span><span style=display:flex><span><span style=color:#ae81ff>2</span>  <span style=color:#ae81ff>1739139120000</span>  95429.64  95429.64  95282.44  95371.00  44.81550
</span></span><span style=display:flex><span><span style=color:#ae81ff>3</span>  <span style=color:#ae81ff>1739139180000</span>  95371.00  95443.28  95371.00  95433.12  12.77712
</span></span><span style=display:flex><span><span style=color:#ae81ff>4</span>  <span style=color:#ae81ff>1739139240000</span>  95433.12  95527.79  95433.12  95436.70  15.98278
</span></span></code></pre></td></tr></table></div></div><p>如果想设计一个高频策略，可能还要拿到分钟级别数据，很多交易所都支持拿到分钟级别数据，甚至是全量的分钟数据。</p><p>假设，获取 <code>BTC/USDT</code> 的 1 分钟数据，只需修改 <code>fetch_ohlcv</code> 的 <code>timeframe</code> 参数即可。</p><p>示例代码:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># 获取最近20根15分钟K线</span>
</span></span><span style=display:flex><span>ohlcvs <span style=color:#f92672>=</span> exchange<span style=color:#f92672>.</span>fetch_ohlcv(<span style=color:#e6db74>&#39;BTC/USDT&#39;</span>, <span style=color:#e6db74>&#39;1m&#39;</span>, limit<span style=color:#f92672>=</span><span style=color:#ae81ff>20</span>)
</span></span></code></pre></td></tr></table></div></div><h2 id=订单簿市场深度>订单簿（市场深度）</h2><p>除了行情数据，如果你拿到订单薄数据，ccxt 也可以做到，只要调用 <code>fetch_order_book</code> 即可。</p><p>一个简单示例：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>order_book <span style=color:#f92672>=</span> exchange<span style=color:#f92672>.</span>fetch_order_book(<span style=color:#e6db74>&#39;BTC/USDT&#39;</span>, limit<span style=color:#f92672>=</span><span style=color:#ae81ff>100</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>best_bid <span style=color:#f92672>=</span> order_book[<span style=color:#e6db74>&#39;bids&#39;</span>][<span style=color:#ae81ff>0</span>][<span style=color:#ae81ff>0</span>]  <span style=color:#75715e># 买一价</span>
</span></span><span style=display:flex><span>best_ask <span style=color:#f92672>=</span> order_book[<span style=color:#e6db74>&#39;asks&#39;</span>][<span style=color:#ae81ff>0</span>][<span style=color:#ae81ff>0</span>]  <span style=color:#75715e># 卖一价</span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;买一价：</span><span style=color:#e6db74>{</span>best_bid<span style=color:#e6db74>}</span><span style=color:#e6db74>, 卖一价：</span><span style=color:#e6db74>{</span>best_ask<span style=color:#e6db74>}</span><span style=color:#e6db74>, 价差：</span><span style=color:#e6db74>{</span>best_ask <span style=color:#f92672>-</span> best_bid<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span></code></pre></td></tr></table></div></div><p>输出：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>买一价：97141.35, 卖一价：97141.36, 价差：0.00999999999476131
</span></span></code></pre></td></tr></table></div></div><p>其中，<code>fetch_order_book</code> 可用于指定获取深度，像 <code>binance</code> 的接口默认是 100，而最多可以获取到 5000 的订单薄深度。</p><h2 id=实时监听>实时监听</h2><p>前面介绍完的几种数据接口，都是我们主动发起请求，对于一些实时性要求非常高的场景，轮询延迟大，丢掉一些交易机会，且可能触发交易所的频率限制。ccxt 还提供了一个 pro 版本 <code>ccxt.pro</code>，可直接通过 WebSocket 实时监听。</p><p>前面的接口，我们简单修改下，就可以实现实时监听的效果。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> asyncio
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> ccxt.pro <span style=color:#66d9ef>as</span> ccxtpro
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>exchange <span style=color:#f92672>=</span> ccxtpro<span style=color:#f92672>.</span>binance({
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;enableRateLimit&#39;</span>: <span style=color:#66d9ef>True</span>,  <span style=color:#75715e># 必须开启！防止被交易所封IP</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;timeout&#39;</span>: <span style=color:#ae81ff>15000</span>,         <span style=color:#75715e># 超时设为15秒</span>
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>async</span> <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>watch_order_book</span>():
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>while</span> <span style=color:#66d9ef>True</span>:
</span></span><span style=display:flex><span>        order_book <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> exchange<span style=color:#f92672>.</span>watch_order_book(<span style=color:#e6db74>&#39;BTC/USDT&#39;</span>)
</span></span><span style=display:flex><span>        best_ask <span style=color:#f92672>=</span> order_book[<span style=color:#e6db74>&#34;asks&#34;</span>][<span style=color:#ae81ff>0</span>][<span style=color:#ae81ff>0</span>]
</span></span><span style=display:flex><span>        best_bid <span style=color:#f92672>=</span> order_book[<span style=color:#e6db74>&#34;bids&#34;</span>][<span style=color:#ae81ff>0</span>][<span style=color:#ae81ff>0</span>]
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;order_book, 价差:</span><span style=color:#e6db74>{</span>best_ask<span style=color:#f92672>-</span>best_bid<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>async</span> <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>watch_ticker</span>():
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>while</span> <span style=color:#66d9ef>True</span>:
</span></span><span style=display:flex><span>        ticker <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> exchange<span style=color:#f92672>.</span>watch_ticker(<span style=color:#e6db74>&#39;BTC/USDT&#39;</span>)
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;ticker, 最新价: </span><span style=color:#e6db74>{</span>ticker[<span style=color:#e6db74>&#39;last&#39;</span>]<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>async</span> <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>main</span>():
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>await</span> asyncio<span style=color:#f92672>.</span>gather(watch_order_book(), watch_ticker())
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;__main__&#34;</span>:
</span></span><span style=display:flex><span>    asyncio<span style=color:#f92672>.</span>run(main())
</span></span></code></pre></td></tr></table></div></div><p>输出：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>order_book, 价差:0.00999999999476131
</span></span><span style=display:flex><span>order_book, 价差:0.00999999999476131
</span></span><span style=display:flex><span>order_book, 价差:0.00999999999476131
</span></span><span style=display:flex><span>order_book, 价差:0.00999999999476131
</span></span><span style=display:flex><span>order_book, 价差:0.00999999999476131
</span></span><span style=display:flex><span>order_book, 价差:0.00999999999476131
</span></span><span style=display:flex><span>order_book, 价差:0.00999999999476131
</span></span><span style=display:flex><span>order_book, 价差:0.00999999999476131
</span></span><span style=display:flex><span>ticker, 最新价: 97228.01
</span></span><span style=display:flex><span>...
</span></span></code></pre></td></tr></table></div></div><p>现在就能实时监控，不断输出新的数据。</p><hr><h2 id=总结>总结</h2><p>现在，就已经掌握了如何利用 ccxt 获取市场行情，接下来可以：</p><ol start=2><li><strong>监控价差</strong>：实时计算不同交易对或交易所间的套利机会；</li><li><strong>对接交易</strong>：用ccxt的 <code>create_order</code> 方法实现自动交易；</li></ol><p>最后，希望本文对你有所帮助，感谢阅读。</p><div>本文来源于 <a href=https://www.poloxue.com>POLOXUE's BLOG</a>，地址： <a href=https://www.poloxue.com/posts/2025-02-10-crypto-currency-market-data-using-ccxt/>如何通过 Python 获取加密货币的历史实时行情</a></div></div><nav class="hide-on-mobile section-nav"><nav id=TableOfContents><ol><li><a href=#概要说明>概要说明</a></li><li><a href=#什么是-ccxt>什么是 ccxt</a></li><li><a href=#安装-ccxt>安装 ccxt</a></li><li><a href=#初始化交易所>初始化交易所</a></li><li><a href=#实时价格>实时价格</a></li><li><a href=#历史行情>历史行情</a></li><li><a href=#订单簿市场深度>订单簿（市场深度）</a></li><li><a href=#实时监听>实时监听</a></li><li><a href=#总结>总结</a></li></ol></nav></nav></div><div class=post><hr class=footer-separator><div class=tags></div><div class=back><a href=https://www.poloxue.com/><span aria-hidden=true>← Back</span></a></div><div class=back></div></div><div class=post><img style=width:85% src=https://cdn.jsdelivr.net/gh/poloxue/images@main/wechat.png><div class=utterances></div><script src=https://utteranc.es/client.js repo=poloxue/blog issue-term=pathname theme=github-light crossorigin=anonymous async></script></div></div><div class="footer wrapper"><nav class=nav><div>2025 Polo Xue All rights reserved</div></nav></div><script>feather.replace()</script><script>var enableTruncate=!0,filterDepth=!1;const MAX_DEPTH=9;window.addEventListener("DOMContentLoaded",()=>{const e=new IntersectionObserver(e=>{e.reverse().forEach(e=>{const n=e.target.getAttribute("id");if(e.intersectionRatio>0){var t=document.querySelectorAll(`nav li a[href="#${n}"]`);t!=null&&t.forEach(e=>{if(e!=null){var t=getDepth(e.parentElement);filterDepth&&t<=MAX_DEPTH&&(clearActiveStatesInTableOfContents(),e.parentElement.classList.add("active"))}else filterDepth||(clearActiveStatesInTableOfContents(),e.parentElement.classList.add("active"))})}})});document.querySelectorAll("h1[id],h2[id],h3[id],h4[id]").forEach(t=>{e.observe(t)})});function isVisible(e){if(!(e instanceof Element))return!1;const n=getComputedStyle(e);if(n.display==="none")return!1;if(n.visibility!=="visible")return!1;if(n.opacity<.1)return!1;if(e.offsetWidth+e.offsetHeight+e.getBoundingClientRect().height+e.getBoundingClientRect().width===0)return!1;const t={x:e.getBoundingClientRect().left+e.offsetWidth/2,y:e.getBoundingClientRect().top+e.offsetHeight/2};if(t.x<0)return!1;if(t.x>(document.documentElement.clientWidth||window.innerWidth))return!1;if(t.y<0)return!1;if(t.y>(document.documentElement.clientHeight||window.innerHeight))return!1;let s=document.elementFromPoint(t.x,t.y);do if(s===e)return!0;while(s=s.parentNode)return!1}function clearActiveStatesInTableOfContents(){document.querySelectorAll("nav li").forEach(e=>{e.classList.remove("active")})}function getDepth(e){for(var t=0;e!==null&&e.tagName.toLowerCase()!=="ul";)t++,e=e.parentElement;return t}function navItems(){var e=document.querySelectorAll("nav nav li a");return Array.from(e).filter(e=>e.href!=null&&e.hash.startsWith("#"))}function lasItemInNavBarVisible(){var e=navItems().slice(-1)[0];return isVisible(e)}document.addEventListener("DOMContentLoaded",function(){if(!enableTruncate)return;var e=navItems();console.log(e),lasItemInNavBarVisible()||(filterDepth=!0,e.forEach(function(e){var t=getDepth(e.parentElement);t>MAX_DEPTH&&e.parentElement.classList.add("depth-nested")}))})</script></body></html>