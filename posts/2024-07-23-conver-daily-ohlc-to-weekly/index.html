<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>如何通过 Python 将日线行情转为周线 - POLOXUE's BLOG</title><meta name=viewport content="width=device-width,initial-scale=1"><meta itemprop=name content="如何通过 Python 将日线行情转为周线"><meta itemprop=description content="将低周期的蜡烛图转换为长周期蜡烛图是一种常见的需求，如分钟线到小时线、日线到周线，这可以帮我们更好分析图表和产生信号。"><meta itemprop=datePublished content="2024-07-23T17:06:52+08:00"><meta itemprop=dateModified content="2024-07-23T17:06:52+08:00"><meta itemprop=wordCount content="306"><meta itemprop=keywords content><meta property="og:title" content="如何通过 Python 将日线行情转为周线"><meta property="og:description" content="将低周期的蜡烛图转换为长周期蜡烛图是一种常见的需求，如分钟线到小时线、日线到周线，这可以帮我们更好分析图表和产生信号。"><meta property="og:type" content="article"><meta property="og:url" content="https://www.poloxue.com/posts/2024-07-23-conver-daily-ohlc-to-weekly/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-07-23T17:06:52+08:00"><meta property="article:modified_time" content="2024-07-23T17:06:52+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="如何通过 Python 将日线行情转为周线"><meta name=twitter:description content="将低周期的蜡烛图转换为长周期蜡烛图是一种常见的需求，如分钟线到小时线、日线到周线，这可以帮我们更好分析图表和产生信号。"><script data-goatcounter=https://poloxue.goatcounter.com/count async src=//gc.zgo.at/count.js></script>
<link rel=stylesheet type=text/css media=screen href=https://www.poloxue.com/css/normalize.css><link rel=stylesheet type=text/css media=screen href=https://www.poloxue.com/css/main.css><link rel=stylesheet type=text/css media=screen href=https://www.poloxue.com/css/extra.css><link id=dark-scheme rel=stylesheet type=text/css href=https://www.poloxue.com/css/dark.css><script src=https://www.poloxue.com/js/feather.min.js></script>
<script src=https://www.poloxue.com/js/main.js></script>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7019080091542951" crossorigin=anonymous></script></head><body><div class="container wrapper"><div class=header><div class=avatar><a href=https://www.poloxue.com/><img src=/avatar.png alt="POLOXUE's BLOG"></a></div><h1 class=site-title><a href=https://www.poloxue.com/>POLOXUE's BLOG</a></h1><div class=site-description><nav class="nav social"><ul class=flat><li><a href=https://github.com/poloxue/ title=Github><i data-feather=github></i></a></li><li><a href=/posts/index.xml title=RSS><i data-feather=rss></i></a></li><li><a href=/ title=Wechat><i data-feather=message-circle></i></a></li><span class=scheme-toggle><a href=# id=scheme-toggle></a></ul></nav></div><nav class=nav><ul class=flat><li><a href=/>首页</a></li><li><a href=/posts>文章列表</a></li><li><a href=/tags>分类标签</a></li><li><a href=/about/>关于我</a></li></ul></nav></div><div class=post><div class=post-header><div class=meta><div class=date><span class=day>23</span>
<span class=rest>Jul 2024</span></div></div><div class=matter><h1 class=title>如何通过 Python 将日线行情转为周线</h1></div></div><p>将低周期的蜡烛图转换为长周期蜡烛图是一种常见的需求，如分钟线到小时线、日线到周线，这可以帮我们更好观察和分析图表。或许，你用的行情图表软件或数据提供商都会提供多周期的数据。</p><p>今天，我将介绍如何通过 Python 实现这个需求，以日线转为周线为例。</p><h2 id=基础思路>基础思路</h2><p>蜡烛图可以按不同时间周期，如分钟、小时、日、周和月。在转换前，先了解下蜡烛图的基本结构。</p><p>每根蜡烛表示一个时间段内的价格信息，包含四个关键数据：</p><ul><li>开盘价（Open）：该时间段的第一个交易价格。</li><li>收盘价（Close）：该时间段的最后一个交易价格。</li><li>最高价（High）：该时间段内的最高交易价格。</li><li>最低价（Low）：该时间段内的最低交易价格。</li></ul><p>如何将日线数据转换为周线数据？我们只要按每周的数据重新计算开盘价、收盘价、最高价和最低价即可。</p><p>规则如下：</p><ul><li>开盘价（Open）：每周的开盘价是该周第一个交易日的开盘价。</li><li>收盘价（Close）：每周的收盘价是该周最后一个交易日的收盘价。</li><li>最高价（High）：每周的最高价是该周所有交易日中的最高价。</li><li>最低价（Low）：每周的最低价是该周所有交易日中的最低价。</li></ul><p>有了基本思路，现在让我们来实现吧。我将通过 Python 的数据处理库 pandas 实现这个需求。</p><h2 id=转换为周线数据>转换为周线数据</h2><p>我直接用 tushare 下载南华期货指数的日线数据，这个数据 tushare 上没有提供周线行情。</p><p>南华连玉米指数行情下载，如下所示：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> tushare <span style=color:#66d9ef>as</span> ts
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>pro <span style=color:#f92672>=</span> ts<span style=color:#f92672>.</span>pro_api()
</span></span><span style=display:flex><span>df <span style=color:#f92672>=</span> pro<span style=color:#f92672>.</span>index_daily(<span style=color:#e6db74>&#34;C.NH&#34;</span>)
</span></span></code></pre></td></tr></table></div></div><p>使用 Python 的 Pandas 库即可轻松实现这一转换。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> pandas <span style=color:#66d9ef>as</span> pd
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 将日期列转换为日期时间类型</span>
</span></span><span style=display:flex><span>df[<span style=color:#e6db74>&#39;trade_date&#39;</span>] <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>to_datetime(df[<span style=color:#e6db74>&#39;trade_date&#39;</span>])
</span></span><span style=display:flex><span>df<span style=color:#f92672>.</span>sort_values(by<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;trade_date&#39;</span>, inplace<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 设置日期列为索引</span>
</span></span><span style=display:flex><span>df<span style=color:#f92672>.</span>set_index(<span style=color:#e6db74>&#39;trade_date&#39;</span>, inplace<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 使用resample和agg方法将日线数据转换为周线数据</span>
</span></span><span style=display:flex><span>weekly_data <span style=color:#f92672>=</span> df<span style=color:#f92672>.</span>resample(<span style=color:#e6db74>&#39;W&#39;</span>)<span style=color:#f92672>.</span>agg({
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;open&#39;</span>: <span style=color:#e6db74>&#39;first&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;high&#39;</span>: <span style=color:#e6db74>&#39;max&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;low&#39;</span>: <span style=color:#e6db74>&#39;min&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;close&#39;</span>: <span style=color:#e6db74>&#39;last&#39;</span>
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(weekly_data)
</span></span></code></pre></td></tr></table></div></div><p>如上使用了<code>resample</code> 函数用于将日线数据转换为周线数据。通过设置日期索引，并使用<code>resample('W')</code>对数据重新采样，然后应用聚合函数计算每周的开盘价、收盘价、最高价和最低价，即 first、max、min 和 last。</p><p>输出：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>                 open       high        low      close
</span></span><span style=display:flex><span>trade_date
</span></span><span style=display:flex><span>2004-09-26  1000.0000  1005.9423   988.9644  1000.8489
</span></span><span style=display:flex><span>2004-10-03   997.4533  1005.0934   953.5251   960.9874
</span></span><span style=display:flex><span>2004-10-10   960.3217   974.2795   948.2662   967.8320
</span></span><span style=display:flex><span>2004-10-17   966.4796   983.7452   958.8617   963.4444
</span></span><span style=display:flex><span>2004-10-24   966.8278   979.5159   958.3692   962.5985
</span></span><span style=display:flex><span>...               ...        ...        ...        ...
</span></span><span style=display:flex><span>2024-06-30  1385.0649  1416.5437  1383.9407  1410.3604
</span></span><span style=display:flex><span>2024-07-07  1408.6740  1410.9225  1386.1892  1387.8755
</span></span><span style=display:flex><span>2024-07-14  1387.8755  1390.6861  1350.7756  1351.3377
</span></span><span style=display:flex><span>2024-07-21  1353.5862  1356.9589  1329.9771  1346.2786
</span></span><span style=display:flex><span>2024-07-28  1347.9650  1356.9589  1346.2786  1352.4619
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span><span style=color:#ae81ff>1036</span> rows x <span style=color:#ae81ff>4</span> columns<span style=color:#f92672>]</span>
</span></span></code></pre></td></tr></table></div></div><p>注意一点，周线的索引日期是周期的最后一天，如果不放心，可检查下最近的数据。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>print(df<span style=color:#f92672>.</span>iloc[<span style=color:#f92672>-</span><span style=color:#ae81ff>8</span>:])
</span></span></code></pre></td></tr></table></div></div><p>输出：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>         ts_code      close       open       high        low  pre_close   change  pct_chg       vol     amount
</span></span><span style=display:flex><span>trade_date
</span></span><span style=display:flex><span>2024-07-11    C.NH  1356.3968  1360.3316  1364.2665  1355.2725  1360.3316  -3.9348  -0.0029  529092.0  1380710.0
</span></span><span style=display:flex><span>2024-07-12    C.NH  1351.3377  1356.3968  1362.5801  1350.7756  1356.3968  -5.0591  -0.0037  554975.0  1394776.0
</span></span><span style=display:flex><span>2024-07-15    C.NH  1340.0953  1353.5862  1356.9589  1335.5983  1351.3377 -11.2424  -0.0083  841183.0  1409114.0
</span></span><span style=display:flex><span>2024-07-16    C.NH  1338.4089  1340.0953  1342.3438  1329.9771  1340.0953  -1.6864  -0.0013  626912.0  1442453.0
</span></span><span style=display:flex><span>2024-07-17    C.NH  1342.3438  1337.2847  1345.7165  1337.2847  1338.4089   3.9349   0.0029  665443.0  1445703.0
</span></span><span style=display:flex><span>2024-07-18    C.NH  1345.7165  1342.9059  1346.8407  1337.2847  1342.3438   3.3727   0.0025  487530.0  1456021.0
</span></span><span style=display:flex><span>2024-07-19    C.NH  1346.2786  1347.4029  1349.0892  1339.5332  1345.7165   0.5621   0.0004  452499.0  1478614.0
</span></span><span style=display:flex><span>2024-07-22    C.NH  1352.4619  1347.9650  1356.9589  1346.2786  1346.2786   6.1833   0.0046  545743.0  1459278.0
</span></span></code></pre></td></tr></table></div></div><p>现在就顺利得到了周线数据。</p><p>这些周线数据可以帮助我们分析市场、产生信号，做出更明智的交易决策。</p><h2 id=结论>结论</h2><p>通过 Python 数据处理库 pandas 的 resample 函数可以容易地将日线数据转换为周线。</p><p>希望这篇博文对你有用，助你更好地理解和实现不同周期数据的转化。</p><hr class=footer-separator><div class=tags></div><div class=back><a href=https://www.poloxue.com/><span aria-hidden=true>← Back</span></a></div><div class=back></div></div><div class=post>欢迎关注我的公众号：<img style=width:85% src=https://cdn.jsdelivr.net/gh/poloxue/images@main/wechat.png><div class=utterances></div><script src=https://utteranc.es/client.js repo=poloxue/blog issue-term=pathname theme=github-light crossorigin=anonymous async></script></div></div><div class="footer wrapper"><nav class=nav><div>2024 Polo Xue All rights reserved</div></nav></div><script>feather.replace()</script></body></html>