<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>Vim 小技巧：高效利用 vim 的行号 - POLOXUE's BLOG</title><meta name=viewport content="width=device-width,initial-scale=1"><meta itemprop=name content="Vim 小技巧：高效利用 vim 的行号"><meta itemprop=description content="我们知道，Vim 支持配置是否显示行号，对这个行号认知，我们一般指的是绝对行号。其实 Vim 支持配置两种行号模式：number（绝对行号） 和 relativenumber（相对行号）。
今天，基于 vim 行号介绍一个提升其使用效率的小技巧，混合使用 number 和 relativenumber。
绝对行号 number 绝对行号 number，我们基本都熟悉怎么使用。效果图如下所示：
通过 set number 显示行号。默认开启的话，配置到 Vim 配置文件中即可。
其他命令：
&#34; 显示行号 set nu &#34; set number 的缩写形式 &#34; 隐藏行号 set nonumber &#34; 无缩写 set nonu &#34; 缩写形式 基于行号 number，实现的一些快捷操作，如：
基于行的快速跳转 10G 或 :10，快速跳转到第 10 行； 粘贴指定范围文本 :10,20y 或删除 :10,20d； 替换指定范围文本 :10,20s/hello/world/g； 注：set numberwidth=4 可配置行号所在的列的默认宽度为 4，如果行号数值达到 5 位数，将会自动扩展到 5 位。另外说明，不同于 Vim 的默认值是 2，Neovim 的默认宽度也是 4。
相对行号 relativenumber 在谈相对行号前，其实 Vim 另外一种行间跳转方式：基于相对位置，可使用如 10k 或 10l 向上向下快速跳转，是一种适合在屏幕范围快速跳转的方式。"><meta itemprop=datePublished content="2023-09-25T15:06:02+08:00"><meta itemprop=dateModified content="2023-09-25T15:06:02+08:00"><meta itemprop=wordCount content="242"><meta itemprop=keywords content="vim,neovim,"><meta property="og:title" content="Vim 小技巧：高效利用 vim 的行号"><meta property="og:description" content="我们知道，Vim 支持配置是否显示行号，对这个行号认知，我们一般指的是绝对行号。其实 Vim 支持配置两种行号模式：number（绝对行号） 和 relativenumber（相对行号）。
今天，基于 vim 行号介绍一个提升其使用效率的小技巧，混合使用 number 和 relativenumber。
绝对行号 number 绝对行号 number，我们基本都熟悉怎么使用。效果图如下所示：
通过 set number 显示行号。默认开启的话，配置到 Vim 配置文件中即可。
其他命令：
&#34; 显示行号 set nu &#34; set number 的缩写形式 &#34; 隐藏行号 set nonumber &#34; 无缩写 set nonu &#34; 缩写形式 基于行号 number，实现的一些快捷操作，如：
基于行的快速跳转 10G 或 :10，快速跳转到第 10 行； 粘贴指定范围文本 :10,20y 或删除 :10,20d； 替换指定范围文本 :10,20s/hello/world/g； 注：set numberwidth=4 可配置行号所在的列的默认宽度为 4，如果行号数值达到 5 位数，将会自动扩展到 5 位。另外说明，不同于 Vim 的默认值是 2，Neovim 的默认宽度也是 4。
相对行号 relativenumber 在谈相对行号前，其实 Vim 另外一种行间跳转方式：基于相对位置，可使用如 10k 或 10l 向上向下快速跳转，是一种适合在屏幕范围快速跳转的方式。"><meta property="og:type" content="article"><meta property="og:url" content="https://www.poloxue.com/posts/2023-09-25-vim-tips-how-to-use-number/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-09-25T15:06:02+08:00"><meta property="article:modified_time" content="2023-09-25T15:06:02+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Vim 小技巧：高效利用 vim 的行号"><meta name=twitter:description content="我们知道，Vim 支持配置是否显示行号，对这个行号认知，我们一般指的是绝对行号。其实 Vim 支持配置两种行号模式：number（绝对行号） 和 relativenumber（相对行号）。
今天，基于 vim 行号介绍一个提升其使用效率的小技巧，混合使用 number 和 relativenumber。
绝对行号 number 绝对行号 number，我们基本都熟悉怎么使用。效果图如下所示：
通过 set number 显示行号。默认开启的话，配置到 Vim 配置文件中即可。
其他命令：
&#34; 显示行号 set nu &#34; set number 的缩写形式 &#34; 隐藏行号 set nonumber &#34; 无缩写 set nonu &#34; 缩写形式 基于行号 number，实现的一些快捷操作，如：
基于行的快速跳转 10G 或 :10，快速跳转到第 10 行； 粘贴指定范围文本 :10,20y 或删除 :10,20d； 替换指定范围文本 :10,20s/hello/world/g； 注：set numberwidth=4 可配置行号所在的列的默认宽度为 4，如果行号数值达到 5 位数，将会自动扩展到 5 位。另外说明，不同于 Vim 的默认值是 2，Neovim 的默认宽度也是 4。
相对行号 relativenumber 在谈相对行号前，其实 Vim 另外一种行间跳转方式：基于相对位置，可使用如 10k 或 10l 向上向下快速跳转，是一种适合在屏幕范围快速跳转的方式。"><script data-goatcounter=https://poloxue.goatcounter.com/count async src=//gc.zgo.at/count.js></script>
<link rel=stylesheet type=text/css media=screen href=https://www.poloxue.com/css/normalize.css><link rel=stylesheet type=text/css media=screen href=https://www.poloxue.com/css/main.css><link rel=stylesheet type=text/css media=screen href=https://www.poloxue.com/css/extra.css><link id=dark-scheme rel=stylesheet type=text/css href=https://www.poloxue.com/css/dark.css><script src=https://www.poloxue.com/js/main.js></script></head><body><div class="container wrapper"><div class=header><div class=avatar><a href=https://www.poloxue.com/><img src=/avatar.webp alt="POLOXUE's BLOG"></a></div><h1 class=site-title><a href=https://www.poloxue.com/>POLOXUE's BLOG</a></h1><div class=site-description><nav class="nav social"><ul class=flat></ul></nav></div><nav class=nav><ul class=flat><li><a href=/>HOME</a></li><li><a href=/posts>POSTS</a></li><li><a href=/tags>TAGS</a></li><li><a href=/about/>ABOUT</a></li></ul></nav></div><div class=post><div class=post-header><div class=meta><div class=date><span class=day>25</span>
<span class=rest>Sep 2023</span></div></div><div class=matter><h1 class=title>Vim 小技巧：高效利用 vim 的行号</h1></div></div><p>我们知道，Vim 支持配置是否显示行号，对这个行号认知，我们一般指的是绝对行号。其实 Vim 支持配置两种行号模式：<code>number</code>（绝对行号） 和 <code>relativenumber</code>（相对行号）。</p><p>今天，基于 vim 行号介绍一个提升其使用效率的小技巧，混合使用 number 和 relativenumber。</p><h2 id=绝对行号-number>绝对行号 number</h2><p>绝对行号 <code>number</code>，我们基本都熟悉怎么使用。效果图如下所示：</p><p><img src=https://cdn.jsdelivr.net/gh/poloxue/images@main/2023-09-25-vim-tips-how-to-use-number-02.gif alt></p><p>通过 <code>set number</code> 显示行号。默认开启的话，配置到 Vim 配置文件中即可。</p><p>其他命令：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-vim data-lang=vim><span style=display:flex><span><span style=color:#75715e>&#34; 显示行号</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>set</span> <span style=color:#a6e22e>nu</span> <span style=color:#75715e>&#34; set number 的缩写形式</span>
</span></span><span style=display:flex><span><span style=color:#75715e>&#34; 隐藏行号</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>set</span> <span style=color:#a6e22e>nonumber</span> <span style=color:#75715e>&#34; 无缩写</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>set</span> <span style=color:#a6e22e>nonu</span>     <span style=color:#75715e>&#34; 缩写形式</span>
</span></span></code></pre></div><p>基于行号 <code>number</code>，实现的一些快捷操作，如：</p><ul><li>基于行的快速跳转 <code>10G</code> 或 <code>:10</code>，快速跳转到第 10 行；</li><li>粘贴指定范围文本 <code>:10,20y</code> 或删除 <code>:10,20d</code>；</li><li>替换指定范围文本 <code>:10,20s/hello/world/g</code>；</li></ul><blockquote><p>注：<code>set numberwidth=4</code> 可配置行号所在的列的默认宽度为 4，如果行号数值达到 5 位数，将会自动扩展到 5 位。另外说明，不同于 Vim 的默认值是 2，Neovim 的默认宽度也是 4。</p></blockquote><h2 id=相对行号-relativenumber>相对行号 relativenumber</h2><p>在谈相对行号前，其实 Vim 另外一种行间跳转方式：基于相对位置，可使用如 <code>10k</code> 或 <code>10l</code> 向上向下快速跳转，是一种适合在屏幕范围快速跳转的方式。</p><p>但它缺点是，要数这个相对位置，如上图中，假设要从 <code>vim.o.shiftwidth = true</code> 跳转到 <code>vim.o.autoindent=true</code> ，可使用 <code>:13</code> 或者通过 <code>6l</code>（向下跳转 6 行）实现，第二种方式快速计算相对行号，使用 <code>13-7 = 6</code>，有一个计算过程，并不方便。</p><p>如何解决？</p><p>我们可引入 <code>relativenumber</code>，即相对行号，效果图如下：</p><p><img src=https://cdn.jsdelivr.net/gh/poloxue/images@main/2023-09-25-vim-tips-how-to-use-number-01.gif alt></p><p>当前位置的相对行号是 <code>0</code>，而上下行号以此为基准递增，是动态变化的数值。基于相对行号，就能在通过相对位置跳转到窗口范围内任意一行。</p><p>相关配置命令：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-vim data-lang=vim><span style=display:flex><span><span style=color:#66d9ef>set</span> <span style=color:#a6e22e>rnu</span> <span style=color:#e6db74>&#34; set relativenumber 的缩写形式&#34;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>&#34; 隐藏相对行号</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>set</span> <span style=color:#a6e22e>norelativenumber</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>set</span> <span style=color:#a6e22e>nornu</span> <span style=color:#75715e>&#34; set norelativenumber 的缩写形式</span>
</span></span></code></pre></div><blockquote><p>特别说明：如果 <code>number</code> 和 <code>relativenumber</code> 同时开启的情况下，当前所在行显示绝对行号，而其他行则显示相对行号。</p></blockquote><h2 id=按模式切换>按模式切换</h2><p>有人提出一种将 <code>number</code> 和 <code>relativenumber</code> 结合使用的方式：在 <code>Insert</code> 模式下使用绝对行号，在其他模式下使用相对行号。猜测原因是，相对行号主要还是在非 <code>Insert</code> 模式下使用。</p><p>这样的效果就能同时兼顾 <code>number</code> 和 <code>relativenumber</code>。</p><p>配置 <code>vimrc</code>，语句如下：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-vim data-lang=vim><span style=display:flex><span><span style=color:#a6e22e>augroup</span> <span style=color:#a6e22e>numbertoggle</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>autocmd</span>!
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>autocmd</span> <span style=color:#a6e22e>BufEnter</span>,<span style=color:#a6e22e>FocusGained</span>,<span style=color:#a6e22e>InsertLeave</span>,<span style=color:#a6e22e>WinEnter</span> * <span style=color:#66d9ef>if</span> &amp;<span style=color:#a6e22e>nu</span> &amp;&amp; <span style=color:#a6e22e>mode</span>() != <span style=color:#e6db74>&#34;i&#34;</span> | <span style=color:#66d9ef>set</span> <span style=color:#a6e22e>rnu</span>   | <span style=color:#66d9ef>endif</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>autocmd</span> <span style=color:#a6e22e>BufLeave</span>,<span style=color:#a6e22e>FocusLost</span>,<span style=color:#a6e22e>InsertEnter</span>,<span style=color:#a6e22e>WinLeave</span>   * <span style=color:#66d9ef>if</span> &amp;<span style=color:#a6e22e>nu</span>                  | <span style=color:#66d9ef>set</span> <span style=color:#a6e22e>nornu</span> | <span style=color:#66d9ef>endif</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>augroup</span> <span style=color:#a6e22e>END</span>
</span></span></code></pre></div><p>或者</p><p>如果是 Neovim，引入插件：<a href=https://github.com/sitiom/nvim-numbertoggle>nvim-numbertoggle</a> 亦可。</p><p>简洁的源码，如下所示：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lua data-lang=lua><span style=display:flex><span><span style=color:#66d9ef>local</span> augroup <span style=color:#f92672>=</span> vim.api.nvim_create_augroup(<span style=color:#e6db74>&#34;numbertoggle&#34;</span>, {})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>vim.api.nvim_create_autocmd({ <span style=color:#e6db74>&#34;BufEnter&#34;</span>, <span style=color:#e6db74>&#34;FocusGained&#34;</span>, <span style=color:#e6db74>&#34;InsertLeave&#34;</span>, <span style=color:#e6db74>&#34;CmdlineLeave&#34;</span>, <span style=color:#e6db74>&#34;WinEnter&#34;</span> }, {
</span></span><span style=display:flex><span>   pattern <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;*&#34;</span>,
</span></span><span style=display:flex><span>   group <span style=color:#f92672>=</span> augroup,
</span></span><span style=display:flex><span>   callback <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span>()
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> vim.o.nu <span style=color:#f92672>and</span> vim.api.nvim_get_mode().mode <span style=color:#f92672>~=</span> <span style=color:#e6db74>&#34;i&#34;</span> <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>         vim.opt.relativenumber <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>end</span>,
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>vim.api.nvim_create_autocmd({ <span style=color:#e6db74>&#34;BufLeave&#34;</span>, <span style=color:#e6db74>&#34;FocusLost&#34;</span>, <span style=color:#e6db74>&#34;InsertEnter&#34;</span>, <span style=color:#e6db74>&#34;CmdlineEnter&#34;</span>, <span style=color:#e6db74>&#34;WinLeave&#34;</span> }, {
</span></span><span style=display:flex><span>   pattern <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;*&#34;</span>,
</span></span><span style=display:flex><span>   group <span style=color:#f92672>=</span> augroup,
</span></span><span style=display:flex><span>   callback <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span>()
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> vim.o.nu <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>         vim.opt.relativenumber <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>         vim.cmd <span style=color:#e6db74>&#34;redraw&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>end</span>,
</span></span><span style=display:flex><span>})
</span></span></code></pre></div><p>注意下，这里加了个限制，只有在启动 <code>number</code> 的情况下，才会按模式切换 <code>relativenumber</code>。</p><h2 id=最后>最后</h2><p>实话实说，虽然这方式看起来挺炫酷，但我一直不太习惯。毕竟，窗口范围内，我也可以使用绝对行号。或许是我没有养成良好的习惯。这次决定尝试下，开启这个配置，锻炼下自己的思维和手指。</p><p>博文地址：<a href=https://www.poloxue.com/posts/coder/2023-09-25-vim-tips-how-to-use-number/>Vim 小技巧：高效利用 vim 的行号</a></p><hr class=footer-separator><div class=tags><ul class=flat><li class=tag-li><a href=/tags/vim>vim</a></li><li class=tag-li><a href=/tags/neovim>neovim</a></li></ul></div><div class=back><a href=https://www.poloxue.com/><span aria-hidden=true>← Back</span></a></div><div class=back></div></div><div class=utterances></div><script src=https://utteranc.es/client.js repo=poloxue/blog issue-term=pathname theme=github-light crossorigin=anonymous async></script></div><div class="footer wrapper"><nav class=nav><div>2023 2023 Polo Xue All rights reserved</div></nav></div></body></html>