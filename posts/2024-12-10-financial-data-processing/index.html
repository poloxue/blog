<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>数据清洗与预处理：做好分析的第一步 - POLOXUE's BLOG</title><meta name=viewport content="width=device-width,initial-scale=1"><meta itemprop=name content="数据清洗与预处理：做好分析的第一步"><meta itemprop=description content="今天，就来聊聊数据清洗和预处理，用一个常见的股票行情数据作为例子，走一遍实际的操作。你会发现，这并不是一件多难的事。"><meta itemprop=datePublished content="2024-12-10T13:56:02+08:00"><meta itemprop=dateModified content="2024-12-10T13:56:02+08:00"><meta itemprop=wordCount content="302"><meta itemprop=keywords content><meta property="og:title" content="数据清洗与预处理：做好分析的第一步"><meta property="og:description" content="今天，就来聊聊数据清洗和预处理，用一个常见的股票行情数据作为例子，走一遍实际的操作。你会发现，这并不是一件多难的事。"><meta property="og:type" content="article"><meta property="og:url" content="https://www.poloxue.com/posts/2024-12-10-financial-data-processing/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-12-10T13:56:02+08:00"><meta property="article:modified_time" content="2024-12-10T13:56:02+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="数据清洗与预处理：做好分析的第一步"><meta name=twitter:description content="今天，就来聊聊数据清洗和预处理，用一个常见的股票行情数据作为例子，走一遍实际的操作。你会发现，这并不是一件多难的事。"><script data-goatcounter=https://poloxue.goatcounter.com/count async src=//gc.zgo.at/count.js></script>
<link rel=stylesheet type=text/css media=screen href=https://www.poloxue.com/css/normalize.css><link rel=stylesheet type=text/css media=screen href=https://www.poloxue.com/css/main.css><link rel=stylesheet type=text/css media=screen href=https://www.poloxue.com/css/extra.css><link id=dark-scheme rel=stylesheet type=text/css href=https://www.poloxue.com/css/dark.css><script src=https://www.poloxue.com/js/feather.min.js></script>
<script src=https://www.poloxue.com/js/main.js></script>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7019080091542951" crossorigin=anonymous></script></head><body><div class="container wrapper"><div class=header><div class=avatar><a href=https://www.poloxue.com/><img src=/avatar.png alt="POLOXUE's BLOG"></a></div><h1 class=site-title><a href=https://www.poloxue.com/>POLOXUE's BLOG</a></h1><div class=site-description><nav class="nav social"><ul class=flat><li><a href=https://github.com/poloxue/ title=Github><i data-feather=github></i></a></li><li><a href=/posts/index.xml title=RSS><i data-feather=rss></i></a></li><li><a href=/ title=Wechat><i data-feather=message-circle></i></a></li><span class=scheme-toggle><a href=# id=scheme-toggle></a></ul></nav></div><nav class=nav><ul class=flat><li><a href=/>文章列表</a></li><li><a href=/tags>分类标签</a></li><li><a href=/about/about>关于我</a></li></ul></nav></div><div class=post><div class=post-header><div class=meta><div class=date><span class=day>10</span>
<span class=rest>Dec 2024</span></div></div><div class=matter><h1 class=title>数据清洗与预处理：做好分析的第一步</h1></div></div><p><img src=https://cdn.jsdelivr.net/gh/poloxue/images@2024-12/2024-12-10-financial-data-processing-00.jpeg alt></p><p>在做数据分析或时，有没有碰到过这样的情况：数据明明下载下来了，却发现了一些问题。比如有的数据缺失，有的地方重复了，还有的怎么看都觉得异常。这个时候，你可能会想：“这数据还能用吗？”</p><p>今天，就来聊聊数据清洗和预处理，用一个常见的股票行情数据作为例子，走一遍实际的操作。你会发现，这并不是一件多难的事。</p><hr><h2 id=数据清洗是什么为什么重要>数据清洗是什么？为什么重要？</h2><p>简单来说，数据清洗和预处理就是给你的原始数据“洗澡”，把里面的脏东西都清理干净。我们要检查缺失值、重复值，甚至一些很怪的异常值。为什么要做这件事呢？很简单，因为“垃圾数据”会让分析结果一团糟，俗话说：“垃圾进，垃圾出（Garbage in, garbage out）。”</p><p>如果你不想做了半天无用功，那就得花时间好好清理数据。</p><hr><h2 id=用股票行情数据举个例子>用股票行情数据举个例子</h2><p>假设我们从两个地方下载了同一只股票的每日收盘价数据，分别叫数据集 A 和数据集 B。看起来差不多，但仔细一看就发现问题多了去了：有缺失值、有重复记录，还有价格离谱的异常点。接下来，我们一步步清理。</p><h3 id=处理缺失值><strong>处理缺失值</strong></h3><p>我们发现数据集 A 中有些日期的收盘价是空的。这种情况怎么办呢？有两种简单的办法：</p><ul><li><strong>删掉空行</strong>：如果缺失的数据不多，可以直接删掉。</li><li><strong>填补空缺</strong>：比如用前一天的数据、平均值或者插值。</li></ul><p><strong>示例操作：</strong></p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> pandas <span style=color:#66d9ef>as</span> pd
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> numpy <span style=color:#66d9ef>as</span> np
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 模拟数据</span>
</span></span><span style=display:flex><span>data <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;Date&#39;</span>: [<span style=color:#e6db74>&#39;2024-12-01&#39;</span>, <span style=color:#e6db74>&#39;2024-12-02&#39;</span>, <span style=color:#e6db74>&#39;2024-12-03&#39;</span>, <span style=color:#e6db74>&#39;2024-12-04&#39;</span>],
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;Close Price&#39;</span>: [<span style=color:#ae81ff>100</span>, <span style=color:#ae81ff>101</span>, np<span style=color:#f92672>.</span>nan, <span style=color:#ae81ff>103</span>],
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>df <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>DataFrame(data)
</span></span></code></pre></td></tr></table></div></div><p>我们可以删除缺失值，如下：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>df_cleaned <span style=color:#f92672>=</span> df<span style=color:#f92672>.</span>dropna()
</span></span><span style=display:flex><span>print(df_cleaned)
</span></span></code></pre></td></tr></table></div></div><p>输出：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>   Date  Close Price
</span></span><span style=display:flex><span><span style=color:#ae81ff>0</span>  2024-12-01        100.0
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span>  2024-12-02        101.0
</span></span><span style=display:flex><span><span style=color:#ae81ff>3</span>  2024-12-04        103.0
</span></span></code></pre></td></tr></table></div></div><p>或者用插值法填补缺失值，如下：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>df_filled <span style=color:#f92672>=</span> df<span style=color:#f92672>.</span>interpolate()
</span></span><span style=display:flex><span>print(df_filled)
</span></span></code></pre></td></tr></table></div></div><p>输出：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>   Date  Close Price
</span></span><span style=display:flex><span><span style=color:#ae81ff>0</span>  2024-12-01        100.0
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span>  2024-12-02        101.0
</span></span><span style=display:flex><span><span style=color:#ae81ff>2</span>  2024-12-03        102.0
</span></span><span style=display:flex><span><span style=color:#ae81ff>3</span>  2024-12-04        103.0
</span></span></code></pre></td></tr></table></div></div><blockquote><p><strong>小提示</strong>：如果缺失值太多，可能就要重新找数据源了。</p></blockquote><hr><h3 id=去掉重复数据><strong>去掉重复数据</strong></h3><p>如果我们的数据集中某些日期重复了多次，如同一天的收盘价被记录了两次。重复的数据会导致分析时重复计算，得出的结果可能偏差很大。</p><p>通过如下代码可直接删除重复值：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>data <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;Date&#39;</span>: [<span style=color:#e6db74>&#39;2024-12-01&#39;</span>, <span style=color:#e6db74>&#39;2024-12-01&#39;</span>, <span style=color:#e6db74>&#39;2024-12-02&#39;</span>, <span style=color:#e6db74>&#39;2024-12-03&#39;</span>, <span style=color:#e6db74>&#39;2024-12-04&#39;</span>],
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;Close Price&#39;</span>: [<span style=color:#ae81ff>100</span>, <span style=color:#ae81ff>100</span>, <span style=color:#ae81ff>101</span>, np<span style=color:#f92672>.</span>nan, <span style=color:#ae81ff>103</span>],
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>df <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>DataFrame(data)
</span></span><span style=display:flex><span>df_cleaned <span style=color:#f92672>=</span> df<span style=color:#f92672>.</span>drop_duplicates()
</span></span><span style=display:flex><span>print(df_cleaned)
</span></span></code></pre></td></tr></table></div></div><p>输出：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#ae81ff>0</span>  2024-12-01        100.0
</span></span><span style=display:flex><span><span style=color:#ae81ff>2</span>  2024-12-02        101.0
</span></span><span style=display:flex><span><span style=color:#ae81ff>3</span>  2024-12-03          NaN
</span></span><span style=display:flex><span><span style=color:#ae81ff>4</span>  2024-12-04        103.0
</span></span></code></pre></td></tr></table></div></div><hr><h3 id=检测异常值><strong>检测异常值</strong></h3><p>如果某一天的价格突然跳到 500，而前一天才 100，这怎么看都不正常。我们可以通过检测价格的变化幅度来发现这些异常点。比如，如果价格波动超过 50%，就需要进一步检查。</p><p><strong>示例操作：</strong></p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>data <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;Date&#39;</span>: [<span style=color:#e6db74>&#39;2024-12-01&#39;</span>, <span style=color:#e6db74>&#39;2024-12-02&#39;</span>, <span style=color:#e6db74>&#39;2024-12-03&#39;</span>, <span style=color:#e6db74>&#39;2024-12-04&#39;</span>],
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;Close Price&#39;</span>: [<span style=color:#ae81ff>100</span>, <span style=color:#ae81ff>101</span>, <span style=color:#ae81ff>500</span>, <span style=color:#ae81ff>103</span>], <span style=color:#75715e># 500 是异常值</span>
</span></span><span style=display:flex><span>}  
</span></span><span style=display:flex><span>df <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>DataFrame(data)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 检测价格波动是否异常</span>
</span></span><span style=display:flex><span>df[<span style=color:#e6db74>&#39;Pct Change&#39;</span>] <span style=color:#f92672>=</span> df[<span style=color:#e6db74>&#39;Close Price&#39;</span>]<span style=color:#f92672>.</span>pct_change()
</span></span><span style=display:flex><span>df[<span style=color:#e6db74>&#39;Anomaly&#39;</span>] <span style=color:#f92672>=</span> df[<span style=color:#e6db74>&#39;Pct Change&#39;</span>]<span style=color:#f92672>.</span>abs() <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0.5</span>
</span></span><span style=display:flex><span>print(df[df[<span style=color:#e6db74>&#39;Anomaly&#39;</span>]])  <span style=color:#75715e># 打印异常值</span>
</span></span></code></pre></td></tr></table></div></div><p>输出：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>   Date  Close Price  Pct Change  Anomaly
</span></span><span style=display:flex><span><span style=color:#ae81ff>2</span>  2024-12-03          <span style=color:#ae81ff>500</span>    3.950495     True
</span></span><span style=display:flex><span><span style=color:#ae81ff>3</span>  2024-12-04          <span style=color:#ae81ff>103</span>   -0.794000     True
</span></span></code></pre></td></tr></table></div></div><blockquote><p><strong>解决方法</strong>：如果确定是录入错误，可以用前一天的价格或者移动平均值替代。</p></blockquote><hr><h3 id=检查日期是否正确><strong>检查日期是否正确</strong></h3><p>股票市场一般只在工作日交易，周末和节假日是不会有数据的。所以我们需要检查数据中是否有周末的记录，或者日期格式是否一致。</p><p><strong>示例操作：</strong></p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># 转换日期格式并检查周末数据</span>
</span></span><span style=display:flex><span>df[<span style=color:#e6db74>&#39;Date&#39;</span>] <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>to_datetime(df[<span style=color:#e6db74>&#39;Date&#39;</span>])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 检查是否有周末数据</span>
</span></span><span style=display:flex><span>df[<span style=color:#e6db74>&#39;Weekday&#39;</span>] <span style=color:#f92672>=</span> df[<span style=color:#e6db74>&#39;Date&#39;</span>]<span style=color:#f92672>.</span>dt<span style=color:#f92672>.</span>weekday
</span></span><span style=display:flex><span>print(df[df[<span style=color:#e6db74>&#39;Weekday&#39;</span>] <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>5</span>])  <span style=color:#75715e># 打印周末数据</span>
</span></span></code></pre></td></tr></table></div></div><hr><h4 id=可视化检查><strong>可视化检查</strong></h4><p>如果你不确定哪里出了问题，可以试着把数据画成图表，这样异常点一眼就能看出来。比如我们可以绘制收盘价随时间的变化趋势。</p><p><strong>示例操作：</strong></p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> matplotlib.pyplot <span style=color:#66d9ef>as</span> plt
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 绘制收盘价趋势图</span>
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>plot(df[<span style=color:#e6db74>&#39;Date&#39;</span>], df[<span style=color:#e6db74>&#39;Close Price&#39;</span>], marker<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;o&#39;</span>)
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>title(<span style=color:#e6db74>&#39;Stock Closing Prices Over Time&#39;</span>)
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>xlabel(<span style=color:#e6db74>&#39;Date&#39;</span>)
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>ylabel(<span style=color:#e6db74>&#39;Close Price&#39;</span>)
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>show()
</span></span></code></pre></td></tr></table></div></div><hr><h3 id=数据清洗的几点建议>数据清洗的几点建议</h3><p><strong>从最基本的检查开始</strong></p><ul><li>查找缺失值、重复值和格式问题。</li><li>确保日期、单位等字段一致。</li></ul><p><strong>借助可视化工具</strong></p><ul><li>用图表直观地查看数据，快速发现问题。</li></ul><p><strong>多数据源验证</strong></p><ul><li>如果一个数据源问题太多，可以参考其他数据源交叉验证。</li></ul><p><strong>记得定期更新数据</strong></p><ul><li>金融数据尤其如此，时效性很重要。</li></ul><hr><h3 id=总结>总结</h3><p>清洗数据就像是搭建房子的地基，虽然不是最吸引人的部分，但却是最重要的环节之一。通过处理缺失值、去掉重复数据、检测异常值等步骤，我们可以确保数据的准确性和可靠性。</p><p>希望通过今天的案例，你能对数据清洗有更清晰的认识。下次拿到数据的时候，不妨试试这些方法，帮你打好分析的基础。</p><div>本文来源于 <a href=https://www.poloxue.com>POLOXUE's BLOG</a>，地址： <a href=https://www.poloxue.com/posts/2024-12-10-financial-data-processing/>数据清洗与预处理：做好分析的第一步</a><hr class=footer-separator><div class=tags></div><div class=back><a href=https://www.poloxue.com/><span aria-hidden=true>← Back</span></a></div><div class=back></div></div><div class=post>欢迎关注我的公众号：<img style=width:85% src=https://cdn.jsdelivr.net/gh/poloxue/images@main/wechat.png><div class=utterances></div><script src=https://utteranc.es/client.js repo=poloxue/blog issue-term=pathname theme=github-light crossorigin=anonymous async></script></div></div><div class="footer wrapper"><nav class=nav><div>2024 Polo Xue All rights reserved</div></nav></div><script>feather.replace()</script></body></html>