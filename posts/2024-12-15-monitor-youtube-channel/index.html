<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>效率神器：用 Python 监控油管频道，AI 生成文章 - POLOXUE's BLOG</title><meta name=viewport content="width=device-width,initial-scale=1"><meta itemprop=name content="效率神器：用 Python 监控油管频道，AI 生成文章"><meta itemprop=description content="油管是许多人获取专业知识和行业资讯的渠道，里面有很多有价值的信息。对于想深入学习的内容，我们肯定要看完整个视频，而如果你关注的是一些资讯分析类频道，要跟进热点信息，比如我平时关注一些财经币圈的相关的内容和资讯，花时间看完每个视频的效率并不高。还有，油管上有不少高质量的英文视频，看起来有点吃力，将其转为中文文章，理解起来更加容易。"><meta itemprop=datePublished content="2024-12-15T17:17:48+08:00"><meta itemprop=dateModified content="2024-12-15T17:17:48+08:00"><meta itemprop=wordCount content="599"><meta itemprop=keywords content><meta property="og:title" content="效率神器：用 Python 监控油管频道，AI 生成文章"><meta property="og:description" content="油管是许多人获取专业知识和行业资讯的渠道，里面有很多有价值的信息。对于想深入学习的内容，我们肯定要看完整个视频，而如果你关注的是一些资讯分析类频道，要跟进热点信息，比如我平时关注一些财经币圈的相关的内容和资讯，花时间看完每个视频的效率并不高。还有，油管上有不少高质量的英文视频，看起来有点吃力，将其转为中文文章，理解起来更加容易。"><meta property="og:type" content="article"><meta property="og:url" content="https://www.poloxue.com/posts/2024-12-15-monitor-youtube-channel/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-12-15T17:17:48+08:00"><meta property="article:modified_time" content="2024-12-15T17:17:48+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="效率神器：用 Python 监控油管频道，AI 生成文章"><meta name=twitter:description content="油管是许多人获取专业知识和行业资讯的渠道，里面有很多有价值的信息。对于想深入学习的内容，我们肯定要看完整个视频，而如果你关注的是一些资讯分析类频道，要跟进热点信息，比如我平时关注一些财经币圈的相关的内容和资讯，花时间看完每个视频的效率并不高。还有，油管上有不少高质量的英文视频，看起来有点吃力，将其转为中文文章，理解起来更加容易。"><script data-goatcounter=https://poloxue.goatcounter.com/count async src=//gc.zgo.at/count.js></script>
<link rel=stylesheet type=text/css media=screen href=https://www.poloxue.com/css/normalize.css><link rel=stylesheet type=text/css media=screen href=https://www.poloxue.com/css/main.css><link rel=stylesheet type=text/css media=screen href=https://www.poloxue.com/css/extra.css><link id=dark-scheme rel=stylesheet type=text/css href=https://www.poloxue.com/css/dark.css><script src=https://www.poloxue.com/js/feather.min.js></script>
<script src=https://www.poloxue.com/js/main.js></script>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7019080091542951" crossorigin=anonymous></script></head><body><div class="container-wide wrapper"><div class=header><div class=avatar><a href=https://www.poloxue.com/><img src=/avatar.png alt="POLOXUE's BLOG"></a></div><h1 class=site-title><a href=https://www.poloxue.com/>POLOXUE's BLOG</a></h1><div class=site-description><nav class="nav social"><ul class=flat><li><a href=https://github.com/poloxue/ title=Github><i data-feather=github></i></a></li><li><a href=/posts/index.xml title=RSS><i data-feather=rss></i></a></li><li><a href=/ title=Wechat><i data-feather=message-circle></i></a></li><span class=scheme-toggle><a href=# id=scheme-toggle></a></ul></nav></div><nav class=nav><ul class=flat><li><a href=/>首页</a></li><li><a href=/posts>文章列表</a></li><li><a href=/tags>分类标签</a></li><li><a href=/about/>关于我</a></li></ul></nav></div><div class=article-nav id=article-nav-id><div class=post><div class=post-header><div class=meta><div class=date><span class=day>15</span>
<span class=rest>Dec 2024</span></div></div><div class=matter><h1 class=title>效率神器：用 Python 监控油管频道，AI 生成文章</h1></div></div><aside class="show-on-mobile toc" id=static-toc><header><h3>Contents</h3></header><nav id=TableOfContents><ol><li><a href=#目标是什么><strong>目标是什么？</strong></a></li><li><a href=#用到哪些工具><strong>用到哪些工具？</strong></a></li><li><a href=#监控油管频道><strong>监控油管频道</strong></a></li><li><a href=#下载音频文件><strong>下载音频文件</strong></a></li><li><a href=#openai-whisper-提取字幕><strong>OpenAI Whisper 提取字幕</strong></a></li><li><a href=#生成文章><strong>生成文章</strong></a></li><li><a href=#注意点>注意点</a></li><li><a href=#总结><strong>总结</strong></a></li></ol></nav></aside><p>油管是许多人获取专业知识和行业资讯的渠道，里面有很多有价值的信息。对于想深入学习的内容，我们肯定要看完整个视频，而如果你关注的是一些资讯分析类频道，要跟进热点信息，比如我平时会看一些与财经和币圈的资讯分析的相关内容，花时间看完每个视频的效率并不高。还有，油管上有不少高质量的英文视频，看起来有点吃力，将其转为中文文章，理解起来更加容易。</p><p>现在市面上有没有这样的工具呢？</p><p>我知道有些 AI 工具，进到视频播放页面，用这些 AI 工具可以分析总结，但我很赖，压根不想去到某个频道查看它是否有新视频更新。我没有找到这类监听某个频道的分析推送的，或许即使有，费用应该也不低吧。</p><p>这篇文章我将实现这样一个小工具，它能监控我指定的某个频道，还能把监控到最新视频内容提取成文章，用邮件推送给我们。我将用 Python 完成这一系列工作。</p><hr><h2 id=目标是什么><strong>目标是什么？</strong></h2><p>先把目标明确下来，这个工具要实现以下功能：</p><ol><li><strong>频道检测</strong>：检查感兴趣油管频道是否有新的视频发布；</li><li><strong>下载音频</strong>：检测到新视频后，只下载它的音频部分，节省存储空间；</li><li><strong>提取字幕</strong>：提取音频内容中的文字；</li><li><strong>生成文章</strong>：将提取的字幕整理为通俗易懂的文章；</li></ol><p>这样，我就不需要逐个观看每个视频，而是直接阅读整理后的文章。</p><hr><h2 id=用到哪些工具><strong>用到哪些工具？</strong></h2><p>为了实现上述的目标，我们还需要几个重要的 Python 库：</p><ol><li><strong>yt-dlp</strong>：一个强大的 YouTube 下载工具，可以获取视频元数据或音频；</li><li><strong>Whisper</strong>：OpenAI 的音频转文字模型，用于从音频中提取字幕文字；</li><li><strong>OpenAI</strong>：用来调用 OpenAI 的接口，将识别出来的字幕转换为通俗易懂的文章；</li></ol><p>如下命令安装依赖包：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pip install yt-dlp openai-whisper openai
</span></span></code></pre></td></tr></table></div></div><hr><p>开始具体的实现吧！我将按步骤进行。</p><h2 id=监控油管频道><strong>监控油管频道</strong></h2><p>油管频道页面会列出了最新发布的视频，通过 <code>yt-dlp</code> 工具来抓取这些信息。</p><p>代码示例：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> click
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> yt_dlp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>fetch_latest_videos</span>(channel_url, fetch_count<span style=color:#f92672>=</span><span style=color:#ae81ff>5</span>):
</span></span><span style=display:flex><span>  ydl_opts <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;quiet&#34;</span>: <span style=color:#66d9ef>True</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;extract_flat&#34;</span>: <span style=color:#e6db74>&#34;in_playlist&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;playlist_items&#34;</span>: <span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;1-</span><span style=color:#e6db74>{</span>fetch_count<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>,
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>with</span> yt_dlp<span style=color:#f92672>.</span>YoutubeDL(ydl_opts) <span style=color:#66d9ef>as</span> ydl:
</span></span><span style=display:flex><span>    info <span style=color:#f92672>=</span> ydl<span style=color:#f92672>.</span>extract_info(channel_url, download<span style=color:#f92672>=</span><span style=color:#66d9ef>False</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> [{<span style=color:#e6db74>&#34;title&#34;</span>: entry[<span style=color:#e6db74>&#34;title&#34;</span>], <span style=color:#e6db74>&#34;url&#34;</span>: entry[<span style=color:#e6db74>&#34;url&#34;</span>]} <span style=color:#66d9ef>for</span> entry <span style=color:#f92672>in</span> info[<span style=color:#e6db74>&#34;entries&#34;</span>]]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@click.command</span>()
</span></span><span style=display:flex><span><span style=color:#a6e22e>@click.option</span>(<span style=color:#e6db74>&#34;--channel-url&#34;</span>, type<span style=color:#f92672>=</span>click<span style=color:#f92672>.</span>STRING, help<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Channel URL&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>@click.option</span>(<span style=color:#e6db74>&#34;--count&#34;</span>, default<span style=color:#f92672>=</span><span style=color:#ae81ff>5</span>, type<span style=color:#f92672>=</span>click<span style=color:#f92672>.</span>INT, help<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Video Count&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>main</span>(channel_url, count):
</span></span><span style=display:flex><span>  videos <span style=color:#f92672>=</span> fetch_latest_videos(channel_url, count)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>for</span> video <span style=color:#f92672>in</span> videos:
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;title:</span><span style=color:#e6db74>{</span>video[<span style=color:#e6db74>&#34;title&#34;</span>]<span style=color:#e6db74>}</span><span style=color:#e6db74>, url: </span><span style=color:#e6db74>{</span>video[<span style=color:#e6db74>&#34;url&#34;</span>]<span style=color:#e6db74>}</span><span style=color:#e6db74>&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;__main__&#34;</span>:
</span></span><span style=display:flex><span>  main()
</span></span></code></pre></td></tr></table></div></div><p>执行如下命令监听某个频道：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>python index.py --channel-url https://www.youtube.com/@CoinBureau/videos
</span></span></code></pre></td></tr></table></div></div><p>输出最新的 5 个视频：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>title:Wall Street Elites Are Going To Pump Crypto: Find Out Who!!, url: https://www.youtube.com/watch?v<span style=color:#f92672>=</span>WQCCwC2-Wkw
</span></span><span style=display:flex><span>title:Is Trump Media The Next MicroStrategy!? TruthFi, Bakkt, &amp; More!!, url: https://www.youtube.com/watch?v<span style=color:#f92672>=</span>c2-Gf473kmQ
</span></span><span style=display:flex><span>title:APT to 10x?! Aptos Updates &amp; Predictions You CANT Miss!!, url: https://www.youtube.com/watch?v<span style=color:#f92672>=</span>n39P_F6Cx58
</span></span><span style=display:flex><span>title:Why Europe Is Falling Apart—and What It Means <span style=color:#66d9ef>for</span> YOU, url: https://www.youtube.com/watch?v<span style=color:#f92672>=</span>qB2QaYXXoBo
</span></span><span style=display:flex><span>title:Crypto’s Dark Secret Exposed: Why 75% of Investors FAIL!, url: https://www.youtube.com/watch?v<span style=color:#f92672>=</span>-ZNXm3nX3zM
</span></span></code></pre></td></tr></table></div></div><p>上面这段代码会提取频道最新的视频列表，包括标题和链接。我们只提取元信息，并不下载视频内容。其中的 <code>fetch_count</code> 是用来指定获取最新视频的数量。</p><hr><h2 id=下载音频文件><strong>下载音频文件</strong></h2><p>有了视频链接后，我们用 <code>yt-dlp</code> 只下载音频文件，这样节省空间，简单高效。</p><p>示例代码：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>download_audio</span>(video_url, output_dir):
</span></span><span style=display:flex><span>  ydl_opts <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;format&#34;</span>: <span style=color:#e6db74>&#34;bestaudio/best&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;postprocessors&#34;</span>: [
</span></span><span style=display:flex><span>      {
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;key&#34;</span>: <span style=color:#e6db74>&#34;FFmpegExtractAudio&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;preferredcodec&#34;</span>: <span style=color:#e6db74>&#34;mp3&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;preferredquality&#34;</span>: <span style=color:#e6db74>&#34;192&#34;</span>,
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    ],
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;outtmpl&#34;</span>: <span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{</span>output_dir<span style=color:#e6db74>}</span><span style=color:#e6db74>/%(id)s/audio.%(ext)s&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;download_archive&#34;</span>: <span style=color:#e6db74>&#34;downloaded_videos.txt&#34;</span>, <span style=color:#75715e># 防止重新下载</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>with</span> yt_dlp<span style=color:#f92672>.</span>YoutubeDL(ydl_opts) <span style=color:#66d9ef>as</span> ydl:
</span></span><span style=display:flex><span>    info_dict <span style=color:#f92672>=</span> ydl<span style=color:#f92672>.</span>extract_info(video_url, download<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> info_dict <span style=color:#f92672>is</span> <span style=color:#f92672>not</span> <span style=color:#66d9ef>None</span> <span style=color:#f92672>and</span> <span style=color:#e6db74>&#34;requested_downloads&#34;</span> <span style=color:#f92672>in</span> info_dict:
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> info_dict[<span style=color:#e6db74>&#34;title&#34;</span>], info_dict[<span style=color:#e6db74>&#34;requested_downloads&#34;</span>][<span style=color:#ae81ff>0</span>][<span style=color:#e6db74>&#34;filepath&#34;</span>]
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> <span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{</span>output_dir<span style=color:#e6db74>}</span><span style=color:#e6db74>/</span><span style=color:#e6db74>{</span>video_url<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#39;v=&#39;</span>)[<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>]<span style=color:#e6db74>}</span><span style=color:#e6db74>/audio.mp3&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>这个函数的功能包括：</p><ul><li>实现音频部分的下载，将下载文件统一转换为 MP3 格式；</li><li>输出文件会保存在指定目录中，目录名为为视频 ID；</li><li>下载函数的返回值为下载音频的文件路径；</li></ul><p>将这部分功能合并到主函数中。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#a6e22e>@click.command</span>()
</span></span><span style=display:flex><span><span style=color:#a6e22e>@click.option</span>(<span style=color:#e6db74>&#34;--channel-url&#34;</span>, type<span style=color:#f92672>=</span>click<span style=color:#f92672>.</span>STRING, help<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Channel URL&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>@click.option</span>(<span style=color:#e6db74>&#34;--count&#34;</span>, default<span style=color:#f92672>=</span><span style=color:#ae81ff>5</span>, type<span style=color:#f92672>=</span>click<span style=color:#f92672>.</span>INT, help<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Video Count&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>@click.option</span>(<span style=color:#e6db74>&#34;--output-dir&#34;</span>, default<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;.&#34;</span>, type<span style=color:#f92672>=</span>CLICK<span style=color:#f92672>.</span>STRING, help<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Output Directory&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>main</span>(channel_url, count, output_dir):
</span></span><span style=display:flex><span>  videos <span style=color:#f92672>=</span> fetch_latest_videos(channel_url, count)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>for</span> video <span style=color:#f92672>in</span> videos:
</span></span><span style=display:flex><span>    download_audio(video[<span style=color:#e6db74>&#34;url&#34;</span>], output_dir<span style=color:#f92672>=</span>output_dir)
</span></span></code></pre></td></tr></table></div></div><p>再次执行脚本就可以下载你指定频道的音频文件了。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ python index.py --channel-url https://www.youtube.com/@CoinBureau/videos
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=openai-whisper-提取字幕><strong>OpenAI Whisper 提取字幕</strong></h2><p>把视频文件下载下来后，通过 OpenAI 的 Whisper 模型，就可以将音频内容转化为文本字幕，whisper 的使用很简单。</p><p>代码示例：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> os
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> whisper
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>transcribe_audio</span>(audio_path):
</span></span><span style=display:flex><span>  subtitle_path <span style=color:#f92672>=</span> audio_path<span style=color:#f92672>.</span>replace(<span style=color:#e6db74>&#34;audio.mp3&#34;</span>, <span style=color:#e6db74>&#34;subtitles.txt&#34;</span>)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>exists(subtitle_path):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>with</span> open(subtitle_path) <span style=color:#66d9ef>as</span> fd:
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> fd<span style=color:#f92672>.</span>read()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    model <span style=color:#f92672>=</span> whisper<span style=color:#f92672>.</span>load_model(<span style=color:#e6db74>&#34;base&#34;</span>)
</span></span><span style=display:flex><span>    result <span style=color:#f92672>=</span> model<span style=color:#f92672>.</span>transcribe(audio_path)
</span></span><span style=display:flex><span>    subtitles <span style=color:#f92672>=</span> result[<span style=color:#e6db74>&#34;text&#34;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>with</span> open(subtitle_path, <span style=color:#e6db74>&#34;w+&#34;</span>) <span style=color:#66d9ef>as</span> fd:
</span></span><span style=display:flex><span>      fd<span style=color:#f92672>.</span>write(subtitles)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> subtitles
</span></span></code></pre></td></tr></table></div></div><p>我们使用 Whisper 的 base 模型识别音频内容，它的返回 <code>result[text]</code> 就是我们要的完整的字幕文本。上面的代码为了防止重复识别，加了去重判断逻辑，如果已识别字幕，直接访问文字即可。</p><p>将这部分合并到主函数流程中，如下：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>main</span>(channel_url, count, output_dir):
</span></span><span style=display:flex><span>    videos <span style=color:#f92672>=</span> fetch_latest_videos(channel_url, count)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> video <span style=color:#f92672>in</span> videos:
</span></span><span style=display:flex><span>        audio_path <span style=color:#f92672>=</span> download_audio(video[<span style=color:#e6db74>&#34;url&#34;</span>], output_dir<span style=color:#f92672>=</span>output_dir)
</span></span><span style=display:flex><span>        subtitles <span style=color:#f92672>=</span> transcribe_audio(audio_path)
</span></span><span style=display:flex><span>        print(subtitles)
</span></span></code></pre></td></tr></table></div></div><p>如果你是首次使用 whisper 识别音频文字，它会下载模型文件，大小视你使用的模型。</p><hr><h2 id=生成文章><strong>生成文章</strong></h2><p>有了字幕，现在就可以借助 GPT 模型将器整理成逻辑清晰、易于阅读的文章。</p><p>代码示例：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> openai
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ai_client <span style=color:#f92672>=</span> openai<span style=color:#f92672>.</span>OpenAI()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>generate_article</span>(audio_path, subtitles, title, video_url):
</span></span><span style=display:flex><span>    article_path <span style=color:#f92672>=</span> audio_path<span style=color:#f92672>.</span>replace(<span style=color:#e6db74>&#34;audio.mp3&#34;</span>, <span style=color:#e6db74>&#34;article.md&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>exists(article_path):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>with</span> open(article_path) <span style=color:#66d9ef>as</span> fd:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> fd<span style=color:#f92672>.</span>read()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    response <span style=color:#f92672>=</span> ai_client<span style=color:#f92672>.</span>chat<span style=color:#f92672>.</span>completions<span style=color:#f92672>.</span>create(
</span></span><span style=display:flex><span>        model<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;gpt-4o&#34;</span>,
</span></span><span style=display:flex><span>        messages<span style=color:#f92672>=</span>[
</span></span><span style=display:flex><span>            {<span style=color:#e6db74>&#34;role&#34;</span>: <span style=color:#e6db74>&#34;system&#34;</span>, <span style=color:#e6db74>&#34;content&#34;</span>: <span style=color:#e6db74>&#34;You are a helpful assistant.&#34;</span>},
</span></span><span style=display:flex><span>            {
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;role&#34;</span>: <span style=color:#e6db74>&#34;user&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;content&#34;</span>: <span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;以下是视频的字幕内容：</span><span style=color:#ae81ff>\n\n</span><span style=color:#e6db74>{</span>subtitles<span style=color:#e6db74>}</span><span style=color:#ae81ff>\n\n</span><span style=color:#e6db74>请根据这些字幕生成一篇文章，原始主题是：</span><span style=color:#e6db74>{</span>title<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>,
</span></span><span style=display:flex><span>            },
</span></span><span style=display:flex><span>        ],
</span></span><span style=display:flex><span>        temperature<span style=color:#f92672>=</span><span style=color:#ae81ff>0.7</span>,
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>    article <span style=color:#f92672>=</span> response<span style=color:#f92672>.</span>choices[<span style=color:#ae81ff>0</span>]<span style=color:#f92672>.</span>message<span style=color:#f92672>.</span>content
</span></span><span style=display:flex><span>    article <span style=color:#f92672>=</span> <span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;来源：[</span><span style=color:#e6db74>{</span>title<span style=color:#e6db74>}</span><span style=color:#e6db74>](</span><span style=color:#e6db74>{</span>video_url<span style=color:#e6db74>}</span><span style=color:#e6db74>)</span><span style=color:#ae81ff>\n\n</span><span style=color:#e6db74>{</span>article<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>with</span> open(article_path, <span style=color:#e6db74>&#34;w+&#34;</span>) <span style=color:#66d9ef>as</span> fd:
</span></span><span style=display:flex><span>        fd<span style=color:#f92672>.</span>write(article)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> article
</span></span></code></pre></td></tr></table></div></div><p>将字幕内容和提示词交易 gpt 模型，最终就能得到我们心心念念的最终结果。</p><p>将这段逻辑加到主函数，如下：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#a6e22e>@click.command</span>()
</span></span><span style=display:flex><span><span style=color:#a6e22e>@click.option</span>(<span style=color:#e6db74>&#34;--channel-url&#34;</span>, type<span style=color:#f92672>=</span>click<span style=color:#f92672>.</span>STRING, help<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Channel URL&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>@click.option</span>(<span style=color:#e6db74>&#34;--count&#34;</span>, default<span style=color:#f92672>=</span><span style=color:#ae81ff>5</span>, type<span style=color:#f92672>=</span>click<span style=color:#f92672>.</span>INT, help<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Video Count&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>@click.option</span>(<span style=color:#e6db74>&#34;--output-dir&#34;</span>, default<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;.&#34;</span>, type<span style=color:#f92672>=</span>click<span style=color:#f92672>.</span>STRING, help<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Output Directory&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>main</span>(channel_url, count, output_dir):
</span></span><span style=display:flex><span>    videos <span style=color:#f92672>=</span> fetch_latest_videos(channel_url, count)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> video <span style=color:#f92672>in</span> videos:
</span></span><span style=display:flex><span>        audio_path <span style=color:#f92672>=</span> download_audio(video[<span style=color:#e6db74>&#34;url&#34;</span>], output_dir<span style=color:#f92672>=</span>output_dir)
</span></span><span style=display:flex><span>        subtitles <span style=color:#f92672>=</span> transcribe_audio(audio_path)
</span></span><span style=display:flex><span>        article <span style=color:#f92672>=</span> generate_article(audio_path, subtitles, video[<span style=color:#e6db74>&#34;title&#34;</span>], video[<span style=color:#e6db74>&#34;url&#34;</span>])
</span></span><span style=display:flex><span>        print(article)
</span></span></code></pre></td></tr></table></div></div><p>最核心的部分全部完成了。</p><h2 id=注意点>注意点</h2><ul><li>openai 是要 APIKEY 的，我已经设置了环境变量，关于 openai 权限，需要各位自己想办法。</li><li>如果字幕太大，openai 没有办法直接处理，可以考虑切分字幕，或将直接丢弃，转化太大的视频太浪费钱了。</li><li>以什么形式将文章推送给你，可以是邮件或其他形式，每个人的场景不一定相同。</li><li>定时触发的能力，我们可以用 crontab 或者 python 的 schedule 库实现，</li><li>自动生成的文章可能存在一拼写错误，这是由于字幕识别导致的，不过不影响我们阅读；</li></ul><hr><h2 id=总结><strong>总结</strong></h2><p>一个简单小工具就实现对 YouTube 频道的自动监控，快速获取视频字幕并生成结构化中文文章，减少不必要的时间浪费，从而提升我们信息获取的效率。</p><p>我要做个赖人。</p></div><nav class="hide-on-mobile section-nav"><nav id=TableOfContents><ol><li><a href=#目标是什么><strong>目标是什么？</strong></a></li><li><a href=#用到哪些工具><strong>用到哪些工具？</strong></a></li><li><a href=#监控油管频道><strong>监控油管频道</strong></a></li><li><a href=#下载音频文件><strong>下载音频文件</strong></a></li><li><a href=#openai-whisper-提取字幕><strong>OpenAI Whisper 提取字幕</strong></a></li><li><a href=#生成文章><strong>生成文章</strong></a></li><li><a href=#注意点>注意点</a></li><li><a href=#总结><strong>总结</strong></a></li></ol></nav></nav></div><div class=post><hr class=footer-separator><div class=tags></div><div class=back><a href=https://www.poloxue.com/><span aria-hidden=true>← Back</span></a></div><div class=back></div></div><div class=post><img style=width:85% src=https://cdn.jsdelivr.net/gh/poloxue/images@main/wechat.png><div class=utterances></div><script src=https://utteranc.es/client.js repo=poloxue/blog issue-term=pathname theme=github-light crossorigin=anonymous async></script></div></div><div class="footer wrapper"><nav class=nav><div>2024 Polo Xue All rights reserved</div></nav></div><script>feather.replace()</script><script>var enableTruncate=!0,filterDepth=!1;const MAX_DEPTH=9;window.addEventListener("DOMContentLoaded",()=>{const e=new IntersectionObserver(e=>{e.reverse().forEach(e=>{const n=e.target.getAttribute("id");if(e.intersectionRatio>0){var t=document.querySelectorAll(`nav li a[href="#${n}"]`);t!=null&&t.forEach(e=>{if(e!=null){var t=getDepth(e.parentElement);filterDepth&&t<=MAX_DEPTH&&(clearActiveStatesInTableOfContents(),e.parentElement.classList.add("active"))}else filterDepth||(clearActiveStatesInTableOfContents(),e.parentElement.classList.add("active"))})}})});document.querySelectorAll("h1[id],h2[id],h3[id],h4[id]").forEach(t=>{e.observe(t)})});function isVisible(e){if(!(e instanceof Element))return!1;const n=getComputedStyle(e);if(n.display==="none")return!1;if(n.visibility!=="visible")return!1;if(n.opacity<.1)return!1;if(e.offsetWidth+e.offsetHeight+e.getBoundingClientRect().height+e.getBoundingClientRect().width===0)return!1;const t={x:e.getBoundingClientRect().left+e.offsetWidth/2,y:e.getBoundingClientRect().top+e.offsetHeight/2};if(t.x<0)return!1;if(t.x>(document.documentElement.clientWidth||window.innerWidth))return!1;if(t.y<0)return!1;if(t.y>(document.documentElement.clientHeight||window.innerHeight))return!1;let s=document.elementFromPoint(t.x,t.y);do if(s===e)return!0;while(s=s.parentNode)return!1}function clearActiveStatesInTableOfContents(){document.querySelectorAll("nav li").forEach(e=>{e.classList.remove("active")})}function getDepth(e){for(var t=0;e!==null&&e.tagName.toLowerCase()!=="ul";)t++,e=e.parentElement;return t}function navItems(){var e=document.querySelectorAll("nav nav li a");return Array.from(e).filter(e=>e.href!=null&&e.hash.startsWith("#"))}function lasItemInNavBarVisible(){var e=navItems().slice(-1)[0];return isVisible(e)}document.addEventListener("DOMContentLoaded",function(){if(!enableTruncate)return;var e=navItems();console.log(e),lasItemInNavBarVisible()||(filterDepth=!0,e.forEach(function(e){var t=getDepth(e.parentElement);t>MAX_DEPTH&&e.parentElement.classList.add("depth-nested")}))})</script></body></html>